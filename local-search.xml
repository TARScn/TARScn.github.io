<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>é¢ç»-python</title>
    <link href="/2026/01/02/%E9%9D%A2%E7%BB%8F-python/"/>
    <url>/2026/01/02/%E9%9D%A2%E7%BB%8F-python/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="Python-å¤šçº¿ç¨‹åŸç†è§£æ"><a href="#Python-å¤šçº¿ç¨‹åŸç†è§£æ" class="headerlink" title="Python å¤šçº¿ç¨‹åŸç†è§£æ"></a>Python å¤šçº¿ç¨‹åŸç†è§£æ</h1><h2 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</h2><p>çº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯<strong>æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½</strong>ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œ<strong>ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡</strong>ã€‚</p><h2 id="2-Python-ä¸­çš„-GIL-å…¨å±€è§£é‡Šå™¨é”"><a href="#2-Python-ä¸­çš„-GIL-å…¨å±€è§£é‡Šå™¨é”" class="headerlink" title="2. Python ä¸­çš„ GIL (å…¨å±€è§£é‡Šå™¨é”)"></a>2. Python ä¸­çš„ GIL (å…¨å±€è§£é‡Šå™¨é”)</h2><p>åœ¨ CPythonï¼ˆPython çš„æ ‡å‡†å®ç°ï¼‰ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä¸€ä¸ªæ ¸å¿ƒç‰¹ç‚¹æ˜¯ <strong>GIL (Global Interpreter Lock)</strong>ã€‚</p><ul><li><p>å®šä¹‰ï¼š<strong>GIL æ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œå®ƒä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ Python å­—èŠ‚ç </strong>ã€‚</p></li><li><p>å½±å“ï¼š</p><ul><li><p>å³ä½¿åœ¨å¤šæ ¸ CPU ä¸Šï¼Œ<strong>Python çš„å¤šçº¿ç¨‹ä¹Ÿæ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿å®ç°çœŸæ­£çš„å¹¶è¡Œï¼ˆParallelismï¼‰è®¡ç®—ã€‚</strong></p></li><li><p>å®ƒ<strong>åªèƒ½å®ç°å¹¶å‘ï¼ˆConcurrencyï¼‰</strong>ï¼Œå³çº¿ç¨‹ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚</p></li></ul></li></ul><h2 id="3-ä¸ºä»€ä¹ˆè¦æœ‰-GILï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆè¦æœ‰-GILï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆè¦æœ‰ GILï¼Ÿ"></a>3. ä¸ºä»€ä¹ˆè¦æœ‰ GILï¼Ÿ</h2><ul><li><p>å†…å­˜ç®¡ç†å®‰å…¨ï¼š<strong>CPython ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å†…å­˜</strong>ã€‚å¦‚æœæ²¡æœ‰ GILï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¼šå¯¼è‡´å†…å­˜æ³„æ¼æˆ–å´©æºƒã€‚</p></li><li><p>å†å²åŸå› ï¼šåœ¨ Python è®¾è®¡ä¹‹åˆï¼Œæ“ä½œç³»ç»Ÿå¯¹å¤šçº¿ç¨‹çš„æ”¯æŒå¹¶ä¸å®Œå–„ï¼ŒGIL æ˜¯å½“æ—¶å®ç°çº¿ç¨‹å®‰å…¨æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p></li></ul><h2 id="4-GILé€‚ç”¨ä¸ä¸é€‚ç”¨åœºæ™¯"><a href="#4-GILé€‚ç”¨ä¸ä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="4. GILé€‚ç”¨ä¸ä¸é€‚ç”¨åœºæ™¯"></a>4. GILé€‚ç”¨ä¸ä¸é€‚ç”¨åœºæ™¯</h2><p>åŸºäº GIL çš„å­˜åœ¨ï¼ŒPython å¤šçº¿ç¨‹çš„è¡¨ç°å‘ˆç°ä¸¤æåŒ–ï¼š</p><p>âœ… é€‚ç”¨åœºæ™¯ï¼šI&#x2F;O å¯†é›†å‹ä»»åŠ¡</p><ul><li><p>ä¾‹å­ï¼šç½‘ç»œçˆ¬è™«ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“è¯·æ±‚ã€API è°ƒç”¨ã€‚</p></li><li><p>åŸç†ï¼š<strong>å½“çº¿ç¨‹æ‰§è¡Œ I&#x2F;O æ“ä½œ</strong>ï¼ˆå¦‚ç­‰å¾…ç½‘ç»œå“åº”ï¼‰æ—¶ï¼Œ<strong>ä¼šä¸»åŠ¨é‡Šæ”¾ GILï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è¿è¡Œ</strong>ã€‚å› æ­¤ï¼Œå¤šçº¿ç¨‹å¯ä»¥æ˜¾è‘—æé«˜ I&#x2F;O å¯†é›†å‹ç¨‹åºçš„æ•ˆç‡ã€‚</p></li></ul><p>âŒ ä¸é€‚ç”¨åœºæ™¯ï¼šCPU å¯†é›†å‹ä»»åŠ¡</p><ul><li><p>ä¾‹å­ï¼šå¤æ‚çš„æ•°å­¦è®¡ç®—ã€è§†é¢‘è§£ç ã€æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒã€‚</p></li><li><p>åŸç†ï¼šçº¿ç¨‹éœ€è¦ä¸€ç›´å ç”¨ CPU è¿›è¡Œè®¡ç®—ï¼ŒGIL å¯¼è‡´å¤šçº¿ç¨‹å˜æˆäº†â€œä¼ªå¤šçº¿ç¨‹â€ï¼Œç”šè‡³å› ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæ¯”å•çº¿ç¨‹è¿˜è¦æ…¢ã€‚<strong>æ— æ³•åˆ©ç”¨å¤šæ ¸ CPU è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå­˜åœ¨èµ„æºç«äº‰éœ€åŠ é”ã€‚</strong></p></li><li><p>æ›¿ä»£æ–¹æ¡ˆï¼šå¯¹äº CPU å¯†é›†å‹ä»»åŠ¡ï¼Œ<strong>å»ºè®®ä½¿ç”¨ <code>multiprocessing</code>ï¼ˆå¤šè¿›ç¨‹ï¼‰æ¨¡å—ï¼Œè€Œä¸æ˜¯å¤šçº¿ç¨‹</strong>ã€‚æ¯ä¸ªè¿›ç¨‹æœ‰ç‹¬ç«‹çš„è§£é‡Šå™¨å’Œå†…å­˜ï¼Œå¯ä»¥ç»•è¿‡ GILã€‚</p></li></ul><h2 id="5-æ­»é”çš„è§£å†³åŠæ³•"><a href="#5-æ­»é”çš„è§£å†³åŠæ³•" class="headerlink" title="5. æ­»é”çš„è§£å†³åŠæ³•"></a>5. æ­»é”çš„è§£å†³åŠæ³•</h2><p>æ­»é”é€šå¸¸å‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„èµ„æºä¸”ä¸é‡Šæ”¾æ—¶ã€‚</p><ul><li><p><strong>æŒ‰åºåŠ é” (Lock Ordering)</strong>: è§„å®šæ‰€æœ‰çº¿ç¨‹å¿…é¡»æŒ‰ç…§ç›¸åŒçš„é¡ºåºè·å–é”ï¼ˆä¾‹å¦‚ï¼Œå¿…é¡»å…ˆæ‹¿ A é”ï¼Œå†æ‹¿ B é”ï¼‰ã€‚</p></li><li><p><strong>è®¾ç½®è¶…æ—¶ (Timeouts)</strong>: åœ¨å°è¯•è·å–é”æ—¶è®¾ç½® timeoutã€‚å¦‚æœè¶…æ—¶æœªæ‹¿åˆ°é”ï¼Œåˆ™æ”¾å¼ƒå½“å‰æ“ä½œå¹¶å›æ»š&#x2F;é‡è¯•ã€‚</p></li><li><p><strong>æ­»é”æ£€æµ‹ (Deadlock Detection)</strong>: æ„å»ºèµ„æºåˆ†é…å›¾ï¼Œ<strong>å‘¨æœŸæ€§æ£€æµ‹æ˜¯å¦å­˜åœ¨ç¯è·¯ï¼ˆé€šå¸¸ç”¨äºæ•°æ®åº“å±‚é¢ï¼‰</strong>ã€‚</p></li><li><p><strong>ä½¿ç”¨ tryâ€¦finally</strong>: ç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œé”ä¹Ÿèƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚</p></li><li><p><strong>é¿å…é”åµŒå¥—</strong>: å°½é‡å‡å°‘æŒæœ‰ä¸€ä¸ªé”çš„åŒæ—¶å»ç”³è¯·å¦ä¸€ä¸ªé”çš„æƒ…å†µã€‚</p></li></ul><hr><h1 id="Python-å¸¸ç”¨çš„æ¡†æ¶"><a href="#Python-å¸¸ç”¨çš„æ¡†æ¶" class="headerlink" title="Python å¸¸ç”¨çš„æ¡†æ¶"></a>Python å¸¸ç”¨çš„æ¡†æ¶</h1><p>Python æ‹¥æœ‰ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼Œåœ¨ä¸åŒé¢†åŸŸéƒ½æœ‰æˆç†Ÿçš„æ¡†æ¶æ”¯æŒï¼š</p><h2 id="1-Web-å¼€å‘æ¡†æ¶"><a href="#1-Web-å¼€å‘æ¡†æ¶" class="headerlink" title="1. Web å¼€å‘æ¡†æ¶"></a>1. Web å¼€å‘æ¡†æ¶</h2><ul><li><p><strong>Django</strong>: â€œå…¨èƒ½å‹â€æ¡†æ¶ã€‚è‡ªå¸¦ ORMã€åå°ç®¡ç†ç•Œé¢ï¼ˆAdminï¼‰ã€ç”¨æˆ·è®¤è¯ç­‰ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ä¼ä¸šçº§åº”ç”¨ã€‚</p></li><li><p><strong>Flask</strong>: â€œè½»é‡çº§â€å¾®æ¡†æ¶ã€‚æ ¸å¿ƒç®€å•ï¼Œæ‰©å±•æ€§æå¼ºï¼Œé€‚åˆå°å‹é¡¹ç›®æˆ–éœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„å¾®æœåŠ¡ã€‚<br><a href="http://bilibili.com/video/BV12Z4y117MS/?spm_id_from=333.337.search-card.all.click&vd_source=1a88fb46407c6a5cc8a52eb1ea305721">Flaskä»‹ç»</a></p></li><li><p><strong>FastAPI</strong>: ç°ä»£ã€é«˜æ€§èƒ½çš„æ¡†æ¶ã€‚åŸºäºæ ‡å‡† Python ç±»å‹æç¤ºï¼Œæ”¯æŒå¼‚æ­¥ï¼ˆasyncï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼ API æ–‡æ¡£ã€‚</p></li></ul><h2 id="2-æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ "><a href="#2-æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ " class="headerlink" title="2. æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ "></a>2. æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ </h2><ul><li><p><strong>Pandas</strong>: æ•°æ®å¤„ç†å’Œåˆ†æçš„æ ¸å¿ƒåº“ï¼Œæä¾›é«˜æ•ˆçš„ DataFrame ç»“æ„ã€‚</p></li><li><p><strong>Scikit-learn</strong>: æœºå™¨å­¦ä¹ å…¥é—¨é¦–é€‰ï¼ŒåŒ…å«å¤§é‡çš„åˆ†ç±»ã€å›å½’ã€èšç±»ç®—æ³•ã€‚</p></li><li><p><strong>PyTorch &#x2F; TensorFlow</strong>: æ·±åº¦å­¦ä¹ ä¸¤å¤§å·¨å¤´ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œã€‚</p></li></ul><h2 id="3-ç½‘ç»œçˆ¬è™«æ¡†æ¶"><a href="#3-ç½‘ç»œçˆ¬è™«æ¡†æ¶" class="headerlink" title="3. ç½‘ç»œçˆ¬è™«æ¡†æ¶"></a>3. ç½‘ç»œçˆ¬è™«æ¡†æ¶</h2><ul><li><p><strong>Scrapy</strong>: åŠŸèƒ½å¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†ã€æŒä¹…åŒ–å­˜å‚¨å’Œä¸­é—´ä»¶ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®æŠ“å–ã€‚</p></li><li><p><strong>BeautifulSoup &#x2F; Selenium</strong>: å¸¸ç”¨äºè½»é‡çº§æŠ“å–æˆ–å¤„ç†åŠ¨æ€åŠ è½½çš„ç½‘é¡µã€‚</p></li></ul><h2 id="4-è‡ªåŠ¨åŒ–è¿ç»´ä¸æµ‹è¯•"><a href="#4-è‡ªåŠ¨åŒ–è¿ç»´ä¸æµ‹è¯•" class="headerlink" title="4. è‡ªåŠ¨åŒ–è¿ç»´ä¸æµ‹è¯•"></a>4. è‡ªåŠ¨åŒ–è¿ç»´ä¸æµ‹è¯•</h2><ul><li><p><strong>Ansible</strong>: åŸºäº Python å¼€å‘çš„é…ç½®ç®¡ç†å’Œè‡ªåŠ¨åŒ–å·¥å…·ã€‚</p></li><li><p><strong>Pytest</strong>: ç›®å‰æœ€æµè¡Œçš„æµ‹è¯•æ¡†æ¶ï¼Œè¯­æ³•ç®€æ´ä¸”æ’ä»¶ä¸°å¯Œã€‚</p></li></ul><hr><h1 id="pythonè£…é¥°å™¨-decorator"><a href="#pythonè£…é¥°å™¨-decorator" class="headerlink" title="pythonè£…é¥°å™¨-decorator"></a>pythonè£…é¥°å™¨-decorator</h1><p>ç®€å•æ¥è¯´ï¼ŒPython è£…é¥°å™¨ï¼ˆDecoratorï¼‰ å°±åƒæ˜¯ä¸€ä¸ªâ€œåŒ…è£…ç›’â€ã€‚<strong>å®ƒå…è®¸ä½ åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™å‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½</strong>ã€‚</p><p>åœ¨ Python ä¸­ï¼Œè£…é¥°å™¨çš„æœ¬è´¨æ˜¯ä¸€ä¸ªé—­åŒ…ï¼ˆClosureï¼‰ï¼Œå®ƒ<strong>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°</strong>ã€‚</p><h2 id="1-è£…é¥°å™¨çš„åŸºæœ¬åŸç†"><a href="#1-è£…é¥°å™¨çš„åŸºæœ¬åŸç†" class="headerlink" title="1. è£…é¥°å™¨çš„åŸºæœ¬åŸç†"></a>1. è£…é¥°å™¨çš„åŸºæœ¬åŸç†</h2><p>è£…é¥°å™¨çš„å®ç°åŸºäº Python çš„ä¸¤ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼š</p><p><strong>å‡½æ•°æ˜¯â€œobjectâ€</strong>ï¼šå‡½æ•°å¯ä»¥åƒå˜é‡ä¸€æ ·è¢«ä½œä¸ºå‚æ•°ä¼ é€’ã€ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚</p><p><strong>é—­åŒ…ç»“æ„</strong>ï¼šå†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚</p><p>è¯­æ³•ç³– <code>@</code><br>åŸæœ¬æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å†™ <code>func = decorator(func)</code>ï¼Œä½†ä½¿ç”¨ <code>@</code> ç¬¦å·å¯ä»¥æ›´ä¼˜é›…åœ°å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_decorator</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- æ‰§è¡Œå‡½æ•°å‰çš„æ“ä½œ ---&quot;</span>)<br>        func()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- æ‰§è¡Œå‡½æ•°åçš„æ“ä½œ ---&quot;</span>)<br>    <span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-meta">@my_decorator</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World!&quot;</span>)<br><br>say_hello()<br><span class="hljs-comment"># ç›¸å½“äºmy_decorator(say_hello)</span><br></code></pre></td></tr></table></figure><h2 id="2-æ ¸å¿ƒç‰¹ç‚¹"><a href="#2-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="2. æ ¸å¿ƒç‰¹ç‚¹"></a>2. æ ¸å¿ƒç‰¹ç‚¹</h2><ul><li><p><strong>æ— ä¾µå…¥æ€§</strong>ï¼šä¸éœ€è¦ä¿®æ”¹è¢«è£…é¥°å‡½æ•°çš„å†…éƒ¨é€»è¾‘ã€‚</p></li><li><p><strong>ä»£ç å¤ç”¨</strong>ï¼šå°†é€šç”¨çš„åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€æƒé™æ ¡éªŒï¼‰æŠ½ç¦»å‡ºæ¥ï¼Œå¤šä¸ªå‡½æ•°å¯ä»¥å…±ç”¨åŒä¸€ä¸ªè£…é¥°å™¨ã€‚</p></li><li><p><strong>é«˜é˜¶å‡½æ•°</strong>ï¼šè£…é¥°å™¨æœ¬èº«æ˜¯ä¸€ä¸ªæ¥æ”¶å‡½æ•°å¹¶è¿”å›å‡½æ•°çš„é«˜é˜¶å‡½æ•°ã€‚</p></li><li><p><strong>åµŒå¥—æ€§</strong>ï¼šä¸€ä¸ªå‡½æ•°å¯ä»¥åŒæ—¶è¢«å¤šä¸ªè£…é¥°å™¨è£…é¥°ï¼Œæ‰§è¡Œé¡ºåºæ˜¯â€œç”±å†…è€Œå¤–â€åµŒå¥—ï¼Œä½†è°ƒç”¨é¡ºåºé€šå¸¸è¡¨ç°ä¸ºâ€œä»ä¸Šåˆ°ä¸‹â€ã€‚</p></li></ul><h2 id="3-è¿›é˜¶ï¼šå¸¦å‚æ•°çš„è£…é¥°å™¨"><a href="#3-è¿›é˜¶ï¼šå¸¦å‚æ•°çš„è£…é¥°å™¨" class="headerlink" title="3. è¿›é˜¶ï¼šå¸¦å‚æ•°çš„è£…é¥°å™¨"></a>3. è¿›é˜¶ï¼šå¸¦å‚æ•°çš„è£…é¥°å™¨</h2><p>å¦‚æœä½ å¸Œæœ›è£…é¥°å™¨æœ¬èº«ä¹Ÿèƒ½æ¥æ”¶å‚æ•°ï¼ˆä¾‹å¦‚è®¾ç½®æ—¥å¿—çº§åˆ«ï¼‰ï¼Œä½ éœ€è¦å†åµŒå¥—ä¸€å±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">times</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(times):<br>                func(*args, **kwargs)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><br><span class="hljs-meta">@repeat(<span class="hljs-params"><span class="hljs-number">3</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä½ å¥½ï¼&quot;</span>)<br><br><span class="hljs-comment"># ç»“æœä¼šæ‰“å° 3 æ¬¡â€œä½ å¥½ï¼â€</span><br></code></pre></td></tr></table></figure><p>ğŸ’¡ æ³¨æ„äº‹é¡¹ï¼šfunctools.wraps<br>å½“ä½ ä½¿ç”¨è£…é¥°å™¨åï¼ŒåŸå‡½æ•°çš„å…ƒæ•°æ®ï¼ˆå¦‚ <strong>name</strong>ã€æ–‡æ¡£å­—ç¬¦ä¸²ï¼‰ä¼šå˜æˆåŒ…è£…å‡½æ•° wrapper çš„ä¿¡æ¯ã€‚ä¸ºäº†ä¿ç•™åŸå‡½æ•°çš„ä¿¡æ¯ï¼Œé€šå¸¸å»ºè®®åœ¨ wrapper ä¸Šä½¿ç”¨ @functools.wraps(func)ã€‚</p><hr>]]></content>
    
    
    <categories>
      
      <category>é¢ç»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(bustub):project4å®ç°ç¬”è®°</title>
    <link href="/2025/12/17/CMU15-445-bustub-project4%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/12/17/CMU15-445-bustub-project4%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="é”ç®¡ç†å™¨"><a href="#é”ç®¡ç†å™¨" class="headerlink" title="é”ç®¡ç†å™¨"></a>é”ç®¡ç†å™¨</h2><p>ä¸ºäº†ç¡®ä¿äº‹åŠ¡æ“ä½œçš„æ­£ç¡®äº¤é”™ï¼Œæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä½¿ç”¨<strong>é”ç®¡ç†å™¨ï¼ˆLMï¼‰æ¥æ§åˆ¶äº‹åŠ¡ä½•æ—¶å¯ä»¥è®¿é—®æ•°æ®é¡¹</strong>ã€‚é”ç®¡ç†å™¨ï¼ˆLMï¼‰çš„åŸºæœ¬æ€æƒ³æ˜¯å®ƒç»´æŠ¤ä¸€ä¸ªå…³äºæ´»åŠ¨äº‹åŠ¡å½“å‰æŒæœ‰çš„é”çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚äº‹åŠ¡åœ¨è®¿é—®æ•°æ®é¡¹ä¹‹å‰å‘ LM å‘å‡ºé”è¯·æ±‚ï¼ŒLM å°†è¦ä¹ˆæˆäºˆé”ï¼Œè¦ä¹ˆé˜»å¡äº‹åŠ¡ç›´åˆ°é”å¯ç”¨ï¼Œè¦ä¹ˆä¸­æ­¢äº‹åŠ¡ã€‚</p><p>è¿™ä¸ªä»»åŠ¡çš„æ ¸å¿ƒæ˜¯å®ç°ä¸€ä¸ªå…¨å±€é”ç®¡ç†å™¨ (Lock Manager, LM)ï¼Œç”¨äºåœ¨äº‹åŠ¡è®¿é—®æ•°æ®æ—¶æ§åˆ¶å¹¶å‘ï¼Œé€šè¿‡<strong>ä¸¤é˜¶æ®µé”åè®® (2PL)</strong> ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚</p><h3 id="å…³é”®æ•°æ®ç»“æ„ä¸çŠ¶æ€"><a href="#å…³é”®æ•°æ®ç»“æ„ä¸çŠ¶æ€" class="headerlink" title="å…³é”®æ•°æ®ç»“æ„ä¸çŠ¶æ€"></a>å…³é”®æ•°æ®ç»“æ„ä¸çŠ¶æ€</h3><p>éœ€è¦ç»´æŠ¤çš„æ•°æ®ä¸»è¦ä½äº Transaction ç±»å’Œ LockManager ç±»ä¸­ã€‚</p><p><strong>A. é”è¯·æ±‚é˜Ÿåˆ— (LockRequestQueue)</strong></p><ul><li><p>æ¯ä¸ªTableOIDæˆ–RIDéƒ½ä¼šæ˜ å°„åˆ°ä¸€ä¸ªLockRequestQueueã€‚</p></li><li><p>ç»„æˆ:</p><ul><li><p>std::list<LockRequest>: ç­‰å¾…æˆ–æŒæœ‰è¯¥èµ„æºé”çš„è¯·æ±‚åˆ—è¡¨ã€‚</p></li><li><p>std::condition_variable: ç”¨äºå”¤é†’è¢«é˜»å¡çš„äº‹åŠ¡ã€‚</p></li><li><p>æ ¸å¿ƒé€»è¾‘: å½“ä¸€ä¸ªé”é‡Šæ”¾æ—¶ï¼Œéœ€è¦é€šè¿‡ CV é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„äº‹åŠ¡æ£€æŸ¥æ˜¯å¦å¯ä»¥è·å–é”ã€‚</p></li></ul></li></ul><p><strong>B. äº‹åŠ¡çŠ¶æ€ (Transaction State)</strong></p><p>åœ¨ Transaction ç±»ä¸­ç»´æŠ¤ï¼ŒLM å¿…é¡»æ ¹æ®æ“ä½œæ›´æ–°å®ƒï¼š</p><ul><li><p>GROWING (å¢é•¿é˜¶æ®µ): äº‹åŠ¡æ­£åœ¨è·å–é”ã€‚</p></li><li><p>SHRINKING (æ”¶ç¼©é˜¶æ®µ): äº‹åŠ¡é‡Šæ”¾äº†ç¬¬ä¸€ä¸ªé”ä¹‹åè¿›å…¥æ­¤é˜¶æ®µï¼ˆä¸¥æ ¼ 2PL ä¸‹é€šå¸¸åœ¨ Commit&#x2F;Abort æ—¶æ‰é‡Šæ”¾ï¼Œä½†ä¸åŒéš”ç¦»çº§åˆ«æœ‰åŒºåˆ«ï¼‰ã€‚</p></li><li><p>ABORTED: å‘ç”Ÿéæ³•é”æ“ä½œæ—¶ã€‚</p><ul><li><p>æ³¨æ„: å¦‚æœéæ³•æ“ä½œï¼Œé™¤äº†è®¾ä¸º ABORTEDï¼Œè¿˜éœ€æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>å¦‚æœåªæ˜¯è·å–é”å¤±è´¥ï¼ˆå¦‚æ­»é”ï¼‰ï¼Œè¿”å› falseï¼Œä¸æŠ›å¼‚å¸¸ã€‚</p></li></ul></li></ul><p><strong>C. éš”ç¦»çº§åˆ«è¡Œä¸º (Isolation Levels)</strong></p><p>LM çš„è¡Œä¸ºï¼ˆèƒ½å¦åŠ é”ã€ä½•æ—¶è§£é”ï¼‰å–å†³äºéš”ç¦»çº§åˆ«ï¼š</p><table><thead><tr><th align="left">éš”ç¦»çº§åˆ«</th><th align="left">è¯»é” (S&#x2F;IS)</th><th align="left">å†™é” (X&#x2F;IX)</th><th align="left">2PL è¡Œä¸º</th></tr></thead><tbody><tr><td align="left">REPEATABLE_READ</td><td align="left">éœ€è¦è·å–ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸ</td><td align="left">éœ€è¦è·å–ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸ</td><td align="left">ä¸¥æ ¼éµå¾ª 2PL (Growing -&gt; Shrinking)</td></tr><tr><td align="left">READ_COMMITTED</td><td align="left">éœ€è¦è·å–ï¼Œç”¨å®Œå³æ”¾</td><td align="left">éœ€è¦è·å–ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸ</td><td align="left">è¯»é”å¯èƒ½ä¼šæå‰é‡Šæ”¾ (æ‰“ç ´ä¸¥æ ¼ 2PL)</td></tr><tr><td align="left">READ_UNCOMMITTED</td><td align="left">ä¸éœ€è¦è·å–</td><td align="left">éœ€è¦è·å–ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸ</td><td align="left">åªåŠ å†™é”ï¼Œä¸åŠ è¯»é”</td></tr></tbody></table><h3 id="éœ€è¦å®ç°çš„æ¥å£-API"><a href="#éœ€è¦å®ç°çš„æ¥å£-API" class="headerlink" title="éœ€è¦å®ç°çš„æ¥å£ (API)"></a>éœ€è¦å®ç°çš„æ¥å£ (API)</h3><p><strong>A. LockTable(Transaction, LockMode, TableOID)</strong></p><ul><li><p>ä½œç”¨: ç”³è¯·è¡¨çº§é”ã€‚</p></li><li><p>é€»è¾‘:</p></li></ul><ol><li><p>æ£€æŸ¥åˆæ³•æ€§:</p><ul><li><p>å¦‚æœæ˜¯ READ_UNCOMMITTED ä¸”ç”³è¯· S&#x2F;IS&#x2F;SIX é” -&gt; Abort (RU æ¨¡å¼ä¸åŠ è¯»é”)ã€‚</p></li><li><p>å¦‚æœæ˜¯ SHRINKING é˜¶æ®µä¸”ç”³è¯·é” -&gt; Abort (è¿å 2PL)ã€‚</p></li><li><p>(ç‰¹ä¾‹: READ_COMMITTED åœ¨ Shrinking é˜¶æ®µèƒ½ä¸èƒ½åŠ é”ï¼Ÿé€šå¸¸ä¸èƒ½ï¼Œé™¤äº†æŸäº›ç‰¹å®šçš„é”å‡çº§åœºæ™¯ï¼Œéœ€ä»”ç»†çœ‹æµ‹è¯•ç”¨ä¾‹)ã€‚</p></li></ul></li><li><p>è·å–è¯·æ±‚é˜Ÿåˆ—: æ‰¾åˆ°å¯¹åº” TableOID çš„é˜Ÿåˆ—ã€‚</p></li><li><p>é”å‡çº§ (Upgrade): æ£€æŸ¥è¯¥äº‹åŠ¡æ˜¯å¦å·²åœ¨è¯¥è¡¨æŒæœ‰é”ã€‚å¦‚æœæŒæœ‰ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å‡çº§ (ä¾‹å¦‚ IS -&gt; S, S -&gt; X)ã€‚å‡çº§é€šå¸¸æœ‰ä¼˜å…ˆçº§ã€‚</p></li><li><p>é˜»å¡ç­‰å¾…: å¦‚æœå½“å‰é”ä¸é˜Ÿåˆ—ä¸­å·²æœ‰çš„é”ä¸å…¼å®¹ï¼Œè°ƒç”¨ cv.wait() é˜»å¡ã€‚</p></li><li><p>æˆäºˆé”: æ›´æ–° request-&gt;granted_ &#x3D; trueï¼Œæ›´æ–°äº‹åŠ¡çš„ lock_setã€‚</p></li></ol><p><strong>B. UnlockTable(Transaction, TableOID)</strong></p><ul><li><p>ä½œç”¨: é‡Šæ”¾è¡¨çº§é”ã€‚</p></li><li><p>é€»è¾‘:</p></li></ul><ol><li><p>æ£€æŸ¥è¡Œé”: åªæœ‰å½“è¯¥è¡¨ä¸‹çš„æ‰€æœ‰è¡Œé”éƒ½é‡Šæ”¾åï¼Œæ‰èƒ½é‡Šæ”¾è¡¨é”ï¼ˆæ„å‘é”åè®®ï¼‰ã€‚</p></li><li><p>æ›´æ–°é˜¶æ®µ: å¦‚æœé‡Šæ”¾çš„æ˜¯ X&#x2F;IX é”ï¼ˆæˆ–è€…åœ¨ RR æ¨¡å¼ä¸‹é‡Šæ”¾ S é”ï¼‰ï¼Œå°†äº‹åŠ¡çŠ¶æ€ä» GROWING æ”¹ä¸º SHRINKINGã€‚</p></li><li><p>æ¸…ç†: ä»é˜Ÿåˆ—ä¸­ç§»é™¤è¯·æ±‚ï¼Œä»äº‹åŠ¡ lock_set ä¸­ç§»é™¤ã€‚</p></li><li><p>å”¤é†’: è°ƒç”¨ cv.notify_all() å”¤é†’ç­‰å¾…è¯¥è¡¨çš„å…¶ä»–äº‹åŠ¡ã€‚</p></li></ol><p><strong>C. LockRow(Transaction, LockMode, TableOID, RID)</strong></p><ul><li><p>ä½œç”¨: ç”³è¯·è¡Œçº§é”ã€‚</p></li><li><p>é€»è¾‘:</p></li></ul><ol><li><p>æ£€æŸ¥è¡¨é”: äº‹åŠ¡å¿…é¡»å…ˆæŒæœ‰è¯¥è¡¨çš„æ„å‘é” (IS&#x2F;IX&#x2F;SIX) æ‰èƒ½ç”³è¯·è¡Œé”ã€‚å¦‚æœæ²¡æœ‰ -&gt; Abortã€‚</p></li><li><p>å…¶ä½™é€»è¾‘: ç±»ä¼¼ LockTable (æ£€æŸ¥ 2PL é˜¶æ®µï¼Œå¤„ç†ç­‰å¾…ï¼Œå¤„ç†å‡çº§)ã€‚</p></li></ol><p><strong>D. UnlockRow(Transaction, TableOID, RID, force)</strong></p><ul><li><p>ä½œç”¨: é‡Šæ”¾è¡Œçº§é”ã€‚</p></li><li><p>å‚æ•° force:</p></li></ul><ol><li><p>å¦‚æœ force &#x3D;&#x3D; true: å¿½ç•¥ 2PL è§„åˆ™æ£€æŸ¥ï¼Œç›´æ¥è§£é”ï¼Œä¸æ”¹å˜äº‹åŠ¡çŠ¶æ€ï¼ˆä¸è¿›å…¥ Shrinkingï¼‰ã€‚è¿™é€šå¸¸ç”¨äºæ‰§è¡Œå™¨åªæ˜¯â€œçœ‹ä¸€çœ¼â€å…ƒç»„ä½†å¹¶ä¸çœŸçš„å¤„ç†å®ƒçš„æƒ…å†µã€‚</p></li><li><p>å¦‚æœ force &#x3D;&#x3D; false: æ­£å¸¸é€»è¾‘ï¼Œå¯èƒ½ä¼šè§¦å‘ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å˜æ›´ (Growing -&gt; Shrinking)ã€‚</p></li></ol><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><ol><li><strong>æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡</strong><br>é”ç®¡ç†å™¨é€šè¿‡å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—æ¥ç®¡ç†ä¸åŒèµ„æºä¸Šçš„é”ç«äº‰ã€‚</li></ol><ul><li><strong>åˆ†å±‚ç»“æ„ï¼š</strong><ul><li>table_lock_map_ï¼šç»´æŠ¤è¡¨çº§é”ï¼ˆOID -&gt; é”è¯·æ±‚é˜Ÿåˆ—ï¼‰ã€‚</li><li>row_lock_map_ï¼šç»´æŠ¤è¡Œçº§é”ï¼ˆRID -&gt; é”è¯·æ±‚é˜Ÿåˆ—ï¼‰ã€‚</li></ul></li><li><strong>è¯·æ±‚é˜Ÿåˆ— (LockRequestQueue)ï¼š</strong><ul><li>æ¯ä¸ªèµ„æºï¼ˆè¡¨æˆ–è¡Œï¼‰éƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—ã€‚</li><li>request_queue_ï¼šä½¿ç”¨ std::list å­˜å‚¨ç­‰å¾…æˆ–å·²æŒæœ‰çš„ LockRequestï¼Œé€šå¸¸éµå¾ª FIFO (å…ˆè¿›å…ˆå‡º) åŸåˆ™ï¼Œä½†å—å…¼å®¹æ€§é™åˆ¶ã€‚</li><li>cv_ (Condition Variable)ï¼šæ ¸å¿ƒåŒæ­¥æœºåˆ¶ã€‚å½“é”è¢«é‡Šæ”¾æ—¶ï¼Œåˆ©ç”¨æ¡ä»¶å˜é‡å”¤é†’ç­‰å¾…è¯¥èµ„æºçš„æ‰€æœ‰äº‹åŠ¡ã€‚</li><li>upgrading_ï¼šä¸“é—¨ç”¨äºè®°å½•å½“å‰æ­£åœ¨å°è¯•é”å‡çº§çš„äº‹åŠ¡ IDï¼Œé˜²æ­¢å¤šä¸ªäº‹åŠ¡åŒæ—¶å‡çº§å¯¼è‡´æ­»é”ã€‚</li></ul></li></ul><ol start="2"><li><p><strong>åŠ é”é€»è¾‘ (LockTable &#x2F; LockRow)</strong><br>åŠ é”çš„æ ¸å¿ƒæ€æƒ³æ˜¯ â€œæ£€æŸ¥-ç­‰å¾…-æˆæƒâ€ (Check-Wait-Grant) æ¨¡å‹ã€‚</p><ol><li><strong>é¢„æ£€æŸ¥ (Pre-checks)ï¼š</strong><ul><li><strong>ç¦»çº§åˆ«é™åˆ¶ï¼š</strong><ul><li>READ_UNCOMMITTED è¯•å›¾è·å–å…±äº«é” (S&#x2F;IS&#x2F;SIX) ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸å¹¶ Abortã€‚</li><li>æ”¶ç¼©é˜¶æ®µæ£€æŸ¥ï¼šå¦‚æœäº‹åŠ¡å¤„äº SHRINKING é˜¶æ®µï¼ˆå³å·²ç»é‡Šæ”¾è¿‡é”ï¼‰ï¼Œé™¤äº† READ_COMMITTED ä¸‹çš„ç‰¹æ®Šæƒ…å†µå¤–ï¼Œé€šå¸¸ç¦æ­¢å†è·å–æ–°é”ï¼ˆä¸¥æ ¼éµå¾ª 2PLï¼‰ã€‚</li></ul></li><li><strong>å±‚çº§çº¦æŸ (LockRow ç‰¹æœ‰)</strong>ï¼šåœ¨ LockRow ä¸­ï¼Œå¿…é¡»è°ƒç”¨ CheckAppropriateLockOnTable ç¡®ä¿äº‹åŠ¡å·²ç»æŒæœ‰äº†æ­£ç¡®çš„è¡¨çº§æ„å‘é”ï¼Œæ‰èƒ½ç”³è¯·è¡Œé”ã€‚</li></ul></li><li><strong>é”å‡çº§å¤„ç† (CheckLockUpdateâ€¦)ï¼š</strong><ul><li>å¦‚æœäº‹åŠ¡å·²æŒæœ‰è¯¥èµ„æºçš„é”ï¼Œä½†è¯·æ±‚æ›´é«˜çº§åˆ«çš„é”ï¼ˆä¾‹å¦‚ä» S å‡çº§åˆ° Xï¼‰ï¼Œä»£ç ä¼šä¼˜å…ˆå¤„ç†ã€‚</li><li><strong>é€»è¾‘</strong>ï¼šé‡Šæ”¾æ—§é” -&gt; ä¿®æ”¹è¯·æ±‚ä¸ºæ–°æ¨¡å¼ -&gt; æ’å…¥åˆ°é˜Ÿåˆ—é€‚å½“ä½ç½®ï¼ˆé€šå¸¸ä¿æŒä¼˜å…ˆçº§ï¼‰-&gt; å°è¯•æˆæƒã€‚</li><li><strong>é˜²æ­»é”</strong>ï¼šåˆ©ç”¨ queue-&gt;upgrading_ æ ‡è®°ï¼ŒåŒä¸€èµ„æºåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªäº‹åŠ¡å‡çº§ã€‚</li></ul></li><li><strong>ç­‰å¾…ä¸æˆæƒå¾ªç¯</strong>ï¼š<ul><li>å¦‚æœæ²¡æœ‰ç›´æ¥è·å¾—é”ï¼Œè¯·æ±‚è¢«åŠ å…¥é˜Ÿåˆ—ã€‚</li><li>ä½¿ç”¨ cv_.wait(lk, predicate) è¿›å…¥é˜»å¡ç­‰å¾…ã€‚</li><li><strong>Predicate (å”¤é†’æ¡ä»¶)</strong>ï¼šä¼ å…¥çš„ lambda è¡¨è¾¾å¼ä¼šè°ƒç”¨ GrantNewLocksIfPossibleã€‚åªæœ‰å½“ request-&gt;granted_ å˜ä¸º true æ—¶ï¼Œäº‹åŠ¡æ‰ä¼šè¢«å”¤é†’å¹¶ç»§ç»­æ‰§è¡Œã€‚</li><li><strong>GrantNewLocksIfPossible</strong>ï¼šè¿™æ˜¯è°ƒåº¦çš„æ ¸å¿ƒã€‚å®ƒéå†é˜Ÿåˆ—ï¼Œæ£€æŸ¥é˜Ÿé¦–è¯·æ±‚ï¼Œå¹¶æ ¹æ® å…¼å®¹æ€§çŸ©é˜µ (AreLocksCompatible) åˆ¤æ–­åç»­è¯·æ±‚æ˜¯å¦å¯ä»¥ä¸å½“å‰æŒæœ‰è€…å…±å­˜ï¼ˆä¾‹å¦‚å¤šä¸ª S é”å¯ä»¥å…±å­˜ï¼Œä½† X é”å¿…é¡»ç‹¬å ï¼‰ã€‚</li></ul></li></ol></li><li><p><strong>è§£é”é€»è¾‘ (UnlockTable &#x2F; UnlockRow)</strong><br>è§£é”çš„æ ¸å¿ƒæ€æƒ³æ˜¯ â€œçŠ¶æ€æµè½¬ä¸å”¤é†’â€ã€‚</p><ol><li><strong>çŠ¶æ€æµè½¬ (2PL Phase Change)</strong>ï¼š<ul><li>å½“é‡Šæ”¾é”æ—¶ï¼Œä»£ç æ ¹æ®éš”ç¦»çº§åˆ«åˆ¤æ–­æ˜¯å¦éœ€è¦å°†äº‹åŠ¡çŠ¶æ€ä» GROWING åˆ‡æ¢åˆ° SHRINKINGã€‚</li><li>ä¾‹å¦‚ï¼šåœ¨ REPEATABLE_READ ä¸‹ï¼Œä¸€æ—¦é‡Šæ”¾ S æˆ– X é”ï¼Œäº‹åŠ¡å³è¿›å…¥æ”¶ç¼©é˜¶æ®µï¼Œä¹‹åä¸èƒ½å†åŠ é”ã€‚</li></ul></li><li><strong>å¼ºåˆ¶è§£é” (force å‚æ•°)</strong>ï¼š<ul><li>UnlockRow åŒ…å«ä¸€ä¸ª force å‚æ•°ã€‚è¿™é€šå¸¸ç”¨äºæ‰§è¡Œå™¨ï¼ˆExecutorï¼‰å±‚ï¼Œå½“åªéœ€è¦â€œçœ‹ä¸€çœ¼â€æ•°æ®ï¼ˆå¦‚åšç®€å•çš„è¿‡æ»¤ï¼‰è€Œä¸éœ€è¦æŒæœ‰é”ç›´åˆ°äº‹åŠ¡ç»“æŸæ—¶ï¼Œå¯ä»¥å¼ºåˆ¶è§£é”è€Œä¸æ”¹å˜äº‹åŠ¡çŠ¶æ€ï¼ˆä¸è¿›å…¥ Shrinkingï¼‰ã€‚</li></ul></li><li><strong>æ¸…ç†ä¸é€šçŸ¥</strong>ï¼š<ul><li>ä»é˜Ÿåˆ—ä¸­ç§»é™¤è¯·æ±‚ã€‚</li><li>ä»äº‹åŠ¡çš„ lock_set ä¸­ç§»é™¤è®°å½•ã€‚</li><li><strong>å…³é”®æ­¥éª¤</strong>ï¼šè°ƒç”¨ list-&gt;cv_.notify_all()ã€‚è¿™ä¼šå”¤é†’æ‰€æœ‰åœ¨ LockTable&#x2F;Row ä¸­æ²‰ç¡çš„çº¿ç¨‹ï¼Œè®©å®ƒä»¬é‡æ–°ç«äº‰é”ï¼ˆé€šè¿‡ GrantNewLocksIfPossible æ£€æŸ¥ï¼‰ã€‚</li></ul></li></ol></li><li><p><strong>æ­»é”æ£€æµ‹ (Deadlock Detection)</strong><br>ä»£ç ä¸­åŒ…å«äº†ä¸€ä¸ªåå°çº¿ç¨‹ RunCycleDetectionï¼Œå…¶å®ç°æ€æƒ³æ˜¯ åŸºäºå›¾çš„ç¯æ£€æµ‹ã€‚</p><ol><li><strong>æ„å»ºç­‰å¾…å›¾ (Waits-for Graph)</strong>ï¼š<ul><li>éå†æ‰€æœ‰é”é˜Ÿåˆ—ã€‚</li><li>å¦‚æœäº‹åŠ¡ A æŒæœ‰é” (granted_ &#x3D; true)ï¼Œäº‹åŠ¡ B åœ¨ç­‰å¾…é” (granted_ &#x3D; false)ï¼Œåˆ™æ·»åŠ ä¸€æ¡è¾¹ B -&gt; A (B ç­‰å¾… A)ã€‚</li></ul></li><li><strong>ç¯æ£€æµ‹ (DFS)</strong>ï¼š<ul><li>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ (Dfs) æŸ¥æ‰¾å›¾ä¸­æ˜¯å¦å­˜åœ¨ç¯ã€‚</li><li>å¦‚æœå­˜åœ¨ç¯ï¼ˆä¾‹å¦‚ A ç­‰ Bï¼ŒB ç­‰ Aï¼‰ï¼Œè¯´æ˜æ­»é”ã€‚</li></ul></li><li><strong>è§£é™¤æ­»é”</strong>ï¼š<ul><li>ç­–ç•¥æ˜¯ â€œæ€æ‰æœ€å¹´è½»çš„äº‹åŠ¡â€ã€‚</li><li>HasCycle ä¼šè¿”å›ç¯ä¸­ txn_id æœ€å¤§çš„äº‹åŠ¡ï¼ˆå³æœ€æ™šå¼€å§‹çš„äº‹åŠ¡ï¼‰ã€‚</li><li>è°ƒç”¨ txn_manager_-&gt;Abort() ä¸­æ­¢è¯¥äº‹åŠ¡ï¼Œä»è€Œé‡Šæ”¾å®ƒæŒæœ‰çš„é”ï¼Œæ‰“ç ´ç¯ã€‚</li></ul></li></ol></li></ol><h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><img src="/img/CMU15-445-Bustub-project4å®ç°ç¬”è®°/result1.png" alt="æµ‹è¯•ç»“æœ1" style="display: block; margin: 0 auto; width: 70%; height:70%;"><img src="/img/CMU15-445-Bustub-project4å®ç°ç¬”è®°/result2.png" alt="æµ‹è¯•ç»“æœ2" style="display: block; margin: 0 auto; width: 70%; height:70%;"><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ ./bin/bustub-terrier-bench --duration 30000<br>x: create schema<br>Table created with id = 0<br>x: create index disabled<br>x: use insert + delete<br>x: benchmark <span class="hljs-keyword">for</span> 30000ms<br>x: <span class="hljs-attribute">nft_num</span>=10<br>x: initialize data<br>x: benchmark start<br>[ 1.01]   Verify: <span class="hljs-attribute">total_committed_txn</span>=12    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=11.9   <span class="hljs-attribute">avg_throughput</span>=11.9  <br>[ 1.01] Update 0: <span class="hljs-attribute">total_committed_txn</span>=4     <span class="hljs-attribute">total_aborted_txn</span>=10    <span class="hljs-attribute">throughput</span>=3.97   <span class="hljs-attribute">avg_throughput</span>=3.97  <br>[ 1.01] Update 1: <span class="hljs-attribute">total_committed_txn</span>=5     <span class="hljs-attribute">total_aborted_txn</span>=10    <span class="hljs-attribute">throughput</span>=4.97   <span class="hljs-attribute">avg_throughput</span>=4.97  <br>[ 1.01]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=14    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=13.9   <span class="hljs-attribute">avg_throughput</span>=13.9  <br>[ 1.01]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=14    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=13.9   <span class="hljs-attribute">avg_throughput</span>=13.9  <br>[ 2.01]   Verify: <span class="hljs-attribute">total_committed_txn</span>=22    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.9  <br>[ 2.01] Update 1: <span class="hljs-attribute">total_committed_txn</span>=5     <span class="hljs-attribute">total_aborted_txn</span>=20    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=2.48  <br>[ 2.01] Update 0: <span class="hljs-attribute">total_committed_txn</span>=4     <span class="hljs-attribute">total_aborted_txn</span>=20    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=1.99  <br>[ 2.01]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=24    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=11.9  <br>[ 2.01]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=24    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=11.9  <br>[ 3.02]   Verify: <span class="hljs-attribute">total_committed_txn</span>=32    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.6  <br>[ 3.02] Update 1: <span class="hljs-attribute">total_committed_txn</span>=5     <span class="hljs-attribute">total_aborted_txn</span>=30    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=1.66  <br>[ 3.02]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=34    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=11.3  <br>[ 3.02] Update 0: <span class="hljs-attribute">total_committed_txn</span>=5     <span class="hljs-attribute">total_aborted_txn</span>=30    <span class="hljs-attribute">throughput</span>=0.992  <span class="hljs-attribute">avg_throughput</span>=1.65  <br>[ 3.02]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=34    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=11.3  <br>[ 4.03]   Verify: <span class="hljs-attribute">total_committed_txn</span>=42    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.4  <br>[ 4.03] Update 1: <span class="hljs-attribute">total_committed_txn</span>=5     <span class="hljs-attribute">total_aborted_txn</span>=40    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=1.24  <br>[ 4.03]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=44    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.9  <br>[ 4.03]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=44    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.9  <br>[ 4.03] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=40    <span class="hljs-attribute">throughput</span>=0.992  <span class="hljs-attribute">avg_throughput</span>=1.49  <br>[ 5.03]   Verify: <span class="hljs-attribute">total_committed_txn</span>=52    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[ 5.04] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=50    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=1.19  <br>[ 5.04]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=54    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.7  <br>[ 5.04] Update 1: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=50    <span class="hljs-attribute">throughput</span>=0.991  <span class="hljs-attribute">avg_throughput</span>=1.19  <br>[ 5.04]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=54    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.7  <br>[ 6.04]   Verify: <span class="hljs-attribute">total_committed_txn</span>=62    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[ 6.04] Update 1: <span class="hljs-attribute">total_committed_txn</span>=7     <span class="hljs-attribute">total_aborted_txn</span>=60    <span class="hljs-attribute">throughput</span>=0.995  <span class="hljs-attribute">avg_throughput</span>=1.16  <br>[ 6.04] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=60    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.993 <br>[ 6.04]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=64    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.6  <br>[ 6.04]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=64    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.6  <br>[ 7.05]   Verify: <span class="hljs-attribute">total_committed_txn</span>=72    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[ 7.05] Update 1: <span class="hljs-attribute">total_committed_txn</span>=7     <span class="hljs-attribute">total_aborted_txn</span>=70    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.993 <br>[ 7.05] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=70    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.851 <br>[ 7.05]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=74    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.5  <br>[ 7.05]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=74    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.5  <br>[ 8.05]   Verify: <span class="hljs-attribute">total_committed_txn</span>=82    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[ 8.06] Update 1: <span class="hljs-attribute">total_committed_txn</span>=7     <span class="hljs-attribute">total_aborted_txn</span>=80    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.869 <br>[ 8.06] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=80    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.745 <br>[ 8.06]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=84    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.4  <br>[ 8.06]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=84    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.4  <br>[ 9.06]   Verify: <span class="hljs-attribute">total_committed_txn</span>=92    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[ 9.06] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=90    <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.662 <br>[ 9.06]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=94    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.4  <br>[ 9.06] Update 1: <span class="hljs-attribute">total_committed_txn</span>=8     <span class="hljs-attribute">total_aborted_txn</span>=90    <span class="hljs-attribute">throughput</span>=0.992  <span class="hljs-attribute">avg_throughput</span>=0.883 <br>[ 9.06]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=94    <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.4  <br>[10.07]   Verify: <span class="hljs-attribute">total_committed_txn</span>=102   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[10.07] Update 1: <span class="hljs-attribute">total_committed_txn</span>=8     <span class="hljs-attribute">total_aborted_txn</span>=100   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.794 <br>[10.07] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=100   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.596 <br>[10.07]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=104   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[10.07]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=104   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[11.07]   Verify: <span class="hljs-attribute">total_committed_txn</span>=112   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[11.08] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=110   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.542 <br>[11.08]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=114   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.95   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[11.08] Update 1: <span class="hljs-attribute">total_committed_txn</span>=9     <span class="hljs-attribute">total_aborted_txn</span>=110   <span class="hljs-attribute">throughput</span>=0.993  <span class="hljs-attribute">avg_throughput</span>=0.812 <br>[11.08]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=114   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[12.08]   Verify: <span class="hljs-attribute">total_committed_txn</span>=122   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[12.08] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=120   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.497 <br>[12.08]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=124   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[12.08] Update 1: <span class="hljs-attribute">total_committed_txn</span>=9     <span class="hljs-attribute">total_aborted_txn</span>=120   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.745 <br>[12.08]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=124   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.3  <br>[13.09]   Verify: <span class="hljs-attribute">total_committed_txn</span>=132   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[13.09] Update 0: <span class="hljs-attribute">total_committed_txn</span>=6     <span class="hljs-attribute">total_aborted_txn</span>=130   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.458 <br>[13.09] Update 1: <span class="hljs-attribute">total_committed_txn</span>=9     <span class="hljs-attribute">total_aborted_txn</span>=130   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.688 <br>[13.09]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=134   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[13.09]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=134   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[14.09]   Verify: <span class="hljs-attribute">total_committed_txn</span>=142   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.95   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[14.10] Update 1: <span class="hljs-attribute">total_committed_txn</span>=9     <span class="hljs-attribute">total_aborted_txn</span>=140   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.639 <br>[14.10] Update 0: <span class="hljs-attribute">total_committed_txn</span>=8     <span class="hljs-attribute">total_aborted_txn</span>=140   <span class="hljs-attribute">throughput</span>=1.99   <span class="hljs-attribute">avg_throughput</span>=0.568 <br>[14.10]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=144   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.95   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[14.10]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=144   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[15.10]   Verify: <span class="hljs-attribute">total_committed_txn</span>=152   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[15.10] Update 0: <span class="hljs-attribute">total_committed_txn</span>=9     <span class="hljs-attribute">total_aborted_txn</span>=150   <span class="hljs-attribute">throughput</span>=0.993  <span class="hljs-attribute">avg_throughput</span>=0.596 <br>[15.10]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=154   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[15.10] Update 1: <span class="hljs-attribute">total_committed_txn</span>=11    <span class="hljs-attribute">total_aborted_txn</span>=150   <span class="hljs-attribute">throughput</span>=1.98   <span class="hljs-attribute">avg_throughput</span>=0.728 <br>[15.10]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=154   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[16.11]   Verify: <span class="hljs-attribute">total_committed_txn</span>=162   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[16.11] Update 1: <span class="hljs-attribute">total_committed_txn</span>=13    <span class="hljs-attribute">total_aborted_txn</span>=160   <span class="hljs-attribute">throughput</span>=1.99   <span class="hljs-attribute">avg_throughput</span>=0.807 <br>[16.11]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=165   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[16.11] Update 0: <span class="hljs-attribute">total_committed_txn</span>=11    <span class="hljs-attribute">total_aborted_txn</span>=160   <span class="hljs-attribute">throughput</span>=1.98   <span class="hljs-attribute">avg_throughput</span>=0.683 <br>[16.11]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=165   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[17.12]   Verify: <span class="hljs-attribute">total_committed_txn</span>=172   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10    <br>[17.12] Update 1: <span class="hljs-attribute">total_committed_txn</span>=13    <span class="hljs-attribute">total_aborted_txn</span>=170   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.759 <br>[17.12] Update 0: <span class="hljs-attribute">total_committed_txn</span>=11    <span class="hljs-attribute">total_aborted_txn</span>=170   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.643 <br>[17.12]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=175   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[17.12]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=175   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[18.12]   Verify: <span class="hljs-attribute">total_committed_txn</span>=182   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10    <br>[18.13] Update 1: <span class="hljs-attribute">total_committed_txn</span>=13    <span class="hljs-attribute">total_aborted_txn</span>=180   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.717 <br>[18.13] Update 0: <span class="hljs-attribute">total_committed_txn</span>=11    <span class="hljs-attribute">total_aborted_txn</span>=180   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.607 <br>[18.13]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=185   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[18.13]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=185   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[19.13]   Verify: <span class="hljs-attribute">total_committed_txn</span>=192   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.94   <span class="hljs-attribute">avg_throughput</span>=10    <br>[19.13] Update 1: <span class="hljs-attribute">total_committed_txn</span>=14    <span class="hljs-attribute">total_aborted_txn</span>=190   <span class="hljs-attribute">throughput</span>=0.995  <span class="hljs-attribute">avg_throughput</span>=0.732 <br>[19.13]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=195   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.96   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[19.13] Update 0: <span class="hljs-attribute">total_committed_txn</span>=12    <span class="hljs-attribute">total_aborted_txn</span>=190   <span class="hljs-attribute">throughput</span>=0.994  <span class="hljs-attribute">avg_throughput</span>=0.627 <br>[19.13]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=196   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[20.14]   Verify: <span class="hljs-attribute">total_committed_txn</span>=202   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10    <br>[20.14] Update 1: <span class="hljs-attribute">total_committed_txn</span>=14    <span class="hljs-attribute">total_aborted_txn</span>=200   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.695 <br>[20.14]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=205   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[20.14] Update 0: <span class="hljs-attribute">total_committed_txn</span>=12    <span class="hljs-attribute">total_aborted_txn</span>=200   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.596 <br>[20.14]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=206   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[21.15]   Verify: <span class="hljs-attribute">total_committed_txn</span>=212   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10    <br>[21.15] Update 1: <span class="hljs-attribute">total_committed_txn</span>=15    <span class="hljs-attribute">total_aborted_txn</span>=210   <span class="hljs-attribute">throughput</span>=0.991  <span class="hljs-attribute">avg_throughput</span>=0.709 <br>[21.15] Update 0: <span class="hljs-attribute">total_committed_txn</span>=13    <span class="hljs-attribute">total_aborted_txn</span>=210   <span class="hljs-attribute">throughput</span>=0.992  <span class="hljs-attribute">avg_throughput</span>=0.615 <br>[21.15]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=216   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[21.15]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=216   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[22.16]   Verify: <span class="hljs-attribute">total_committed_txn</span>=222   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10    <br>[22.16] Update 1: <span class="hljs-attribute">total_committed_txn</span>=15    <span class="hljs-attribute">total_aborted_txn</span>=220   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.677 <br>[22.16] Update 0: <span class="hljs-attribute">total_committed_txn</span>=14    <span class="hljs-attribute">total_aborted_txn</span>=220   <span class="hljs-attribute">throughput</span>=0.991  <span class="hljs-attribute">avg_throughput</span>=0.632 <br>[22.16]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=226   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[22.16]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=226   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[23.17]   Verify: <span class="hljs-attribute">total_committed_txn</span>=232   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10    <br>[23.17] Update 0: <span class="hljs-attribute">total_committed_txn</span>=15    <span class="hljs-attribute">total_aborted_txn</span>=230   <span class="hljs-attribute">throughput</span>=0.989  <span class="hljs-attribute">avg_throughput</span>=0.647 <br>[23.17] Update 1: <span class="hljs-attribute">total_committed_txn</span>=16    <span class="hljs-attribute">total_aborted_txn</span>=230   <span class="hljs-attribute">throughput</span>=0.989  <span class="hljs-attribute">avg_throughput</span>=0.691 <br>[23.17]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=236   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[23.17]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=236   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[24.18]   Verify: <span class="hljs-attribute">total_committed_txn</span>=242   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10    <br>[24.18] Update 0: <span class="hljs-attribute">total_committed_txn</span>=15    <span class="hljs-attribute">total_aborted_txn</span>=240   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.62  <br>[24.18] Update 1: <span class="hljs-attribute">total_committed_txn</span>=16    <span class="hljs-attribute">total_aborted_txn</span>=240   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.662 <br>[24.18]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=246   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[24.18]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=246   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[25.19]   Verify: <span class="hljs-attribute">total_committed_txn</span>=252   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.92   <span class="hljs-attribute">avg_throughput</span>=10    <br>[25.19] Update 1: <span class="hljs-attribute">total_committed_txn</span>=16    <span class="hljs-attribute">total_aborted_txn</span>=250   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.635 <br>[25.19] Update 0: <span class="hljs-attribute">total_committed_txn</span>=15    <span class="hljs-attribute">total_aborted_txn</span>=250   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.596 <br>[25.19]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=256   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.93   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[25.19]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=256   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[26.20]   Verify: <span class="hljs-attribute">total_committed_txn</span>=262   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10    <br>[26.20] Update 0: <span class="hljs-attribute">total_committed_txn</span>=16    <span class="hljs-attribute">total_aborted_txn</span>=260   <span class="hljs-attribute">throughput</span>=0.991  <span class="hljs-attribute">avg_throughput</span>=0.611 <br>[26.20] Update 1: <span class="hljs-attribute">total_committed_txn</span>=17    <span class="hljs-attribute">total_aborted_txn</span>=260   <span class="hljs-attribute">throughput</span>=0.991  <span class="hljs-attribute">avg_throughput</span>=0.649 <br>[26.20]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=266   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.91   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[26.20]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=266   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[27.21]   Verify: <span class="hljs-attribute">total_committed_txn</span>=272   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10    <br>[27.21] Update 0: <span class="hljs-attribute">total_committed_txn</span>=18    <span class="hljs-attribute">total_aborted_txn</span>=270   <span class="hljs-attribute">throughput</span>=1.98   <span class="hljs-attribute">avg_throughput</span>=0.662 <br>[27.21] Update 1: <span class="hljs-attribute">total_committed_txn</span>=19    <span class="hljs-attribute">total_aborted_txn</span>=270   <span class="hljs-attribute">throughput</span>=1.98   <span class="hljs-attribute">avg_throughput</span>=0.698 <br>[27.21]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=276   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10.1  <br>[27.21]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=277   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[28.22]   Verify: <span class="hljs-attribute">total_committed_txn</span>=282   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=9.99  <br>[28.22] Update 1: <span class="hljs-attribute">total_committed_txn</span>=21    <span class="hljs-attribute">total_aborted_txn</span>=280   <span class="hljs-attribute">throughput</span>=1.98   <span class="hljs-attribute">avg_throughput</span>=0.744 <br>[28.22] Update 0: <span class="hljs-attribute">total_committed_txn</span>=22    <span class="hljs-attribute">total_aborted_txn</span>=280   <span class="hljs-attribute">throughput</span>=3.96   <span class="hljs-attribute">avg_throughput</span>=0.78  <br>[28.22]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=287   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[28.22]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=287   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=10.9   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[29.23]   Verify: <span class="hljs-attribute">total_committed_txn</span>=292   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=9.99  <br>[29.23] Update 0: <span class="hljs-attribute">total_committed_txn</span>=23    <span class="hljs-attribute">total_aborted_txn</span>=290   <span class="hljs-attribute">throughput</span>=0.99   <span class="hljs-attribute">avg_throughput</span>=0.787 <br>[29.23] Update 1: <span class="hljs-attribute">total_committed_txn</span>=21    <span class="hljs-attribute">total_aborted_txn</span>=290   <span class="hljs-attribute">throughput</span>=0      <span class="hljs-attribute">avg_throughput</span>=0.718 <br>[29.23]  Count 1: <span class="hljs-attribute">total_committed_txn</span>=297   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.9    <span class="hljs-attribute">avg_throughput</span>=10.2  <br>[29.23]  Count 0: <span class="hljs-attribute">total_committed_txn</span>=297   <span class="hljs-attribute">total_aborted_txn</span>=0     <span class="hljs-attribute">throughput</span>=9.89   <span class="hljs-attribute">avg_throughput</span>=10.2  <br>SELECT count(*) <span class="hljs-keyword">FROM</span> nft WHERE terrier = 0: 0<br>&lt;&lt;&lt; BEGIN<br>update: 1.4622798271851114<br>count: 20.272515785975408<br>verify: 9.970089730807578<br>&gt;&gt;&gt; END<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Bustub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(bustub):è¯¾ç¨‹å­¦ä¹ ç¬”è®°2</title>
    <link href="/2025/12/16/CMU15-445-bustub-%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"/>
    <url>/2025/12/16/CMU15-445-bustub-%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬åä¸‰è®²ï¼šQuery-Processing-I"><a href="#ç¬¬åä¸‰è®²ï¼šQuery-Processing-I" class="headerlink" title="ç¬¬åä¸‰è®²ï¼šQuery Processing I"></a>ç¬¬åä¸‰è®²ï¼šQuery Processing I</h1><h2 id="1-æ¦‚è¿°ï¼šä»-SQL-åˆ°æ‰§è¡Œ"><a href="#1-æ¦‚è¿°ï¼šä»-SQL-åˆ°æ‰§è¡Œ" class="headerlink" title="1. æ¦‚è¿°ï¼šä» SQL åˆ°æ‰§è¡Œ"></a>1. æ¦‚è¿°ï¼šä» SQL åˆ°æ‰§è¡Œ</h2><p>SQL æ˜¯ä¸€ç§å£°æ˜å¼è¯­è¨€ï¼ˆDeclarativeï¼‰ï¼Œä½ å‘Šè¯‰æ•°æ®åº“â€œæˆ‘æƒ³è¦ä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯â€œæ€ä¹ˆåšâ€ã€‚DBMS çš„å·¥ä½œå°±æ˜¯å°†è¿™ç§å£°æ˜è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„<strong>æŸ¥è¯¢è®¡åˆ’ (Query Plan)</strong> ã€‚</p><ul><li><p><strong>æŸ¥è¯¢è®¡åˆ’çš„æœ¬è´¨</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼ˆOperatorsï¼‰æ„æˆçš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œé€šå¸¸ç»„ç»‡æˆæ ‘çŠ¶ç»“æ„ ã€‚</p></li><li><p><strong>æ•°æ®æµå‘</strong>ï¼šæ•°æ®ä»æ ‘çš„å¶å­èŠ‚ç‚¹ï¼ˆLeavesï¼‰æµå‘æ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰ï¼Œæ ¹èŠ‚ç‚¹çš„è¾“å‡ºå³ä¸ºæŸ¥è¯¢ç»“æœ ã€‚</p></li><li><p><strong>æ“ä½œç¬¦ (Operators)</strong>ï¼šé€šå¸¸æ˜¯äºŒå…ƒçš„ï¼ˆ1-2ä¸ªå­èŠ‚ç‚¹ï¼‰ï¼Œè´Ÿè´£å…·ä½“çš„æ•°æ®å¤„ç†é€»è¾‘ï¼ˆå¦‚è¿‡æ»¤ã€è¿æ¥ã€æ’åºï¼‰ã€‚</p></li></ul><h3 id="å…³é”®æ¦‚å¿µï¼šæµæ°´çº¿ä¸é˜»æ–­-Pipeline-Breakers"><a href="#å…³é”®æ¦‚å¿µï¼šæµæ°´çº¿ä¸é˜»æ–­-Pipeline-Breakers" class="headerlink" title="å…³é”®æ¦‚å¿µï¼šæµæ°´çº¿ä¸é˜»æ–­ (Pipeline &amp; Breakers)"></a>å…³é”®æ¦‚å¿µï¼šæµæ°´çº¿ä¸é˜»æ–­ (Pipeline &amp; Breakers)</h3><p>ç†è§£æŸ¥è¯¢æ‰§è¡Œçš„æ ¸å¿ƒåœ¨äºç†è§£æ•°æ®æ˜¯å¦‚ä½•æµåŠ¨çš„ï¼š</p><ul><li><p><strong>æµæ°´çº¿ (Pipeline)</strong>ï¼šç†æƒ³æƒ…å†µä¸‹ï¼Œæ“ä½œç¬¦ä¹‹é—´åº”è¯¥åƒæµæ°´çº¿ä¸€æ ·ã€‚ä¸Šæ¸¸ç®—å­äº§ç”Ÿä¸€ä¸ªå…ƒç»„ï¼ˆTupleï¼‰ï¼Œä¸‹æ¸¸ç®—å­ç«‹å³å¤„ç†ï¼Œä¸­é—´ä¸éœ€è¦è½ç›˜å­˜å‚¨ ã€‚</p></li><li><p><strong>æµæ°´çº¿é˜»æ–­å™¨ (Pipeline Breaker)</strong>ï¼šæŸäº›æ“ä½œç¬¦å¿…é¡»ç­‰å¾…æ‰€æœ‰å­èŠ‚ç‚¹çš„æ•°æ®å…¨éƒ¨åˆ°è¾¾åæ‰èƒ½å¼€å§‹å·¥ä½œã€‚è¿™å°±åƒç”Ÿäº§çº¿ä¸Šçš„â€œè·¯éšœâ€ ã€‚</p></li><li><p><strong>ä¾‹å­</strong>ï¼š<code>JOIN</code> çš„æ„å»ºé˜¶æ®µï¼ˆå¿…é¡»å…ˆæ„å»ºå®Œå“ˆå¸Œè¡¨æ‰èƒ½æ¢æµ‹ï¼‰ã€<code>ORDER BY</code>ï¼ˆå¿…é¡»æ‹¿åˆ°æ‰€æœ‰æ•°æ®æ‰èƒ½æ’åºï¼‰ã€å­æŸ¥è¯¢ ã€‚</p></li></ul><hr><h2 id="2-å¤„ç†æ¨¡å‹-Processing-Models"><a href="#2-å¤„ç†æ¨¡å‹-Processing-Models" class="headerlink" title="2. å¤„ç†æ¨¡å‹ (Processing Models)"></a>2. å¤„ç†æ¨¡å‹ (Processing Models)</h2><p>DBMS å¤„ç†æ¨¡å‹å®šä¹‰äº†ç³»ç»Ÿå¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’ï¼Œç‰¹åˆ«æ˜¯æ“ä½œç¬¦ä¹‹é—´å¦‚ä½•ä¼ é€’æ•°æ®ï¼ˆæ˜¯ä¸€ä¸ªä¸ªä¼ ã€ä¸€æ‰¹æ‰¹ä¼ ï¼Œè¿˜æ˜¯å…¨éƒ¨ä¼ ï¼‰ã€‚ä¸»è¦æœ‰ä¸‰ç§æ¨¡å‹ï¼š</p><h3 id="1-è¿­ä»£å™¨æ¨¡å‹-Iterator-Model-Volcano-Model-Pipeline-Model"><a href="#1-è¿­ä»£å™¨æ¨¡å‹-Iterator-Model-Volcano-Model-Pipeline-Model" class="headerlink" title="(1) è¿­ä»£å™¨æ¨¡å‹ (Iterator Model) &#x2F; Volcano Model &#x2F; Pipeline Model"></a>(1) è¿­ä»£å™¨æ¨¡å‹ (Iterator Model) &#x2F; Volcano Model &#x2F; Pipeline Model</h3><p>è¿™æ˜¯æœ€å¸¸è§çš„æ¨¡å‹ï¼Œå‡ ä¹æ‰€æœ‰çš„è¡Œå­˜å‚¨ï¼ˆRow-basedï¼‰æ•°æ®åº“éƒ½ä½¿ç”¨å®ƒ ã€‚</p><ul><li><strong>åŸç†</strong>ï¼šæ¯ä¸ªæ“ä½œç¬¦å®ç°ä¸€ä¸ª <code>Next()</code> å‡½æ•°ã€‚<ul><li><p>çˆ¶èŠ‚ç‚¹è°ƒç”¨å­èŠ‚ç‚¹çš„ <code>Next()</code>ã€‚</p></li><li><p>å­èŠ‚ç‚¹è¿”å›<strong>ä¸€ä¸ªå…ƒç»„ (Tuple)</strong> æˆ–ç©ºæ ‡è®°ï¼ˆnull&#x2F;EOFï¼‰ã€‚</p></li><li><p>æ˜¯ä¸€ä¸ªâ€œæ‹‰å–â€ï¼ˆPullï¼‰æ•°æ®çš„è¿‡ç¨‹ï¼Œä» Root åˆ°åº•éƒ¨å¾ªç¯è°ƒç”¨ ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-è¯¾ç¨‹å­¦ä¹ ç¬”è®°2/Iterator.png" alt="è¿­ä»£å™¨" style="display: block; margin: 0 auto; width: 70%; height:70%;"><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><p><strong>æµæ§åˆ¶å‹å¥½</strong>ï¼šéå¸¸é€‚åˆåŸºäºç£ç›˜çš„ç³»ç»Ÿï¼Œå†…å­˜ç”¨é‡å¯æ§ ã€‚</p></li><li><p><strong>æ˜“äºå®ç°</strong>ï¼šæ“ä½œç¬¦ä¹‹é—´è§£è€¦ï¼Œå®¹æ˜“ç»„åˆ ã€‚</p></li><li><p><strong>æ”¯æŒ Limit</strong>ï¼šåªè¦çˆ¶èŠ‚ç‚¹æ‹¿å¤Ÿäº†æ•°æ®ï¼Œå°±å¯ä»¥åœæ­¢è°ƒç”¨ <code>Next()</code> ã€‚</p></li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå‡½æ•°è°ƒç”¨å¼€é”€å¤§ï¼ˆæ¯ä¸ª Tuple è°ƒç”¨ä¸€æ¬¡ï¼‰ï¼Œä¸åˆ©äº CPU æµæ°´çº¿å’Œç¼“å­˜ä¼˜åŒ–ã€‚</p></li></ul><h3 id="2-ç‰©åŒ–æ¨¡å‹-Materialization-Model"><a href="#2-ç‰©åŒ–æ¨¡å‹-Materialization-Model" class="headerlink" title="(2) ç‰©åŒ–æ¨¡å‹ (Materialization Model)"></a>(2) ç‰©åŒ–æ¨¡å‹ (Materialization Model)</h3><p>è¿™ç§æ¨¡å‹æ˜¯è¿­ä»£å™¨æ¨¡å‹çš„ä¸€ç§ç‰¹åŒ–ï¼ŒåŒºåˆ«åœ¨äºå®ƒä¸æµå¼ä¼ è¾“ï¼Œè€Œæ˜¯â€œä¸€æ¬¡æ€§äº¤è´§â€ã€‚</p><ul><li><p><strong>åŸç†</strong>ï¼šæ¯ä¸ªæ“ä½œç¬¦å®ç°ä¸€ä¸ª <code>Output()</code> å‡½æ•°ã€‚è¯¥å‡½æ•°ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰è¾“å…¥ï¼Œå¹¶å°†<strong>æ‰€æœ‰ç»“æœ</strong>ç‰©åŒ–ï¼ˆå­˜å‚¨ï¼‰åä¸€æ¬¡æ€§è¿”å›ç»™çˆ¶èŠ‚ç‚¹ ã€‚</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><p><strong>OLTP (è”æœºäº‹åŠ¡å¤„ç†)</strong>ï¼šé€‚åˆï¼Œå› ä¸º OLTP æŸ¥è¯¢é€šå¸¸åªæ¶‰åŠå°‘é‡æ•°æ®ï¼Œå‡å°‘äº†å‡½æ•°è°ƒç”¨æ¬¡æ•° ã€‚</p></li><li><p><strong>ä¸é€‚åˆ OLAP</strong>ï¼šå¦‚æœä¸­é—´ç»“æœé›†å¾ˆå¤§ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ï¼Œæ•ˆç‡æä½ ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-è¯¾ç¨‹å­¦ä¹ ç¬”è®°2/Materialization.png" alt="ç‰©åŒ–æ¨¡å‹" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h3 id="3-å‘é‡åŒ–-æ‰¹å¤„ç†æ¨¡å‹-Vectorized-Batch-Model"><a href="#3-å‘é‡åŒ–-æ‰¹å¤„ç†æ¨¡å‹-Vectorized-Batch-Model" class="headerlink" title="(3) å‘é‡åŒ–&#x2F;æ‰¹å¤„ç†æ¨¡å‹ (Vectorized &#x2F; Batch Model)"></a>(3) å‘é‡åŒ–&#x2F;æ‰¹å¤„ç†æ¨¡å‹ (Vectorized &#x2F; Batch Model)</h3><p>è¿™æ˜¯ç°ä»£åˆ†æå‹æ•°æ®åº“ï¼ˆå¦‚ Snowflake, Redshift, DuckDBï¼‰çš„æ ‡å‡†ã€‚</p><ul><li><p><strong>åŸç†</strong>ï¼šç»“åˆäº†è¿­ä»£å™¨çš„æµå¼æ€æƒ³å’Œç‰©åŒ–çš„æ‰¹é‡æ€æƒ³ã€‚æ¯ä¸ªæ“ä½œç¬¦ä¹Ÿæœ‰ <code>Next()</code> å‡½æ•°ï¼Œä½†å®ƒæ¯æ¬¡è¿”å›<strong>ä¸€æ‰¹å…ƒç»„ (Batch&#x2F;Vector)</strong>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><p><strong>å‡å°‘å¼€é”€</strong>ï¼šå°†å‡½æ•°è°ƒç”¨çš„å¼€é”€åˆ†æ‘Šåˆ°ä¸€æ‰¹æ•°æ®ä¸Š ã€‚</p></li><li><p><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>ï¼šéå¸¸é€‚åˆåˆ©ç”¨ CPU çš„ <strong>SIMD</strong> (å•æŒ‡ä»¤å¤šæ•°æ®) æŒ‡ä»¤é›†æ¥å¹¶è¡Œå¤„ç†æ•°æ® ã€‚</p></li><li><p><strong>OLAP ç†æƒ³é€‰æ‹©</strong>ï¼šç‰¹åˆ«æ˜¯å¯¹äºåˆ—å¼å­˜å‚¨ï¼Œæ‰«æå¤§é‡æ•°æ®æå…¶é«˜æ•ˆ ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-è¯¾ç¨‹å­¦ä¹ ç¬”è®°2/Vectorized.png" alt="æ‰¹å¤„ç†æ¨¡å‹" style="display: block; margin: 0 auto; width: 70%; height:70%;"><hr><h2 id="3-è®¿é—®æ–¹æ³•-Access-Methods"><a href="#3-è®¿é—®æ–¹æ³•-Access-Methods" class="headerlink" title="3. è®¿é—®æ–¹æ³• (Access Methods)"></a>3. è®¿é—®æ–¹æ³• (Access Methods)</h2><p>è®¿é—®æ–¹æ³•æ˜¯ DBMS ä»è¡¨ä¸­è¯»å–æ•°æ®çš„æ–¹å¼ã€‚ä¸»è¦æœ‰ä¸¤ç§è·¯å¾„ï¼šå…¨è¡¨æ‰«ææˆ–é€šè¿‡ç´¢å¼•ã€‚</p><h3 id="1-é¡ºåºæ‰«æ-Sequential-Scan"><a href="#1-é¡ºåºæ‰«æ-Sequential-Scan" class="headerlink" title="(1) é¡ºåºæ‰«æ (Sequential Scan)"></a>(1) é¡ºåºæ‰«æ (Sequential Scan)</h3><p>DBMS éå†è¡¨ä¸­çš„æ¯ä¸€é¡µï¼Œä»ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰è·å–æ•°æ®å¹¶æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ¡ä»¶ ã€‚è¿™é€šå¸¸æ˜¯æ•ˆç‡æœ€ä½çš„æ–¹æ³•ï¼Œä½†æœ‰å¾ˆå¤šä¼˜åŒ–æ‰‹æ®µï¼š</p><ul><li><p><strong>é¢„å– (Prefetching)</strong>ï¼šæå‰åŠ è½½åç»­é¡µé¢ï¼Œæ©ç›– I&#x2F;O å»¶è¿Ÿ ã€‚</p></li><li><p><strong>ç»•è¿‡ç¼“å†²æ±  (Buffer Pool Bypass)</strong>ï¼šæ‰«æå¤§é‡æ•°æ®æ—¶ä¸æ±¡æŸ“çƒ­æ•°æ®ç¼“å­˜ï¼Œç›´æ¥åœ¨å±€éƒ¨å†…å­˜å¤„ç† ã€‚</p></li><li><p><strong>å¹¶è¡ŒåŒ– (Parallelization)</strong>ï¼šå¤šçº¿ç¨‹åŒæ—¶æ‰« ã€‚</p></li><li><p><strong>Zone Map (åŒºåŸŸæ˜ å°„ &#x2F; Lossless Data Skipping)</strong>ï¼š</p><ul><li><p><strong>åŸç†</strong>ï¼šåœ¨æ¯é¡µæ•°æ®çš„å¤´éƒ¨æˆ–å•ç‹¬åŒºåŸŸå­˜å‚¨é¢„è®¡ç®—çš„èšåˆä¿¡æ¯ï¼ˆå¦‚ Min, Max, Sum, Countï¼‰ã€‚</p></li><li><p><strong>ä½œç”¨</strong>ï¼šåœ¨è¯»å–é¡µé¢å‰ï¼Œå…ˆæ£€æŸ¥ Zone Mapã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ <code>WHERE val &gt; 600</code>ï¼Œè€Œ Zone Map æ˜¾ç¤ºè¯¥é¡µ <code>MAX = 400</code>ï¼Œåˆ™ç›´æ¥<strong>è·³è¿‡æ•´é¡µ</strong>ï¼Œå®Œå…¨ä¸è¿›è¡Œ I&#x2F;O ã€‚è¿™åœ¨äº‘æ•°æ®åº“ï¼ˆå‡å°‘ç½‘ç»œä¼ è¾“ï¼‰ä¸­å°¤ä¸ºé‡è¦ ã€‚</p></li></ul></li></ul><h3 id="2-ç´¢å¼•æ‰«æ-Index-Scan"><a href="#2-ç´¢å¼•æ‰«æ-Index-Scan" class="headerlink" title="(2) ç´¢å¼•æ‰«æ (Index Scan)"></a>(2) ç´¢å¼•æ‰«æ (Index Scan)</h3><p>DBMS é€‰æ‹©ä¸€ä¸ªç´¢å¼•æ¥æŸ¥æ‰¾æ•°æ®ã€‚ç´¢å¼•å¹¶ä¸æ€»æ˜¯æ¯”é¡ºåºæ‰«æå¿«ã€‚</p><ul><li><p><strong>é€‰æ‹©å›°å¢ƒ</strong>ï¼š</p><ul><li><p>å¦‚æœæŸ¥è¯¢ç»“æœå è¡¨çš„ä¸€å¤§éƒ¨åˆ†ï¼ˆå¦‚99%ï¼‰ï¼Œé¡ºåºæ‰«æå¾€å¾€æ¯”éšæœº I&#x2F;O çš„ç´¢å¼•æ‰«æå¿« ã€‚</p></li><li><p>DBMS éœ€è¦æ ¹æ®ç»Ÿè®¡ä¿¡æ¯ï¼ˆé€‰æ‹©æ€§ Selectivityï¼‰æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç´¢å¼• ã€‚</p></li></ul></li><li><p><strong>å¤šç´¢å¼•æ‰«æ (Multi-Index Scan)</strong>ï¼š</p><ul><li><p>å¦‚æœæŸ¥è¯¢æœ‰å¤šä¸ªæ¡ä»¶ï¼ˆå¦‚ <code>age &lt; 30 AND dept = &#39;CS&#39;</code>ï¼‰ï¼Œå¯ä»¥åˆ†åˆ«åœ¨ä¸¤ä¸ªç´¢å¼•ä¸­æŸ¥æ‰¾ ã€‚</p></li><li><p>è·å–ä¸¤ç»„ Record IDï¼Œåˆ©ç”¨ä½å›¾ï¼ˆBitmapï¼‰æˆ–å“ˆå¸Œè¡¨è®¡ç®—<strong>äº¤é›† (Intersection)</strong>ï¼Œç„¶åå†å›è¡¨å–æ•°æ® ã€‚</p></li></ul></li></ul><hr><h2 id="4-è¡¨è¾¾å¼æ±‚å€¼-Expression-Evaluation"><a href="#4-è¡¨è¾¾å¼æ±‚å€¼-Expression-Evaluation" class="headerlink" title="4. è¡¨è¾¾å¼æ±‚å€¼ (Expression Evaluation)"></a>4. è¡¨è¾¾å¼æ±‚å€¼ (Expression Evaluation)</h2><p><code>WHERE</code> å­å¥ä¸­çš„æ¡ä»¶ï¼ˆå¦‚ <code>B.value = ? + [cite_start]1</code>ï¼‰åœ¨å†…éƒ¨è¢«è¡¨ç¤ºä¸º<strong>è¡¨è¾¾å¼æ ‘ (Expression Tree)</strong> ã€‚</p><ul><li><p><strong>è§£é‡Šæ‰§è¡Œ (Interpretation)</strong>ï¼šDBMS éå†è¿™æ£µæ ‘ï¼Œé€’å½’è°ƒç”¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œè®¡ç®—ã€‚è¿™å¾ˆæ…¢ï¼Œå› ä¸ºæ¯æ¬¡è®¡ç®—éƒ½æœ‰ç±»å‹æ£€æŸ¥å’Œå‡½æ•°è·³è½¬çš„å¼€é”€ ã€‚</p></li><li><p><strong>ä¼˜åŒ–æŠ€æœ¯</strong>ï¼š</p><ol><li><p><strong>JIT ç¼–è¯‘ (Just-In-Time Compilation)</strong>ï¼šå°†æ•´ä¸ªè¡¨è¾¾å¼æ ‘ç¼–è¯‘æˆåŸç”Ÿçš„æœºå™¨ç ï¼Œå»é™¤æ ‘éå†çš„å¼€é”€ï¼Œç›´æ¥æ‰§è¡Œ ã€‚</p></li><li><p><strong>å¸¸é‡æŠ˜å  (Constant Folding)</strong>ï¼šå¦‚æœè¡¨è¾¾å¼ä¸­æœ‰ <code>1 + 2</code>ï¼Œç›´æ¥åœ¨è§„åˆ’é˜¶æ®µç®—æˆ <code>3</code> ã€‚</p></li></ol></li></ul><hr><h2 id="5-ä¿®æ”¹æŸ¥è¯¢-Modification-Queries-ä¸ä¸‡åœ£èŠ‚é—®é¢˜"><a href="#5-ä¿®æ”¹æŸ¥è¯¢-Modification-Queries-ä¸ä¸‡åœ£èŠ‚é—®é¢˜" class="headerlink" title="5. ä¿®æ”¹æŸ¥è¯¢ (Modification Queries)ä¸ä¸‡åœ£èŠ‚é—®é¢˜"></a>5. ä¿®æ”¹æŸ¥è¯¢ (Modification Queries)ä¸ä¸‡åœ£èŠ‚é—®é¢˜</h2><p>å¯¹äº <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>ï¼Œæ“ä½œç¬¦ä¸ä»…è¦ä¿®æ”¹æ•°æ®ï¼Œè¿˜è¦è´Ÿè´£æ£€æŸ¥çº¦æŸï¼ˆConstraintsï¼‰å’Œæ›´æ–°ç´¢å¼• ã€‚</p><h3 id="ä¸‡åœ£èŠ‚é—®é¢˜-Halloween-Problem"><a href="#ä¸‡åœ£èŠ‚é—®é¢˜-Halloween-Problem" class="headerlink" title="ä¸‡åœ£èŠ‚é—®é¢˜ (Halloween Problem)"></a>ä¸‡åœ£èŠ‚é—®é¢˜ (Halloween Problem)</h3><p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„æ•°æ®åº“å¼‚å¸¸ç°è±¡ï¼Œç”± IBM ç ”ç©¶å‘˜åœ¨ 1976 å¹´ä¸‡åœ£èŠ‚å‘ç° ã€‚</p><ul><li><p><strong>ç°è±¡</strong>ï¼šå‡è®¾ä½ è¦ç»™æ‰€æœ‰è–ªæ°´ä½äº 1000 çš„å‘˜å·¥åŠ è–ª 10%ã€‚</p><ul><li><p>ä½ æ›´æ–°äº†ç¬¬ä¸€ä¸ªå‘˜å·¥ï¼Œè–ªæ°´å˜é«˜äº†ã€‚</p></li><li><p>å¦‚æœæ›´æ–°æ“ä½œæ”¹å˜äº†å…ƒç»„åœ¨ç‰©ç†å­˜å‚¨æˆ–ç´¢å¼•ä¸­çš„ä½ç½®ï¼Œæ‰«ææ“ä½œç¬¦å¯èƒ½ä¼š<strong>å†æ¬¡æ‰«æåˆ°è¿™ä¸ªå·²ç»è¢«æ›´æ–°è¿‡çš„å…ƒç»„</strong> ã€‚</p></li><li><p>ç»“æœï¼šè¯¥å‘˜å·¥è¢«åå¤åŠ è–ªï¼Œç”šè‡³å¯¼è‡´æ— é™å¾ªç¯ã€‚</p></li></ul></li><li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šDBMS å¿…é¡»è·Ÿè¸ªå“ªäº›å…ƒç»„å·²ç»è¢«ä¿®æ”¹è¿‡ï¼ˆä¾‹å¦‚è®°å½• Record IDsï¼‰ï¼Œé˜²æ­¢é‡å¤å¤„ç† ã€‚</p></li></ul><hr><h3 id="æ€»ç»“ä¸ä¸‹ä¸€æ­¥"><a href="#æ€»ç»“ä¸ä¸‹ä¸€æ­¥" class="headerlink" title="æ€»ç»“ä¸ä¸‹ä¸€æ­¥"></a>æ€»ç»“ä¸ä¸‹ä¸€æ­¥</h3><p>è¿™èŠ‚è¯¾çš„æ ¸å¿ƒåœ¨äºç†è§£ <strong>Query Plan æ˜¯å¦‚ä½•è¢«â€œæ‰§è¡Œâ€çš„</strong>ã€‚</p><ol><li><strong>Iterator æ¨¡å‹</strong> æ˜¯è¿™ä¸€å±‚çš„åŸºçŸ³ï¼Œç®€å•ä½†æœ‰è°ƒç”¨å¼€é”€ã€‚</li><li><strong>Vectorization æ¨¡å‹</strong> é€šè¿‡æ‰¹å¤„ç†è§£å†³äº†å¼€é”€é—®é¢˜ï¼Œæ˜¯ç°ä»£ OLAP çš„æ ‡é…ã€‚</li><li><strong>Access Methods</strong> å†³å®šäº†æœ€åº•å±‚çš„ I&#x2F;O æ•ˆç‡ï¼ŒZone Map å’Œ Index Selection æ˜¯å…¶ä¸­çš„å…³é”®ä¼˜åŒ–ç‚¹ã€‚</li></ol><hr><h1 id="ç¬¬åå››è®²ï¼šQuery-Processing-IIï¼ˆå¹¶è¡ŒæŸ¥è¯¢æ‰§è¡Œï¼‰"><a href="#ç¬¬åå››è®²ï¼šQuery-Processing-IIï¼ˆå¹¶è¡ŒæŸ¥è¯¢æ‰§è¡Œï¼‰" class="headerlink" title="ç¬¬åå››è®²ï¼šQuery Processing IIï¼ˆå¹¶è¡ŒæŸ¥è¯¢æ‰§è¡Œï¼‰"></a>ç¬¬åå››è®²ï¼šQuery Processing IIï¼ˆå¹¶è¡ŒæŸ¥è¯¢æ‰§è¡Œï¼‰</h1><h2 id="1-æ ¸å¿ƒèƒŒæ™¯ä¸æ„ä¹‰"><a href="#1-æ ¸å¿ƒèƒŒæ™¯ä¸æ„ä¹‰" class="headerlink" title="1. æ ¸å¿ƒèƒŒæ™¯ä¸æ„ä¹‰"></a>1. æ ¸å¿ƒèƒŒæ™¯ä¸æ„ä¹‰</h2><p>åœ¨æ—©æœŸçš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å‡è®¾æŸ¥è¯¢æ˜¯ç”±å•ä¸ªçº¿ç¨‹ï¼ˆWorkerï¼‰æ‰§è¡Œçš„ ã€‚ç„¶è€Œï¼Œç°ä»£ DBMS ä¸ºäº†æå‡æ€§èƒ½ï¼Œé€šå¸¸é‡‡ç”¨<strong>å¹¶è¡Œæ‰§è¡Œï¼ˆParallel Executionï¼‰</strong> ã€‚</p><p><strong>å¹¶è¡Œæ‰§è¡Œçš„ä¸»è¦ä¼˜åŠ¿ï¼š</strong></p><ul><li><p><strong>æ€§èƒ½æå‡ï¼š</strong> æé«˜ååé‡ï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰å¹¶é™ä½å“åº”å»¶è¿Ÿ ã€‚</p></li><li><p><strong>å“åº”æ€§ä¸å¯ç”¨æ€§ï¼š</strong> å¢å¼ºå¤–éƒ¨å®¢æˆ·ç«¯çš„äº¤äº’ä½“éªŒ ã€‚</p></li><li><p><strong>é™ä½æ€»æ‹¥æœ‰æˆæœ¬ (TCO)ï¼š</strong> é€šè¿‡æ›´é«˜æ•ˆåœ°åˆ©ç”¨ç¡¬ä»¶èµ„æºå’Œé™ä½èƒ½è€—ï¼Œä¼˜åŒ–äº‘ç«¯ç³»ç»Ÿçš„è¿è¡Œæˆæœ¬ ã€‚</p></li></ul><h3 id="å¹¶è¡Œï¼ˆParallelï¼‰ä¸åˆ†å¸ƒå¼ï¼ˆDistributedï¼‰çš„åŒºåˆ«"><a href="#å¹¶è¡Œï¼ˆParallelï¼‰ä¸åˆ†å¸ƒå¼ï¼ˆDistributedï¼‰çš„åŒºåˆ«" class="headerlink" title="å¹¶è¡Œï¼ˆParallelï¼‰ä¸åˆ†å¸ƒå¼ï¼ˆDistributedï¼‰çš„åŒºåˆ«"></a>å¹¶è¡Œï¼ˆParallelï¼‰ä¸åˆ†å¸ƒå¼ï¼ˆDistributedï¼‰çš„åŒºåˆ«</h3><p>è™½ç„¶ä¸¤è€…éƒ½å°†æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªèµ„æºä¸Š ï¼Œä½†ç¯å¢ƒå®Œå…¨ä¸åŒï¼š</p><ul><li><p><strong>å¹¶è¡Œæ•°æ®åº“ï¼š</strong> èŠ‚ç‚¹ç‰©ç†è·ç¦»è¿‘ï¼Œé€šè¿‡é«˜é€Ÿäº’è¿é€šä¿¡ã€‚é€šä¿¡é€Ÿåº¦å¿«ä¸”å»‰ä»·ï¼Œæ•…éšœç‡ä½ ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼æ•°æ®åº“ï¼š</strong> èŠ‚ç‚¹è·¨æœºæ¶æˆ–æ•°æ®ä¸­å¿ƒã€‚é€šä¿¡ä½¿ç”¨å…¬å…±ç½‘ç»œï¼Œæˆæœ¬é«˜ã€å»¶è¿Ÿå¤§ï¼Œä¸”å¿…é¡»è€ƒè™‘èŠ‚ç‚¹æ•…éšœ ã€‚</p></li></ul><hr><h2 id="2-DBMS-è¿›ç¨‹æ¨¡å‹-Process-Models"><a href="#2-DBMS-è¿›ç¨‹æ¨¡å‹-Process-Models" class="headerlink" title="2. DBMS è¿›ç¨‹æ¨¡å‹ (Process Models)"></a>2. DBMS è¿›ç¨‹æ¨¡å‹ (Process Models)</h2><p>è¿›ç¨‹æ¨¡å‹å®šä¹‰äº†ç³»ç»Ÿå¦‚ä½•æ”¯æŒå¤šç”¨æˆ·çš„å¹¶å‘è¯·æ±‚ ã€‚</p><h3 id="A-è¿›ç¨‹æ¯å·¥ä½œè€…-Process-per-Worker"><a href="#A-è¿›ç¨‹æ¯å·¥ä½œè€…-Process-per-Worker" class="headerlink" title="A. è¿›ç¨‹æ¯å·¥ä½œè€… (Process per Worker)"></a>A. è¿›ç¨‹æ¯å·¥ä½œè€… (Process per Worker)</h3><ul><li><p><strong>åŸç†ï¼š</strong> æ¯ä¸ªå·¥ä½œè€…æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹ ã€‚</p></li><li><p><strong>è°ƒåº¦ï¼š</strong> ä¾èµ–æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹ï¼š</strong> éš”ç¦»æ€§å¼ºï¼Œå•ä¸ªè¿›ç¨‹å´©æºƒä¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå®•æœº ã€‚</p></li><li><p><strong>ç¼ºç‚¹ï¼š</strong> ä¾èµ–å…±äº«å†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰å¼€é”€å¤§ ã€‚</p></li><li><p><strong>ä»£è¡¨æ¡ˆä¾‹ï¼š</strong> Postgres, Oracle, IBM DB2 ã€‚</p></li></ul><h3 id="B-çº¿ç¨‹æ¯å·¥ä½œè€…-Thread-per-Worker-â€”â€”-ç°ä»£ä¸»æµ"><a href="#B-çº¿ç¨‹æ¯å·¥ä½œè€…-Thread-per-Worker-â€”â€”-ç°ä»£ä¸»æµ" class="headerlink" title="B. çº¿ç¨‹æ¯å·¥ä½œè€… (Thread per Worker) â€”â€” ç°ä»£ä¸»æµ"></a>B. çº¿ç¨‹æ¯å·¥ä½œè€… (Thread per Worker) â€”â€” ç°ä»£ä¸»æµ</h3><ul><li><p><strong>åŸç†ï¼š</strong> ä¸€ä¸ªæ•°æ®åº“è¿›ç¨‹å†…åŒ…å«å¤šä¸ªå·¥ä½œçº¿ç¨‹ ã€‚</p></li><li><p><strong>è°ƒåº¦ï¼š</strong> DBMS å¯ä»¥å®Œå…¨æ§åˆ¶ä»»åŠ¡è°ƒåº¦ï¼Œæ‹¥æœ‰æ›´é«˜çš„çµæ´»æ€§ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹ï¼š</strong> ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å°ï¼Œæ— éœ€å¤æ‚çš„è·¨è¿›ç¨‹å…±äº«æ¨¡å‹ ã€‚</p></li><li><p><strong>ç¼ºç‚¹ï¼š</strong> ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹ï¼ˆæ•´ä¸ªæ•°æ®åº“ï¼‰å´©æºƒ ã€‚</p></li><li><p><strong>ä»£è¡¨æ¡ˆä¾‹ï¼š</strong> MySQL, Microsoft SQL Server ã€‚</p></li></ul><h3 id="C-åµŒå…¥å¼æ¨¡å‹-Embedded-DBMS"><a href="#C-åµŒå…¥å¼æ¨¡å‹-Embedded-DBMS" class="headerlink" title="C. åµŒå…¥å¼æ¨¡å‹ (Embedded DBMS)"></a>C. åµŒå…¥å¼æ¨¡å‹ (Embedded DBMS)</h3><ul><li><p><strong>åŸç†ï¼š</strong> æ•°æ®åº“è¿è¡Œåœ¨åº”ç”¨ç¨‹åºçš„åŒä¸€åœ°å€ç©ºé—´å†… ã€‚</p></li><li><p><strong>è°ƒåº¦ï¼š</strong> ç”±åº”ç”¨ç¨‹åºè´Ÿè´£çº¿ç¨‹è°ƒåº¦ ã€‚</p></li><li><p><strong>ä»£è¡¨æ¡ˆä¾‹ï¼š</strong> SQLite, DuckDB, RocksDB ã€‚</p></li></ul><hr><h2 id="3-å¹¶è¡Œæ‰§è¡Œçš„ç±»å‹"><a href="#3-å¹¶è¡Œæ‰§è¡Œçš„ç±»å‹" class="headerlink" title="3. å¹¶è¡Œæ‰§è¡Œçš„ç±»å‹"></a>3. å¹¶è¡Œæ‰§è¡Œçš„ç±»å‹</h2><p>å¹¶è¡Œå¯ä»¥ä»æŸ¥è¯¢é—´ï¼ˆInterï¼‰å’ŒæŸ¥è¯¢å†…ï¼ˆIntraï¼‰ä¸¤ä¸ªç»´åº¦å±•å¼€ã€‚</p><h3 id="3-1-æŸ¥è¯¢é—´å¹¶è¡Œ-Inter-Query-Parallelism"><a href="#3-1-æŸ¥è¯¢é—´å¹¶è¡Œ-Inter-Query-Parallelism" class="headerlink" title="3.1 æŸ¥è¯¢é—´å¹¶è¡Œ (Inter-Query Parallelism)"></a>3.1 æŸ¥è¯¢é—´å¹¶è¡Œ (Inter-Query Parallelism)</h3><ul><li><p><strong>å®šä¹‰ï¼š</strong> å¤šä¸ªä¸åŒçš„æŸ¥è¯¢åŒæ—¶æ‰§è¡Œ ã€‚</p></li><li><p><strong>æ ¸å¿ƒæŒ‘æˆ˜ï¼š</strong> å¦‚æœå¤šä¸ªæŸ¥è¯¢åŒæ—¶æ›´æ–°ç›¸åŒçš„æ•°æ®ï¼Œä¼šäº§ç”Ÿå¹¶å‘å†²çª ã€‚</p></li></ul><h3 id="3-2-æŸ¥è¯¢å†…å¹¶è¡Œ-Intra-Query-Parallelism"><a href="#3-2-æŸ¥è¯¢å†…å¹¶è¡Œ-Intra-Query-Parallelism" class="headerlink" title="3.2 æŸ¥è¯¢å†…å¹¶è¡Œ (Intra-Query Parallelism)"></a>3.2 æŸ¥è¯¢å†…å¹¶è¡Œ (Intra-Query Parallelism)</h3><ul><li><strong>å®šä¹‰ï¼š</strong> å¹¶è¡Œæ‰§è¡Œå•ä¸ªæŸ¥è¯¢ä¸­çš„å„ä¸ªæ“ä½œ ã€‚</li></ul><h4 id="ç®—å­å†…å¹¶è¡Œ-Intra-Operator-Horizontal"><a href="#ç®—å­å†…å¹¶è¡Œ-Intra-Operator-Horizontal" class="headerlink" title="ç®—å­å†…å¹¶è¡Œ (Intra-Operator &#x2F; Horizontal)"></a>ç®—å­å†…å¹¶è¡Œ (Intra-Operator &#x2F; Horizontal)</h4><ul><li><p><strong>åŸç†ï¼š</strong> å°†å•ä¸ªç®—å­åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„ç‰‡æ®µï¼ˆFragmentsï¼‰ï¼Œæ¯ä¸ªç‰‡æ®µåœ¨ä¸åŒçš„æ•°æ®å­é›†ä¸Šæ‰§è¡Œç›¸åŒåŠŸèƒ½ ã€‚</p></li><li><p><strong>å…³é”®ç»„ä»¶ï¼š</strong> <strong>äº¤æ¢ç®—å­ (Exchange Operator)</strong> ã€‚</p><ul><li><p><strong>Gatherï¼š</strong> å°†å¤šä¸ªæµåˆå¹¶ä¸ºä¸€ä¸ª ã€‚</p></li><li><p><strong>Distributeï¼š</strong> å°†ä¸€ä¸ªæµæ‹†åˆ†ä¸ºå¤šä¸ª ã€‚</p></li><li><p><strong>Repartitionï¼š</strong> é‡æ–°ç»„ç»‡å¤šä¸ªè¾“å…¥æµåˆ°å¤šä¸ªè¾“å‡ºæµ ã€‚</p></li></ul></li></ul><h4 id="ç®—å­é—´å¹¶è¡Œ-Inter-Operator-Vertical-Pipelining"><a href="#ç®—å­é—´å¹¶è¡Œ-Inter-Operator-Vertical-Pipelining" class="headerlink" title="ç®—å­é—´å¹¶è¡Œ (Inter-Operator &#x2F; Vertical &#x2F; Pipelining)"></a>ç®—å­é—´å¹¶è¡Œ (Inter-Operator &#x2F; Vertical &#x2F; Pipelining)</h4><ul><li><strong>åŸç†ï¼š</strong> ç±»ä¼¼äºæµæ°´çº¿ï¼Œä¸Šæ¸¸ç®—å­åœ¨ä¸‹æ¸¸ç®—å­äº§ç”Ÿæ•°æ®æ—¶ç«‹å³å¼€å§‹å¤„ç†ï¼Œæ— éœ€ç­‰å¾…æ‰€æœ‰æ•°æ®ç‰©åŒ– ã€‚</li></ul><h4 id="ä¸›å¼å¹¶è¡Œ-Bushy-Parallelism"><a href="#ä¸›å¼å¹¶è¡Œ-Bushy-Parallelism" class="headerlink" title="ä¸›å¼å¹¶è¡Œ (Bushy Parallelism)"></a>ä¸›å¼å¹¶è¡Œ (Bushy Parallelism)</h4><ul><li><strong>åŸç†ï¼š</strong> ç»“åˆäº†ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œä¸åŒçš„å·¥ä½œè€…åŒæ—¶æ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’ä¸­ä¸åŒéƒ¨åˆ†çš„å¤šä¸ªç®—å­ ã€‚</li></ul><hr><h2 id="4-I-O-å¹¶è¡Œ-I-O-Parallelism"><a href="#4-I-O-å¹¶è¡Œ-I-O-Parallelism" class="headerlink" title="4. I&#x2F;O å¹¶è¡Œ (I&#x2F;O Parallelism)"></a>4. I&#x2F;O å¹¶è¡Œ (I&#x2F;O Parallelism)</h2><p>å¦‚æœç£ç›˜æ˜¯ç“¶é¢ˆï¼Œå¢åŠ  CPU çº¿ç¨‹ä¹Ÿæ— æ³•æå‡æ€§èƒ½ ã€‚</p><ul><li><p><strong>å¤šç£ç›˜å¹¶è¡Œ (Multi-Disk)ï¼š</strong> é€šè¿‡ RAID æˆ–å­˜å‚¨è®¾å¤‡å°†æ–‡ä»¶åˆ†æ•£åœ¨ç‰©ç†ç¡¬ç›˜ä¸Šï¼Œè¿™å¯¹ DBMS æ˜¯é€æ˜çš„ ã€‚</p></li><li><p><strong>æ•°æ®åº“åˆ†åŒº (Database Partitioning)ï¼š</strong> å°†æ•°æ®åº“ç‰©ç†æ‹†åˆ†ä¸ºä¸ç›¸äº¤çš„å­é›†ï¼Œå­˜å‚¨åœ¨ä¸åŒç£ç›˜ã€‚</p></li><li><p><strong>é€»è¾‘åˆ†åŒºï¼š</strong> å°†ä¸€ä¸ªé€»è¾‘è¡¨æ‹†åˆ†ä¸ºç‰©ç†æ®µç®¡ç†ï¼Œå¯¹åº”ç”¨é€æ˜ ã€‚</p></li></ul><hr><h3 id="è¡¥å……ç†è§£ï¼šä¸ºä»€ä¹ˆ-DBMS-è¦â€œå¤ºå–â€è°ƒåº¦æƒï¼Ÿ"><a href="#è¡¥å……ç†è§£ï¼šä¸ºä»€ä¹ˆ-DBMS-è¦â€œå¤ºå–â€è°ƒåº¦æƒï¼Ÿ" class="headerlink" title="è¡¥å……ç†è§£ï¼šä¸ºä»€ä¹ˆ DBMS è¦â€œå¤ºå–â€è°ƒåº¦æƒï¼Ÿ"></a>è¡¥å……ç†è§£ï¼šä¸ºä»€ä¹ˆ DBMS è¦â€œå¤ºå–â€è°ƒåº¦æƒï¼Ÿ</h3><p>åœ¨ç¬”è®°ä¸­æåˆ°ï¼ŒDBMS æ€»æ˜¯æ¯”æ“ä½œç³»ç»Ÿæ›´äº†è§£æŸ¥è¯¢è®¡åˆ’ï¼Œå› æ­¤å€¾å‘äºè‡ªå·±è°ƒåº¦ ã€‚è¿™æ˜¯å› ä¸ºï¼š</p><ol><li><strong>æ•°æ®ä½ç½®æ„ŸçŸ¥ï¼š</strong> DBMS çŸ¥é“æ•°æ®åœ¨å“ªä¸ª Buffer Pool é¡µé¢ï¼Œå¯ä»¥å®ç°â€œè®¡ç®—å‘æ•°æ®ç§»åŠ¨â€ã€‚</li><li><strong>ä¾èµ–å…³ç³»æ„ŸçŸ¥ï¼š</strong> DBMS çŸ¥é“ç®—å­é—´çš„å…ˆåé¡ºåºï¼ˆå¦‚ Join å¿…é¡»åœ¨ Scan åï¼‰ï¼Œè€Œ OS åªæŠŠå®ƒä»¬çœ‹ä½œæ™®é€šçš„çº¿ç¨‹ã€‚</li></ol><p>è¿™ä»½ç¬”è®°åŸºäºä½ æä¾›çš„ CMU 15-445&#x2F;645 è¯¾ç¨‹èµ„æ–™ï¼ˆLecture #15: Query Planning &amp; Optimizationï¼‰ï¼Œç³»ç»Ÿåœ°æ€»ç»“äº†æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æ ¸å¿ƒæ¶æ„ã€ç­–ç•¥ä¸ç®—æ³•ã€‚</p><hr><h1 id="ç¬¬åäº”è®²ï¼šæŸ¥è¯¢è§„åˆ’ä¸ä¼˜åŒ–-Query-Planning-Optimization"><a href="#ç¬¬åäº”è®²ï¼šæŸ¥è¯¢è§„åˆ’ä¸ä¼˜åŒ–-Query-Planning-Optimization" class="headerlink" title="ç¬¬åäº”è®²ï¼šæŸ¥è¯¢è§„åˆ’ä¸ä¼˜åŒ– (Query Planning &amp; Optimization)"></a>ç¬¬åäº”è®²ï¼šæŸ¥è¯¢è§„åˆ’ä¸ä¼˜åŒ– (Query Planning &amp; Optimization)</h1><h2 id="1-ä¼˜åŒ–å™¨æ¦‚è¿°-Overview"><a href="#1-ä¼˜åŒ–å™¨æ¦‚è¿°-Overview" class="headerlink" title="1. ä¼˜åŒ–å™¨æ¦‚è¿° (Overview)"></a>1. ä¼˜åŒ–å™¨æ¦‚è¿° (Overview)</h2><p>ç”±äº SQL æ˜¯<strong>å£°æ˜å¼ (Declarative)</strong> è¯­è¨€ï¼Œç”¨æˆ·åªè¯´æ˜â€œæƒ³è¦ä»€ä¹ˆâ€ï¼Œè€Œä¸è¯´æ˜â€œå¦‚ä½•è®¡ç®—â€ ã€‚DBMS çš„ä»»åŠ¡æ˜¯å°† SQL è¯­å¥è½¬åŒ–ä¸ºé«˜æ•ˆçš„<strong>å¯æ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’</strong> ã€‚</p><ul><li><p><strong>æ ¸å¿ƒæŒ‘æˆ˜</strong>ï¼šåŒä¸€ä¸ªæŸ¥è¯¢æœ‰å¤šç§æ‰§è¡Œæ–¹å¼ï¼ˆå¦‚ä¸åŒçš„è¿æ¥ç®—æ³•ï¼‰ï¼Œæ€§èƒ½å·®å¼‚å·¨å¤§ ã€‚</p></li><li><p><strong>å†å²åœ°ä½</strong>ï¼šæŸ¥è¯¢ä¼˜åŒ–æ˜¯æ„å»º DBMS æœ€éš¾çš„éƒ¨åˆ† ã€‚æœ€æ—©çš„ä¼˜åŒ–å™¨æºäº 20 ä¸–çºª 70 å¹´ä»£çš„ IBM System R ã€‚</p></li></ul><p>æŸ¥è¯¢å¤„ç†æµç¨‹ ï¼š</p><ol><li><strong>Parser (è§£æå™¨)</strong>ï¼šå°† SQL å­—ç¬¦ä¸²è½¬åŒ–ä¸º<strong>æŠ½è±¡è¯­æ³•æ ‘ (AST)</strong>ã€‚</li><li><strong>Binder (ç»‘å®šå™¨)</strong>ï¼šç»“åˆç³»ç»Ÿç›®å½• (System Catalog)ï¼Œå°† AST ä¸­çš„åç§°æ˜ å°„ä¸ºå†…éƒ¨ IDã€‚</li><li><strong>Optimizer (ä¼˜åŒ–å™¨)</strong>ï¼šæ ¹æ®é€»è¾‘è®¡åˆ’é€‰æ‹©æœ€é«˜æ•ˆçš„ç‰©ç†æ‰§è¡Œè·¯å¾„ã€‚</li></ol><hr><h2 id="2-é€»è¾‘è®¡åˆ’-vs-ç‰©ç†è®¡åˆ’"><a href="#2-é€»è¾‘è®¡åˆ’-vs-ç‰©ç†è®¡åˆ’" class="headerlink" title="2. é€»è¾‘è®¡åˆ’ vs. ç‰©ç†è®¡åˆ’"></a>2. é€»è¾‘è®¡åˆ’ vs. ç‰©ç†è®¡åˆ’</h2><ul><li><strong>é€»è¾‘è®¡åˆ’ (Logical Plan)</strong>ï¼šå¯¹åº”äºå…³ç³»ä»£æ•°è¡¨è¾¾å¼ï¼Œæè¿°æ“ä½œçš„é€»è¾‘é¡ºåºã€‚</li><li><strong>ç‰©ç†è®¡åˆ’ (Physical Plan)</strong>ï¼šå®šä¹‰å…·ä½“çš„æ‰§è¡Œç­–ç•¥å’Œè®¿é—®è·¯å¾„ï¼ˆå¦‚é¡ºåºæ‰«æã€ç´¢å¼•æ‰«æã€å“ˆå¸Œè¿æ¥ç­‰ï¼‰ï¼Œå—æ•°æ®ç‰©ç†æ ¼å¼ï¼ˆå¦‚æ’åºã€å‹ç¼©ï¼‰å½±å“ã€‚</li></ul><hr><h2 id="3-æŸ¥è¯¢ä¼˜åŒ–ä¸¤å¤§ç­–ç•¥"><a href="#3-æŸ¥è¯¢ä¼˜åŒ–ä¸¤å¤§ç­–ç•¥" class="headerlink" title="3. æŸ¥è¯¢ä¼˜åŒ–ä¸¤å¤§ç­–ç•¥"></a>3. æŸ¥è¯¢ä¼˜åŒ–ä¸¤å¤§ç­–ç•¥</h2><h3 id="A-åŸºäºè§„åˆ™çš„é€»è¾‘ä¼˜åŒ–-Rule-based-Heuristics"><a href="#A-åŸºäºè§„åˆ™çš„é€»è¾‘ä¼˜åŒ–-Rule-based-Heuristics" class="headerlink" title="A. åŸºäºè§„åˆ™çš„é€»è¾‘ä¼˜åŒ– (Rule-based &#x2F; Heuristics)"></a>A. åŸºäºè§„åˆ™çš„é€»è¾‘ä¼˜åŒ– (Rule-based &#x2F; Heuristics)</h3><p>åˆ©ç”¨é™æ€è§„åˆ™å’Œæ¨¡å¼åŒ¹é…æ¥è½¬æ¢é€»è¾‘è®¡åˆ’ï¼Œä¸æŸ¥çœ‹å…·ä½“æ•°æ®å†…å®¹ ã€‚</p><ul><li><p><strong>è°“è¯ä¸‹æ¨ (Predicate Pushdown)</strong>ï¼šå°½å¯èƒ½æ—©åœ°è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘è¿›å…¥åç»­ç®—å­çš„æ•°æ®é‡ ã€‚</p></li><li><p><strong>æŠ•å½±ä¸‹æ¨ (Projection Pushdown)</strong>ï¼šå°½æ—©åˆ‡æ‰ä¸éœ€è¦çš„åˆ—ï¼Œå‡å°å…ƒç»„å¤§å°ï¼Œé™ä½ä¸­é—´ç»“æœå¼€é”€ ã€‚</p></li><li><p><strong>è¡¨è¾¾å¼é‡å†™</strong>ï¼šåˆå¹¶å†—ä½™è°“è¯ï¼ˆå¦‚å°† <code>val BETWEEN 1 AND 100 OR val BETWEEN 50 AND 150</code> é‡å†™ä¸º <code>BETWEEN 1 AND 150</code>ï¼‰æˆ–åˆ é™¤ä¸å¯èƒ½æ‰§è¡Œçš„è°“è¯ ã€‚</p></li></ul><h3 id="B-åŸºäºä»£ä»·çš„ç‰©ç†ä¼˜åŒ–-Cost-based-Search"><a href="#B-åŸºäºä»£ä»·çš„ç‰©ç†ä¼˜åŒ–-Cost-based-Search" class="headerlink" title="B. åŸºäºä»£ä»·çš„ç‰©ç†ä¼˜åŒ– (Cost-based Search)"></a>B. åŸºäºä»£ä»·çš„ç‰©ç†ä¼˜åŒ– (Cost-based Search)</h3><p>é€šè¿‡ä¼°ç®—ä¸åŒç­‰ä»·è®¡åˆ’çš„ä»£ä»·ï¼Œé€‰æ‹©ä»£ä»·æœ€ä½çš„ä¸€ä¸ª ã€‚</p><ul><li><strong>è¯„ä»·æŒ‡æ ‡</strong>ï¼šCPU å¼€é”€ã€ç£ç›˜ I&#x2F;Oï¼ˆå—ä¼ è¾“æ•°ï¼‰ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œå¼€é”€ ã€‚</li></ul><hr><h2 id="4-ä»£ä»·ä¼°ç®—-Cost-Estimations"><a href="#4-ä»£ä»·ä¼°ç®—-Cost-Estimations" class="headerlink" title="4. ä»£ä»·ä¼°ç®— (Cost Estimations)"></a>4. ä»£ä»·ä¼°ç®— (Cost Estimations)</h2><p>ä¸ºäº†åœ¨ä¸å®é™…æ‰§è¡ŒæŸ¥è¯¢çš„æƒ…å†µä¸‹ä¼°ç®—ä»£ä»·ï¼ŒDBMS åœ¨ç›®å½•ä¸­ç»´æŠ¤<strong>ç»Ÿè®¡ä¿¡æ¯</strong> ã€‚</p><p>æ ¸å¿ƒç»Ÿè®¡æŒ‡æ ‡ ï¼š</p><ul><li>$N_{R}$ï¼šå…³ç³» $R$ ä¸­çš„å…ƒç»„æ€»æ•°ã€‚</li><li>$V(A, R)$ï¼šå±æ€§ $A$ çš„ä¸åŒå–å€¼æ•° (Distinct Values)ã€‚</li><li><strong>é€‰æ‹©åº¦ (Selectivity)</strong>ï¼šè°“è¯ P è¿‡æ»¤åç¬¦åˆæ¡ä»¶çš„å…ƒç»„æ¯”ä¾‹ ã€‚</li></ul><h3 id="è§£å†³æ•°æ®å€¾æ–œï¼šç›´æ–¹å›¾-Histograms"><a href="#è§£å†³æ•°æ®å€¾æ–œï¼šç›´æ–¹å›¾-Histograms" class="headerlink" title="è§£å†³æ•°æ®å€¾æ–œï¼šç›´æ–¹å›¾ (Histograms)"></a>è§£å†³æ•°æ®å€¾æ–œï¼šç›´æ–¹å›¾ (Histograms)</h3><p>ç°å®æ•°æ®é€šå¸¸æ˜¯ä¸å‡åŒ€çš„ ã€‚DBMS ä½¿ç”¨ç›´æ–¹å›¾æ¥å‡å°‘å­˜å‚¨å¼€é”€å¹¶æé«˜ä¼°ç®—å‡†ç¡®æ€§ï¼š</p><ul><li><p><strong>ç­‰å®½ç›´æ–¹å›¾ (Equi-Width)</strong>ï¼šæ¯ä¸ªæ¡¶çš„å–å€¼èŒƒå›´è·¨åº¦ç›¸åŒ ã€‚</p></li><li><p><strong>ç­‰æ·±ç›´æ–¹å›¾ (Equi-Depth)</strong>ï¼šè°ƒæ•´æ¡¶èŒƒå›´ï¼Œä½¿æ¯ä¸ªæ¡¶å†…è½å…¥çš„è®°å½•æ•°å¤§è‡´ç›¸ç­‰ ã€‚</p></li></ul><h3 id="é‡‡æ ·-Sampling"><a href="#é‡‡æ ·-Sampling" class="headerlink" title="é‡‡æ · (Sampling)"></a>é‡‡æ · (Sampling)</h3><p>å¯¹äºè¶…å¤§è§„æ¨¡æ•°æ®ï¼ˆå¦‚ 10 äº¿è¡Œï¼‰ï¼ŒDBMS ä¼šåœ¨æ•°æ®è¡¨çš„å­é›†ä¸Šåº”ç”¨è°“è¯æ¥ä¼°ç®—é€‰æ‹©åº¦ ã€‚</p><hr><h2 id="5-æœç´¢ç©ºé—´ä¸ä¼˜åŒ–ç®—æ³•"><a href="#5-æœç´¢ç©ºé—´ä¸ä¼˜åŒ–ç®—æ³•" class="headerlink" title="5. æœç´¢ç©ºé—´ä¸ä¼˜åŒ–ç®—æ³•"></a>5. æœç´¢ç©ºé—´ä¸ä¼˜åŒ–ç®—æ³•</h2><h3 id="å•è¡¨æŸ¥è¯¢"><a href="#å•è¡¨æŸ¥è¯¢" class="headerlink" title="å•è¡¨æŸ¥è¯¢"></a>å•è¡¨æŸ¥è¯¢</h3><p>é‡ç‚¹åœ¨äºé€‰æ‹©<strong>è®¿é—®æ–¹æ³• (Access Method)</strong>ã€‚å¯¹äº OLTP æŸ¥è¯¢ï¼Œé€šå¸¸å­˜åœ¨æœ€ä¼˜ç´¢å¼•ï¼ˆSargableï¼‰ï¼Œä½¿ç”¨ç®€å•å¯å‘å¼è§„åˆ™å³å¯é€‰æ‹© ã€‚</p><h3 id="å¤šè¡¨è¿æ¥-Multi-Relation"><a href="#å¤šè¡¨è¿æ¥-Multi-Relation" class="headerlink" title="å¤šè¡¨è¿æ¥ (Multi-Relation)"></a>å¤šè¡¨è¿æ¥ (Multi-Relation)</h3><p>è¿æ¥é¡ºåºçš„é€‰æ‹©æ˜¯æŒ‡æ•°çº§éš¾é¢˜ï¼ˆn ä¸ªè¡¨è¿æ¥æœ‰ 4^n ç§å¯èƒ½çš„é¡ºåºï¼‰ ã€‚</p><ol><li><p><strong>è‡ªåº•å‘ä¸Š (Bottom-up)</strong>ï¼šä»å•ä¸ªè¡¨å¼€å§‹æ„å»ºï¼Œé€šè¿‡åŠ¨æ€è§„åˆ’å¯»æ‰¾æœ€ä¼˜è¿æ¥é¡ºåºï¼ˆå¦‚ IBM System R, Postgresï¼‰ ã€‚</p></li><li><p><strong>è‡ªé¡¶å‘ä¸‹ (Top-down)</strong>ï¼šä»ç›®æ ‡ç»“æœå‡ºå‘ï¼Œé€šè¿‡è§„åˆ™å’Œåˆ†æ”¯é™ç•Œæœç´¢å‘ä¸‹å¯»æ‰¾æœ€ä¼˜ç‰©ç†ç®—å­ï¼ˆå¦‚ MSSQL, Volcano æ¨¡å‹ï¼‰ ã€‚</p></li></ol><hr><h2 id="6-åµŒå¥—å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#6-åµŒå¥—å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="6. åµŒå¥—å­æŸ¥è¯¢ä¼˜åŒ–"></a>6. åµŒå¥—å­æŸ¥è¯¢ä¼˜åŒ–</h2><p>DBMS ä¼šå°è¯•â€œæ‰å¹³åŒ–â€å­æŸ¥è¯¢ï¼š</p><ul><li><p><strong>é‡å†™</strong>ï¼šå°†å­æŸ¥è¯¢æ”¹å†™ä¸ºè¿æ¥ (JOIN) ã€‚</p></li><li><p><strong>åˆ†è§£</strong>ï¼šå°†å¤æ‚å­æŸ¥è¯¢çš„ç»“æœå­˜å…¥ä¸´æ—¶è¡¨ï¼Œä¾›å¤–å±‚æŸ¥è¯¢ä½¿ç”¨ ã€‚</p></li></ul><hr><h3 id="è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ"><a href="#è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ" class="headerlink" title="è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ"></a>è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ</h3><p><strong>ä¸ºä»€ä¹ˆè¿æ¥é¡ºåºå¦‚æ­¤é‡è¦ï¼Ÿ</strong><br>åœ¨å¤šè¡¨è¿æ¥ä¸­ï¼Œä¸­é—´ç»“æœçš„å¤§å°ç›´æ¥å†³å®šäº†æŸ¥è¯¢æ•ˆç‡ã€‚å¦‚æœå…ˆè¿æ¥ä¸¤ä¸ªäº§ç”Ÿæµ·é‡æ•°æ®çš„è¡¨ï¼Œå†…å­˜å’Œ I&#x2F;O å‹åŠ›ä¼šç¬é—´æ¿€å¢ã€‚ä¼˜åŒ–å™¨çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯é€šè¿‡<strong>é€‰æ‹©åº¦ä¼°ç®—</strong>ï¼Œæ‰¾åˆ°èƒ½è®©ä¸­é—´ç»“æœå°½å¯èƒ½å°çš„è¿æ¥è·¯å¾„ã€‚</p><p>è¿™ä»½ CMU 15-445&#x2F;645 Database Systems (Fall 2024) Lecture #16 <strong>Concurrency Control Theory (å¹¶å‘æ§åˆ¶ç†è®º)</strong> çš„è¯¾ç¨‹ç¬”è®°æ•´ç†å¦‚ä¸‹ã€‚</p><p>è¿™ä»½ç¬”è®°ä¸ä»…æ€»ç»“äº†è¯¾ä»¶å†…å®¹ï¼Œè¿˜è¡¥å……äº†ç›¸å…³åŸç†çš„æ·±åº¦è§£æï¼Œæ—¨åœ¨å¸®åŠ©ä½ ç†è§£æ•°æ®åº“å¦‚ä½•åœ¨å¤šç”¨æˆ·å¹¶å‘è®¿é—®æ—¶ï¼Œä¾ç„¶ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p><hr><h1 id="ç¬¬åå…­è®²ï¼šConcurrency-Control-Theory-å¹¶å‘æ§åˆ¶ç†è®º"><a href="#ç¬¬åå…­è®²ï¼šConcurrency-Control-Theory-å¹¶å‘æ§åˆ¶ç†è®º" class="headerlink" title="ç¬¬åå…­è®²ï¼šConcurrency Control Theory (å¹¶å‘æ§åˆ¶ç†è®º)"></a>ç¬¬åå…­è®²ï¼šConcurrency Control Theory (å¹¶å‘æ§åˆ¶ç†è®º)</h1><h2 id="1-ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ-Motivation"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ-Motivation" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ(Motivation)"></a>1. ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ(Motivation)</h2><p>åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•åœ°è®©æ‰€æœ‰æ“ä½œé¡ºåºæ‰§è¡Œï¼ˆä¸€æ¬¡å¤„ç†ä¸€ä¸ªï¼‰ï¼Œè™½ç„¶èƒ½ä¿è¯ä¸å‡ºé”™ï¼Œä½†æ•ˆç‡æä½ã€‚æˆ‘ä»¬éœ€è¦è®©å¤šä¸ªäº‹åŠ¡â€œå¹¶å‘â€æ‰§è¡Œä»¥æé«˜ç³»ç»Ÿååé‡ï¼Œä½†è¿™å¸¦æ¥äº†ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p><ol><li><p><strong>ä¸¢å¤±æ›´æ–° (Lost Update Problem)</strong>ï¼šç”±äºç«äº‰æ¡ä»¶ï¼ˆRace Conditionï¼‰ï¼Œä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æ›´æ–°åŒä¸€æ¡è®°å½•ï¼Œå¯¼è‡´å…¶ä¸­ä¸€ä¸ªæ›´æ–°è¢«è¦†ç›– ã€‚</p></li><li><p><strong>æŒä¹…æ€§é—®é¢˜ (Durability Problem)</strong>ï¼šå¦‚æœç³»ç»Ÿæ–­ç”µæˆ–å´©æºƒï¼Œå¦‚ä½•ç¡®ä¿å·²æäº¤çš„æ•°æ®ä¸ä¸¢å¤±ï¼Œæœªæäº¤çš„æ•°æ®ä¸æ®‹ç•™ ã€‚</p></li></ol><hr><h2 id="2-äº‹åŠ¡-Transactions"><a href="#2-äº‹åŠ¡-Transactions" class="headerlink" title="2. äº‹åŠ¡ (Transactions)"></a>2. äº‹åŠ¡ (Transactions)</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>äº‹åŠ¡æ˜¯ DBMS ä¸­å˜åŒ–çš„<strong>åŸºæœ¬å•ä½</strong>ã€‚å®ƒæ˜¯ä¸€ç³»åˆ—åœ¨å…±äº«æ•°æ®åº“ä¸Šæ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ SQL æŸ¥è¯¢ï¼‰çš„åºåˆ—ï¼Œè¿™äº›æ“ä½œå…±åŒå®Œæˆä¸€ä¸ªé«˜çº§åŠŸèƒ½ ã€‚</p><ul><li><p><strong>åŸå­æ€§ (Atomic)</strong>ï¼šäº‹åŠ¡ä¸å¯åˆ†å‰²ï¼Œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åšï¼ˆPartial transactions represent unfinished businessï¼‰ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼šAndy ç»™ Promotor è½¬è´¦ $100ã€‚</p><ol><li>æ£€æŸ¥ Andy ä½™é¢ã€‚</li><li>Andy æ‰£é™¤ $100ã€‚</li><li>Promotor å¢åŠ  $100ã€‚</li></ol></li></ul><p><em>è¿™ä¸‰æ­¥å¿…é¡»ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸èƒ½åªåšäº†å‰ä¸¤æ­¥è€Œæ²¡åšç¬¬ä¸‰æ­¥</em> ã€‚</p><h3 id="â€œç¨»è‰äººâ€ç³»ç»Ÿ-The-Strawman-System"><a href="#â€œç¨»è‰äººâ€ç³»ç»Ÿ-The-Strawman-System" class="headerlink" title="â€œç¨»è‰äººâ€ç³»ç»Ÿ (The Strawman System)"></a>â€œç¨»è‰äººâ€ç³»ç»Ÿ (The Strawman System)</h3><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºå¯¹æ¯”çš„ç®€å•è®¾è®¡ï¼šç³»ç»Ÿåªå…è®¸<strong>åŒä¸€æ—¶é—´è¿è¡Œä¸€ä¸ªäº‹åŠ¡</strong>ï¼ˆå•çº¿ç¨‹ï¼‰ã€‚</p><ul><li><p><strong>æ‰§è¡Œæ–¹å¼</strong>ï¼šæ¯æ¬¡äº‹åŠ¡å¼€å§‹å‰ï¼Œå¤åˆ¶æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œåœ¨å‰¯æœ¬ä¸Šä¿®æ”¹ã€‚å¦‚æœæˆåŠŸï¼Œç”¨å‰¯æœ¬è¦†ç›–åŸæ–‡ä»¶ï¼›å¦‚æœå¤±è´¥ï¼Œä¸¢å¼ƒå‰¯æœ¬ ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šææ…¢ï¼ˆä¸æ”¯æŒå¹¶å‘ï¼‰ã€ç©ºé—´æµªè´¹ï¼ˆæ¯æ¬¡éƒ½è¦å¤åˆ¶æ•´ä¸ªåº“ï¼‰ã€‚</p></li><li><p><strong>ç»“è®º</strong>ï¼šæˆ‘ä»¬éœ€è¦å…è®¸<strong>å¹¶å‘æ‰§è¡Œ (Concurrent Execution)</strong>ï¼Œä½†å¿…é¡»ä¿è¯<strong>æ­£ç¡®æ€§ (Correctness)</strong> å’Œ<strong>å…¬å¹³æ€§ (Fairness)</strong> ã€‚</p></li></ul><hr><h2 id="3-ACID-ç‰¹æ€§"><a href="#3-ACID-ç‰¹æ€§" class="headerlink" title="3. ACID ç‰¹æ€§"></a>3. ACID ç‰¹æ€§</h2><p>ACID æ˜¯ç¡®ä¿æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ€§çš„å››ä¸ªæ ‡å‡† ã€‚</p><h3 id="A-Atomicity-åŸå­æ€§"><a href="#A-Atomicity-åŸå­æ€§" class="headerlink" title="A - Atomicity (åŸå­æ€§)"></a>A - Atomicity (åŸå­æ€§)</h3><p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼ˆå›æ»šï¼‰ã€‚å³ä½¿ç³»ç»Ÿåœ¨äº‹åŠ¡æ‰§è¡Œä¸­é€”å´©æºƒï¼Œé‡å¯åä¹Ÿä¸èƒ½æ®‹ç•™åªæ‰§è¡Œäº†ä¸€åŠçš„çŠ¶æ€ ã€‚</p><p><strong>å®ç°æœºåˆ¶ï¼š</strong></p><ol><li><p><strong>æ—¥å¿— (Logging - æ¨è)</strong>ï¼šDBMS è®°å½•æ‰€æœ‰æ“ä½œçš„æ—¥å¿—ï¼ˆUndo Recordsï¼‰ã€‚å¦‚æœäº‹åŠ¡ä¸­æ­¢ï¼Œåˆ©ç”¨æ—¥å¿—æ’¤é”€å·²åšçš„ä¿®æ”¹ã€‚è¿™æ˜¯ç°ä»£æ•°æ®åº“çš„æ ‡å‡†åšæ³•ï¼Œæ•ˆç‡é«˜ ã€‚</p></li><li><p><strong>å½±å­åˆ†é¡µ (Shadow Paging)</strong>ï¼šä¿®æ”¹æ•°æ®æ—¶ï¼Œä¸ç›´æ¥æ”¹åŸé¡µé¢ï¼Œè€Œæ˜¯å¤åˆ¶ä¸€ä»½å‰¯æœ¬è¿›è¡Œä¿®æ”¹ã€‚æäº¤æ—¶æ‰å°†æŒ‡é’ˆæŒ‡å‘æ–°é¡µé¢ã€‚</p><ul><li><em>ä¼˜ç‚¹</em>ï¼šæ¢å¤ç®€å•ï¼ˆç›´æ¥ä¸¢å¼ƒå‰¯æœ¬ï¼‰ï¼Œä¸éœ€è¦å¤æ‚çš„ Undo æ—¥å¿—ã€‚</li><li><em>ç¼ºç‚¹</em>ï¼šè¿è¡Œæ—¶æ€§èƒ½å·®ï¼ˆæ•°æ®ç¢ç‰‡åŒ–ã€å¤åˆ¶å¼€é”€å¤§ï¼‰ï¼Œå› æ­¤å¾ˆå°‘åœ¨é«˜æ€§èƒ½ DBMS ä¸­ä½¿ç”¨ ã€‚</li></ul></li></ol><h3 id="C-Consistency-ä¸€è‡´æ€§"><a href="#C-Consistency-ä¸€è‡´æ€§" class="headerlink" title="C - Consistency (ä¸€è‡´æ€§)"></a>C - Consistency (ä¸€è‡´æ€§)</h3><p>ä¸€è‡´æ€§æŒ‡æ•°æ®åº“ä»ä¸€ä¸ªâ€œé€»è¾‘ä¸Šæ­£ç¡®â€çš„çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªâ€œé€»è¾‘ä¸Šæ­£ç¡®â€çš„çŠ¶æ€ ã€‚</p><ul><li><p><strong>æ•°æ®åº“ä¸€è‡´æ€§ (Database Consistency)</strong>ï¼šæ•°æ®å¿…é¡»æ»¡è¶³æ‰€æœ‰å®Œæ•´æ€§çº¦æŸï¼ˆä¾‹å¦‚ï¼šå¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå¤–é”®çº¦æŸç­‰ï¼‰ã€‚</p></li><li><p><strong>äº‹åŠ¡ä¸€è‡´æ€§ (Transaction Consistency)</strong>ï¼šå¦‚æœæ•°æ®åº“åœ¨äº‹åŠ¡å¼€å§‹å‰æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆäº‹åŠ¡ç»“æŸåä¹Ÿå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚<strong>æ³¨æ„ï¼šè¿™æ˜¯åº”ç”¨å±‚ï¼ˆApplicationï¼‰çš„è´£ä»»ï¼ŒDBMS åªèƒ½è´Ÿè´£æ£€æŸ¥çº¦æŸï¼Œæ— æ³•åˆ¤æ–­ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®</strong> ã€‚</p></li></ul><h3 id="I-Isolation-éš”ç¦»æ€§"><a href="#I-Isolation-éš”ç¦»æ€§" class="headerlink" title="I - Isolation (éš”ç¦»æ€§)"></a>I - Isolation (éš”ç¦»æ€§)</h3><p>æ¯ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œåº”è¯¥æ„Ÿè§‰ä¸åˆ°å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨ã€‚å¹¶å‘æ‰§è¡Œçš„ç»“æœå¿…é¡»ä¸æŸç§<strong>ä¸²è¡Œæ‰§è¡Œ (Serial Execution)</strong> çš„ç»“æœç›¸åŒ ã€‚</p><ul><li>è¿™æ˜¯å¹¶å‘æ§åˆ¶ï¼ˆConcurrency Controlï¼‰çš„æ ¸å¿ƒç›®æ ‡ã€‚</li></ul><h3 id="D-Durability-æŒä¹…æ€§"><a href="#D-Durability-æŒä¹…æ€§" class="headerlink" title="D - Durability (æŒä¹…æ€§)"></a>D - Durability (æŒä¹…æ€§)</h3><p>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼ˆCommitï¼‰ï¼Œå…¶å¯¹æ•°æ®åº“çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä½¿éšåå‘ç”Ÿç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µä¹Ÿä¸èƒ½ä¸¢å¤± ã€‚</p><ul><li>å®ç°é€šå¸¸ä¾èµ–äºå°†æ—¥å¿—æˆ–å½±å­é¡µé¢å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ï¼ˆç£ç›˜ï¼‰ ã€‚</li></ul><hr><h2 id="4-å¹¶å‘æ§åˆ¶ç†è®º-Concurrency-Control-Theory"><a href="#4-å¹¶å‘æ§åˆ¶ç†è®º-Concurrency-Control-Theory" class="headerlink" title="4. å¹¶å‘æ§åˆ¶ç†è®º (Concurrency Control Theory)"></a>4. å¹¶å‘æ§åˆ¶ç†è®º (Concurrency Control Theory)</h2><p>å¹¶å‘æ§åˆ¶åè®®å†³å®šäº† DBMS å¦‚ä½•åœ¨è¿è¡Œæ—¶äº¤æ›¿æ‰§è¡Œå¤šä¸ªäº‹åŠ¡çš„æ“ä½œ ã€‚</p><h3 id="ä¸¤ç§ä¸»è¦æµæ´¾"><a href="#ä¸¤ç§ä¸»è¦æµæ´¾" class="headerlink" title="ä¸¤ç§ä¸»è¦æµæ´¾"></a>ä¸¤ç§ä¸»è¦æµæ´¾</h3><ol><li><p><strong>æ‚²è§‚å¹¶å‘æ§åˆ¶ (Pessimistic)</strong>ï¼šå‡è®¾å†²çªé¢‘ç¹å‘ç”Ÿï¼Œåœ¨æ“ä½œå‰å…ˆåŠ é”ï¼Œé˜»æ­¢é—®é¢˜çš„å‘ç”Ÿï¼ˆDonâ€™t let problems ariseï¼‰ã€‚</p></li><li><p><strong>ä¹è§‚å¹¶å‘æ§åˆ¶ (Optimistic)</strong>ï¼šå‡è®¾å†²çªå¾ˆå°‘ï¼Œå…ˆæ‰§è¡Œï¼Œåœ¨æäº¤æ—¶æ£€æŸ¥æ˜¯å¦å†²çªã€‚å¦‚æœå†²çªåˆ™å›æ»šï¼ˆDeal with conflicts after commitï¼‰ã€‚</p></li></ol><h3 id="è°ƒåº¦-Schedule"><a href="#è°ƒåº¦-Schedule" class="headerlink" title="è°ƒåº¦ (Schedule)"></a>è°ƒåº¦ (Schedule)</h3><p>è°ƒåº¦æ˜¯æ“ä½œæ‰§è¡Œçš„é¡ºåº ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ç§<strong>å¯ä¸²è¡ŒåŒ– (Serializable)</strong> çš„è°ƒåº¦ã€‚</p><ul><li><strong>ä¸²è¡Œè°ƒåº¦ (Serial Schedule)</strong>ï¼šäº‹åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œï¼Œæ²¡æœ‰äº¤é”™ã€‚</li><li><strong>å¯ä¸²è¡ŒåŒ–è°ƒåº¦ (Serializable Schedule)</strong>ï¼šä¸€ä¸ªå¹¶å‘è°ƒåº¦çš„æ‰§è¡Œç»“æœï¼Œç­‰ä»·äºï¼ˆEquivalent toï¼‰æŸç§ä¸²è¡Œè°ƒåº¦çš„ç»“æœã€‚è¿™ç§è°ƒåº¦è¢«è®¤ä¸ºæ˜¯æ­£ç¡®çš„ ã€‚</li></ul><h3 id="å†²çª-Conflicts"><a href="#å†²çª-Conflicts" class="headerlink" title="å†²çª (Conflicts)"></a>å†²çª (Conflicts)</h3><p>å½“ä¸¤ä¸ªæ“ä½œæ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œç§°ä¸ºå†²çª ï¼š</p><ol><li>å±äºä¸åŒçš„äº‹åŠ¡ã€‚</li><li>æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ã€‚</li><li>è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯<strong>å†™ (Write)</strong> æ“ä½œã€‚</li></ol><p><strong>ä¸‰ç§å†²çªç±»å‹ï¼š</strong></p><ol><li><p><strong>Read-Write (ä¸å¯é‡å¤è¯»)</strong>ï¼šTxn A è¯»å–äº†æ•°æ®ï¼ŒTxn B ä¿®æ”¹äº†å®ƒã€‚Txn A å†æ¬¡è¯»å–æ—¶å‘ç°å€¼å˜äº† ã€‚</p></li><li><p><strong>Write-Read (è„è¯»)</strong>ï¼šTxn A ä¿®æ”¹äº†æ•°æ®ä½†æœªæäº¤ï¼ŒTxn B è¯»å–äº†è¿™ä¸ªæœªæäº¤çš„æ•°æ®ã€‚å¦‚æœ Txn A éšåå›æ»šï¼ŒTxn B è¯»åˆ°çš„å°±æ˜¯è„æ•°æ® ã€‚</p></li><li><p><strong>Write-Write (ä¸¢å¤±æ›´æ–°)</strong>ï¼šTxn A å’Œ Txn B åŒæ—¶ä¿®æ”¹åŒä¸€æ•°æ®ï¼ŒTxn B çš„å†™è¦†ç›–äº† Txn A çš„å†™ ã€‚</p></li></ol><hr><h2 id="5-å¯ä¸²è¡ŒåŒ–-Serializability-çš„ç±»å‹"><a href="#5-å¯ä¸²è¡ŒåŒ–-Serializability-çš„ç±»å‹" class="headerlink" title="5. å¯ä¸²è¡ŒåŒ– (Serializability) çš„ç±»å‹"></a>5. å¯ä¸²è¡ŒåŒ– (Serializability) çš„ç±»å‹</h2><p>æˆ‘ä»¬éœ€è¦ä¸€ç§å½¢å¼åŒ–çš„æ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªè°ƒåº¦æ˜¯å¦æ˜¯â€œæ­£ç¡®â€çš„ï¼ˆå³å¯ä¸²è¡ŒåŒ–çš„ï¼‰ã€‚</p><h3 id="1-å†²çªå¯ä¸²è¡ŒåŒ–-Conflict-Serializability"><a href="#1-å†²çªå¯ä¸²è¡ŒåŒ–-Conflict-Serializability" class="headerlink" title="(1) å†²çªå¯ä¸²è¡ŒåŒ– (Conflict Serializability)"></a>(1) å†²çªå¯ä¸²è¡ŒåŒ– (Conflict Serializability)</h3><p>è¿™æ˜¯å¤§å¤šæ•° DBMS å®é™…é‡‡ç”¨çš„æ ‡å‡† ã€‚</p><ul><li><p><strong>å®šä¹‰</strong>ï¼šå¦‚æœä¸€ä¸ªè°ƒåº¦å¯ä»¥é€šè¿‡äº¤æ¢<strong>ä¸å†²çª</strong>çš„æ“ä½œï¼Œè½¬æ¢æˆä¸€ä¸ªä¸²è¡Œè°ƒåº¦ï¼Œé‚£å®ƒå°±æ˜¯å†²çªå¯ä¸²è¡ŒåŒ–çš„ ã€‚</p></li><li><p><strong>æ£€æµ‹æ–¹æ³• - ä¾èµ–å›¾ (Dependency Graph)</strong>ï¼š</p><ul><li>èŠ‚ç‚¹æ˜¯äº‹åŠ¡ã€‚</li><li>å¦‚æœ $T_i$ çš„æ“ä½œä¸ $T_j$ çš„æ“ä½œå†²çªï¼Œä¸” $T_i$ åœ¨ $T_j$ ä¹‹å‰æ‰§è¡Œï¼Œåˆ™ç”»ä¸€æ¡ $T_i \to T_j$ çš„è¾¹ ã€‚</li></ul></li><li><p><strong>å®šç†</strong>ï¼šå¦‚æœä¾èµ–å›¾<strong>æ²¡æœ‰ç¯ (Acyclic)</strong>ï¼Œåˆ™è°ƒåº¦æ˜¯å†²çªå¯ä¸²è¡ŒåŒ–çš„ ã€‚</p></li></ul><h3 id="2-è§†å›¾å¯ä¸²è¡ŒåŒ–-View-Serializability"><a href="#2-è§†å›¾å¯ä¸²è¡ŒåŒ–-View-Serializability" class="headerlink" title="(2) è§†å›¾å¯ä¸²è¡ŒåŒ– (View Serializability)"></a>(2) è§†å›¾å¯ä¸²è¡ŒåŒ– (View Serializability)</h3><p>è¿™æ˜¯ä¸€ä¸ªæ¯”å†²çªå¯ä¸²è¡ŒåŒ–æ›´å¼±ï¼ˆåŒ…å«èŒƒå›´æ›´å¹¿ï¼‰çš„æ¦‚å¿µ ã€‚</p><ul><li><p><strong>å…³é”®ç‚¹</strong>ï¼šå®ƒå…è®¸<strong>ç›²å†™ (Blind Writes)</strong>ï¼ˆå³ä¸è¯»æ•°æ®ç›´æ¥å†™å…¥ï¼‰ã€‚</p></li><li><p><strong>åŸç†</strong>ï¼šåªè¦æœ€ç»ˆçš„æ•°æ®åº“çŠ¶æ€å’ŒæŸç§ä¸²è¡Œæ‰§è¡Œçš„ç»“æœä¸€è‡´å³å¯ã€‚å³ä½¿ä¸­é—´è¿‡ç¨‹æœ‰å†²çªï¼Œå¦‚æœæœ€åçš„ç›²å†™è¦†ç›–äº†é”™è¯¯ï¼Œé‚£ä¹Ÿæ˜¯å¯æ¥å—çš„ ã€‚</p></li><li><p><strong>ç°çŠ¶</strong>ï¼šå¾ˆéš¾é«˜æ•ˆåœ°éªŒè¯ï¼ˆé€šå¸¸æ˜¯ NP å®Œå…¨é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥æ•°æ®åº“ç³»ç»Ÿ<strong>å®é™…ä¸Šä¸ä½¿ç”¨</strong>å®ƒï¼Œè€Œæ˜¯åšæŒä½¿ç”¨å†²çªå¯ä¸²è¡ŒåŒ– ã€‚</p></li></ul><h3 id="è°ƒåº¦é›†åˆçš„å…³ç³»-Universe-of-Schedules"><a href="#è°ƒåº¦é›†åˆçš„å…³ç³»-Universe-of-Schedules" class="headerlink" title="è°ƒåº¦é›†åˆçš„å…³ç³» (Universe of Schedules)"></a>è°ƒåº¦é›†åˆçš„å…³ç³» (Universe of Schedules)</h3><h2 id="æè¿°äº†åŒ…å«å…³ç³»ï¼š-text-Serial-subset-text-Conflict-Serializable-subset-text-View-Serializable-subset-text-All-Schedules"><a href="#æè¿°äº†åŒ…å«å…³ç³»ï¼š-text-Serial-subset-text-Conflict-Serializable-subset-text-View-Serializable-subset-text-All-Schedules" class="headerlink" title=" æè¿°äº†åŒ…å«å…³ç³»ï¼š$$\text{Serial} \subset \text{Conflict Serializable} \subset \text{View Serializable} \subset \text{All Schedules}$$"></a> æè¿°äº†åŒ…å«å…³ç³»ï¼š<br>$$\text{Serial} \subset \text{Conflict Serializable} \subset \text{View Serializable} \subset \text{All Schedules}$$</h2><h3 id="è¡¥å……æ€»ç»“ï¼šç†è§£çš„æ ¸å¿ƒé€»è¾‘"><a href="#è¡¥å……æ€»ç»“ï¼šç†è§£çš„æ ¸å¿ƒé€»è¾‘" class="headerlink" title="è¡¥å……æ€»ç»“ï¼šç†è§£çš„æ ¸å¿ƒé€»è¾‘"></a>è¡¥å……æ€»ç»“ï¼šç†è§£çš„æ ¸å¿ƒé€»è¾‘</h3><ol><li><strong>ç›®æ ‡</strong>ï¼šæˆ‘ä»¬æƒ³è¦å¹¶å‘ï¼ˆå¿«ï¼‰ï¼Œä½†ä¸èƒ½ä¹±ï¼ˆæ­£ç¡®ï¼‰ã€‚</li><li><strong>æ ‡å‡†</strong>ï¼šä»€ä¹ˆå«â€œä¸ä¹±â€ï¼Ÿæ ‡å‡†æ˜¯ ACID ä¸­çš„ <strong>Isolation</strong>ã€‚</li><li><strong>åº¦é‡</strong>ï¼šæ€ä¹ˆåˆ¤æ–­ Isolation è¾¾æ ‡äº†ï¼Ÿçœ‹è¿™ä¸ªè°ƒåº¦æ˜¯å¦ <strong>Serializable</strong>ï¼ˆç­‰ä»·äºä¸²è¡Œï¼‰ã€‚</li><li><strong>å®ç°</strong>ï¼šæ€ä¹ˆåˆ¤æ–­æ˜¯å¦ Serializableï¼Ÿ</li></ol><ul><li><strong>View Serializability</strong> ç†è®ºå®Œç¾ä½†å¤ªéš¾ç®—ã€‚</li><li><strong>Conflict Serializability</strong> å®¹æ˜“ç®—ï¼ˆæŸ¥æœ‰æ— ç¯ï¼‰ï¼Œè™½ç„¶æ¼æ‰äº†ä¸€äº›ç›²å†™çš„æƒ…å†µï¼Œä½†è¶³å¤Ÿå¥½ç”¨ã€‚</li></ul><ol start="5"><li><strong>æ‰‹æ®µ</strong>ï¼šæ€ä¹ˆä¿è¯ç”Ÿæˆçš„è°ƒåº¦æ˜¯ Conflict Serializable çš„ï¼Ÿé€šè¿‡é”ï¼ˆ2PLï¼‰æˆ–æ—¶é—´æˆ³æ’åºï¼ˆTimestamp Orderingï¼‰ç­‰åè®®ï¼ˆè¿™æ˜¯ä¸‹ä¸€èŠ‚è¯¾çš„å†…å®¹ï¼‰ã€‚</li></ol><p>è¿™ä»½ CMU 15-445&#x2F;645 Database Systems (Fall 2024) Lecture #17 <strong>Two-Phase Locking (äºŒé˜¶æ®µé”)</strong> çš„è¯¾ç¨‹ç¬”è®°æ•´ç†å¦‚ä¸‹ã€‚</p><p>è¿™ä»½ç¬”è®°åœ¨æ€»ç»“è¯¾ä»¶æ ¸å¿ƒå†…å®¹çš„åŸºç¡€ä¸Šï¼Œè¡¥å……äº†ç›¸å…³åŸç†çš„å¯¹æ¯”å’Œè§£æï¼Œæ—¨åœ¨å¸®åŠ©ä½ ç†è§£æ•°æ®åº“å¦‚ä½•é€šè¿‡é”æœºåˆ¶â€œåŠ¨æ€åœ°â€ä¿è¯äº‹åŠ¡çš„æ­£ç¡®æ€§ï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ã€‚</p><hr><h1 id="ç¬¬åä¸ƒè®²ï¼šTwo-Phase-Locking-äºŒé˜¶æ®µé”"><a href="#ç¬¬åä¸ƒè®²ï¼šTwo-Phase-Locking-äºŒé˜¶æ®µé”" class="headerlink" title="ç¬¬åä¸ƒè®²ï¼šTwo-Phase Locking (äºŒé˜¶æ®µé”)"></a>ç¬¬åä¸ƒè®²ï¼šTwo-Phase Locking (äºŒé˜¶æ®µé”)</h1><h2 id="1-äº‹åŠ¡é”-Transaction-Locks"><a href="#1-äº‹åŠ¡é”-Transaction-Locks" class="headerlink" title="1. äº‹åŠ¡é” (Transaction Locks)"></a>1. äº‹åŠ¡é” (Transaction Locks)</h2><p>åœ¨ä¹‹å‰çš„ç†è®ºè¯¾ä¸­ï¼Œæˆ‘ä»¬å‡è®¾åœ¨å®‰æ’è°ƒåº¦æ—¶å·²ç»çŸ¥é“æ‰€æœ‰äº‹åŠ¡çš„è¯»å†™æ“ä½œã€‚ä½†åœ¨ç°å®ä¸­ï¼ŒDBMS æ— æ³•é¢„çŸ¥æœªæ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶åœ¨<strong>è¿è¡Œæ—¶ (On-the-fly)</strong> åŠ¨æ€ç”Ÿæˆæ­£ç¡®çš„è°ƒåº¦ã€‚</p><h3 id="é”çš„æœ¬è´¨"><a href="#é”çš„æœ¬è´¨" class="headerlink" title="é”çš„æœ¬è´¨"></a>é”çš„æœ¬è´¨</h3><p>DBMS ä½¿ç”¨<strong>é” (Locks)</strong> æ¥ä¿æŠ¤æ•°æ®åº“å¯¹è±¡ï¼Œé˜²æ­¢å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å†™é€ æˆå†²çªã€‚</p><ul><li><p><strong>é”ç®¡ç†å™¨ (Lock Manager)</strong>ï¼šä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç»„ä»¶ï¼Œè´Ÿè´£ç»´æŠ¤å†…éƒ¨çš„é”è¡¨ (Lock Table)ï¼Œå†³å®šæ˜¯å¦æ‰¹å‡†äº‹åŠ¡çš„é”è¯·æ±‚ ã€‚</p></li><li><p><strong>é” vs. Latch</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¸¸è€ƒçš„é¢è¯•ç‚¹ ã€‚</p><ul><li><strong>Locks</strong>ï¼šä¿æŠ¤æ•°æ®åº“çš„é€»è¾‘å†…å®¹ï¼ˆå¦‚å…ƒç»„ã€è¡¨ï¼‰ï¼Œå±äºäº‹åŠ¡å±‚ï¼ŒæŒç»­æ—¶é—´é•¿ï¼ˆæ•´ä¸ªäº‹åŠ¡æœŸé—´ï¼‰ï¼Œæ”¯æŒå›æ»šã€‚</li><li><strong>Latches</strong>ï¼šä¿æŠ¤ DBMS å†…éƒ¨çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ B+ æ ‘èŠ‚ç‚¹ã€å“ˆå¸Œè¡¨ bucketï¼‰ï¼Œå±äºçº¿ç¨‹&#x2F;ç‰©ç†å±‚ï¼ŒæŒç»­æ—¶é—´æçŸ­ï¼ˆä¸´ç•ŒåŒºï¼‰ï¼Œä¸éœ€è¦å›æ»šã€‚</li></ul></li></ul><h3 id="åŸºæœ¬é”ç±»å‹"><a href="#åŸºæœ¬é”ç±»å‹" class="headerlink" title="åŸºæœ¬é”ç±»å‹"></a>åŸºæœ¬é”ç±»å‹</h3><ol><li><p><strong>Shared Lock (S-LOCK &#x2F; å…±äº«é”)</strong>ï¼š</p><ul><li><strong>ç”¨é€”</strong>ï¼šç”¨äº<strong>è¯»å–</strong>å¯¹è±¡ã€‚</li><li><strong>å…¼å®¹æ€§</strong>ï¼šå¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒä¸€ä¸ªå¯¹è±¡çš„ S é”ï¼ˆå³å¤šè¯»ä¸äº’æ–¥ï¼‰ã€‚</li></ul></li><li><p><strong>Exclusive Lock (X-LOCK &#x2F; æ’ä»–é”)</strong>ï¼š</p><ul><li><strong>ç”¨é€”</strong>ï¼šç”¨äº<strong>ä¿®æ”¹</strong>å¯¹è±¡ã€‚</li><li><strong>å…¼å®¹æ€§</strong>ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åŠ äº† X é”ï¼Œå…¶ä»–ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½å¯¹å®ƒåŠ ä»»ä½•é”ï¼ˆS æˆ– Xï¼‰ã€‚X é”å¿…é¡»ç‹¬å  ã€‚</li></ul></li></ol><hr><h2 id="2-äºŒé˜¶æ®µé”åè®®-Two-Phase-Locking-2PL"><a href="#2-äºŒé˜¶æ®µé”åè®®-Two-Phase-Locking-2PL" class="headerlink" title="2. äºŒé˜¶æ®µé”åè®® (Two-Phase Locking - 2PL)"></a>2. äºŒé˜¶æ®µé”åè®® (Two-Phase Locking - 2PL)</h2><p>ä»…ä»…æœ‰é”æ˜¯ä¸å¤Ÿçš„ï¼Œå¦‚æœäº‹åŠ¡éšæ„åŠ é”è§£é”ï¼Œä¾ç„¶å¯èƒ½å¯¼è‡´ä¸å¯ä¸²è¡ŒåŒ–çš„ç»“æœã€‚<strong>2PL</strong> æ˜¯ä¸€ç§æ‚²è§‚çš„å¹¶å‘æ§åˆ¶åè®®ï¼Œå®ƒè§„å®šäº†äº‹åŠ¡<strong>ä½•æ—¶</strong>å¯ä»¥åŠ é”å’Œè§£é”ï¼Œä»¥æ­¤æ¥ä¿è¯å†²çªå¯ä¸²è¡ŒåŒ–ï¼ˆConflict Serializabilityï¼‰ã€‚</p><h3 id="åè®®è§„åˆ™"><a href="#åè®®è§„åˆ™" class="headerlink" title="åè®®è§„åˆ™"></a>åè®®è§„åˆ™</h3><p>2PL å°†äº‹åŠ¡çš„æ‰§è¡Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ ï¼š</p><ol><li><p><strong>å¢é•¿é˜¶æ®µ (Growing Phase)</strong>ï¼š</p><ul><li>äº‹åŠ¡å¯ä»¥<strong>ç”³è¯·</strong>æ–°é”ï¼ˆS æˆ– Xï¼‰ã€‚</li><li><strong>ç»å¯¹ä¸å…è®¸</strong>é‡Šæ”¾ä»»ä½•é”ã€‚</li></ul></li><li><p><strong>ç¼©å‡é˜¶æ®µ (Shrinking Phase)</strong>ï¼š</p><ul><li>ä¸€æ—¦äº‹åŠ¡é‡Šæ”¾äº†ç¬¬ä¸€ä¸ªé”ï¼Œå°±ç«‹å³è¿›å…¥ç¼©å‡é˜¶æ®µã€‚</li><li>åœ¨æ­¤é˜¶æ®µï¼Œäº‹åŠ¡åªèƒ½<strong>é‡Šæ”¾</strong>é”ã€‚</li><li><strong>ç»å¯¹ä¸å…è®¸</strong>ç”³è¯·æ–°é”ã€‚</li></ul></li></ol><h3 id="2PL-çš„æ€§è´¨"><a href="#2PL-çš„æ€§è´¨" class="headerlink" title="2PL çš„æ€§è´¨"></a>2PL çš„æ€§è´¨</h3><ul><li><p><strong>æ­£ç¡®æ€§</strong>ï¼š2PL è¶³ä»¥ä¿è¯ç”Ÿæˆçš„è°ƒåº¦æ˜¯<strong>å†²çªå¯ä¸²è¡ŒåŒ–</strong>çš„ï¼ˆDependency Graph æ— ç¯ï¼‰ã€‚</p></li><li><p><strong>é—®é¢˜ 1ï¼šçº§è”ä¸­æ­¢ (Cascading Aborts)</strong>ï¼š</p><ul><li>å¦‚æœ T1 å†™äº†æ•°æ® Aï¼ˆæœªæäº¤ï¼‰ï¼ŒT2 è¯»äº† Aã€‚æ­¤æ—¶ T1 ä¸­æ­¢ï¼ˆå›æ»šï¼‰ï¼ŒT2 è¯»åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼Œå¿…é¡»ä¹Ÿè¢«å¼ºåˆ¶ä¸­æ­¢ã€‚è¿™ä¼šå¯¼è‡´è¿é”ååº”ï¼Œæµªè´¹å¤§é‡è®¡ç®—èµ„æº ã€‚</li></ul></li><li><p><strong>é—®é¢˜ 2ï¼šæ­»é” (Deadlocks)</strong>ï¼š2PL å¯èƒ½å¯¼è‡´æ­»é”ï¼ˆäº’ç›¸ç­‰å¾…ï¼‰ã€‚</p></li></ul><h3 id="å¼ºä¸¥æ ¼äºŒé˜¶æ®µé”-Strong-Strict-2PL-SS2PL"><a href="#å¼ºä¸¥æ ¼äºŒé˜¶æ®µé”-Strong-Strict-2PL-SS2PL" class="headerlink" title="å¼ºä¸¥æ ¼äºŒé˜¶æ®µé” (Strong Strict 2PL &#x2F; SS2PL)"></a>å¼ºä¸¥æ ¼äºŒé˜¶æ®µé” (Strong Strict 2PL &#x2F; SS2PL)</h3><p>ä¸ºäº†è§£å†³çº§è”ä¸­æ­¢é—®é¢˜ï¼Œç°ä»£ DBMS é€šå¸¸ä½¿ç”¨ SS2PLï¼ˆä¹Ÿç§°ä¸º Rigorous 2PLï¼‰ã€‚</p><ul><li><p><strong>è§„åˆ™</strong>ï¼šäº‹åŠ¡åªèƒ½åœ¨<strong>æäº¤ (Commit)</strong> æˆ– <strong>ä¸­æ­¢ (Abort)</strong> çš„é‚£ä¸€åˆ»ï¼Œä¸€æ¬¡æ€§é‡Šæ”¾<strong>æ‰€æœ‰</strong>çš„é” ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>æ— çº§è”ä¸­æ­¢</strong>ï¼šåªæœ‰å·²æäº¤çš„æ•°æ®æ‰èƒ½è¢«åˆ«äººè¯»åˆ°ã€‚</li><li><strong>æ¢å¤ç®€å•</strong>ï¼šå›æ»šæ—¶åªéœ€æ¢å¤æ—§å€¼ï¼Œä¸ä¼šå½±å“å…¶ä»–æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡ ã€‚</li></ul></li><li><p><strong>ä»£ä»·</strong>ï¼šæŒé”æ—¶é—´å˜é•¿ï¼Œå¹¶å‘åº¦é™ä½ ã€‚</p></li></ul><p><strong>è°ƒåº¦é›†åˆçš„å…³ç³»</strong>ï¼š</p><h2 id="text-Strong-Strict-2PL-subset-text-Conflict-Serializable-subset-text-View-Serializable-subset-text-All-Schedules"><a href="#text-Strong-Strict-2PL-subset-text-Conflict-Serializable-subset-text-View-Serializable-subset-text-All-Schedules" class="headerlink" title="$$\text{Strong Strict 2PL} \subset \text{Conflict Serializable} \subset \text{View Serializable} \subset \text{All Schedules}$$"></a>$$\text{Strong Strict 2PL} \subset \text{Conflict Serializable} \subset \text{View Serializable} \subset \text{All Schedules}$$</h2><h2 id="3-æ­»é”å¤„ç†-Deadlock-Handling"><a href="#3-æ­»é”å¤„ç†-Deadlock-Handling" class="headerlink" title="3. æ­»é”å¤„ç† (Deadlock Handling)"></a>3. æ­»é”å¤„ç† (Deadlock Handling)</h2><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡äº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œå¯¼è‡´æ— é™ç­‰å¾… ã€‚å¤„ç†æ­»é”æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p><h3 id="ç­–ç•¥-1-æ­»é”æ£€æµ‹-Deadlock-Detection"><a href="#ç­–ç•¥-1-æ­»é”æ£€æµ‹-Deadlock-Detection" class="headerlink" title="ç­–ç•¥ #1: æ­»é”æ£€æµ‹ (Deadlock Detection)"></a>ç­–ç•¥ #1: æ­»é”æ£€æµ‹ (Deadlock Detection)</h3><p>DBMS å…è®¸æ­»é”å‘ç”Ÿï¼Œä½†ä¼šå®šæœŸæ£€æŸ¥å¹¶æ‰“ç ´å®ƒã€‚</p><ul><li><p><strong>ç­‰å¾…å›¾ (Waits-for Graph)</strong>ï¼šèŠ‚ç‚¹æ˜¯äº‹åŠ¡ï¼Œè¾¹$T_i \to T_j$ è¡¨ç¤º $T_i$ æ­£åœ¨ç­‰å¾… $T_j$ é‡Šæ”¾é”ã€‚å¦‚æœå›¾ä¸­å‡ºç°<strong>ç¯</strong>ï¼Œè¯´æ˜æœ‰æ­»é” ã€‚</p></li><li><p><strong>å¤„ç†æµç¨‹</strong>ï¼šåå°çº¿ç¨‹å®šæœŸæ„å»ºç­‰å¾…å›¾ã€‚å¦‚æœå‘ç°ç¯ï¼Œé€‰æ‹©ä¸€ä¸ª<strong>å—å®³è€… (Victim)</strong> äº‹åŠ¡è¿›è¡Œå›æ»š ã€‚</p></li><li><p><strong>å—å®³è€…é€‰æ‹©æ ‡å‡†</strong>ï¼š</p><ul><li><p><strong>å¹´é¾„</strong>ï¼ˆé€šå¸¸æ€å¹´è½»çš„ï¼Œä¿æŠ¤è€çš„ï¼‰ã€‚</p></li><li><p><strong>è¿›åº¦</strong>ï¼ˆæ€è¿›åº¦å°‘çš„ï¼‰ã€‚</p></li><li><p><strong>é”æ•°é‡</strong>ï¼ˆæ€æŒæœ‰é”å°‘çš„ï¼Œå›æ»šå¼€é”€å°ï¼‰ã€‚</p></li><li><p><strong>é˜²é¥¥é¥¿</strong>ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡æ¯æ¬¡éƒ½è¢«æ€ï¼Œå®ƒä¼šâ€œé¥¥é¥¿â€ã€‚ç³»ç»Ÿåº”è®°å½•å®ƒè¢«æ€çš„æ¬¡æ•°ï¼Œä¸‹æ¬¡æé«˜å®ƒçš„ä¼˜å…ˆçº§ ã€‚</p></li></ul></li></ul><h3 id="ç­–ç•¥-2-æ­»é”é¢„é˜²-Deadlock-Prevention"><a href="#ç­–ç•¥-2-æ­»é”é¢„é˜²-Deadlock-Prevention" class="headerlink" title="ç­–ç•¥ #2: æ­»é”é¢„é˜² (Deadlock Prevention)"></a>ç­–ç•¥ #2: æ­»é”é¢„é˜² (Deadlock Prevention)</h3><p>DBMS åœ¨äº‹åŠ¡ç”³è¯·é”æ—¶å°±æ‰¼æ€æ­»é”çš„å¯èƒ½æ€§ï¼Œä¸å…è®¸å‡ºç°å¾ªç¯ç­‰å¾…ã€‚è¿™é€šå¸¸åŸºäº<strong>æ—¶é—´æˆ³ (Timestamp)</strong> åˆ†é…ä¼˜å…ˆçº§ï¼ˆè¶Šè€ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚</p><ul><li><p><strong>Wait-Die (è€ç­‰ï¼Œå°‘æ­»)</strong>ï¼š</p><ul><li>å¦‚æœè¯·æ±‚è€…ä¼˜å…ˆçº§ <strong>é«˜</strong> (è€)ï¼šå…è®¸ç­‰å¾… (Wait)ã€‚</li><li>å¦‚æœè¯·æ±‚è€…ä¼˜å…ˆçº§ <strong>ä½</strong> (æ–°)ï¼šè‡ªå·±ä¸­æ­¢ (Die)ã€‚</li></ul></li><li><p><strong>Wound-Wait (è€æ€ï¼Œå°‘ç­‰)</strong>ï¼š</p><ul><li>å¦‚æœè¯·æ±‚è€…ä¼˜å…ˆçº§ <strong>é«˜</strong> (è€)ï¼šå¼ºåˆ¶æŠ¢å ï¼ŒæŠŠæŒæœ‰è€…ä¸­æ­¢ (Wound)ã€‚</li><li>å¦‚æœè¯·æ±‚è€…ä¼˜å…ˆçº§ <strong>ä½</strong> (æ–°)ï¼šè€å®ç­‰å¾… (Wait)ã€‚</li></ul></li></ul><p><strong>è®°å¿†å£è¯€</strong>ï¼šå¦‚æœåè®®åæ˜¯ X-Yï¼Œè¯·æ±‚è€…ä¼˜å…ˆçº§<strong>é«˜</strong>æ—¶åš Xï¼Œ<strong>ä½</strong>æ—¶åš Y ã€‚</p><hr><h2 id="4-é”çš„ç²’åº¦-Lock-Granularities"><a href="#4-é”çš„ç²’åº¦-Lock-Granularities" class="headerlink" title="4. é”çš„ç²’åº¦ (Lock Granularities)"></a>4. é”çš„ç²’åº¦ (Lock Granularities)</h2><p>å¦‚æœä¸€ä¸ªäº‹åŠ¡è¦æ›´æ–° 10 äº¿æ¡è®°å½•ï¼š</p><ul><li><p>ç”³è¯· 10 äº¿ä¸ª Tuple Lockï¼Ÿå¤ªæ…¢ï¼Œé”ç®¡ç†å™¨å†…å­˜çˆ†ç‚¸ ã€‚</p></li><li><p>ç”³è¯· 1 ä¸ª Table Lockï¼Ÿå¤ªç²—ï¼Œé˜»å¡äº†æ‰€æœ‰å…¶ä»–åªè¯»è¯¥è¡¨ä¸€è¡Œçš„äº‹åŠ¡ ã€‚</p></li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¤šç²’åº¦é” (Lock Hierarchy)ã€‚</p><ul><li><p><strong>å±‚çº§</strong>ï¼šDatabase \to Table \to Page \to Tuple ã€‚</p></li><li><p><strong>æ„å‘é” (Intention Locks)</strong>ï¼š</p><ul><li>å½“äº‹åŠ¡æƒ³ç»™åº•å±‚èŠ‚ç‚¹ï¼ˆå¦‚ Tupleï¼‰åŠ é”æ—¶ï¼Œå¿…é¡»å…ˆç»™ä¸Šå±‚èŠ‚ç‚¹ï¼ˆå¦‚ Table, Pageï¼‰åŠ <strong>æ„å‘é”</strong>ã€‚</li><li>è¿™å°±åƒåœ¨å¤§æ¥¼é—¨å£æŒ‚ä¸ªç‰Œå­ï¼šâ€œé‡Œé¢æœ‰äººæ­£åœ¨å¹²æ´»ï¼Œåˆ«é”å¤§é—¨â€ã€‚è¿™æ ·å…¶ä»–äº‹åŠ¡æƒ³é”æ•´ä¸ªè¡¨æ—¶ï¼Œçœ‹ä¸€çœ¼è¡¨ä¸Šçš„æ„å‘é”å°±çŸ¥é“ä¸è¡Œï¼Œä¸ç”¨é€è¡Œæ£€æŸ¥ ã€‚</li></ul></li></ul><p><strong>æ„å‘é”ç±»å‹</strong> ï¼š</p><ol><li><strong>IS (Intention-Shared)</strong>ï¼šæ‰“ç®—åœ¨åº•å±‚åŠ  S é”ã€‚</li><li><strong>IX (Intention-Exclusive)</strong>ï¼šæ‰“ç®—åœ¨åº•å±‚åŠ  X é”ã€‚</li><li><strong>SIX (Shared + Intention-Exclusive)</strong>ï¼šæˆ‘è¯»æ•´ä¸ªå­æ ‘ï¼ˆSï¼‰ï¼ŒåŒæ—¶æˆ‘è¦ä¿®æ”¹åº•å±‚çš„æŸäº›èŠ‚ç‚¹ï¼ˆIXï¼‰ã€‚ï¼ˆä¾‹å¦‚ï¼šå…¨è¡¨æ‰«æå¹¶æ›´æ–°éƒ¨åˆ†è¡Œï¼‰ã€‚</li></ol><p><strong>é”å‡çº§ (Lock Escalation)</strong>ï¼šå½“ DBMS å‘ç°ä¸€ä¸ªäº‹åŠ¡åœ¨æŸä¸ªå¯¹è±¡ä¸ŠæŒæœ‰çš„é”å¤ªå¤šï¼ˆä¾‹å¦‚åœ¨ä¸€ä¸ªè¡¨é‡Œé”äº† 1000 è¡Œï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨å°†è¿™äº›ç»†ç²’åº¦é”åˆå¹¶æˆä¸€ä¸ªç²—ç²’åº¦é”ï¼ˆæŠŠ 1000 ä¸ªè¡Œé”å‡çº§ä¸º 1 ä¸ªè¡¨é”ï¼‰ï¼Œä»¥èŠ‚çœèµ„æº ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>2PL</strong> è§£å†³äº†å¹¶å‘æ‰§è¡Œçš„<strong>æ­£ç¡®æ€§</strong>é—®é¢˜ï¼ˆé€šè¿‡å¼ºåˆ¶ä¸¤é˜¶æ®µï¼‰ã€‚</li><li><strong>Strong Strict 2PL</strong> è¿›ä¸€æ­¥è§£å†³äº†<strong>çº§è”å›æ»š</strong>é—®é¢˜ã€‚</li><li><strong>æ­»é”æ£€æµ‹&#x2F;é¢„é˜²</strong> è§£å†³äº† 2PL å¸¦æ¥çš„<strong>æ­»é”</strong>å‰¯ä½œç”¨ã€‚</li><li><strong>æ„å‘é”</strong> è§£å†³äº†é”ç®¡ç†çš„<strong>æ€§èƒ½ä¸å¹¶å‘åº¦å¹³è¡¡</strong>é—®é¢˜ã€‚</li></ul><p>è¿™ä»½ç¬”è®°åŸºäº CMU 15-445&#x2F;645 è¯¾ç¨‹çš„ç¬¬ 17 è®²ï¼ˆLecture #17: Timestamp Ordering Concurrency Controlï¼‰ï¼Œç³»ç»Ÿåœ°æ€»ç»“äº†åŸºäºæ—¶é—´æˆ³çš„å¹¶å‘æ§åˆ¶åè®®ã€ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆOCCï¼‰ã€å¹»è¯»é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚</p><hr><h1 id="ç¬¬åå…«è®²ï¼šæ—¶é—´æˆ³æ’åºå¹¶å‘æ§åˆ¶-Timestamp-Ordering"><a href="#ç¬¬åå…«è®²ï¼šæ—¶é—´æˆ³æ’åºå¹¶å‘æ§åˆ¶-Timestamp-Ordering" class="headerlink" title="ç¬¬åå…«è®²ï¼šæ—¶é—´æˆ³æ’åºå¹¶å‘æ§åˆ¶ (Timestamp Ordering)"></a>ç¬¬åå…«è®²ï¼šæ—¶é—´æˆ³æ’åºå¹¶å‘æ§åˆ¶ (Timestamp Ordering)</h1><h2 id="1-æ—¶é—´æˆ³æ’åºåè®®-Timestamp-Ordering-T-O"><a href="#1-æ—¶é—´æˆ³æ’åºåè®®-Timestamp-Ordering-T-O" class="headerlink" title="1. æ—¶é—´æˆ³æ’åºåè®® (Timestamp Ordering, T&#x2F;O)"></a>1. æ—¶é—´æˆ³æ’åºåè®® (Timestamp Ordering, T&#x2F;O)</h2><p>æ—¶é—´æˆ³æ’åºæ˜¯ä¸€ç§<strong>ä¹è§‚ (Optimistic)</strong> çš„å¹¶å‘æ§åˆ¶åè®® ã€‚ä¸æ‚²è§‚åè®®ï¼ˆå¦‚ 2PLï¼‰ä¸åŒï¼Œå®ƒä¸è¦æ±‚äº‹åŠ¡åœ¨è¯»å†™å‰è·å–é”ï¼Œè€Œæ˜¯åˆ©ç”¨æ—¶é—´æˆ³æ¥å†³å®šäº‹åŠ¡çš„ä¸²è¡ŒåŒ–é¡ºåº ã€‚</p><ul><li><p><strong>æ ¸å¿ƒåŸç†</strong>ï¼šä¸ºæ¯ä¸ªäº‹åŠ¡ T_{i} åˆ†é…ä¸€ä¸ªå”¯ä¸€ä¸”å•è°ƒé€’å¢çš„æ—¶é—´æˆ³ TS(T_{i}) ã€‚</p></li><li><p><strong>ä¸²è¡Œé¡ºåº</strong>ï¼šå¦‚æœ TS(T_{i}) &lt; TS(T_{j})ï¼ŒDBMS å¿…é¡»ç¡®ä¿æ‰§è¡Œç»“æœç­‰ä»·äº T_{i} åœ¨ T_{j} ä¹‹å‰æ‰§è¡Œçš„ä¸²è¡Œè®¡åˆ’ ã€‚</p></li><li><p><strong>åˆ†é…ç­–ç•¥</strong>ï¼š</p></li><li><p><strong>ç³»ç»Ÿæ—¶é’Ÿ</strong>ï¼šå¯èƒ½å­˜åœ¨å¤ä»¤æ—¶ç­‰è¾¹ç¼˜é—®é¢˜ ã€‚</p></li><li><p><strong>é€»è¾‘è®¡æ•°å™¨</strong>ï¼šå­˜åœ¨æº¢å‡ºé—®é¢˜ï¼Œä¸”åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éš¾ä»¥ç»´æŠ¤ ã€‚</p></li><li><p><strong>æ··åˆæ–¹å¼</strong>ï¼šç»“åˆä¸Šè¿°ä¸¤ç§æ–¹æ³• ã€‚</p></li></ul><hr><h2 id="2-ä¹è§‚å¹¶å‘æ§åˆ¶-Optimistic-Concurrency-Control-OCC"><a href="#2-ä¹è§‚å¹¶å‘æ§åˆ¶-Optimistic-Concurrency-Control-OCC" class="headerlink" title="2. ä¹è§‚å¹¶å‘æ§åˆ¶ (Optimistic Concurrency Control, OCC)"></a>2. ä¹è§‚å¹¶å‘æ§åˆ¶ (Optimistic Concurrency Control, OCC)</h2><p>OCC å‡è®¾äº‹åŠ¡å†²çªæå°‘å‘ç”Ÿï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘æˆ–è®¿é—®æ•°æ®ä¸é‡å çš„åœºæ™¯ ã€‚</p><p>OCC çš„ä¸‰ä¸ªé˜¶æ®µ </p><ol><li><p><strong>Read Phase (è¯»å–é˜¶æ®µ)</strong>ï¼šDBMS ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºä¸€ä¸ªç§æœ‰å·¥ä½œç©ºé—´ ã€‚äº‹åŠ¡è¯»å–çš„å¯¹è±¡è¢«å¤åˆ¶åˆ°å·¥ä½œç©ºé—´ï¼Œæ‰€æœ‰çš„ä¿®æ”¹ä¹Ÿä»…åº”ç”¨äºè¯¥ç©ºé—´ ã€‚</p></li><li><p><strong>Validation Phase (éªŒè¯é˜¶æ®µ)</strong>ï¼šå½“äº‹åŠ¡æäº¤æ—¶ï¼ŒDBMS æ£€æŸ¥å…¶å†™é›†æ˜¯å¦ä¸å…¶ä»–äº‹åŠ¡å†²çª ã€‚</p></li><li><p><strong>Write Phase (å†™å…¥é˜¶æ®µ)</strong>ï¼šå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°†ç§æœ‰ç©ºé—´ä¸­çš„ä¿®æ”¹åº”ç”¨åˆ°å…¨å±€æ•°æ®åº“ï¼›å¦åˆ™ï¼Œä¸­æ­¢å¹¶é‡å¯äº‹åŠ¡ ã€‚</p></li></ol><h3 id="éªŒè¯é€»è¾‘-Validation-Phase"><a href="#éªŒè¯é€»è¾‘-Validation-Phase" class="headerlink" title="éªŒè¯é€»è¾‘ (Validation Phase)"></a>éªŒè¯é€»è¾‘ (Validation Phase)</h3><p>DBMS åœ¨éªŒè¯é˜¶æ®µä¸ºäº‹åŠ¡åˆ†é…æ—¶é—´æˆ³ ã€‚ä¸ºäº†ç¡®ä¿ä¸²è¡ŒåŒ–ï¼Œå¿…é¡»æ£€æŸ¥ T_{i} ä¸å…¶ä»–äº‹åŠ¡ä¹‹é—´çš„è¯»å†™ï¼ˆRWï¼‰å’Œå†™å†™ï¼ˆWWï¼‰å†²çª ã€‚</p><ul><li><p><strong>å‰å‘éªŒè¯ (Forward Validation)</strong>ï¼šæ£€æŸ¥æäº¤äº‹åŠ¡ä¸æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡ä¹‹é—´çš„å†²çª ã€‚</p></li><li><p><strong>åå‘éªŒè¯ (Backward Validation)</strong>ï¼šæ£€æŸ¥æäº¤äº‹åŠ¡ä¸å·²æäº¤äº‹åŠ¡ä¹‹é—´çš„å†²çª ã€‚</p></li></ul><p><strong>éªŒè¯æˆåŠŸå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼ˆä»¥ TS(T_{i}) &lt; TS(T_{j}) ä¸ºä¾‹ï¼‰</strong>ï¼š</p><ul><li><p>æ¡ä»¶ 1ï¼š$T_{i}$ åœ¨ $T_{j}$ å¼€å§‹å‰å®Œæˆæ‰€æœ‰é˜¶æ®µ ã€‚</p></li><li><p>æ¡ä»¶ 2ï¼š$T_{i}$ åœ¨ $T_{j}$ å¼€å§‹å†™å…¥å‰å®Œæˆå†™å…¥ï¼Œä¸” $T_{i}$ çš„å†™é›†ä¸ $T_{j}$ çš„è¯»é›†ä¸ç›¸äº¤ï¼ˆ$WriteSet(T_{i}) \cap ReadSet(T_{j}) &#x3D; \emptyset$ï¼‰ ã€‚</p></li><li><p>æ¡ä»¶ 3ï¼š$T_{i}$ åœ¨ $T_{j}$ å®Œæˆè¯»å–å‰å®Œæˆå…¶è¯»å–ï¼Œä¸” $T_{i}$ çš„å†™é›†ä¸ $T_{j}$ çš„è¯»é›†å’Œå†™é›†éƒ½ä¸ç›¸äº¤ ã€‚</p></li></ul><hr><h2 id="3-åŠ¨æ€æ•°æ®åº“ä¸å¹»è¯»é—®é¢˜-Phantom-Problem"><a href="#3-åŠ¨æ€æ•°æ®åº“ä¸å¹»è¯»é—®é¢˜-Phantom-Problem" class="headerlink" title="3. åŠ¨æ€æ•°æ®åº“ä¸å¹»è¯»é—®é¢˜ (Phantom Problem)"></a>3. åŠ¨æ€æ•°æ®åº“ä¸å¹»è¯»é—®é¢˜ (Phantom Problem)</h2><p>å½“äº‹åŠ¡æ¶‰åŠæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ—¶ï¼Œä»…é”å®šç°æœ‰è®°å½•æ˜¯ä¸å¤Ÿçš„ ã€‚<strong>å¹»è¯»</strong>æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€èŒƒå›´å†…æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢ï¼Œå´å¾—åˆ°äº†ä¸åŒçš„ç»“æœé›† ã€‚</p><h3 id="è§£å†³å¹»è¯»çš„æ–¹æ¡ˆ"><a href="#è§£å†³å¹»è¯»çš„æ–¹æ¡ˆ" class="headerlink" title="è§£å†³å¹»è¯»çš„æ–¹æ¡ˆ"></a>è§£å†³å¹»è¯»çš„æ–¹æ¡ˆ</h3><ol><li><p><strong>é‡æ‰§è¡Œæ‰«æ (Re-Execute Scans)</strong>ï¼šåœ¨æäº¤æ—¶é‡æ–°è¿è¡Œæ‰€æœ‰å¸¦æœ‰ <code>WHERE</code> å­å¥çš„æŸ¥è¯¢ï¼Œæ£€æŸ¥ç»“æœæ˜¯å¦ä¸€è‡´ ã€‚</p></li><li><p><strong>è°“è¯é” (Predicate Locking)</strong>ï¼šå¯¹æŸ¥è¯¢çš„è°“è¯å±æ€§åŠ é”ï¼Œä½†ç”±äºå¼€é”€å¤§ï¼Œå¾ˆå°‘è¢«å®é™…åº”ç”¨ ã€‚</p></li><li><p><strong>ç´¢å¼•é” (Index Locking)</strong>ï¼šåˆ©ç”¨ç´¢å¼•é”®ä¿æŠ¤æ•°æ®èŒƒå›´ ã€‚</p><ul><li><p><strong>Key-Value Locks</strong>ï¼šé”å®šç´¢å¼•ä¸­çš„å•ä¸ªé”®å€¼ ã€‚</p></li><li><p><strong>Gap Locks (é—´éš™é”)</strong>ï¼šé”å®šé”®å€¼ä¹‹é—´çš„é—´éš™ï¼Œé˜²æ­¢æ–°æ•°æ®æ’å…¥è¯¥é—´éš™ ã€‚</p></li><li><p><strong>Key-Range Locks</strong>ï¼šé”å®šä¸€ä¸ªé”®åˆ°ä¸‹ä¸€ä¸ªç°æœ‰é”®ä¹‹é—´çš„èŒƒå›´ ã€‚</p></li></ul></li></ol><hr><h2 id="4-éš”ç¦»çº§åˆ«-Isolation-Levels"><a href="#4-éš”ç¦»çº§åˆ«-Isolation-Levels" class="headerlink" title="4. éš”ç¦»çº§åˆ« (Isolation Levels)"></a>4. éš”ç¦»çº§åˆ« (Isolation Levels)</h2><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒDBMS å…è®¸åœ¨ä¸²è¡ŒåŒ–ä¹‹å¤–ä½¿ç”¨è¾ƒå¼±çš„éš”ç¦»çº§åˆ« ã€‚</p><table><thead><tr><th align="left">éš”ç¦»çº§åˆ«</th><th align="left">è„è¯» (Dirty Read)</th><th align="left">ä¸å¯é‡å¤è¯»(Unrepeatable Read)</th><th align="left">å¹»è¯» (Phantom Read)</th><th align="left">å¸¸è§å®ç°æ–¹å¼</th></tr></thead><tbody><tr><td align="left"><strong>SERIALIZABLE</strong></td><td align="left">ä¸å…è®¸</td><td align="left">ä¸å…è®¸</td><td align="left">ä¸å…è®¸</td><td align="left">ä¸¥æ ¼ 2PL + å¹»è¯»ä¿æŠ¤</td></tr><tr><td align="left"><strong>REPEATABLE READS</strong></td><td align="left">ä¸å…è®¸</td><td align="left">ä¸å…è®¸</td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left">ä¸¥æ ¼ 2PL</td></tr><tr><td align="left"><strong>READ COMMITTED</strong></td><td align="left">ä¸å…è®¸</td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left">å†™åŠ é”ï¼Œè¯»åç«‹å³é‡Šæ”¾å…±äº«é”</td></tr><tr><td align="left"><strong>READ UNCOMMITTED</strong></td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left"><strong>å¯èƒ½å‘ç”Ÿ</strong></td><td align="left">å†™åŠ é”ï¼Œè¯»ä¸åŠ å…±äº«é”</td></tr></tbody></table><hr><h3 id="è¡¥å……ç†è§£ï¼šOCC-çš„ä»£ä»·"><a href="#è¡¥å……ç†è§£ï¼šOCC-çš„ä»£ä»·" class="headerlink" title="è¡¥å……ç†è§£ï¼šOCC çš„ä»£ä»·"></a>è¡¥å……ç†è§£ï¼šOCC çš„ä»£ä»·</h3><p>è™½ç„¶ OCC é¿å…äº†é”ç®¡ç†å™¨çš„å¼€é”€ï¼Œä½†å®ƒå¹¶éå®Œç¾ã€‚æ­£å¦‚ç¬”è®°ä¸­æåˆ°çš„ï¼ŒOCC å­˜åœ¨æ˜¾è‘—çš„<strong>æ•°æ®å¤åˆ¶å¼€é”€</strong> ä»¥åŠ<strong>ä¸­æ­¢æµªè´¹</strong>ï¼ˆäº‹åŠ¡åœ¨æ‰§è¡Œå®Œæ‰€æœ‰å·¥ä½œåæ‰å‘ç°å†²çªè¢«ä¸­æ­¢ï¼‰ ã€‚å› æ­¤ï¼Œåœ¨å†²çªé¢‘ç¹çš„é«˜å‹åŠ›ç¯å¢ƒä¸‹ï¼ŒOCC çš„æ€§èƒ½å¾€å¾€ä¸å¦‚ä¼ ç»Ÿçš„ 2PLã€‚</p><p>è¿™ä»½ CMU 15-445&#x2F;645 Database Systems (Fall 2024) Lecture #19 <strong>Multi-Version Concurrency Control (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)</strong> çš„è¯¾ç¨‹ç¬”è®°æ•´ç†å¦‚ä¸‹ã€‚</p><p>è¿™ä»½ç¬”è®°åœ¨æ€»ç»“è¯¾ä»¶æ ¸å¿ƒå†…å®¹çš„åŸºç¡€ä¸Šï¼Œè¡¥å……äº†ç›¸å…³åŸç†çš„æ·±åº¦è§£æï¼Œå¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆç°ä»£æ•°æ®åº“ï¼ˆå¦‚ Postgres, MySQL&#x2F;InnoDB, Oracleï¼‰å‡ ä¹éƒ½ä½¿ç”¨ MVCCã€‚</p><hr><h1 id="ç¬¬åä¹è®²ï¼šMulti-Version-Concurrency-Control-MVCC"><a href="#ç¬¬åä¹è®²ï¼šMulti-Version-Concurrency-Control-MVCC" class="headerlink" title="ç¬¬åä¹è®²ï¼šMulti-Version Concurrency Control (MVCC)"></a>ç¬¬åä¹è®²ï¼šMulti-Version Concurrency Control (MVCC)</h1><h2 id="1-æ ¸å¿ƒæ¦‚å¿µï¼šä»€ä¹ˆæ˜¯-MVCCï¼Ÿ"><a href="#1-æ ¸å¿ƒæ¦‚å¿µï¼šä»€ä¹ˆæ˜¯-MVCCï¼Ÿ" class="headerlink" title="1. æ ¸å¿ƒæ¦‚å¿µï¼šä»€ä¹ˆæ˜¯ MVCCï¼Ÿ"></a>1. æ ¸å¿ƒæ¦‚å¿µï¼šä»€ä¹ˆæ˜¯ MVCCï¼Ÿ</h2><p><strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ (MVCC)</strong> ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œæ˜¯ä¸€ç§é€šè¿‡ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰©ç†ç‰ˆæœ¬æ¥å®ç°å¹¶å‘æ§åˆ¶çš„è®¾è®¡ç†å¿µ ã€‚</p><ul><li><p><strong>åŸºæœ¬åŸç†</strong>ï¼š</p><ul><li><p>DBMS ä¸ºæ•°æ®åº“ä¸­çš„æ¯ä¸ªé€»è¾‘å¯¹è±¡ï¼ˆLogical Objectï¼‰ç»´æŠ¤å¤šä¸ªç‰©ç†ç‰ˆæœ¬ï¼ˆPhysical Versionsï¼‰ã€‚</p></li><li><p><strong>å†™æ“ä½œ</strong>ï¼šå½“äº‹åŠ¡æ›´æ–°æ•°æ®æ—¶ï¼Œä¸æ˜¯è¦†ç›–åŸæ•°æ®ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°æ—¶é—´æˆ³çš„<strong>æ–°ç‰ˆæœ¬</strong> ã€‚</p></li><li><p><strong>è¯»æ“ä½œ</strong>ï¼šå½“äº‹åŠ¡è¯»å–æ•°æ®æ—¶ï¼Œå®ƒè¯»å–çš„æ˜¯è¯¥äº‹åŠ¡å¼€å§‹é‚£ä¸€åˆ»â€œå¯è§â€çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯å¿«ç…§ï¼‰ã€‚</p></li></ul></li><li><p><strong>æ ¸å¿ƒä¼˜åŠ¿ ( The â€œGolden Ruleâ€ )</strong>ï¼š</p><blockquote><p><strong>Writers do not block readers, and readers do not block writers.</strong><br>(å†™æ“ä½œä¸é˜»å¡è¯»æ“ä½œï¼Œè¯»æ“ä½œä¹Ÿä¸é˜»å¡å†™æ“ä½œã€‚)</p></blockquote></li></ul><p>è¿™æ„å‘³ç€ä¸€ä¸ªäº‹åŠ¡åœ¨ä¿®æ”¹æ•°æ® A çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å¯ä»¥æ¯«æ— é˜»ç¢åœ°è¯»å–æ•°æ® A çš„æ—§ç‰ˆæœ¬ ã€‚è¿™æ¯”ä¼ ç»Ÿçš„äºŒé˜¶æ®µé”ï¼ˆ2PLï¼‰å¹¶å‘åº¦é«˜å¾—å¤šï¼Œå› ä¸ºåœ¨ 2PL ä¸­è¯»å†™æ˜¯äº’æ–¥çš„ã€‚</p><p>æ³¨æ„ï¼šå†™æ“ä½œä¹‹é—´ä»ç„¶å¯èƒ½äº’ç›¸é˜»å¡ï¼ˆWrite-Write Conflictï¼‰ï¼Œé€šå¸¸é€šè¿‡å¯¹ç‰¹å®šç‰ˆæœ¬åŠ é”è§£å†³ ã€‚</p><hr><h2 id="2-å¿«ç…§éš”ç¦»-Snapshot-Isolation"><a href="#2-å¿«ç…§éš”ç¦»-Snapshot-Isolation" class="headerlink" title="2. å¿«ç…§éš”ç¦» (Snapshot Isolation)"></a>2. å¿«ç…§éš”ç¦» (Snapshot Isolation)</h2><p>MVCC å¤©ç„¶æ”¯æŒ<strong>å¿«ç…§éš”ç¦» (SI)</strong> çº§åˆ«ã€‚</p><ul><li><p><strong>å·¥ä½œæœºåˆ¶</strong>ï¼š</p><ul><li><p>äº‹åŠ¡å¼€å§‹æ—¶ï¼ŒDBMS ä¼šä¸ºå®ƒæ‹ä¸€å¼ â€œå¿«ç…§â€ï¼ˆé€šå¸¸ç”± Transaction Status Table å’Œæ—¶é—´æˆ³å†³å®šï¼‰ã€‚</p></li><li><p>äº‹åŠ¡åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œçœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯åŸºäºè¿™å¼ å¿«ç…§çš„ã€‚å®ƒå®Œå…¨ä¸å…¶ä»–å¹¶å‘äº‹åŠ¡éš”ç¦»å¼€æ¥ ã€‚</p></li><li><p>è¿™å¯¹<strong>åªè¯»äº‹åŠ¡</strong>æ˜¯å®Œç¾çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ä»»ä½•é”ï¼Œå°±èƒ½è¯»åˆ°ä¸€è‡´çš„æ•°æ® ã€‚</p></li></ul></li><li><p><strong>å†™å†²çª (Write Conflicts)</strong>ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªäº‹åŠ¡è¯•å›¾æ›´æ–°åŒä¸€ä¸ªå¯¹è±¡ï¼Œ<strong>å…ˆå†™è€…èƒœ (First Writer Wins)</strong> ã€‚åæ¥çš„å†™è€…è¦ä¹ˆç­‰å¾…ï¼Œè¦ä¹ˆä¸­æ­¢ã€‚</li></ul></li><li><p><strong>å¼‚å¸¸ï¼šå†™åæ–œ (Write Skew)</strong>ï¼š</p><ul><li>è¿™æ˜¯ SI éš”ç¦»çº§åˆ«ä¸‹ç‰¹æœ‰çš„å¼‚å¸¸ï¼ˆåœ¨å¯ä¸²è¡ŒåŒ–çº§åˆ«ä¸‹ä¸åº”å‘ç”Ÿï¼‰ã€‚</li></ul></li><li><p><strong>åœºæ™¯</strong>ï¼šä¸¤ä¸ªå¹¶å‘äº‹åŠ¡è¯»å–äº†<strong>ä¸åŒ</strong>çš„å¯¹è±¡ï¼Œä½†ä¿®æ”¹å¯¼è‡´äº†æ•´ä½“é€»è¾‘çº¦æŸè¢«ç ´åã€‚</p></li><li><p><strong>ä¾‹å­</strong>ï¼šç”±äºæ­¤æ—¶è¯»å†™ä¸äº’æ–¥ï¼Œå¦‚æœäº‹åŠ¡ A æŠŠæ‰€æœ‰ç™½çƒæ¶‚é»‘ï¼Œäº‹åŠ¡ B æŠŠæ‰€æœ‰é»‘çƒæ¶‚ç™½ï¼Œæœ€ç»ˆç»“æœå¯èƒ½æ—¢æœ‰é»‘åˆæœ‰ç™½ï¼Œè¿™åœ¨ä¸²è¡Œæ‰§è¡Œä¸­æ˜¯ä¸å¯èƒ½å‡ºç°çš„ ã€‚</p></li></ul><hr><h2 id="3-MVCC-çš„å››å¤§è®¾è®¡å†³ç­–"><a href="#3-MVCC-çš„å››å¤§è®¾è®¡å†³ç­–" class="headerlink" title="3. MVCC çš„å››å¤§è®¾è®¡å†³ç­–"></a>3. MVCC çš„å››å¤§è®¾è®¡å†³ç­–</h2><p>å®ç° MVCC éœ€è¦è§£å†³å››ä¸ªä¸»è¦çš„è®¾è®¡é—®é¢˜ï¼š</p><ol><li><strong>ç‰ˆæœ¬å­˜å‚¨ (Version Storage)</strong>ï¼šæ€ä¹ˆå­˜ï¼Ÿ</li><li><strong>åƒåœ¾å›æ”¶ (Garbage Collection)</strong>ï¼šæ€ä¹ˆåˆ ï¼Ÿ</li><li><strong>ç´¢å¼•ç®¡ç† (Index Management)</strong>ï¼šæ€ä¹ˆæ‰¾ï¼Ÿ</li><li><strong>åˆ é™¤å¤„ç† (Deletes)</strong>ï¼šæ€ä¹ˆæ ‡ï¼Ÿ</li></ol><h3 id="1-ç‰ˆæœ¬å­˜å‚¨-Version-Storage"><a href="#1-ç‰ˆæœ¬å­˜å‚¨-Version-Storage" class="headerlink" title="(1) ç‰ˆæœ¬å­˜å‚¨ (Version Storage)"></a>(1) ç‰ˆæœ¬å­˜å‚¨ (Version Storage)</h3><p>æ¯ä¸ªé€»è¾‘å…ƒç»„ï¼ˆTupleï¼‰éƒ½æœ‰ä¸€ä¸ª<strong>ç‰ˆæœ¬é“¾ (Version Chain)</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‰æ—¶é—´æˆ³æ’åºçš„é“¾è¡¨ ã€‚ç´¢å¼•é€šå¸¸æŒ‡å‘é“¾è¡¨çš„â€œå¤´â€ã€‚</p><p>ä¸»è¦æœ‰ä¸‰ç§å­˜å‚¨ç‰©ç†ç‰ˆæœ¬çš„æ–¹æ³•ï¼š</p><ol><li><strong>Append-Only Storage (è¿½åŠ å­˜å‚¨)</strong></li></ol><ul><li><p>æ‰€æœ‰ç‰ˆæœ¬ï¼ˆæ–°æ—§ï¼‰éƒ½æ··åœ¨åŒä¸€ä¸ªè¡¨ä¸­ã€‚æ›´æ–°æ—¶ï¼Œç›´æ¥åœ¨è¡¨ä¸­è¿½åŠ æ–°è¡Œï¼Œå¹¶æ›´æ–°é“¾è¡¨æŒ‡é’ˆã€‚</p></li><li><p><strong>é“¾è¡¨é¡ºåº</strong>ï¼š</p><ul><li><em>Oldest-to-Newest (O2N)</em>ï¼šé“¾è¡¨å¤´æ˜¯æœ€è€ç‰ˆæœ¬ã€‚ç¼ºç‚¹æ˜¯è¯»æœ€æ–°æ•°æ®éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ï¼ˆæ…¢ï¼‰ã€‚</li><li><em>Newest-to-Oldest (N2O)</em>ï¼šé“¾è¡¨å¤´æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚ä¼˜ç‚¹æ˜¯è¯»å–æœ€å¿«ï¼ˆå› ä¸ºå¤§å¤šæ•°æŸ¥è¯¢éƒ½æŸ¥æœ€æ–°æ•°æ®ï¼‰ï¼Œç¼ºç‚¹æ˜¯æ¯æ¬¡æ›´æ–°éƒ½è¦ä¿®æ”¹ç´¢å¼•æŒ‡å‘æ–°çš„å¤´ ã€‚</li></ul></li><li><p><em>PostgreSQL ä½¿ç”¨æ­¤æ–¹æ¡ˆã€‚</em></p></li></ul><ol start="2"><li><strong>Time-Travel Storage (æ—¶é—´æ—…è¡Œå­˜å‚¨)</strong></li></ol><ul><li>ä¸»è¡¨åªå­˜<strong>æœ€æ–°</strong>ç‰ˆæœ¬ã€‚</li><li>æ—§ç‰ˆæœ¬è¢«å¤åˆ¶åˆ°ä¸€ä¸ªå•ç‹¬çš„â€œå†å²è¡¨ (Time-Travel Table)â€ä¸­ã€‚</li><li>ä¼˜ç‚¹æ˜¯ä¸»è¡¨å¾ˆç´§å‡‘ï¼Œå…¨è¡¨æ‰«æå¿«ã€‚</li></ul><ol start="3"><li><strong>Delta Storage (å¢é‡å­˜å‚¨)</strong></li></ol><ul><li>ä¸»è¡¨å­˜æœ€æ–°ç‰ˆæœ¬ã€‚</li><li>â€œå›æ»šæ®µ (Delta Storage)â€ä¸­åªå­˜å‚¨<strong>ä¿®æ”¹çš„å€¼ (Delta&#x2F;Changes)</strong>ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ—§è¡Œã€‚</li><li><strong>åŸç†</strong>ï¼šæƒ³çœ‹æ—§ç‰ˆæœ¬ï¼Ÿæ‹¿æœ€æ–°ç‰ˆæœ¬ï¼Œé€†å‘åº”ç”¨ Delta ç®—å‡ºæ¥ã€‚<ul><li><em>ä¼˜ç‚¹</em>ï¼šå†™å…¥æå¿«ï¼ŒèŠ‚çœç©ºé—´ã€‚<em>ç¼ºç‚¹</em>ï¼šè¯»å–æ—§ç‰ˆæœ¬æ…¢ï¼ˆéœ€è¦è®¡ç®—ï¼‰ã€‚</li><li><em>MySQL (InnoDB) å’Œ Oracle ä½¿ç”¨æ­¤æ–¹æ¡ˆã€‚</em></li></ul></li></ul><h3 id="2-åƒåœ¾å›æ”¶-Garbage-Collection-GC"><a href="#2-åƒåœ¾å›æ”¶-Garbage-Collection-GC" class="headerlink" title="(2) åƒåœ¾å›æ”¶ (Garbage Collection - GC)"></a>(2) åƒåœ¾å›æ”¶ (Garbage Collection - GC)</h3><p>éšç€æ›´æ–°å¢å¤šï¼Œæ—§ç‰ˆæœ¬ä¼šå †ç§¯ã€‚å½“æ²¡æœ‰æ´»è·ƒäº‹åŠ¡éœ€è¦é€šè¿‡å¿«ç…§çœ‹åˆ°æŸä¸ªæ—§ç‰ˆæœ¬æ—¶ï¼Œè¯¥ç‰ˆæœ¬å°±æ˜¯â€œå¯å›æ”¶â€çš„ ã€‚</p><ol><li><strong>å…ƒç»„çº§ GC (Tuple-level GC)</strong></li></ol><ul><li><p><strong>åå°æ¸…ç† (Background Vacuuming)</strong>ï¼šåå°çº¿ç¨‹å®šæœŸæ‰«æè¡¨ï¼Œé€šè¿‡æ¯”å¯¹æ´»è·ƒäº‹åŠ¡çš„ä½å›¾ï¼Œæ¸…é™¤ä¸å¯è§çš„ç‰ˆæœ¬ ã€‚</p></li><li><p><strong>åä½œæ¸…ç† (Cooperative Cleaning)</strong>ï¼šå·¥ä½œçº¿ç¨‹ï¼ˆWorkerï¼‰åœ¨æ‰§è¡ŒæŸ¥è¯¢æ‰«æç‰ˆæœ¬é“¾æ—¶ï¼Œé¡ºæ‰‹æŠŠä¸å†éœ€è¦çš„æ—§ç‰ˆæœ¬åˆ æ‰ï¼ˆä»…é€‚ç”¨äº O2N é¡ºåºï¼‰ã€‚</p></li></ul><ol start="2"><li><strong>äº‹åŠ¡çº§ GC (Transaction-level GC)</strong></li></ol><ul><li>æ¯ä¸ªäº‹åŠ¡è´Ÿè´£è®°å½•è‡ªå·±äº§ç”Ÿäº†å“ªäº›æ—§ç‰ˆæœ¬ã€‚å½“äº‹åŠ¡ç»“æŸä¸”ç¡®è®¤è¿™äº›ç‰ˆæœ¬ä¸å†è¢«éœ€è¦æ—¶ï¼Œç”±ç³»ç»Ÿå›æ”¶ã€‚</li></ul><h3 id="3-ç´¢å¼•ç®¡ç†-Index-Management"><a href="#3-ç´¢å¼•ç®¡ç†-Index-Management" class="headerlink" title="(3) ç´¢å¼•ç®¡ç† (Index Management)"></a>(3) ç´¢å¼•ç®¡ç† (Index Management)</h3><p>åœ¨ MVCC ä¸­ï¼Œä¸»é”®ç´¢å¼• (Primary Key Index) æ€»æ˜¯æŒ‡å‘ç‰ˆæœ¬é“¾çš„å¤´éƒ¨ ã€‚éš¾ç‚¹åœ¨äº<strong>è¾…åŠ©ç´¢å¼• (Secondary Indexes)</strong>ã€‚</p><p>å¦‚æœæ›´æ–°äº†æ•°æ®ï¼ˆå¯¼è‡´äº§ç”Ÿäº†æ–°ç‰ˆæœ¬çš„ç‰©ç†ä½ç½®å˜åŒ–ï¼‰ï¼Œè¾…åŠ©ç´¢å¼•è¯¥æ€ä¹ˆåŠï¼Ÿ</p><ol><li><strong>é€»è¾‘æŒ‡é’ˆ (Logical Pointers)</strong></li></ol><ul><li>è¾…åŠ©ç´¢å¼•å­˜å‚¨ä¸»é”®ï¼ˆæˆ–é€»è¾‘ IDï¼‰ï¼Œè€Œä¸æ˜¯ç‰©ç†åœ°å€ã€‚</li><li><em>æŸ¥æ‰¾è·¯å¾„</em>ï¼šè¾…åŠ©ç´¢å¼• -&gt; ä¸»é”® -&gt; ä¸»é”®ç´¢å¼• -&gt; ç‰©ç†åœ°å€ã€‚</li><li><em>ä¼˜ç‚¹</em>ï¼šæ›´æ–°æ•°æ®æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹è¾…åŠ©ç´¢å¼•ï¼ˆå› ä¸ºä¸»é”®æ²¡å˜ï¼‰ã€‚</li><li><em>ç¼ºç‚¹</em>ï¼šè¯»æ•°æ®å¤šäº†ä¸€æ¬¡æŸ¥æ‰¾ï¼ˆå›è¡¨ï¼‰ï¼Œæ…¢ã€‚</li></ul><ol start="2"><li><strong>ç‰©ç†æŒ‡é’ˆ (Physical Pointers)</strong></li></ol><ul><li>è¾…åŠ©ç´¢å¼•ç›´æ¥å­˜å‚¨ç‰©ç†åœ°å€ï¼ˆæŒ‡å‘ç‰ˆæœ¬é“¾å¤´ï¼‰ã€‚</li><li><em>ä¼˜ç‚¹</em>ï¼šè¯»æ•°æ®å¿«ï¼Œä¸€æ­¥åˆ°ä½ã€‚</li><li></li></ul><p><em>ç¼ºç‚¹</em>ï¼š<strong>å†™æ”¾å¤§</strong>ã€‚ä¸€æ—¦æ›´æ–°æ•°æ®äº§ç”Ÿæ–°ç‰ˆæœ¬ï¼Œæ‰€æœ‰æŒ‡å‘è¯¥æ•°æ®çš„è¾…åŠ©ç´¢å¼•éƒ½å¿…é¡»æ›´æ–°æŒ‡å‘æ–°åœ°å€ ã€‚</p><p><strong>é‡å¤é”®é—®é¢˜ (Duplicate Key Problem)</strong> ï¼š<br>åœ¨ MVCC ä¸­ï¼Œç´¢å¼•å¯èƒ½åŒ…å«åŒä¸€ä¸ª Key çš„å¤šä¸ªæ¡ç›®ï¼ˆæŒ‡å‘ä¸åŒç‰ˆæœ¬çš„å…ƒç»„ï¼‰ã€‚ç´¢å¼•ç»“æ„å¿…é¡»æ”¯æŒéå”¯ä¸€ Keyï¼Œå³ä½¿æ˜¯å”¯ä¸€ç´¢å¼•åœ¨åº•å±‚ç‰©ç†å­˜å‚¨ä¸Šä¹Ÿå¯èƒ½å› ä¸ºç‰ˆæœ¬å…±å­˜è€Œå‡ºç°é‡å¤ã€‚</p><h3 id="4-åˆ é™¤-Deletes"><a href="#4-åˆ é™¤-Deletes" class="headerlink" title="(4) åˆ é™¤ (Deletes)"></a>(4) åˆ é™¤ (Deletes)</h3><p>åœ¨ MVCC ä¸­ï¼Œç‰©ç†åˆ é™¤ä¹Ÿæ˜¯ä¸€ç§â€œæ›´æ–°â€ã€‚</p><ol><li><p><strong>Deleted Flag</strong>ï¼šåœ¨å…ƒç»„å¤´åŠ ä¸ªæ ‡è®°ï¼Œè¯´â€œæˆ‘è¢«åˆ äº†â€ ã€‚</p></li><li><p><strong>Tombstone Tuple (å¢“ç¢‘å…ƒç»„)</strong>ï¼šæ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„ç©ºç‰ˆæœ¬ï¼Œæ ‡å¿—ç€ç”Ÿå‘½å‘¨æœŸçš„ç»“æŸ ã€‚<br>çœŸæ­£çš„ç‰©ç†åˆ é™¤ç”±åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰ç¨åå®Œæˆ ã€‚</p></li></ol><hr><h2 id="4-æ€»ç»“ä¸è¡¥å……"><a href="#4-æ€»ç»“ä¸è¡¥å……" class="headerlink" title="4. æ€»ç»“ä¸è¡¥å……"></a>4. æ€»ç»“ä¸è¡¥å……</h2><p>MVCC æ˜¯ç°ä»£æ•°æ®åº“å¹¶å‘æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚</p><ul><li><strong>ç›¸æ¯” 2PL</strong>ï¼šMVCC æœ€å¤§çš„è´¡çŒ®æ˜¯è§£é™¤äº†â€œè¯»-å†™â€é˜»å¡ã€‚è¯»æ“ä½œæ°¸è¿œä¸ä¼šå› ä¸ºå†™é”è€Œè¢«æŒ‚èµ·ï¼Œè¿™å¯¹äºä»¥è¯»ä¸ºä¸»çš„äº’è”ç½‘åº”ç”¨è‡³å…³é‡è¦ã€‚</li><li><strong>ä»£ä»·</strong>ï¼š<ol><li><strong>ç©ºé—´æ”¾å¤§</strong>ï¼šéœ€è¦å­˜å‚¨å¤šç‰ˆæœ¬ã€‚</li><li><strong>ç®¡ç†å¼€é”€</strong>ï¼šéœ€è¦å¤æ‚çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¦åˆ™æ•°æ®åº“ä¼šæ— é™è†¨èƒ€ï¼ˆPostgreSQL çš„ Vacuum é—®é¢˜å°±æ˜¯å…¸å‹ï¼‰ã€‚</li><li><strong>ç´¢å¼•ç»´æŠ¤</strong>ï¼šæ›´æ–°æ“ä½œå¯èƒ½å¯¼è‡´ä¸¥é‡çš„ç´¢å¼•å†™æ”¾å¤§ã€‚</li></ol></li></ul><h3 id="æ€è€ƒé¢˜ï¼š"><a href="#æ€è€ƒé¢˜ï¼š" class="headerlink" title="æ€è€ƒé¢˜ï¼š"></a>æ€è€ƒé¢˜ï¼š</h3><p>å¦‚æœä½ çš„ç³»ç»Ÿæ˜¯<strong>å†™å¯†é›†å‹ (Write-Heavy)</strong> çš„ï¼Œä¸”å‡ ä¹ä¸è¯»å†å²æ•°æ®ï¼ŒAppend-Only Storage çš„ N2O ç­–ç•¥å’Œ Delta Storage å“ªä¸ªæ›´å¥½ï¼Ÿ</p><ul><li><em>åˆ†æ</em>ï¼šDelta Storage é€šå¸¸æ›´å¥½ã€‚å› ä¸º Append-Only æ¯æ¬¡ Update éƒ½è¦å¤åˆ¶æ•´ä¸ª Tupleï¼Œå†™æ”¾å¤§ä¸¥é‡ï¼›è€Œ Delta åªå­˜å˜æ›´é‡ï¼Œå†™å…¥ I&#x2F;O æ›´å°ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå†™æ€§èƒ½å¼ºæ‚çš„ InnoDB é€‰æ‹© Delta Storage çš„åŸå› ã€‚</li></ul><p>è¿™ä»½ç¬”è®°åŸºäº CMU 15-445&#x2F;645 è¯¾ç¨‹ç¬¬ 20 è®²ï¼ˆLecture #20: Database Loggingï¼‰ï¼Œç³»ç»Ÿæ€»ç»“äº†æ•°æ®åº“æ¢å¤ç®—æ³•ã€ç¼“å†²æ± ç®¡ç†ç­–ç•¥ã€å½±å­åˆ†é¡µã€é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰ä»¥åŠæ£€æŸ¥ç‚¹æœºåˆ¶ã€‚</p><hr><h1 id="ç¬¬äºŒåè®²ï¼šæ•°æ®åº“æ—¥å¿—ä¸æ•…éšœæ¢å¤-Database-Logging"><a href="#ç¬¬äºŒåè®²ï¼šæ•°æ®åº“æ—¥å¿—ä¸æ•…éšœæ¢å¤-Database-Logging" class="headerlink" title="ç¬¬äºŒåè®²ï¼šæ•°æ®åº“æ—¥å¿—ä¸æ•…éšœæ¢å¤ (Database Logging)"></a>ç¬¬äºŒåè®²ï¼šæ•°æ®åº“æ—¥å¿—ä¸æ•…éšœæ¢å¤ (Database Logging)</h1><h2 id="1-æ•…éšœæ¢å¤æ¦‚è¿°-Crash-Recovery"><a href="#1-æ•…éšœæ¢å¤æ¦‚è¿°-Crash-Recovery" class="headerlink" title="1. æ•…éšœæ¢å¤æ¦‚è¿° (Crash Recovery)"></a>1. æ•…éšœæ¢å¤æ¦‚è¿° (Crash Recovery)</h2><p>æ¢å¤ç®—æ³•æ˜¯ç¡®ä¿æ•°æ®åº“åœ¨å‘ç”Ÿæ•…éšœï¼ˆå¦‚æ–­ç”µã€ç³»ç»Ÿå´©æºƒï¼‰åï¼Œä¾ç„¶èƒ½ä¿æŒ<strong>ä¸€è‡´æ€§ (Consistency)</strong>ã€<strong>åŸå­æ€§ (Atomicity)</strong> å’Œ<strong>æŒä¹…æ€§ (Durability)</strong> çš„æŠ€æœ¯ ã€‚</p><h3 id="æ ¸å¿ƒæ“ä½œ"><a href="#æ ¸å¿ƒæ“ä½œ" class="headerlink" title="æ ¸å¿ƒæ“ä½œ"></a>æ ¸å¿ƒæ“ä½œ</h3><ul><li><p><strong>UNDO</strong>ï¼šæ’¤é”€æœªå®Œæˆæˆ–å·²å›æ»šäº‹åŠ¡å¯¹æ•°æ®åº“çš„å½±å“ ã€‚</p></li><li><p><strong>REDO</strong>ï¼šé‡æ–°åº”ç”¨å·²æäº¤äº‹åŠ¡çš„å½±å“ï¼Œä»¥ç¡®ä¿æŒä¹…æ€§ ã€‚</p></li></ul><hr><h2 id="2-ç¼“å†²æ± ç®¡ç†ç­–ç•¥-Buffer-Pool-Management-Policies"><a href="#2-ç¼“å†²æ± ç®¡ç†ç­–ç•¥-Buffer-Pool-Management-Policies" class="headerlink" title="2. ç¼“å†²æ± ç®¡ç†ç­–ç•¥ (Buffer Pool Management Policies)"></a>2. ç¼“å†²æ± ç®¡ç†ç­–ç•¥ (Buffer Pool Management Policies)</h2><p>DBMS å¿…é¡»å¹³è¡¡ç³»ç»Ÿæ€§èƒ½ä¸æ•°æ®å®‰å…¨æ€§ã€‚è¿™ä¸»è¦ç”±ä¸¤ä¸ªç­–ç•¥å†³å®šï¼š</p><h3 id="A-Steal-ç­–ç•¥-çªƒå–"><a href="#A-Steal-ç­–ç•¥-çªƒå–" class="headerlink" title="A. Steal ç­–ç•¥ (çªƒå–)"></a>A. Steal ç­–ç•¥ (çªƒå–)</h3><p>å®šä¹‰æ˜¯å¦å…è®¸æœªæäº¤çš„äº‹åŠ¡è¦†ç›–éæ˜“å¤±æ€§å­˜å‚¨ï¼ˆç£ç›˜ï¼‰ä¸­æœ€è¿‘æäº¤çš„å€¼ ã€‚</p><ul><li><p><strong>STEAL</strong>ï¼šå…è®¸ ã€‚ä¼˜ç‚¹æ˜¯å†…å­˜åˆ©ç”¨ç‡é«˜ï¼Œä½†å´©æºƒåéœ€è¦ <strong>UNDO</strong> ã€‚</p></li><li><p><strong>NO-STEAL</strong>ï¼šä¸å…è®¸ ã€‚ä¸éœ€è¦ UNDOï¼Œä½†äº‹åŠ¡ä¿®æ”¹é‡å—é™äºå¯ç”¨å†…å­˜ ã€‚</p></li></ul><h3 id="B-Force-ç­–ç•¥-å¼ºåˆ¶"><a href="#B-Force-ç­–ç•¥-å¼ºåˆ¶" class="headerlink" title="B. Force ç­–ç•¥ (å¼ºåˆ¶)"></a>B. Force ç­–ç•¥ (å¼ºåˆ¶)</h3><p>å®šä¹‰æ˜¯å¦è¦æ±‚äº‹åŠ¡åœ¨æäº¤å‰ï¼Œå°†å…¶æ‰€æœ‰æ›´æ–°éƒ½åæ˜ åˆ°ç£ç›˜ä¸Š ã€‚</p><ul><li><p><strong>FORCE</strong>ï¼šå¼ºåˆ¶è¦æ±‚ ã€‚æ¢å¤ç®€å•ï¼Œä½†ç”±äºæ¶‰åŠå¤§é‡éšæœºå†™ï¼Œè¿è¡Œæ—¶æ€§èƒ½æå·® ã€‚</p></li><li><p><strong>NO-FORCE</strong>ï¼šä¸å¼ºåˆ¶ ã€‚è¿è¡Œæ—¶æ€§èƒ½æœ€ä¼˜ï¼Œä½†å´©æºƒåéœ€è¦ <strong>REDO</strong> ã€‚</p></li></ul><blockquote><p><strong>æ€»ç»“</strong>ï¼šç°ä»£ä¸»æµ DBMS é€šå¸¸é‡‡ç”¨ <strong>STEAL + NO-FORCE</strong> ç­–ç•¥ï¼Œå› ä¸ºå®ƒèƒ½æä¾›æœ€ä½³çš„è¿è¡Œæ—¶æ€§èƒ½ ã€‚</p></blockquote><hr><h2 id="3-å½±å­åˆ†é¡µ-Shadow-Paging"><a href="#3-å½±å­åˆ†é¡µ-Shadow-Paging" class="headerlink" title="3. å½±å­åˆ†é¡µ (Shadow Paging)"></a>3. å½±å­åˆ†é¡µ (Shadow Paging)</h2><p>è¿™æ˜¯ä¸€ç§æ—©æœŸçš„ <strong>NO-STEAL + FORCE</strong> ç³»ç»Ÿå®ç° ã€‚</p><ul><li><p><strong>åŸç†</strong>ï¼šDBMS ç»´æŠ¤ä¸¤ä»½é¡µè¡¨ï¼š<strong>Master (ä¸»é¡µè¡¨)</strong> å’Œ <strong>Shadow (å½±å­é¡µè¡¨)</strong> ã€‚</p></li><li><p><strong>æ‰§è¡Œ</strong>ï¼šå†™æ“ä½œåªå‘ç”Ÿåœ¨å½±å­é¡µè¡¨ä¸­ ã€‚</p></li><li><p><strong>æäº¤</strong>ï¼šé€šè¿‡åŸå­æ€§åœ°ä¿®æ”¹æ ¹èŠ‚ç‚¹æŒ‡é’ˆï¼Œè®©ä¸»é¡µè¡¨æŒ‡å‘å½±å­é¡µè¡¨çš„å†…å®¹ ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå¤åˆ¶é¡µè¡¨å¼€é”€å¤§ã€å¯¼è‡´éšæœºå†™ã€é€ æˆæ•°æ®ç¢ç‰‡ã€ä¸”éœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶ ã€‚</p></li></ul><hr><h2 id="4-é¢„å†™æ—¥å¿—-Write-Ahead-Logging-WAL"><a href="#4-é¢„å†™æ—¥å¿—-Write-Ahead-Logging-WAL" class="headerlink" title="4. é¢„å†™æ—¥å¿— (Write-Ahead Logging, WAL)"></a>4. é¢„å†™æ—¥å¿— (Write-Ahead Logging, WAL)</h2><p>è¿™æ˜¯ç›®å‰å‡ ä¹æ‰€æœ‰æ•°æ®åº“ï¼ˆå¦‚ PostgreSQL, MySQL, SQL Serverï¼‰çš„æ ‡å‡†åšæ³• ã€‚</p><h3 id="æ ¸å¿ƒå‡†åˆ™-The-Golden-Rule"><a href="#æ ¸å¿ƒå‡†åˆ™-The-Golden-Rule" class="headerlink" title="æ ¸å¿ƒå‡†åˆ™ (The Golden Rule)"></a>æ ¸å¿ƒå‡†åˆ™ (The Golden Rule)</h3><p>åœ¨å°†æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰ï¼Œå¿…é¡»å…ˆå°†å¯¹åº”ä¿®æ”¹çš„æ—¥å¿—è®°å½•å†™å…¥ç¨³å®šå­˜å‚¨ï¼ˆç£ç›˜ï¼‰ ã€‚</p><h3 id="è¿è¡Œæœºåˆ¶"><a href="#è¿è¡Œæœºåˆ¶" class="headerlink" title="è¿è¡Œæœºåˆ¶"></a>è¿è¡Œæœºåˆ¶</h3><ol><li><p>äº‹åŠ¡çš„æ‰€æœ‰æ—¥å¿—è®°å½•å…ˆç¼“å­˜åœ¨å†…å­˜çš„ <strong>WAL Buffer</strong> ä¸­ ã€‚</p></li><li><p>åªæœ‰åœ¨äº‹åŠ¡çš„æ‰€æœ‰æ—¥å¿—éƒ½åˆ·å…¥ç£ç›˜åï¼Œè¯¥äº‹åŠ¡æ‰è¢«è®¤ä¸ºå·²æäº¤ ã€‚</p></li><li><p><strong>æ—¥å¿—è®°å½•å†…å®¹</strong>ï¼šäº‹åŠ¡ IDã€å¯¹è±¡ IDã€<strong>Before Value (ç”¨äº UNDO)</strong>ã€<strong>After Value (ç”¨äº REDO)</strong> ã€‚</p></li></ol><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>å°†éšæœºå†™æ“ä½œè½¬å˜ä¸ºé¡ºåºå†™æ—¥å¿—ï¼Œæå¤§æå‡äº†ç³»ç»Ÿååé‡ ã€‚</p><hr><h2 id="5-æ—¥å¿—è®°å½•æ–¹æ¡ˆ-Logging-Schemes"><a href="#5-æ—¥å¿—è®°å½•æ–¹æ¡ˆ-Logging-Schemes" class="headerlink" title="5. æ—¥å¿—è®°å½•æ–¹æ¡ˆ (Logging Schemes)"></a>5. æ—¥å¿—è®°å½•æ–¹æ¡ˆ (Logging Schemes)</h2><p>æ—¥å¿—ä¸­å­˜å‚¨å†…å®¹çš„ç²’åº¦å„ä¸ç›¸åŒï¼š</p><ul><li><p><strong>ç‰©ç†æ—¥å¿— (Physical Logging)</strong>ï¼šè®°å½•æ•°æ®åº“ç‰¹å®šä½ç½®çš„å­—èŠ‚çº§æ›´æ”¹ï¼ˆç±»ä¼¼äº git diffï¼‰ ã€‚</p></li><li><p><strong>é€»è¾‘æ—¥å¿— (Logical Logging)</strong>ï¼šè®°å½•é«˜å±‚æ“ä½œï¼ˆå¦‚ <code>INSERT</code> æˆ– <code>UPDATE</code> è¯­å¥ï¼‰ ã€‚å­˜å‚¨é‡å°ï¼Œä½†å¹¶å‘ç¯å¢ƒä¸‹æ¢å¤æéš¾ä¸”ç¼“æ…¢ ã€‚</p></li><li><p><strong>ç”Ÿç†æ—¥å¿— (Physiological Logging)</strong>ï¼š<strong>æœ€å¸¸ç”¨çš„æ–¹æ¡ˆ</strong> ã€‚æ—¥å¿—é’ˆå¯¹å•ä¸ªæ•°æ®é¡µï¼Œä½†é€šè¿‡æ’æ§½å·ï¼ˆSlot Numberï¼‰æ ‡è¯†å…ƒç»„ï¼Œè€Œä¸æŒ‡å®šé¡µå†…å…·ä½“å­—èŠ‚ä½ç½® ã€‚è¿™å…è®¸ DBMS åœ¨æ—¥å¿—å†™ç›˜åé‡æ–°ç»„ç»‡é¡µé¢å¸ƒå±€ ã€‚</p></li></ul><hr><h2 id="6-æ£€æŸ¥ç‚¹-Checkpoints"><a href="#6-æ£€æŸ¥ç‚¹-Checkpoints" class="headerlink" title="6. æ£€æŸ¥ç‚¹ (Checkpoints)"></a>6. æ£€æŸ¥ç‚¹ (Checkpoints)</h2><p>å¦‚æœä¸å—é™åˆ¶ï¼ŒWAL æ—¥å¿—ä¼šæ— é™å¢é•¿ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒåçš„æ¢å¤æ—¶é—´è¿‡é•¿ ã€‚</p><ul><li><p><strong>æœºåˆ¶</strong>ï¼šDBMS å®šæœŸæ‰§è¡Œæ£€æŸ¥ç‚¹æ“ä½œï¼Œå°†ç¼“å†²æ± ä¸­çš„æ‰€æœ‰è„é¡µï¼ˆDirty Pagesï¼‰åˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶å†™å…¥ä¸€ä¸ª <code>&lt;CHECKPOINT&gt;</code> è®°å½• ã€‚</p></li><li><p><strong>é˜»å¡å¼å®ç°</strong>ï¼šåœæ­¢æ¥å—æ–°äº‹åŠ¡ï¼Œç­‰å¾…å½“å‰äº‹åŠ¡å®Œæˆï¼Œç„¶ååˆ·æ–°æ•°æ® ã€‚è¿™ç§æ–¹å¼è™½ç„¶ä¿è¯äº†ä¸€è‡´æ€§ï¼Œä½†ä¼šé€ æˆæ€§èƒ½ç¬æ—¶ä¸‹é™ ã€‚</p></li></ul><hr><h3 id="è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ-1"><a href="#è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ-1" class="headerlink" title="è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ"></a>è¡¥å……ï¼šåŸç†æ·±åº¦è§£æ</h3><p><strong>ä¸ºä»€ä¹ˆéšæœºå†™ä¼šä¸¥é‡æ‹–æ…¢æ€§èƒ½ï¼Ÿ</strong><br>ä¼ ç»Ÿçš„æœºæ¢°ç¡¬ç›˜ï¼ˆHDDï¼‰åœ¨è¿›è¡Œéšæœºè¯»å†™æ—¶ï¼Œéœ€è¦é¢‘ç¹ç§»åŠ¨ç£å¤´ï¼ˆå¯»é“ï¼‰ï¼Œå»¶è¿Ÿæé«˜ã€‚å³ä¾¿åœ¨ SSD æ—¶ä»£ï¼Œéšæœºå†™å…¥ä¹Ÿä¼šè§¦å‘å¤æ‚çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰å’Œå†™æ”¾å¤§æ•ˆåº” ã€‚WAL å°†æ•°æ®ä¿®æ”¹é€šè¿‡æ—¥å¿—è½¬åŒ–ä¸º<strong>é¡ºåºè¿½åŠ  (Sequential Append)</strong>ï¼Œå®Œç¾é¿å¼€äº†ç£ç›˜æ€§èƒ½çš„æœ€å¼±é¡¹ï¼Œè¿™ä¹Ÿæ˜¯æ•°æ®åº“èƒ½æ”¯æ’‘é«˜å¹¶å‘å†™æ“ä½œçš„å…³é”®æ‰€åœ¨ã€‚</p><p>è¿™ä»½ CMU 15-445&#x2F;645 Database Systems (Fall 2024) Lecture #21 <strong>Database Crash Recovery (æ•°æ®åº“å´©æºƒæ¢å¤)</strong> çš„è¯¾ç¨‹ç¬”è®°æ•´ç†å¦‚ä¸‹ã€‚</p><p>è¿™ä»½ç¬”è®°åœ¨æ€»ç»“è¯¾ä»¶æ ¸å¿ƒå†…å®¹çš„åŸºç¡€ä¸Šï¼Œè¡¥å……äº† <strong>ARIES</strong> ç®—æ³•èƒŒåçš„è®¾è®¡å“²å­¦ï¼ˆå¦‚ STEAL&#x2F;NO-FORCE ç­–ç•¥ï¼‰ï¼Œå¸®åŠ©ä½ ä»åŸç†å±‚é¢ç†è§£æ•°æ®åº“æ˜¯å¦‚ä½•åœ¨å´©æºƒåâ€œèµ·æ­»å›ç”Ÿâ€çš„ã€‚</p><hr><h1 id="ç¬¬äºŒåä¸€è®²ï¼šDatabase-Crash-Recovery-æ•°æ®åº“å´©æºƒæ¢å¤"><a href="#ç¬¬äºŒåä¸€è®²ï¼šDatabase-Crash-Recovery-æ•°æ®åº“å´©æºƒæ¢å¤" class="headerlink" title="ç¬¬äºŒåä¸€è®²ï¼šDatabase Crash Recovery (æ•°æ®åº“å´©æºƒæ¢å¤)"></a>ç¬¬äºŒåä¸€è®²ï¼šDatabase Crash Recovery (æ•°æ®åº“å´©æºƒæ¢å¤)</h1><h2 id="1-æ ¸å¿ƒèƒŒæ™¯ï¼šæ•…éšœä¸æ¢å¤-Motivation"><a href="#1-æ ¸å¿ƒèƒŒæ™¯ï¼šæ•…éšœä¸æ¢å¤-Motivation" class="headerlink" title="1. æ ¸å¿ƒèƒŒæ™¯ï¼šæ•…éšœä¸æ¢å¤ (Motivation)"></a>1. æ ¸å¿ƒèƒŒæ™¯ï¼šæ•…éšœä¸æ¢å¤ (Motivation)</h2><p>DBMS çš„æ¢å¤ç³»ç»Ÿæ˜¯ä¸ºäº†ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœï¼ˆå¦‚æ–­ç”µã€å´©æºƒï¼‰æ—¶ï¼Œä¾ç„¶èƒ½ç»´æŒ ACID ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯ <strong>Atomicity (åŸå­æ€§)</strong> å’Œ <strong>Durability (æŒä¹…æ€§)</strong> ã€‚</p><h3 id="å…³é”®å‰æï¼šSTEAL-NO-FORCE-ç­–ç•¥"><a href="#å…³é”®å‰æï¼šSTEAL-NO-FORCE-ç­–ç•¥" class="headerlink" title="å…³é”®å‰æï¼šSTEAL + NO-FORCE ç­–ç•¥"></a>å…³é”®å‰æï¼šSTEAL + NO-FORCE ç­–ç•¥</h3><p>è™½ç„¶è¯¾ä»¶ä¸­åªç®€ç•¥æåˆ°äº†è¿™å‡ ä¸ªè¯ ï¼Œä½†ç†è§£å®ƒä»¬æ˜¯ç†è§£ ARIES çš„åŸºç¡€ï¼š</p><ol><li><strong>STEAL (å…è®¸å·è·‘)</strong>ï¼šDBMS å…è®¸æœªæäº¤äº‹åŠ¡ï¼ˆUncommittedï¼‰ä¿®æ”¹çš„è„é¡µè¢«å†™å…¥ç£ç›˜ã€‚</li></ol><ul><li><em>åæœ</em>ï¼šå¦‚æœå´©æºƒï¼Œç£ç›˜ä¸Šå¯èƒ½å­˜æœ‰è„æ•°æ®ï¼Œæ¢å¤æ—¶å¿…é¡» <strong>Undo (æ’¤é”€)</strong> è¿™äº›æ›´æ”¹ã€‚</li></ul><ol start="2"><li><strong>NO-FORCE (éå¼ºåˆ¶åˆ·ç›˜)</strong>ï¼šäº‹åŠ¡æäº¤æ—¶ï¼Œ<strong>ä¸å¼ºåˆ¶</strong>å°†æ‰€æœ‰è„é¡µç«‹å³åˆ·å…¥ç£ç›˜ï¼ˆåªåˆ·æ—¥å¿—ï¼‰ã€‚</li></ol><ul><li><em>åæœ</em>ï¼šå¦‚æœå´©æºƒï¼Œå·²æäº¤çš„æ•°æ®å¯èƒ½è¿˜æ²¡å†™å…¥ç£ç›˜ï¼Œæ¢å¤æ—¶å¿…é¡» <strong>Redo (é‡åš)</strong> è¿™äº›æ›´æ”¹ã€‚</li></ul><p><strong>ç»“è®º</strong>ï¼šå› ä¸ºç°ä»£æ•°æ®åº“ä¸ºäº†æ€§èƒ½å‡ ä¹éƒ½é‡‡ç”¨ <strong>STEAL + NO-FORCE</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¢èƒ½ Undo åˆèƒ½ Redo çš„æ¢å¤ç®—æ³•â€”â€”å³ <strong>ARIES</strong>ã€‚</p><hr><h2 id="2-ARIES-æ¢å¤ç®—æ³•æ¦‚è¿°"><a href="#2-ARIES-æ¢å¤ç®—æ³•æ¦‚è¿°" class="headerlink" title="2. ARIES æ¢å¤ç®—æ³•æ¦‚è¿°"></a>2. ARIES æ¢å¤ç®—æ³•æ¦‚è¿°</h2><p><strong>ARIES</strong> (Algorithms for Recovery and Isolation Exploiting Semantics) æ˜¯ IBM åœ¨ 90 å¹´ä»£ç ”å‘çš„æ¢å¤ç®—æ³•ï¼Œç°åœ¨å‡ ä¹æ˜¯æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„æ ‡å‡† ã€‚å®ƒçš„ä¸‰å¤§æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š</p><ol><li><p><strong>Write-Ahead Logging (WAL)</strong>ï¼šå…ˆå†™æ—¥å¿—ï¼Œåå†™æ•°æ®é¡µã€‚ä»»ä½•ä¿®æ”¹å¿…é¡»å…ˆè¿›å…¥ Stable Storageï¼ˆç£ç›˜ï¼‰ä¸Šçš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰èƒ½ä¿®æ”¹ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶ ã€‚</p></li><li><p><strong>Repeating History (é‡æ¼”å†å²)</strong>ï¼šé‡å¯æ—¶ï¼Œé‡æ–°æ‰§è¡Œä¸€éå´©æºƒå‘ç”Ÿå‰æ‰€æœ‰çš„æ“ä½œï¼ˆåŒ…æ‹¬é‚£äº›åæ¥ abort çš„æ“ä½œï¼‰ï¼Œå°†æ•°æ®åº“æ¢å¤åˆ°å´©æºƒé‚£ä¸€ç¬é—´çš„â€œå‡†ç¡®çŠ¶æ€â€ ã€‚</p></li><li><p><strong>Logging Changes During Undo (Undo æ—¶ä¹Ÿè¦å†™æ—¥å¿—)</strong>ï¼šåœ¨æ’¤é”€æ“ä½œæ—¶ï¼Œä¹Ÿä¼šè®°å½•æ—¥å¿—ï¼ˆç§°ä¸º CLRï¼‰ã€‚è¿™ä¿è¯äº†å¦‚æœæ¢å¤è¿‡ç¨‹ä¸­å†æ¬¡å´©æºƒï¼Œæˆ‘ä»¬ä¸ä¼šé‡å¤æ’¤é”€å·²ç»æ’¤é”€è¿‡çš„æ­¥éª¤ ã€‚</p></li></ol><hr><h2 id="3-æ—¥å¿—ä¸-LSN-Log-Sequence-Numbers"><a href="#3-æ—¥å¿—ä¸-LSN-Log-Sequence-Numbers" class="headerlink" title="3. æ—¥å¿—ä¸ LSN (Log Sequence Numbers)"></a>3. æ—¥å¿—ä¸ LSN (Log Sequence Numbers)</h2><p>ä¸ºäº†è¿½è¸ªæ‰§è¡Œé¡ºåºï¼ŒDBMS ä½¿ç”¨ <strong>LSN (æ—¥å¿—åºåˆ—å·)</strong>ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€ä¸”å•è°ƒé€’å¢çš„ ã€‚</p><h3 id="å…³é”®çš„-LSN-ç±»å‹"><a href="#å…³é”®çš„-LSN-ç±»å‹" class="headerlink" title="å…³é”®çš„ LSN ç±»å‹"></a>å…³é”®çš„ LSN ç±»å‹</h3><p>ç†è§£æ¢å¤è¿‡ç¨‹éœ€è¦åˆ†æ¸…ä»¥ä¸‹å‡ ç§ LSN çš„ä½ç½®å’Œä½œç”¨ ï¼š</p><table><thead><tr><th>LSN åç§°</th><th>ä½ç½®</th><th>å®šä¹‰</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>flushedLSN</strong></td><td>å†…å­˜</td><td>å·²ç»å†™å…¥ç£ç›˜çš„æœ€æ–°æ—¥å¿—çš„ LSN</td><td>åªæœ‰å½“  æ—¶ï¼Œé¡µé¢æ‰èƒ½åˆ·ç›˜ ã€‚</td></tr><tr><td><strong>pageLSN</strong></td><td>æ•°æ®é¡µ (Page)</td><td>è¯¥é¡µé¢æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„ LSN</td><td>å³ä½¿é¡µé¢åœ¨ç£ç›˜ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“å®ƒæœ€åè¢«è°æ”¹è¿‡ã€‚</td></tr><tr><td><strong>recLSN</strong></td><td>è„é¡µè¡¨ (DPT)</td><td>è¯¥é¡µé¢æœ€æ—©å˜è„çš„é‚£æ¡æ—¥å¿— LSN</td><td>ç”¨äºæ¢å¤æ—¶ç¡®å®š Redo ä»å“ªé‡Œå¼€å§‹ã€‚</td></tr><tr><td><strong>lastLSN</strong></td><td>æ´»è·ƒäº‹åŠ¡è¡¨ (ATT)</td><td>äº‹åŠ¡  äº§ç”Ÿçš„æœ€æ–°ä¸€æ¡æ—¥å¿— LSN</td><td>ç”¨äºå°†åŒä¸€äº‹åŠ¡çš„æ—¥å¿—ä¸²è”èµ·æ¥ï¼ˆé“¾è¡¨ï¼‰ã€‚</td></tr><tr><td><strong>MasterRecord</strong></td><td>ç£ç›˜</td><td>æœ€è¿‘ä¸€æ¬¡ Checkpoint çš„ LSN</td><td>æ¢å¤çš„èµ·ç‚¹ ã€‚</td></tr></tbody></table><hr><h2 id="4-æ­£å¸¸æ‰§è¡Œæ—¶çš„å…³é”®æœºåˆ¶-Normal-Execution"><a href="#4-æ­£å¸¸æ‰§è¡Œæ—¶çš„å…³é”®æœºåˆ¶-Normal-Execution" class="headerlink" title="4. æ­£å¸¸æ‰§è¡Œæ—¶çš„å…³é”®æœºåˆ¶ (Normal Execution)"></a>4. æ­£å¸¸æ‰§è¡Œæ—¶çš„å…³é”®æœºåˆ¶ (Normal Execution)</h2><h3 id="äº‹åŠ¡æäº¤-Commit"><a href="#äº‹åŠ¡æäº¤-Commit" class="headerlink" title="äº‹åŠ¡æäº¤ (Commit)"></a>äº‹åŠ¡æäº¤ (Commit)</h3><ol><li><p>å†™å…¥ <code>COMMIT</code> æ—¥å¿—è®°å½•ã€‚</p></li><li><p><strong>å¼ºåˆ¶åˆ·æ–° (Flush)</strong> æ—¥å¿—åˆ°ç£ç›˜ï¼ˆç›´åˆ°åŒ…å«è¯¥ <code>COMMIT</code> è®°å½•ï¼‰ã€‚æ³¨æ„ï¼šæ•°æ®é¡µä¸éœ€è¦ç«‹å³åˆ·ç›˜ï¼ˆNO-FORCEï¼‰ã€‚</p></li><li><p>å‘ç”¨æˆ·è¿”å›â€œæˆåŠŸâ€ã€‚</p></li><li><p>ç¨åå†™å…¥ <code>TXN-END</code>ï¼ˆç”¨äºå†…éƒ¨æ¸…ç†ï¼‰ã€‚</p></li></ol><h3 id="äº‹åŠ¡ä¸­æ­¢-Abort-ä¸-CLR"><a href="#äº‹åŠ¡ä¸­æ­¢-Abort-ä¸-CLR" class="headerlink" title="äº‹åŠ¡ä¸­æ­¢ (Abort)ä¸ CLR"></a>äº‹åŠ¡ä¸­æ­¢ (Abort)ä¸ CLR</h3><p>å½“äº‹åŠ¡å›æ»šæ—¶ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ç§â€œä¿®æ”¹â€ï¼ˆæŠŠæ•°æ®æ”¹å›æ—§å€¼ï¼‰ã€‚ARIES ä¼šå¼•å…¥ <strong>CLR (Compensation Log Recordï¼Œè¡¥å¿æ—¥å¿—è®°å½•)</strong> ã€‚</p><ul><li><strong>CLR çš„ä½œç”¨</strong>ï¼šè®°å½•â€œæˆ‘åšäº†ä¸€ä¸ªæ’¤é”€æ“ä½œâ€ã€‚</li><li><strong>UndoNextLSN</strong>ï¼šCLR ä¸­åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘<strong>ä¸‹ä¸€ä¸ªéœ€è¦è¢« Undo çš„ LSN</strong>ã€‚</li><li><strong>é¿å…æ­»å¾ªç¯</strong>ï¼šCLR æœ¬èº«æ°¸è¿œä¸éœ€è¦è¢« Undoã€‚å¦‚æœåœ¨ Undo è¿‡ç¨‹ä¸­å´©æºƒï¼Œé‡å¯å DBMS çœ‹åˆ° CLRï¼Œä¼šç›´æ¥è·³åˆ° <code>UndoNextLSN</code> ç»§ç»­æ’¤é”€æ›´æ—©çš„æ“ä½œï¼Œè€Œä¸ä¼šé‡å¤æ’¤é”€å·²ç»æ’¤é”€è¿‡çš„æ­¥éª¤ ã€‚</li></ul><hr><h2 id="5-æ£€æŸ¥ç‚¹-Checkpointing"><a href="#5-æ£€æŸ¥ç‚¹-Checkpointing" class="headerlink" title="5. æ£€æŸ¥ç‚¹ (Checkpointing)"></a>5. æ£€æŸ¥ç‚¹ (Checkpointing)</h2><p>ä¸ºäº†é¿å…æ¢å¤æ—¶ä»å¤´é‡æ”¾æ‰€æœ‰æ—¥å¿—ï¼ŒDBMS éœ€è¦å®šæœŸåš Checkpointã€‚</p><ul><li><p><strong>Blocking Checkpoint (é˜»å¡å¼)</strong>ï¼šåœæ­¢æ‰€æœ‰äº‹åŠ¡ï¼Œåˆ·è„é¡µã€‚ç®€å•ä½†æ€§èƒ½å·® ã€‚</p></li><li><p><strong>Fuzzy Checkpoint (æ¨¡ç³Š&#x2F;éé˜»å¡å¼)</strong>ï¼šARIES é‡‡ç”¨çš„æ–¹å¼ ã€‚</p><ul><li><p>å…è®¸äº‹åŠ¡åœ¨ Checkpoint æœŸé—´ç»§ç»­è¿è¡Œã€‚</p></li><li><p>è®°å½• <code>&lt;CHECKPOINT-BEGIN&gt;</code> å’Œ <code>&lt;CHECKPOINT-END&gt;</code>ã€‚</p></li><li><p>ä¿å­˜å½“å‰çš„ <strong>ATT (æ´»è·ƒäº‹åŠ¡è¡¨)</strong> å’Œ <strong>DPT (è„é¡µè¡¨)</strong> å¿«ç…§ ã€‚</p></li><li><p>è¿™å¹¶ä¸ä¿è¯æ­¤æ—¶ç£ç›˜ä¸Šçš„æ•°æ®é¡µæ˜¯ä¸€è‡´çš„ï¼Œä½†é€šè¿‡æ—¥å¿—é‡æ”¾å¯ä»¥ä¿®å¤ã€‚</p></li></ul></li></ul><hr><h2 id="6-ARIES-æ¢å¤æµç¨‹-The-3-Phases"><a href="#6-ARIES-æ¢å¤æµç¨‹-The-3-Phases" class="headerlink" title="6. ARIES æ¢å¤æµç¨‹ (The 3 Phases)"></a>6. ARIES æ¢å¤æµç¨‹ (The 3 Phases)</h2><p>å½“æ•°æ®åº“å´©æºƒé‡å¯åï¼ŒARIES åˆ†ä¸‰ä¸ªé˜¶æ®µæ‰§è¡Œæ¢å¤ ã€‚</p><h3 id="ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æ-Analysis"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æ-Analysis" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æ (Analysis)"></a>ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æ (Analysis)</h3><p><strong>ç›®æ ‡</strong>ï¼šææ¸…æ¥šå´©æºƒé‚£ä¸€åˆ»ï¼Œè°è¿˜åœ¨è¿è¡Œï¼ˆéœ€è¦ Undoï¼‰ï¼Œå“ªäº›é¡µå¯èƒ½æ˜¯è„çš„ï¼ˆéœ€è¦ Redoï¼‰ã€‚</p><ol><li><p>ä» <code>MasterRecord</code> æŒ‡å‘çš„ Checkpoint å¼€å§‹æ‰«ææ—¥å¿—ã€‚</p></li><li><p><strong>é‡å»º ATT (æ´»è·ƒäº‹åŠ¡è¡¨)</strong>ï¼šé‡åˆ° <code>BEGIN</code> åŠ å…¥ ATTï¼Œé‡åˆ° <code>END</code> ç§»é™¤ã€‚æœ€ç»ˆç•™ä¸‹çš„å°±æ˜¯å´©æºƒæ—¶çš„â€œå¤±è´¥è€… (Losers)â€ ã€‚</p></li><li><p><strong>é‡å»º DPT (è„é¡µè¡¨)</strong>ï¼šé‡åˆ° <code>UPDATE</code> ä¸”é¡µé¢ä¸åœ¨ DPT ä¸­ï¼Œåˆ™åŠ å…¥å¹¶è®°å½• <code>recLSN</code> ã€‚</p></li></ol><h3 id="ç¬¬äºŒé˜¶æ®µï¼šé‡åš-Redo-â€”â€”-â€œRepeating-Historyâ€"><a href="#ç¬¬äºŒé˜¶æ®µï¼šé‡åš-Redo-â€”â€”-â€œRepeating-Historyâ€" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šé‡åš (Redo) â€”â€” â€œRepeating Historyâ€"></a>ç¬¬äºŒé˜¶æ®µï¼šé‡åš (Redo) â€”â€” â€œRepeating Historyâ€</h3><p><strong>ç›®æ ‡</strong>ï¼šå°†æ•°æ®åº“çŠ¶æ€<strong>å®Œå…¨</strong>æ¢å¤åˆ°å´©æºƒå‘ç”Ÿçš„é‚£ä¸€ç§’ï¼ˆåŒ…æ‹¬å·²æäº¤å’Œæœªæäº¤çš„ä¿®æ”¹ï¼‰ã€‚</p><ol><li><p><strong>èµ·ç‚¹</strong>ï¼šä» DPT ä¸­æœ€å°çš„ <code>recLSN</code> å¼€å§‹è¯»å–æ—¥å¿— ã€‚</p></li><li><p><strong>æ“ä½œ</strong>ï¼šå¯¹æ¯ä¸€æ¡æ›´æ–°æ—¥å¿—ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦é‡åšã€‚</p></li><li><p><strong>ä¸éœ€è¦é‡åšçš„æƒ…å†µ</strong> ï¼š</p><ul><li>é¡µé¢ä¸åœ¨ DPT ä¸­ï¼ˆè¯´æ˜æ—©å·²åˆ·ç›˜ï¼‰ã€‚</li><li>é¡µé¢åœ¨ DPT ä¸­ï¼Œä½†æ—¥å¿— LSN &lt; <code>recLSN</code>ï¼ˆè¯´æ˜è¯¥æ›´æ–°åœ¨å˜è„ä¹‹å‰ï¼‰ã€‚</li><li><strong>æœ€å…³é”®æ£€æŸ¥</strong>ï¼šä»ç£ç›˜è¯»å–é¡µé¢ï¼Œå¦‚æœç£ç›˜ä¸Šçš„ <code>pageLSN</code>  æ—¥å¿— LSNï¼ˆè¯´æ˜ç£ç›˜ä¸Šçš„é¡µé¢å·²ç»æ˜¯æœ€æ–°çš„äº†ï¼‰ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œ</strong>ï¼šå¦‚æœä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œé‡æ–°æ‰§è¡Œä¿®æ”¹ï¼Œå¹¶å°†é¡µé¢çš„ <code>pageLSN</code> æ›´æ–°ä¸ºæ—¥å¿— LSN ã€‚</p></li></ol><h3 id="ç¬¬ä¸‰é˜¶æ®µï¼šæ’¤é”€-Undo"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šæ’¤é”€-Undo" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šæ’¤é”€ (Undo)"></a>ç¬¬ä¸‰é˜¶æ®µï¼šæ’¤é”€ (Undo)</h3><p><strong>ç›®æ ‡</strong>ï¼šå›æ»šæ‰€æœ‰åœ¨å´©æºƒæ—¶æœªæäº¤çš„äº‹åŠ¡ï¼ˆå³ ATT ä¸­çš„ Losersï¼‰ã€‚</p><ol><li><p><strong>èµ·ç‚¹</strong>ï¼šå¤„ç†æ‰€æœ‰ ATT ä¸­çŠ¶æ€ä¸º Undo çš„äº‹åŠ¡ã€‚</p></li><li><p><strong>é¡ºåº</strong>ï¼šæŒ‰ç…§ LSN <strong>ä»å¤§åˆ°å° (Reverse Order)</strong> å›æ»šã€‚</p></li><li><p><strong>æ‰§è¡Œ</strong>ï¼š</p><ul><li><p>æ‰¾åˆ°äº‹åŠ¡çš„æœ€åä¸€æ¡è®°å½• (<code>lastLSN</code>)ã€‚</p></li><li><p>æ‰§è¡Œé€†æ“ä½œã€‚</p></li><li><p>ä¸ºæ¯ä¸ªé€†æ“ä½œå†™å…¥ <strong>CLR</strong> æ—¥å¿— ã€‚</p></li><li><p>å¦‚æœé‡åˆ° CLRï¼Œç›´æ¥è·³åˆ° <code>undoNextLSN</code>ï¼ˆè·³è¿‡å·²ç»æ’¤é”€è¿‡çš„éƒ¨åˆ†ï¼‰ã€‚</p></li></ul></li><li><p><strong>ç»“æŸ</strong>ï¼šå½“æ‰€æœ‰ Loser äº‹åŠ¡å®Œå…¨å›æ»šï¼Œå†™å…¥ <code>TXN-END</code> ã€‚</p></li></ol><hr><h3 id="æ€»ç»“ï¼šä¸ºä»€ä¹ˆ-ARIES-å¦‚æ­¤å¼ºå¤§ï¼Ÿ"><a href="#æ€»ç»“ï¼šä¸ºä»€ä¹ˆ-ARIES-å¦‚æ­¤å¼ºå¤§ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šä¸ºä»€ä¹ˆ ARIES å¦‚æ­¤å¼ºå¤§ï¼Ÿ"></a>æ€»ç»“ï¼šä¸ºä»€ä¹ˆ ARIES å¦‚æ­¤å¼ºå¤§ï¼Ÿ</h3><ol><li><strong>Redo ä¸€åˆ‡</strong>ï¼šå®ƒä¸çŒœæµ‹è°æäº¤äº†è°æ²¡æäº¤ï¼Œå…ˆæ— è„‘é‡åšæ‰€æœ‰å†å²ï¼ŒæŠŠçŠ¶æ€æ¢å¤åˆ°å´©æºƒç‚¹ã€‚è¿™å¤§å¤§ç®€åŒ–äº†é€»è¾‘ã€‚</li><li><strong>Undo Losers</strong>ï¼šåœ¨çŠ¶æ€ä¸€è‡´åï¼Œå†ç²¾å‡†åœ°æ’¤é”€æœªæäº¤çš„äº‹åŠ¡ã€‚</li><li><strong>CLR æœºåˆ¶</strong>ï¼šç¡®ä¿äº†<strong>æ¢å¤è¿‡ç¨‹æœ¬èº«ä¹Ÿæ˜¯å¯æ¢å¤çš„</strong>ã€‚å¦‚æœæ¢å¤åˆ°ä¸€åŠåˆå´©äº†ï¼Œé‡å¯åä¸ä¼šæŠŠæ•°æ®æ”¹ä¹±ã€‚</li></ol><h3 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h3><p>å¦‚æœç³»ç»Ÿåœ¨ <strong>Redo é˜¶æ®µ</strong> å´©æºƒäº†æ€ä¹ˆåŠï¼Ÿ</p><ul><li><strong>ç­”æ¡ˆ</strong>ï¼šæ²¡å…³ç³»ã€‚é‡å¯åå†æ¬¡è¿è¡Œ Redoã€‚å› ä¸º Redo æ“ä½œæ˜¯<strong>å¹‚ç­‰ (Idempotent)</strong> çš„ï¼ˆé€šè¿‡æ£€æŸ¥ <code>pageLSN</code>ï¼Œå¦‚æœ <code>pageLSN</code> å·²ç»å˜å¤§ï¼Œå°±ä¸ä¼šé‡å¤åº”ç”¨åŒä¸€ä¸ª LSN çš„ä¿®æ”¹ï¼‰ã€‚</li></ul><p>è¿™ä»½ç¬”è®°åŸºäº CMU 15-445&#x2F;645 è¯¾ç¨‹çš„ç¬¬ 22 è®²ï¼ˆLecture #22: Introduction to Distributed Databasesï¼‰ï¼Œç³»ç»Ÿåœ°æ€»ç»“äº†åˆ†å¸ƒå¼æ•°æ®åº“çš„æ ¸å¿ƒæ¶æ„ã€è®¾è®¡æŒ‘æˆ˜åŠæ•°æ®åˆ†åŒºç­–ç•¥ã€‚</p><hr><h1 id="ç¬¬äºŒåäºŒè®²ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯¼è®º"><a href="#ç¬¬äºŒåäºŒè®²ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯¼è®º" class="headerlink" title="ç¬¬äºŒåäºŒè®²ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯¼è®º"></a>ç¬¬äºŒåäºŒè®²ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯¼è®º</h1><h2 id="1-åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚è¿°-Overview"><a href="#1-åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚è¿°-Overview" class="headerlink" title="1. åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚è¿° (Overview)"></a>1. åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚è¿° (Overview)</h2><p>åˆ†å¸ƒå¼ DBMS å°†å•ä¸ªé€»è¾‘æ•°æ®åº“æ‹†åˆ†å¹¶å­˜å‚¨åœ¨å¤šä¸ªç‰©ç†èµ„æºï¼ˆèŠ‚ç‚¹ï¼‰ä¸Š ã€‚å¯¹äºåº”ç”¨ç¨‹åºè€Œè¨€ï¼Œè¿™ç§æ‹†åˆ†é€šå¸¸æ˜¯é€æ˜çš„ï¼Œå³åº”ç”¨æ— éœ€å…³å¿ƒæ•°æ®å…·ä½“å­˜æ”¾åœ¨å“ªé‡Œ ã€‚</p><p><strong>è®¾è®¡æ ¸å¿ƒç›®æ ‡ï¼š</strong> <strong>å®¹é”™æ€§ (Fault Tolerance)</strong>ã€‚ç¡®ä¿å•ä¸ªèŠ‚ç‚¹çš„æ•…éšœä¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„ç˜«ç—ª ã€‚</p><h3 id="åˆ†å¸ƒå¼-Distributed-vs-å¹¶è¡Œ-Parallel"><a href="#åˆ†å¸ƒå¼-Distributed-vs-å¹¶è¡Œ-Parallel" class="headerlink" title="åˆ†å¸ƒå¼ (Distributed) vs. å¹¶è¡Œ (Parallel)"></a>åˆ†å¸ƒå¼ (Distributed) vs. å¹¶è¡Œ (Parallel)</h3><p>è™½ç„¶ä¸¤è€…éƒ½åˆ©ç”¨å¤šèµ„æºï¼Œä½†ç¯å¢ƒå‡è®¾ä¸åŒï¼š</p><ul><li><p><strong>å¹¶è¡Œæ•°æ®åº“ (Parallel DB)ï¼š</strong> èŠ‚ç‚¹é—´ç‰©ç†è·ç¦»è¿‘ï¼Œé€šè¿‡é«˜é€Ÿ LAN è¿æ¥ï¼Œé€šä¿¡æˆæœ¬ä½ä¸”æå…¶å¯é  ã€‚è®¾è®¡æ—¶é€šå¸¸ä¸è€ƒè™‘ä¸¢åŒ…æˆ–èŠ‚ç‚¹å´©æºƒ ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼æ•°æ®åº“ (Distributed DB)ï¼š</strong> èŠ‚ç‚¹å¯èƒ½è·¨åœ°åŸŸåˆ†å¸ƒï¼Œé€šè¿‡å…¬å…±ç½‘ç»œè¿æ¥ï¼Œé€šä¿¡æ…¢ä¸”ä¸å¯é  ã€‚é€šä¿¡å¼€é”€å’ŒèŠ‚ç‚¹æ•…éšœæ˜¯è®¾è®¡ä¸­å¿…é¡»å¤„ç†çš„ä¸€ç­‰å…¬æ°‘ ã€‚</p></li></ul><hr><h2 id="2-ç³»ç»Ÿæ¶æ„-System-Architectures"><a href="#2-ç³»ç»Ÿæ¶æ„-System-Architectures" class="headerlink" title="2. ç³»ç»Ÿæ¶æ„ (System Architectures)"></a>2. ç³»ç»Ÿæ¶æ„ (System Architectures)</h2><p>æ¶æ„å†³å®šäº† CPU å¯ä»¥ç›´æ¥è®¿é—®å“ªäº›å…±äº«èµ„æºï¼Œç›´æ¥å½±å“åè°ƒæ•ˆç‡å’Œæ•°æ®å­˜å‚¨æ–¹å¼ ã€‚</p><table><thead><tr><th>æ¶æ„ç±»å‹</th><th>å…±äº«èµ„æº</th><th>ç‰¹ç‚¹ä¸åŸç†</th></tr></thead><tbody><tr><td><strong>Shared Everything</strong></td><td>CPU, å†…å­˜, ç£ç›˜</td><td>å•æœºæ¶æ„ï¼Œæ‰€æœ‰èµ„æºç”±æœ¬åœ°æ§åˆ¶ ã€‚</td></tr><tr><td><strong>Shared Memory</strong></td><td>å†…å­˜, ç£ç›˜</td><td>å¤šä¸ª CPU é€šè¿‡é«˜é€Ÿäº’è¿å…±äº«å†…å­˜ç©ºé—´å’Œç£ç›˜ ã€‚åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å®ç°ï¼Œå®è·µä¸­è¾ƒå°‘ç”± DBMS ç›´æ¥é‡‡ç”¨ ã€‚</td></tr><tr><td><strong>Shared Disk</strong></td><td>ç£ç›˜</td><td>æ‰€æœ‰ CPU å…±äº«ä¸€ä¸ªé€»è¾‘ç£ç›˜ï¼Œä½†æ‹¥æœ‰ç§æœ‰å†…å­˜ ã€‚<strong>äº‘åŸç”Ÿæ•°æ®åº“çš„ä¸»æµ</strong>ï¼Œå…è®¸è®¡ç®—å±‚ä¸å­˜å‚¨å±‚ç‹¬ç«‹æ‰©å±• ã€‚</td></tr><tr><td><strong>Shared Nothing</strong></td><td>æ— å…±äº«ç¡¬ä»¶</td><td>æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ç‹¬ç«‹çš„ CPUã€å†…å­˜å’Œç£ç›˜ ã€‚èŠ‚ç‚¹é—´ä»…é€šè¿‡ç½‘ç»œé€šä¿¡ ã€‚</td></tr></tbody></table><h3 id="åŸç†è¡¥å……ï¼š"><a href="#åŸç†è¡¥å……ï¼š" class="headerlink" title="åŸç†è¡¥å……ï¼š"></a>åŸç†è¡¥å……ï¼š</h3><ul><li><p><strong>Shared Nothing çš„éš¾ç‚¹ï¼š</strong> å¢åŠ å®¹é‡æ—¶å¿…é¡»ç‰©ç†è¿ç§»æ•°æ®ï¼Œä¸”è·¨èŠ‚ç‚¹ä¸€è‡´æ€§åè°ƒéå¸¸å›°éš¾ ã€‚</p></li><li><p><strong>Shared Disk çš„ä¼˜åŠ¿ï¼š</strong> èŠ‚ç‚¹å´©æºƒä¸å½±å“æ•°æ®åº“çŠ¶æ€ï¼ˆçŠ¶æ€å­˜å‚¨åœ¨å…±äº«ç£ç›˜ä¸­ï¼‰ï¼Œä¸”èŠ‚ç‚¹å¯ä»¥ç¼“å­˜æ•°æ®ä½œä¸ºæœ¬åœ°çŠ¶æ€ ã€‚</p></li></ul><hr><h2 id="3-æ•°æ®åº“åˆ†åŒºæ–¹æ¡ˆ-Partitioning-Schemes"><a href="#3-æ•°æ®åº“åˆ†åŒºæ–¹æ¡ˆ-Partitioning-Schemes" class="headerlink" title="3. æ•°æ®åº“åˆ†åŒºæ–¹æ¡ˆ (Partitioning Schemes)"></a>3. æ•°æ®åº“åˆ†åŒºæ–¹æ¡ˆ (Partitioning Schemes)</h2><p>åˆ†åŒºï¼ˆåœ¨ NoSQL ä¸­å¸¸ç§°ä¸º Shardingï¼‰æ—¨åœ¨å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒèŠ‚ç‚¹ï¼Œä»¥æé«˜å¹¶è¡Œåº¦ ã€‚</p><h3 id="åˆ†åŒºç±»å‹"><a href="#åˆ†åŒºç±»å‹" class="headerlink" title="åˆ†åŒºç±»å‹"></a>åˆ†åŒºç±»å‹</h3><ol><li><p><strong>å¹¼ç¨šåˆ†åŒº (Naive Partitioning)ï¼š</strong> æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€å¼ å®Œæ•´çš„è¡¨ ã€‚è™½ç„¶ç®€å•ï¼Œä½†éš¾ä»¥æ‰©å±•ï¼Œä¸” JOIN æ“ä½œæˆ–è®¿é—®ä¸å‡æ—¶æ€§èƒ½æå·® ã€‚</p></li><li><p><strong>å‚ç›´åˆ†åŒº (Vertical Partitioning)ï¼š</strong> å°†è¡¨çš„å±æ€§ï¼ˆåˆ—ï¼‰æ‹†åˆ†åˆ°ä¸åŒåˆ†åŒº ã€‚</p></li><li><p><strong>æ°´å¹³åˆ†åŒº (Horizontal Partitioning)ï¼š</strong> æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œå°†å…ƒç»„ï¼ˆè¡Œï¼‰æ‹†åˆ†ä¸ºä¸ç›¸äº¤çš„å­é›† ã€‚é€šå¸¸é€‰æ‹©ä¸€ä¸ªåˆ—ä½œä¸º <strong>åˆ†åŒºé”® (Partitioning Key)</strong> ã€‚</p></li></ol><h3 id="ä¸€è‡´æ€§å“ˆå¸Œ-Consistent-Hashing"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ-Consistent-Hashing" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ (Consistent Hashing)"></a>ä¸€è‡´æ€§å“ˆå¸Œ (Consistent Hashing)</h3><p>ä¼ ç»Ÿçš„å“ˆå¸Œåˆ†åŒºï¼ˆå¦‚ hash(key) \pmod nï¼‰åœ¨å¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šå¯¼è‡´ç»å¤§éƒ¨åˆ†æ•°æ®éœ€è¦é‡æ–°åˆ†å¸ƒ ã€‚ä¸€è‡´æ€§å“ˆå¸Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li><p><strong>åŸç†ï¼š</strong> å°†æ‰€æœ‰èŠ‚ç‚¹å’Œåˆ†åŒºé”®æ˜ å°„åˆ°ä¸€ä¸ªé€»è¾‘ç¯ä¸Š ã€‚é”®ç”±é¡ºæ—¶é’ˆæ–¹å‘æœ€è¿‘çš„èŠ‚ç‚¹è´Ÿè´£ ã€‚</p></li><li><p><strong>ä¼˜åŠ¿ï¼š</strong> å½“èŠ‚ç‚¹å˜åŠ¨æ—¶ï¼Œä»…å½±å“ç¯ä¸Šç›¸é‚»çš„èŠ‚ç‚¹ï¼Œåªæœ‰ 1&#x2F;n çš„é”®éœ€è¦è¿ç§» ã€‚</p></li></ul><hr><h2 id="4-åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶-Distributed-Concurrency-Control"><a href="#4-åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶-Distributed-Concurrency-Control" class="headerlink" title="4. åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶ (Distributed Concurrency Control)"></a>4. åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶ (Distributed Concurrency Control)</h2><p>åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠå¤šä¸ªåˆ†åŒºï¼Œéœ€è¦æ˜‚è´µçš„åè°ƒæˆæœ¬ ã€‚</p><ul><li><p><strong>é›†ä¸­å¼åè°ƒå™¨ (Centralized Coordinator)ï¼š</strong> ä¸€ä¸ªå…¨å±€çš„â€œäº¤é€šè­¦å¯Ÿâ€è´Ÿè´£åˆ†é…é”å’Œç®¡ç†äº‹åŠ¡ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹ï¼š</strong> æ˜“äºå®ç°åˆ†å¸ƒå¼ 2PLï¼Œæ‹¥æœ‰å…¨å±€è§†å›¾ï¼Œèƒ½å¿«é€Ÿå¤„ç†æ­»é” ã€‚</p></li><li><p><strong>ç¼ºç‚¹ï¼š</strong> åœ¨é«˜å¹¶å‘ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ ã€‚</p></li><li><p><strong>åˆ†æ•£å¼åè°ƒå™¨ (Decentralized Coordinator)ï¼š</strong> èŠ‚ç‚¹é—´è‡ªç»„ç»‡ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä¸æŸä¸ªâ€œä¸»åˆ†åŒºâ€é€šä¿¡ï¼Œç”±è¯¥åˆ†åŒºè´Ÿè´£ä¸å…¶ä»–èŠ‚ç‚¹åè°ƒ ã€‚</p></li></ul><hr><h2 id="5-è”é‚¦æ•°æ®åº“-Federated-Databases"><a href="#5-è”é‚¦æ•°æ®åº“-Federated-Databases" class="headerlink" title="5. è”é‚¦æ•°æ®åº“ (Federated Databases)"></a>5. è”é‚¦æ•°æ®åº“ (Federated Databases)</h2><p>è¿™æ˜¯ä¸€ç§å°†å¤šä¸ªäº’ä¸ç›¸åŒçš„ DBMS é€»è¾‘è¿æ¥æˆä¸€ä¸ªå•ä¸€ç³»ç»Ÿçš„æ¶æ„ ã€‚</p><ul><li><p><strong>å®ç°ï¼š</strong> é€šè¿‡ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰å’Œè¿æ¥å™¨ï¼ˆConnectorï¼‰å°†æŸ¥è¯¢è½¬æ¢ä¸ºå„ä¸ªåç«¯æ•°æ®åº“å¯è¯»çš„æ ¼å¼ ã€‚</p></li><li><p><strong>æŒ‘æˆ˜ï¼š</strong> ç”±äºä¸åŒç³»ç»Ÿçš„æŸ¥è¯¢è¯­è¨€ã€æ•°æ®æ¨¡å‹å’Œé™åˆ¶å„ä¸ç›¸åŒï¼Œå¾ˆéš¾è¿›è¡Œç»Ÿä¸€çš„æŸ¥è¯¢ä¼˜åŒ– ã€‚</p></li></ul><hr><h3 id="åŸç†æ·±åº¦æ€»ç»“ï¼šé€æ˜æ€§-Transparency"><a href="#åŸç†æ·±åº¦æ€»ç»“ï¼šé€æ˜æ€§-Transparency" class="headerlink" title="åŸç†æ·±åº¦æ€»ç»“ï¼šé€æ˜æ€§ (Transparency)"></a>åŸç†æ·±åº¦æ€»ç»“ï¼šé€æ˜æ€§ (Transparency)</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç»ˆæç›®æ ‡æ˜¯<strong>æ•°æ®é€æ˜æ€§</strong> ã€‚å³ç”¨æˆ·å‘é€ä¸€æ¡ SQL æŸ¥è¯¢ï¼Œä»–ä¸åº”è¯¥çŸ¥é“è¿™æ¡æŸ¥è¯¢æ˜¯åœ¨å•èŠ‚ç‚¹æ‰§è¡Œï¼Œè¿˜æ˜¯è¢«åˆ‡æˆäº† 100 ä¸ªç¢ç‰‡åœ¨ä¸åŒæœºå™¨ä¸Šè·‘ï¼Œæ›´ä¸åº”è¯¥çŸ¥é“æ•°æ®æ˜¯æŒ‰å“ˆå¸Œåˆ†å¸ƒè¿˜æ˜¯æŒ‰èŒƒå›´åˆ†å¸ƒçš„ ã€‚</p><p>è¿™ä»½ CMU 15-445&#x2F;645 Database Systems (Fall 2024) Lecture #23 <strong>Distributed OLTP Databases (åˆ†å¸ƒå¼ OLTP æ•°æ®åº“)</strong> çš„è¯¾ç¨‹ç¬”è®°æ•´ç†å¦‚ä¸‹ã€‚</p><p>è¿™ä»½ç¬”è®°ä¸ä»…æ€»ç»“äº†è¯¾ä»¶çš„æ ¸å¿ƒå†…å®¹ï¼Œè¿˜è¡¥å……äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…³é”®çš„è®¾è®¡æƒè¡¡ï¼ˆTrade-offsï¼‰å’ŒåŸç†æ·±åº¦è§£æï¼Œå¸®åŠ©ä½ ç†è§£å¦‚ä½•æ„å»ºä¸€ä¸ªæ—¢å¯é åˆé«˜æ•ˆçš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p><hr><h1 id="ç¬¬äºŒåä¸‰è®²ï¼šDistributed-OLTP-Databases-åˆ†å¸ƒå¼-OLTP-æ•°æ®åº“"><a href="#ç¬¬äºŒåä¸‰è®²ï¼šDistributed-OLTP-Databases-åˆ†å¸ƒå¼-OLTP-æ•°æ®åº“" class="headerlink" title="ç¬¬äºŒåä¸‰è®²ï¼šDistributed OLTP Databases (åˆ†å¸ƒå¼ OLTP æ•°æ®åº“)"></a>ç¬¬äºŒåä¸‰è®²ï¼šDistributed OLTP Databases (åˆ†å¸ƒå¼ OLTP æ•°æ®åº“)</h1><h2 id="1-èƒŒæ™¯ï¼šOLTP-ä¸-OLAP-çš„åŒºåˆ«"><a href="#1-èƒŒæ™¯ï¼šOLTP-ä¸-OLAP-çš„åŒºåˆ«" class="headerlink" title="1. èƒŒæ™¯ï¼šOLTP ä¸ OLAP çš„åŒºåˆ«"></a>1. èƒŒæ™¯ï¼šOLTP ä¸ OLAP çš„åŒºåˆ«</h2><p>åœ¨è®¨è®ºåˆ†å¸ƒå¼æ¶æ„ä¹‹å‰ï¼Œé¦–å…ˆè¦æ˜ç¡®æˆ‘ä»¬é’ˆå¯¹çš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼Œæœ¬èŠ‚è¯¾å…³æ³¨çš„æ˜¯ <strong>OLTP</strong>ã€‚</p><ul><li><p><strong>OLTP (On-line Transaction Processing)</strong>ï¼š</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šçŸ­ç”Ÿå‘½å‘¨æœŸçš„è¯»å†™äº‹åŠ¡ï¼Œæ“ä½œé‡å¤æ€§é«˜ï¼Œå ç”¨èµ„æºå°‘ï¼ˆSmall footprintï¼‰ã€‚</p></li><li><p><strong>ç›®æ ‡</strong>ï¼šé«˜ååé‡ã€ä½å»¶è¿Ÿã€‚</p></li></ul></li><li><p><strong>OLAP (On-line Analytical Processing)</strong>ï¼š</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šé•¿è¿è¡Œæ—¶é—´çš„åªè¯»æŸ¥è¯¢ï¼Œæ¶‰åŠå¤æ‚çš„è¿æ¥ï¼ˆJoinsï¼‰ï¼Œé€šå¸¸æ˜¯æ¢ç´¢æ€§çš„åˆ†ææŸ¥è¯¢ ã€‚</p></li><li><p><strong>ç›®æ ‡</strong>ï¼šæ‰«æå¤§é‡æ•°æ®å¹¶èšåˆç»“æœã€‚</p></li></ul></li></ul><hr><h2 id="2-åˆ†å¸ƒå¼æ¶æ„åŸºç¡€-System-Architecture"><a href="#2-åˆ†å¸ƒå¼æ¶æ„åŸºç¡€-System-Architecture" class="headerlink" title="2. åˆ†å¸ƒå¼æ¶æ„åŸºç¡€ (System Architecture)"></a>2. åˆ†å¸ƒå¼æ¶æ„åŸºç¡€ (System Architecture)</h2><p>åœ¨åˆ†å¸ƒå¼ OLTP ç³»ç»Ÿä¸­ï¼Œæ•°æ®è¢«åˆ†ç‰‡ï¼ˆPartitionï¼‰å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><h3 id="å»ä¸­å¿ƒåŒ–åè°ƒ-Decentralized-Coordinator"><a href="#å»ä¸­å¿ƒåŒ–åè°ƒ-Decentralized-Coordinator" class="headerlink" title="å»ä¸­å¿ƒåŒ–åè°ƒ (Decentralized Coordinator)"></a>å»ä¸­å¿ƒåŒ–åè°ƒ (Decentralized Coordinator)</h3><ul><li><p><strong>æ¶æ„</strong>ï¼šåº”ç”¨æœåŠ¡å™¨ç›´æ¥ä¸æŸä¸ªèŠ‚ç‚¹é€šä¿¡ã€‚é€šå¸¸ä¼šé€‰å‡ºä¸€ä¸ªåˆ†åŒºä½œä¸º<strong>ä¸»èŠ‚ç‚¹ (Primary Node)</strong> ã€‚</p></li><li><p><strong>æµç¨‹</strong>ï¼š</p><ol><li>äº‹åŠ¡çš„ <code>BEGIN</code> è¯·æ±‚å‘é€ç»™ä¸»èŠ‚ç‚¹ã€‚</li><li>æŸ¥è¯¢è¢«ç›´æ¥è·¯ç”±åˆ°ç›¸å…³èŠ‚ç‚¹ã€‚</li><li><code>COMMIT</code> è¯·æ±‚å‘é€ç»™ä¸»èŠ‚ç‚¹ï¼Œç”±ä¸»èŠ‚ç‚¹è´Ÿè´£åˆ¤æ–­æ˜¯å¦æ‰€æœ‰å‚ä¸èŠ‚ç‚¹éƒ½åŒæ„æäº¤ ã€‚</li></ol></li><li><p><strong>æŒ‘æˆ˜</strong>ï¼šéœ€è¦ç¡®ä¿å³ä½¿èŠ‚ç‚¹æ•…éšœæˆ–æ¶ˆæ¯å»¶è¿Ÿï¼Œæ‰€æœ‰èŠ‚ç‚¹å¯¹äº‹åŠ¡çš„ç»“æœï¼ˆæäº¤æˆ–ä¸­æ­¢ï¼‰ä¹Ÿèƒ½è¾¾æˆä¸€è‡´ ã€‚</p></li></ul><hr><h2 id="3-å¤åˆ¶-Replication"><a href="#3-å¤åˆ¶-Replication" class="headerlink" title="3. å¤åˆ¶ (Replication)"></a>3. å¤åˆ¶ (Replication)</h2><p>ä¸ºäº†æé«˜å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼ŒDBMS å°†æ•°æ®å¤åˆ¶åˆ°å†—ä½™èŠ‚ç‚¹ä¸Šã€‚è¿™é‡Œæ¶‰åŠå››ä¸ªå…³é”®çš„è®¾è®¡å†³ç­–ã€‚</p><h3 id="1-å‰¯æœ¬é…ç½®-Replica-Configuration"><a href="#1-å‰¯æœ¬é…ç½®-Replica-Configuration" class="headerlink" title="(1) å‰¯æœ¬é…ç½® (Replica Configuration)"></a>(1) å‰¯æœ¬é…ç½® (Replica Configuration)</h3><p>å†³å®šäº†å†™æ“ä½œå¯ä»¥å‘ç”Ÿåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šã€‚</p><ul><li><p><strong>ä¸»ä»å¤åˆ¶ (Primary-Replica)</strong>ï¼š</p><ul><li><p><strong>åŸç†</strong>ï¼šæ‰€æœ‰çš„<strong>æ›´æ–° (Updates)</strong> å¿…é¡»å‘å¾€æŒ‡å®šçš„ Primary èŠ‚ç‚¹ã€‚Primary è´Ÿè´£å°†æ›´æ–°ä¼ æ’­ç»™ Replicas ã€‚</p></li><li><p><strong>è¯»æ“ä½œ</strong>ï¼šå¯ä»¥è¯» Replicaï¼ˆå¦‚æœå…è®¸è¯»æ—§æ•°æ®ï¼‰ï¼Œä¹Ÿå¯ä»¥è¯» Primaryã€‚</p></li><li><p><strong>æ•…éšœ</strong>ï¼šPrimary æŒ‚äº†éœ€è¦é‡æ–°é€‰ä¸¾ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼šæ²¡æœ‰å†™å†²çªï¼Œå¹¶å‘æ§åˆ¶ç®€å•ã€‚</p></li></ul></li><li><p><strong>å¤šä¸»å¤åˆ¶ (Multi-Primary)</strong>ï¼š</p><ul><li><p><strong>åŸç†</strong>ï¼šäº‹åŠ¡å¯ä»¥æ›´æ–°<strong>ä»»æ„</strong>å‰¯æœ¬ã€‚å‰¯æœ¬ä¹‹é—´å¿…é¡»é€šè¿‡åŸå­æäº¤åè®®åŒæ­¥ ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå†™å†²çªé¢‘ç¹ï¼Œéœ€è¦å¤æ‚çš„åŒæ­¥æœºåˆ¶ï¼Œæ€§èƒ½é€šå¸¸è¾ƒå·®ã€‚</p></li></ul></li></ul><h3 id="2-ä¼ æ’­æ–¹æ¡ˆ-Propagation-Scheme"><a href="#2-ä¼ æ’­æ–¹æ¡ˆ-Propagation-Scheme" class="headerlink" title="(2) ä¼ æ’­æ–¹æ¡ˆ (Propagation Scheme)"></a>(2) ä¼ æ’­æ–¹æ¡ˆ (Propagation Scheme)</h3><p>å†³å®šäº†å®¢æˆ·ç«¯ä½•æ—¶æ”¶åˆ°â€œå†™å…¥æˆåŠŸâ€çš„ç¡®è®¤ã€‚</p><ul><li><p><strong>åŒæ­¥ (Synchronous &#x2F; Strong Consistency)</strong>ï¼š</p><ul><li><p>Primary å‘é€æ›´æ–°ç»™ Replicasï¼Œ<strong>ç­‰å¾…</strong>å®ƒä»¬ç¡®è®¤å·²è®°å½•æ—¥å¿—åï¼Œæ‰å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼šå¼ºä¸€è‡´æ€§ï¼Œä¸ä¸¢æ•°æ® ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šæ…¢ï¼Œå—æœ€æ…¢èŠ‚ç‚¹çš„æ‹–ç´¯ã€‚</p></li></ul></li><li><p><strong>å¼‚æ­¥ (Asynchronous &#x2F; Eventual Consistency)</strong>ï¼š</p><ul><li><p>Primary å¤„ç†å®Œå°±ç«‹å³å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸï¼Œ<strong>ä¸ç­‰å¾…</strong> Replicas ç¡®è®¤ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼šå¿«ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½ä¸¢æ•°æ®ï¼ˆå¦‚æœ Primary åœ¨åŒæ­¥å‰æŒ‚æ‰ï¼‰ï¼Œå¯èƒ½è¯»åˆ°æ—§æ•°æ®ï¼ˆStale readsï¼‰ã€‚å¸¸è§äº NoSQL ç³»ç»Ÿã€‚</p></li></ul></li></ul><h3 id="3-ä¼ æ’­æ—¶æœº-Propagation-Timing"><a href="#3-ä¼ æ’­æ—¶æœº-Propagation-Timing" class="headerlink" title="(3) ä¼ æ’­æ—¶æœº (Propagation Timing)"></a>(3) ä¼ æ’­æ—¶æœº (Propagation Timing)</h3><ul><li><p><strong>Continuous (è¿ç»­)</strong>ï¼šç”Ÿæˆæ—¥å¿—æ—¶ç«‹å³å‘é€ã€‚å¤§å¤šæ•°ç³»ç»Ÿé‡‡ç”¨æ­¤æ³• ã€‚</p></li><li><p><strong>On Commit (æäº¤æ—¶)</strong>ï¼šäº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ—¥å¿—ã€‚é¿å…äº†ä¸ºä¸­æ­¢çš„äº‹åŠ¡å‘é€æ—¥å¿—ï¼Œä½†å‡è®¾äº‹åŠ¡æ—¥å¿—èƒ½å¡è¿›å†…å­˜ ã€‚</p></li></ul><h3 id="4-æ›´æ–°æ–¹å¼-Update-Method"><a href="#4-æ›´æ–°æ–¹å¼-Update-Method" class="headerlink" title="(4) æ›´æ–°æ–¹å¼ (Update Method)"></a>(4) æ›´æ–°æ–¹å¼ (Update Method)</h3><ul><li><p><strong>Active-Active</strong>ï¼šSQL è¯­å¥åœ¨æ¯ä¸ªå‰¯æœ¬ä¸Šéƒ½æ‰§è¡Œä¸€éã€‚<strong>éš¾ç‚¹</strong>ï¼šå¿…é¡»ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œé¡ºåºå®Œå…¨ä¸€è‡´ï¼ˆéç¡®å®šæ€§å‡½æ•°å¦‚ <code>RAND()</code> ä¼šå‡ºé—®é¢˜ï¼‰ã€‚</p></li><li><p><strong>Active-Passive</strong>ï¼šåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œï¼Œä¼ è¾“<strong>ç‰©ç†å­—èŠ‚ (Bytes)</strong> æˆ–é€»è¾‘ç»“æœç»™å‰¯æœ¬ã€‚è¿™æ˜¯ä¸»æµåšæ³• ã€‚</p></li></ul><h3 id="K-Safety"><a href="#K-Safety" class="headerlink" title="K-Safety"></a>K-Safety</h3><ul><li>è¡¡é‡å®¹é”™èƒ½åŠ›çš„æŒ‡æ ‡ã€‚ ä»£è¡¨å¿…é¡»éšæ—¶å¯ç”¨çš„å‰¯æœ¬æ•°é‡ã€‚å¦‚æœå¯ç”¨å‰¯æœ¬æ•° ï¼Œç³»ç»Ÿå¿…é¡»åœæ­¢æœåŠ¡ ã€‚</li></ul><hr><h2 id="4-åŸå­æäº¤åè®®-Atomic-Commit-Protocols"><a href="#4-åŸå­æäº¤åè®®-Atomic-Commit-Protocols" class="headerlink" title="4. åŸå­æäº¤åè®® (Atomic Commit Protocols)"></a>4. åŸå­æäº¤åè®® (Atomic Commit Protocols)</h2><p>å½“ä¸€ä¸ªäº‹åŠ¡è·¨è¶Šå¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»ä¿è¯<strong>åŸå­æ€§</strong>ï¼šè¦ä¹ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½æäº¤ï¼Œè¦ä¹ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸­æ­¢ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸‰ä¸ªå±æ€§ï¼š</p><ol><li><p><strong>ç¨³å®šæ€§ (Stability)</strong>ï¼šä¸€æ—¦å†³å®šäº†ç»“æœï¼ˆæäº¤&#x2F;ä¸­æ­¢ï¼‰ï¼Œä¸å¯æ›´æ”¹ ã€‚</p></li><li><p><strong>ä¸€è‡´æ€§ (Consistency)</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹æœ€ç»ˆçŠ¶æ€ä¸€è‡´ ã€‚</p></li><li><p><strong>æ´»æ€§ (Liveness)</strong>ï¼šåè®®æœ€ç»ˆèƒ½å®Œæˆï¼Œä¸ä¼šæ— é™é˜»å¡ ã€‚</p></li></ol><h3 id="1-ä¸¤é˜¶æ®µæäº¤-Two-Phase-Commit-2PC"><a href="#1-ä¸¤é˜¶æ®µæäº¤-Two-Phase-Commit-2PC" class="headerlink" title="(1) ä¸¤é˜¶æ®µæäº¤ (Two-Phase Commit, 2PC)"></a>(1) ä¸¤é˜¶æ®µæäº¤ (Two-Phase Commit, 2PC)</h3><p>è¿™æ˜¯æœ€ç»å…¸çš„åè®®ï¼ˆ1970sï¼‰ï¼Œç”±åè°ƒè€… (Coordinator) å’Œå‚ä¸è€… (Participants) ç»„æˆã€‚</p><ul><li><p><strong>Phase 1: Prepare (å‡†å¤‡é˜¶æ®µ)</strong></p><ul><li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ <code>Prepare</code> æ¶ˆæ¯ï¼ˆåŒ…å«äº‹åŠ¡å†…å®¹ï¼‰ã€‚</li><li>å‚ä¸è€…æ‰§è¡ŒéªŒè¯ï¼Œå¦‚æœå¯ä»¥æäº¤ï¼Œå†™å…¥æ—¥å¿—å¹¶å›å¤ <code>OK</code>ï¼›å¦åˆ™å›å¤ <code>Abort</code> ã€‚</li></ul></li><li><p><strong>Phase 2: Commit (æäº¤é˜¶æ®µ)</strong></p><ul><li>å¦‚æœ<strong>æ‰€æœ‰</strong>å‚ä¸è€…éƒ½å›å¤ <code>OK</code>ï¼Œåè°ƒè€…å‘é€ <code>Commit</code> æ¶ˆæ¯ã€‚</li><li>å¦‚æœæœ‰<strong>ä»»æ„</strong>ä¸€ä¸ªå›å¤ <code>Abort</code>ï¼Œåè°ƒè€…å‘é€ <code>Abort</code> æ¶ˆæ¯ ã€‚</li></ul></li><li><p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š<strong>é˜»å¡ (Blocking)</strong>ã€‚å¦‚æœåè°ƒè€…åœ¨å‘é€ Prepare åå´©æºƒï¼Œå‚ä¸è€…ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠï¼Œå¿…é¡»ä¸€ç›´æŒæœ‰é”å¹¶é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°åè°ƒè€…æ¢å¤ ã€‚</p></li><li><p><strong>ä¼˜åŒ–</strong>ï¼š</p><ul><li><p><em>Early Prepare Voting</em>ï¼šæœ€åä¸€ä¸ªæŸ¥è¯¢é¡ºä¾¿å¸¦ä¸ŠæŠ•ç¥¨ ã€‚</p></li><li><p><em>Early Acknowledgement</em>ï¼šåè°ƒè€…ç¡®è®¤å…¨ç¥¨é€šè¿‡åï¼Œåœ¨ Phase 2 å®Œæˆå‰å°±å‘ŠçŸ¥å®¢æˆ·ç«¯æˆåŠŸ ã€‚</p></li></ul></li></ul><h3 id="2-Paxos-ä¸-Raft"><a href="#2-Paxos-ä¸-Raft" class="headerlink" title="(2) Paxos (ä¸ Raft)"></a>(2) Paxos (ä¸ Raft)</h3><p>ç°ä»£ç³»ç»Ÿæ›´å€¾å‘äºä½¿ç”¨ Paxos æˆ– Raftï¼Œå› ä¸ºå®ƒä»¬å®¹é”™æ€§æ›´å¼ºã€‚</p><ul><li><p><strong>åŸç†</strong>ï¼šåŸºäº<strong>å…±è¯† (Consensus)</strong>ã€‚2PC è¦æ±‚ 100% åŒæ„ï¼Œè€Œ Paxos åªéœ€è¦ <strong>å¤šæ•°æ´¾ (Majority)</strong> åŒæ„ã€‚</p></li><li><p><strong>å®¹é”™</strong>ï¼šåªè¦  ä¸ªèŠ‚ç‚¹ä¸­æœ‰  ä¸ªæ´»ç€ï¼Œç³»ç»Ÿå°±èƒ½ç»§ç»­è¿è¡Œï¼ˆéé˜»å¡ï¼‰ã€‚</p></li><li><p><strong>æµç¨‹</strong>ï¼šProposer æè®®ä¸€ä¸ªå€¼ï¼ˆCommit&#x2F;Abortï¼‰ï¼ŒAcceptors æŠ•ç¥¨ã€‚ä¸€æ—¦å¤šæ•°æ´¾æ¥å—ï¼Œç»“æœå°±ç¡®å®šäº† ã€‚</p></li><li><p><strong>Multi-Paxos</strong>ï¼šé€‰å‡ºä¸€ä¸ª Leader é•¿æœŸè´Ÿè´£æè®®ï¼Œè·³è¿‡ç¬¬ä¸€é˜¶æ®µï¼Œæé«˜æ€§èƒ½ ã€‚</p></li></ul><p><strong>å¯¹æ¯”æ€»ç»“</strong>ï¼š</p><ul><li><p>å¦‚æœèŠ‚ç‚¹åœ¨åŒä¸€æ•°æ®ä¸­å¿ƒä¸”å¾ˆå°‘æ•…éšœï¼Œ<strong>2PC</strong> é€šå¸¸æ›´å¿«ï¼ˆæ¶ˆæ¯å¾€è¿”å°‘ï¼‰ã€‚</p></li><li><p>å¦‚æœéœ€è¦è·¨æ•°æ®ä¸­å¿ƒæˆ–é«˜å®¹é”™ï¼Œ<strong>Paxos&#x2F;Raft</strong> æ˜¯å¿…é¡»çš„ã€‚</p></li></ul><hr><h2 id="5-CAP-å®šç†ä¸-PACELC"><a href="#5-CAP-å®šç†ä¸-PACELC" class="headerlink" title="5. CAP å®šç†ä¸ PACELC"></a>5. CAP å®šç†ä¸ PACELC</h2><h3 id="CAP-å®šç†"><a href="#CAP-å®šç†" class="headerlink" title="CAP å®šç†"></a>CAP å®šç†</h3><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ— æ³•åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ï¼Œåªèƒ½ä¸‰é€‰äºŒ ï¼š</p><ol><li><p><strong>C (Consistency)</strong>ï¼šä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰ã€‚å†™æ“ä½œå®Œæˆåï¼Œéšåçš„è¯»æ“ä½œå¿…é¡»èƒ½è¯»åˆ°è¯¥å€¼ ã€‚</p></li><li><p><strong>A (Availability)</strong>ï¼šå¯ç”¨æ€§ã€‚æ‰€æœ‰å­˜æ´»èŠ‚ç‚¹éƒ½èƒ½å¤„ç†è¯·æ±‚ ã€‚</p></li><li><p><strong>P (Partition Tolerance)</strong>ï¼šåˆ†åŒºå®¹é”™æ€§ã€‚ç½‘ç»œæ–­å¼€æ—¶ç³»ç»Ÿä»èƒ½å·¥ä½œ ã€‚</p></li></ol><ul><li><p><strong>ç°å®é€‰æ‹©</strong>ï¼šç”±äºç½‘ç»œåˆ†åŒºï¼ˆPï¼‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯ä¸å¯é¿å…çš„ï¼ˆç½‘çº¿æ€»ä¼šè¢«æŒ–æ–­ï¼‰ï¼Œæ‰€ä»¥å®é™…ä¸Šåªèƒ½åœ¨ <strong>CP</strong>ï¼ˆå¼ºä¸€è‡´ï¼Œåˆ†åŒºæ—¶ä¸å¯ç”¨ï¼‰å’Œ <strong>AP</strong>ï¼ˆé«˜å¯ç”¨ï¼Œåˆ†åŒºæ—¶æ•°æ®ä¸ä¸€è‡´ï¼‰ä¹‹é—´åšé€‰æ‹© ã€‚</p></li><li><p><em>ä¼ ç»Ÿ DBMS &#x2F; NewSQL</em>ï¼šå€¾å‘äº CPã€‚</p></li><li><p><em>NoSQL</em>ï¼šå€¾å‘äº APã€‚</p></li></ul><h3 id="PACELC-å®šç†"><a href="#PACELC-å®šç†" class="headerlink" title="PACELC å®šç†"></a>PACELC å®šç†</h3><p>CAP çš„æ‰©å±•ç‰ˆæœ¬ï¼Œè€ƒè™‘äº†ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼ˆæ²¡æœ‰åˆ†åŒºï¼‰æ—¶çš„æƒè¡¡ ã€‚</p><ul><li><strong>P (Partition)</strong>ï¼šå¦‚æœæœ‰åˆ†åŒºï¼Œé€‰æ‹© <strong>A</strong> æˆ– <strong>C</strong>ã€‚</li><li><strong>E (Else)</strong>ï¼šå¦‚æœæ²¡æœ‰åˆ†åŒºï¼ˆæ­£å¸¸æƒ…å†µï¼‰ï¼Œé€‰æ‹© <strong>L (Latency)</strong> æˆ– <strong>C (Consistency)</strong>ã€‚</li><li>æ¯”å¦‚ï¼šå¦‚æœä½ æƒ³è¦æä½çš„å»¶è¿Ÿï¼ˆLï¼‰ï¼Œå°±å¿…é¡»æ”¾å¼ƒå¼ºä¸€è‡´æ€§ï¼ˆCï¼‰ï¼Œæ”¹ç”¨å¼‚æ­¥å¤åˆ¶ã€‚</li></ul><p>è¿™ä»½ç¬”è®°åŸºäº CMU 15-445&#x2F;645 è¯¾ç¨‹ç¬¬ 23 è®²ï¼ˆLecture #23: Distributed OLAP Databasesï¼‰ï¼Œç³»ç»Ÿæ€»ç»“äº†åˆ†å¸ƒå¼åˆ†æå‹æ•°æ®åº“ï¼ˆOLAPï¼‰çš„è®¾è®¡æ¶æ„ã€æ‰§è¡Œæ¨¡å‹åŠç°ä»£äº‘åŸç”Ÿè¶‹åŠ¿ã€‚</p><hr><h1 id="ç¬¬äºŒåå››è®²ï¼šåˆ†å¸ƒå¼åˆ†æå‹æ•°æ®åº“-Distributed-OLAP"><a href="#ç¬¬äºŒåå››è®²ï¼šåˆ†å¸ƒå¼åˆ†æå‹æ•°æ®åº“-Distributed-OLAP" class="headerlink" title="ç¬¬äºŒåå››è®²ï¼šåˆ†å¸ƒå¼åˆ†æå‹æ•°æ®åº“ (Distributed OLAP)"></a>ç¬¬äºŒåå››è®²ï¼šåˆ†å¸ƒå¼åˆ†æå‹æ•°æ®åº“ (Distributed OLAP)</h1><h2 id="1-å†³ç­–æ”¯æŒç³»ç»Ÿ-Decision-Support-Systems-DSS"><a href="#1-å†³ç­–æ”¯æŒç³»ç»Ÿ-Decision-Support-Systems-DSS" class="headerlink" title="1. å†³ç­–æ”¯æŒç³»ç»Ÿ (Decision Support Systems, DSS)"></a>1. å†³ç­–æ”¯æŒç³»ç»Ÿ (Decision Support Systems, DSS)</h2><p>OLAP æ•°æ®åº“ä¸»è¦ç”¨äºæ‰§è¡Œåªè¯»çš„å¤æ‚æŸ¥è¯¢ï¼Œä»¥æ”¯æŒç»„ç»‡çš„å†³ç­–åˆ†æ ã€‚</p><h3 id="æ•°æ®æ‘„å–ï¼šETL-vs-ELT"><a href="#æ•°æ®æ‘„å–ï¼šETL-vs-ELT" class="headerlink" title="æ•°æ®æ‘„å–ï¼šETL vs. ELT"></a>æ•°æ®æ‘„å–ï¼šETL vs. ELT</h3><ul><li><p><strong>ETL (Extract, Transform, Load)</strong>ï¼šåœ¨å°†æ•°æ®å­˜å…¥æ•°æ®ä»“åº“å‰ï¼Œå…ˆåœ¨å¤–éƒ¨å®Œæˆæ¸…æ´—è½¬æ¢ ã€‚</p></li><li><p><strong>ELT (Extract, Load, Transform)</strong>ï¼šç°ä»£è¶‹åŠ¿ï¼Œå…ˆå°†åŸå§‹æ•°æ®åŠ è½½å…¥åº“ï¼Œåˆ©ç”¨ OLAP æ•°æ®åº“è‡ªèº«çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›å®Œæˆè½¬æ¢ ã€‚</p></li></ul><h3 id="æ¨¡å¼å»ºæ¨¡-Schema-Modeling"><a href="#æ¨¡å¼å»ºæ¨¡-Schema-Modeling" class="headerlink" title="æ¨¡å¼å»ºæ¨¡ (Schema Modeling)"></a>æ¨¡å¼å»ºæ¨¡ (Schema Modeling)</h3><ul><li><p><strong>æ˜Ÿå‹æ¨¡å¼ (Star Schema)</strong> ï¼š</p><ul><li><p>ç”±<strong>äº‹å®è¡¨ (Fact Table)</strong> å’Œä¸€å±‚<strong>ç»´åº¦è¡¨ (Dimension Tables)</strong> ç»„æˆ ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå†—ä½™åº¦é«˜ï¼ˆéè§„èŒƒåŒ–ï¼‰ï¼Œä½† <strong>JOIN æ¬¡æ•°å°‘ï¼ŒæŸ¥è¯¢é€Ÿåº¦æœ€å¿«</strong> ã€‚</p></li></ul></li><li><p><strong>é›ªèŠ±æ¨¡å¼ (Snowflake Schema)</strong> ï¼š</p><ul><li><p>ç»´åº¦è¡¨å¯ä»¥è¿›ä¸€æ­¥åˆ†è§£ï¼Œæ”¯æŒå¤šå±‚ç»´åº¦ ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå­˜å‚¨æ›´èŠ‚çœï¼ˆè§„èŒƒåŒ–ï¼‰ï¼Œä½†ç”±äºéœ€è¦ <strong>æ›´å¤šçš„ JOIN æ“ä½œï¼ŒæŸ¥è¯¢æ€§èƒ½ç›¸å¯¹è¾ƒä½</strong> ã€‚</p></li></ul></li></ul><hr><h2 id="2-åˆ†å¸ƒå¼æ‰§è¡Œæ¨¡å‹"><a href="#2-åˆ†å¸ƒå¼æ‰§è¡Œæ¨¡å‹" class="headerlink" title="2. åˆ†å¸ƒå¼æ‰§è¡Œæ¨¡å‹"></a>2. åˆ†å¸ƒå¼æ‰§è¡Œæ¨¡å‹</h2><h3 id="Pushing-vs-Pulling"><a href="#Pushing-vs-Pulling" class="headerlink" title="Pushing vs. Pulling"></a>Pushing vs. Pulling</h3><ul><li><p><strong>Pushing (Query to Data)</strong>ï¼šå°†æŸ¥è¯¢é€»è¾‘ï¼ˆç‰‡æ®µï¼‰å‘é€åˆ°å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå°½å¯èƒ½åœ¨æœ¬åœ°å®Œæˆè¿‡æ»¤å’Œå¤„ç† ã€‚</p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šShared-nothing ç³»ç»Ÿï¼Œæ—¨åœ¨å‡å°‘æ˜‚è´µçš„ç½‘ç»œä¼ è¾“ ã€‚</li></ul></li><li><p><strong>Pulling (Data to Query)</strong>ï¼šå°†æ•°æ®ä»å­˜å‚¨èŠ‚ç‚¹æ‹‰å–åˆ°æ‰§è¡ŒæŸ¥è¯¢çš„èŠ‚ç‚¹ä¸Šå¤„ç† ã€‚</p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šShared-disk ç³»ç»Ÿ ã€‚</li></ul></li></ul><h3 id="å®¹é”™æ€§-Fault-Tolerance"><a href="#å®¹é”™æ€§-Fault-Tolerance" class="headerlink" title="å®¹é”™æ€§ (Fault Tolerance)"></a>å®¹é”™æ€§ (Fault Tolerance)</h3><ul><li><p><strong>ç°çŠ¶</strong>ï¼šå¤§å¤šæ•°åˆ†å¸ƒå¼ OLAP å‡è®¾èŠ‚ç‚¹åœ¨æŸ¥è¯¢æœŸé—´ä¸ä¼šå¤±æ•ˆ ã€‚</p></li><li><p><strong>ä»£ä»·</strong>ï¼šè‹¥æŸä¸ªèŠ‚ç‚¹åœ¨æ‰§è¡Œé•¿è¾¾æ•°å¤©çš„æŸ¥è¯¢æ—¶å´©æºƒï¼Œé€šå¸¸ä¼šå¯¼è‡´æ•´ä¸ªæŸ¥è¯¢å¤±è´¥å¹¶å¿…é¡»<strong>ä»å¤´å¼€å§‹é‡æ–°æ‰§è¡Œ</strong> ã€‚</p></li></ul><hr><h2 id="3-åˆ†å¸ƒå¼è¿æ¥ç®—æ³•-Distributed-Joins"><a href="#3-åˆ†å¸ƒå¼è¿æ¥ç®—æ³•-Distributed-Joins" class="headerlink" title="3. åˆ†å¸ƒå¼è¿æ¥ç®—æ³• (Distributed Joins)"></a>3. åˆ†å¸ƒå¼è¿æ¥ç®—æ³• (Distributed Joins)</h2><p>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ JOIN æ˜¯æœ€è€—æ—¶çš„æ“ä½œï¼Œå…¶æ•ˆç‡å–å†³äºæ•°æ®çš„åˆ†åŒºæ–¹å¼ ã€‚</p><table><thead><tr><th>åœºæ™¯</th><th>æè¿°</th><th>ç­–ç•¥</th></tr></thead><tbody><tr><td><strong>åœºæ™¯ 1</strong></td><td>ä¸€ä¸ªè¡¨å…¨é‡å‰¯æœ¬åœ¨æ¯èŠ‚ç‚¹ï¼Œå¦ä¸€è¡¨åˆ†åŒº</td><td>æœ¬åœ°å¹¶è¡Œè¿æ¥</td></tr><tr><td><strong>åœºæ™¯ 2</strong></td><td>ä¸¤ä¸ªè¡¨éƒ½æŒ‰ JOIN å±æ€§è¿›è¡Œåˆ†åŒºä¸” ID åŒ¹é…</td><td>æœ¬åœ°å¹¶è¡Œè¿æ¥</td></tr><tr><td><strong>åœºæ™¯ 3</strong></td><td>åˆ†åŒºé”®ä¸åŒï¼Œä½†å…¶ä¸­ä¸€è¡¨å¾ˆå°</td><td><br><strong>å¹¿æ’­è¿æ¥ (Broadcast Join)</strong>ï¼šå°†å°è¡¨å‘é€ç»™æ‰€æœ‰èŠ‚ç‚¹</td></tr><tr><td><strong>åœºæ™¯ 4</strong></td><td>æœ€åæƒ…å†µï¼šä¸¤è¡¨åˆ†åŒºé”®å‡é JOIN é”®</td><td><br><strong>æ´—ç‰Œè¿æ¥ (Shuffle Join)</strong>ï¼šå…¨é‡é‡æ–°åˆ†é…æ•°æ®</td></tr></tbody></table><hr><h2 id="4-äº‘ç³»ç»Ÿä¸æ— æœåŠ¡å™¨æ¶æ„-Cloud-Serverless"><a href="#4-äº‘ç³»ç»Ÿä¸æ— æœåŠ¡å™¨æ¶æ„-Cloud-Serverless" class="headerlink" title="4. äº‘ç³»ç»Ÿä¸æ— æœåŠ¡å™¨æ¶æ„ (Cloud &amp; Serverless)"></a>4. äº‘ç³»ç»Ÿä¸æ— æœåŠ¡å™¨æ¶æ„ (Cloud &amp; Serverless)</h2><h3 id="æ¶æ„æ¼”è¿›"><a href="#æ¶æ„æ¼”è¿›" class="headerlink" title="æ¶æ„æ¼”è¿›"></a>æ¶æ„æ¼”è¿›</h3><ul><li><p><strong>æ‰˜ç®¡å‹ (Managed)</strong>ï¼šä¼ ç»Ÿ DBMS æ¬ä¸Šäº‘ï¼Œä¸æ„ŸçŸ¥äº‘ç¯å¢ƒ ã€‚</p></li><li><p><strong>äº‘åŸç”Ÿ (Cloud-Native)</strong>ï¼šåŸºäº Shared-disk æ¶æ„ï¼Œè®¡ç®—ä¸å­˜å‚¨è§£è€¦ï¼ˆå¦‚ Snowflake, BigQueryï¼‰ ã€‚</p></li><li><p><strong>æ— æœåŠ¡å™¨ (Serverless)</strong> ï¼š</p><ul><li><p>å½“æ•°æ®åº“ç©ºé—²æ—¶ï¼Œé©±é€ç§Ÿæˆ·å¹¶å¯¹ Buffer Pool è¿›è¡Œæ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰å­˜ç›˜ï¼Œåœæ­¢è®¡è´¹ ã€‚</p></li><li><p>ç”¨æˆ·ä»…éœ€ä¸ºæ´»åŠ¨æŸ¥è¯¢æ—¶é—´å’Œéæ´»åŠ¨å­˜å‚¨ä»˜è´¹ ã€‚</p></li></ul></li></ul><hr><h2 id="5-OLAP-å•†å“åŒ–-Commoditization"><a href="#5-OLAP-å•†å“åŒ–-Commoditization" class="headerlink" title="5. OLAP å•†å“åŒ– (Commoditization)"></a>5. OLAP å•†å“åŒ– (Commoditization)</h2><p>ç°ä»£ OLAP å€¾å‘äºå°†åŠŸèƒ½è§£è€¦ä¸ºç‹¬ç«‹çš„å¼€æºç»„ä»¶ï¼Œæå¤§åœ°æé«˜äº†ç³»ç»Ÿé—´çš„äº’æ“ä½œæ€§ ï¼š</p><ul><li><p><strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong>ï¼šå¦‚ Apache Calcite ã€‚</p></li><li><p><strong>æ•°æ®æ–‡ä»¶æ ¼å¼</strong>ï¼šå¼€æºäºŒè¿›åˆ¶æ ¼å¼ï¼ˆå¦‚ <strong>Apache Parquet</strong>, Apache Arrowï¼‰å–ä»£ç§æœ‰æ ¼å¼ ã€‚</p></li><li><p><strong>æ‰§è¡Œå¼•æ“</strong>ï¼šå¦‚ Velox, DataFusion ã€‚</p></li></ul><hr><h3 id="åŸç†æ·±åº¦æ€»ç»“ï¼šä¸ºä»€ä¹ˆ-OLAP-åçˆ±åˆ—å­˜ï¼Ÿ"><a href="#åŸç†æ·±åº¦æ€»ç»“ï¼šä¸ºä»€ä¹ˆ-OLAP-åçˆ±åˆ—å­˜ï¼Ÿ" class="headerlink" title="åŸç†æ·±åº¦æ€»ç»“ï¼šä¸ºä»€ä¹ˆ OLAP åçˆ±åˆ—å­˜ï¼Ÿ"></a>åŸç†æ·±åº¦æ€»ç»“ï¼šä¸ºä»€ä¹ˆ OLAP åçˆ±åˆ—å­˜ï¼Ÿ</h3><p>è™½ç„¶ç¬”è®°ä¸­æœªè¯¦ç»†å±•å¼€åˆ—å­˜ç»†èŠ‚ï¼Œä½†åˆ—å­˜ï¼ˆColumnar Storageï¼‰æ˜¯ OLAP æ€§èƒ½çš„æ ¸å¿ƒã€‚</p><ol><li><strong>æé«˜çš„å‹ç¼©æ¯”</strong>ï¼šåŒä¸€åˆ—æ•°æ®ç±»å‹ç›¸åŒï¼Œå‹ç¼©æ•ˆç‡æé«˜ã€‚</li><li><strong>I&#x2F;O è£å‰ª</strong>ï¼šåªéœ€è¯»å–æŸ¥è¯¢æ¶‰åŠçš„åˆ—ï¼Œæ— éœ€æ‰«ææ•´è¡Œï¼Œæå¤§å‡å°‘ç£ç›˜è¯»å–é‡ã€‚</li><li><strong>å‘é‡åŒ–æ‰§è¡Œ</strong>ï¼šé€‚é…ç°ä»£ CPU çš„ SIMD æŒ‡ä»¤ï¼Œæ‰¹é‡å¤„ç†æ•°æ®ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(Bustub):project3å®ç°ç¬”è®°</title>
    <link href="/2025/12/04/CMU15-445-Bustub-project3%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/12/04/CMU15-445-Bustub-project3%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰ç½®çŸ¥è¯†ç‚¹"><a href="#å‰ç½®çŸ¥è¯†ç‚¹" class="headerlink" title="å‰ç½®çŸ¥è¯†ç‚¹"></a>å‰ç½®çŸ¥è¯†ç‚¹</h2><hr><h3 id="è¿­ä»£å™¨æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹"><a href="#è¿­ä»£å™¨æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹" class="headerlink" title="è¿­ä»£å™¨æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹"></a>è¿­ä»£å™¨æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹</h3><p>Volcano æ¨¡å‹ï¼ˆä¹Ÿç§°ä¸º Iterator Model æˆ– Pipeline Modelï¼‰æ˜¯æ•°æ®åº“æŸ¥è¯¢å¤„ç†ä¸­æœ€ç»å…¸ã€æœ€é€šç”¨çš„æ‰§è¡Œæ¨¡å‹ã€‚å®ƒç”± Goetz Graefe åœ¨ 1990 å¹´ä»£æå‡ºï¼Œå‡ ä¹è¢«ç”¨äºæ‰€æœ‰ä¼ ç»Ÿçš„è¡Œå¼æ•°æ®åº“ç³»ç»Ÿï¼ˆå¦‚ PostgreSQL, SQLite, MySQL ç­‰ï¼‰ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå®ƒçš„æ ¸å¿ƒåŸç†æ˜¯å°†æ‰€æœ‰çš„æŸ¥è¯¢æ“ä½œï¼ˆå¦‚æ‰«æã€è¿‡æ»¤ã€è¿æ¥ã€æ’åºï¼‰éƒ½æŠ½è±¡ä¸ºè¿­ä»£å™¨ï¼ˆIteratorï¼‰ï¼Œå¹¶é€šè¿‡<strong>æ‹‰å– Pull-based</strong>çš„æ–¹å¼é€è¡Œå¤„ç†æ•°æ®ã€‚</p><h4 id="æ ¸å¿ƒæŠ½è±¡ï¼šæ ‡å‡†æ¥å£"><a href="#æ ¸å¿ƒæŠ½è±¡ï¼šæ ‡å‡†æ¥å£" class="headerlink" title="æ ¸å¿ƒæŠ½è±¡ï¼šæ ‡å‡†æ¥å£"></a>æ ¸å¿ƒæŠ½è±¡ï¼šæ ‡å‡†æ¥å£</h4><p>åœ¨ Volcano æ¨¡å‹ä¸­ï¼ŒæŸ¥è¯¢è®¡åˆ’æ ‘ï¼ˆQuery Plan Treeï¼‰ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆOperatorï¼‰éƒ½è¢«çœ‹ä½œä¸€ä¸ªè¿­ä»£å™¨ã€‚æ— è®ºè¿™ä¸ªèŠ‚ç‚¹æ˜¯å¤æ‚çš„ Hash Join è¿˜æ˜¯ç®€å•çš„ Sequential Scanï¼Œå®ƒä»¬éƒ½å¿…é¡»å®ç°ä¸€ç»„ç»Ÿä¸€çš„æ¥å£ã€‚</p><p>é€šå¸¸åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š</p><ol><li><p>Open(): åˆå§‹åŒ–æ“ä½œã€‚</p><ul><li><p>è®¾ç½®å†…éƒ¨çŠ¶æ€ï¼Œä¸ºå­èŠ‚ç‚¹è°ƒç”¨ Open()ã€‚</p></li><li><p>ä¾‹å¦‚ï¼šSequential Scan ä¼šæ‰“å¼€æ–‡ä»¶å¹¶æŒ‡å‘ç¬¬ä¸€æ¡è®°å½•ï¼›Sort å¯èƒ½ä¼šåœ¨æ­¤æ—¶è¯»å–æ‰€æœ‰å­èŠ‚ç‚¹æ•°æ®å¹¶è¿›è¡Œæ’åºã€‚</p></li></ul></li><li><p>Next(): æ ¸å¿ƒæ‰§è¡Œé€»è¾‘ã€‚</p><ul><li><p>è¿™æ˜¯é©±åŠ¨æ•°æ®æµåŠ¨çš„å…³é”®ã€‚å½“çˆ¶èŠ‚ç‚¹è°ƒç”¨å­èŠ‚ç‚¹çš„ Next() æ—¶ï¼Œå­èŠ‚ç‚¹è¿”å›**ä¸€ä¸ªå…ƒç»„ï¼ˆTupleï¼‰**æˆ–è€…ä¸€ä¸ªâ€œç»“æŸæ ‡è®°â€ï¼ˆEOF&#x2F;Nullï¼‰ã€‚</p></li><li><p>å…³é”®ç‚¹ï¼šè¿™æ˜¯ä¸€ä¸ªTuple-at-a-timeï¼ˆä¸€æ¬¡å¤„ç†ä¸€è¡Œï¼‰çš„æ¨¡å‹ã€‚</p></li></ul></li><li><p>Close(): æ¸…ç†æ“ä½œã€‚</p><ul><li>é‡Šæ”¾èµ„æºï¼Œå…³é—­æ–‡ä»¶å¥æŸ„ï¼Œé€šçŸ¥å­èŠ‚ç‚¹å…³é—­ã€‚</li></ul></li></ol><h4 id="å·¥ä½œæµï¼šè‡ªé¡¶å‘ä¸‹çš„â€œæ‹‰å–â€æ¨¡å¼"><a href="#å·¥ä½œæµï¼šè‡ªé¡¶å‘ä¸‹çš„â€œæ‹‰å–â€æ¨¡å¼" class="headerlink" title="å·¥ä½œæµï¼šè‡ªé¡¶å‘ä¸‹çš„â€œæ‹‰å–â€æ¨¡å¼"></a>å·¥ä½œæµï¼šè‡ªé¡¶å‘ä¸‹çš„â€œæ‹‰å–â€æ¨¡å¼</h4><p>Volcano æ¨¡å‹çš„æ•°æ®æµå‘å’Œæ§åˆ¶æµå‘æ˜¯ç›¸åçš„ï¼š</p><ul><li><p>æ§åˆ¶æµï¼ˆControl Flowï¼‰ï¼šä»æ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰å‘ä¸‹ä¼ é€’ï¼Œçˆ¶èŠ‚ç‚¹ä¸»åŠ¨è°ƒç”¨å­èŠ‚ç‚¹çš„ Next()ã€‚</p></li><li><p>æ•°æ®æµï¼ˆData Flowï¼‰ï¼šæ•°æ®ä»å¶å­èŠ‚ç‚¹ï¼ˆLeafï¼‰è¢«â€œæ‹‰â€å‘æ ¹èŠ‚ç‚¹ã€‚</p></li></ul><p><strong>æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</strong><br>å‡è®¾æœ‰ä¸€ä¸ªæŸ¥è¯¢ï¼š<code>SELECT * FROM Users WHERE age &gt; 20</code>ã€‚ æ‰§è¡Œè®¡åˆ’æ ‘é€šå¸¸æ˜¯ï¼š<code>Filter (age &gt; 20) -&gt; SeqScan (Users table)</code>ã€‚</p><ol><li><p>ç”¨æˆ·è°ƒç”¨æ ¹èŠ‚ç‚¹ Filter çš„ Next()ã€‚</p></li><li><p>Filter è‡ªèº«æ²¡æœ‰æ•°æ®ï¼Œå®ƒè°ƒç”¨å­èŠ‚ç‚¹ SeqScan çš„ Next()ã€‚</p></li><li><p>SeqScan è¯»å–ç£ç›˜ä¸Šçš„ç¬¬ä¸€è¡Œæ•°æ®ï¼ˆä¾‹å¦‚ age&#x3D;18ï¼‰ï¼Œå¹¶å°†å…¶è¿”å›ç»™ Filterã€‚</p></li><li><p>Filter æ‹¿åˆ°æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼š</p><ul><li><p>å¦‚æœ age &gt; 20 ä¸ºçœŸï¼šFilter å°†è¯¥è¡Œè¿”å›ç»™ç”¨æˆ·ã€‚</p></li><li><p>å¦‚æœ age &gt; 20 ä¸ºå‡ï¼ˆå¦‚æœ¬ä¾‹ï¼‰ï¼šFilter ä¸¢å¼ƒè¯¥è¡Œï¼Œå†æ¬¡è°ƒç”¨ SeqScan çš„ Next()ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¡Œæˆ–æ”¶åˆ° EOFã€‚</p></li></ul></li></ol><hr><h3 id="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)"></a>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)</h3><h4 id="æ ¸å¿ƒæ€æƒ³ï¼šè¯»å†™ä¸å†²çª"><a href="#æ ¸å¿ƒæ€æƒ³ï¼šè¯»å†™ä¸å†²çª" class="headerlink" title="æ ¸å¿ƒæ€æƒ³ï¼šè¯»å†™ä¸å†²çª"></a>æ ¸å¿ƒæ€æƒ³ï¼šè¯»å†™ä¸å†²çª</h4><p>MVCC çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šâ€œå³ä¾¿æœ‰äººåœ¨æ”¹æ•°æ®ï¼Œæˆ‘ä¾ç„¶å¯ä»¥è¯»åˆ°è¯¥æ•°æ®åœ¨è¯¥æ“ä½œä¹‹å‰çš„æ—§ç‰ˆæœ¬ã€‚â€</p><ul><li>è¯»ä¸é˜»å¡å†™</li><li>å†™ä¸é˜»å¡è¯»</li></ul><p>è¿™å°±å¥½æ¯”ä½ åœ¨ç¼–è¾‘ä¸€ä»½åœ¨çº¿æ–‡æ¡£ï¼Œå½“ä½ è¿˜æ²¡ç‚¹å‡»â€œä¿å­˜â€æ—¶ï¼Œå…¶ä»–äººçœ‹åˆ°çš„ä¾ç„¶æ˜¯ä¿®æ”¹å‰çš„ç‰ˆæœ¬ï¼Œè€Œäº’ä¸å¹²æ‰°ã€‚</p><h4 id="MVCCå®ç°"><a href="#MVCCå®ç°" class="headerlink" title="MVCCå®ç°"></a>MVCCå®ç°</h4><p>MVCC çš„å®ç°ä¾èµ–äºä¸‰ä¸ªå…³é”®ç»„ä»¶ï¼šéšè—åˆ—ã€å›æ»šæ—¥å¿—ï¼ˆUndo Logï¼‰ å’Œ ä¸€è‡´æ€§è§†å›¾ï¼ˆRead Viewï¼‰ã€‚</p><ol><li><p>éšè—åˆ—</p><p>InnoDB ä¼šåœ¨æ¯ä¸€è¡Œæ•°æ®çš„åé¢æ‚„æ‚„åŠ ä¸Šå‡ ä¸ªéšè—å­—æ®µï¼š</p><ul><li><p>DB_TRX_IDï¼šè®°å½•æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è¡Œæ•°æ®çš„äº‹åŠ¡ IDã€‚</p></li><li><p>DB_ROLL_PTRï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥è¡Œæ•°æ®ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ Undo Log è®°å½•ã€‚</p></li></ul></li><li><p>å›æ»šæ—¥å¿—ï¼ˆUndo Logï¼‰<br>æ¯å½“ä¸€æ¡è®°å½•è¢«ä¿®æ”¹æ—¶ï¼ŒInnoDB ä¸ä¼šç›´æ¥è¦†ç›–æ—§æ•°æ®ï¼Œè€Œæ˜¯æŠŠæ—§æ•°æ®å†™å…¥ Undo Log ä¸­ã€‚é€šè¿‡ DB_ROLL_PTRï¼Œè¿™äº›æ—§ç‰ˆæœ¬çš„æ•°æ®ä¼šåƒé“¾è¡¨ä¸€æ ·ä¸²èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾ã€‚</p></li><li><p>ä¸€è‡´æ€§è§†å›¾<br>å½“ä¸€ä¸ªäº‹åŠ¡å‘èµ·æŸ¥è¯¢æ—¶ï¼ŒMVCC ä¼šç”Ÿæˆä¸€ä¸ª Read Viewã€‚å®ƒåƒä¸€å¼ â€œå¿«ç…§â€ï¼Œè®°å½•äº†å½“å‰ç³»ç»Ÿä¸­å“ªäº›äº‹åŠ¡æ˜¯æ´»è·ƒçš„ï¼ˆè¿˜æ²¡æäº¤çš„ï¼‰ã€‚</p><p>æ ¹æ® Read View çš„è§„åˆ™ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ç‰ˆæœ¬é“¾ä¸­å“ªä¸ªç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ï¼š</p><ul><li><p>å¦‚æœç‰ˆæœ¬ ID åœ¨ Read View åˆ›å»ºå‰å·²æäº¤ -&gt; å¯è§ã€‚</p></li><li><p>å¦‚æœç‰ˆæœ¬ ID åœ¨ Read View åˆ›å»ºåæ‰å¼€å¯ -&gt; ä¸å¯è§ã€‚</p></li><li><p>å¦‚æœç‰ˆæœ¬ ID å±äºå½“å‰æ­£åœ¨è¿è¡Œä¸”æœªæäº¤çš„äº‹åŠ¡ -&gt; ä¸å¯è§ã€‚</p></li></ul></li></ol><hr><h2 id="éƒ¨ä»¶å®ç°ï¼šè®¿é—®æ–¹æ³•æ‰§è¡Œå™¨"><a href="#éƒ¨ä»¶å®ç°ï¼šè®¿é—®æ–¹æ³•æ‰§è¡Œå™¨" class="headerlink" title="éƒ¨ä»¶å®ç°ï¼šè®¿é—®æ–¹æ³•æ‰§è¡Œå™¨"></a>éƒ¨ä»¶å®ç°ï¼šè®¿é—®æ–¹æ³•æ‰§è¡Œå™¨</h2><p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œå°†å®ç°å…è®¸ BusTub æ‰§è¡ŒæŸ¥è¯¢çš„ç»„ä»¶ã€‚å°†åˆ›å»ºæ‰§è¡Œ SQL æŸ¥è¯¢çš„æ“ä½œç¬¦æ‰§è¡Œå™¨ï¼Œå¹¶å®ç°ä¼˜åŒ–è§„åˆ™ä»¥è½¬æ¢æŸ¥è¯¢è®¡åˆ’ã€‚</p><hr><h3 id="SeqScanExecutorç±»"><a href="#SeqScanExecutorç±»" class="headerlink" title="SeqScanExecutorç±»"></a>SeqScanExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> SeqScanExecutor éå†ä¸€ä¸ªè¡¨ï¼Œå¹¶é€ä¸ªè¿”å›å…¶å…ƒç»„ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li><p>Init()ï¼šåˆå§‹åŒ–é˜¶æ®µï¼š</p><ul><li>è¿™æ˜¯ Volcano æ¨¡å‹ä¸­çš„ Open() æ“ä½œã€‚</li><li>é€»è¾‘ï¼šå‡†å¤‡å·¥ä½œã€‚å®ƒä¸è¯»å–æ•°æ®ï¼Œ<code>åªæ˜¯æŠŠâ€œè¿­ä»£å™¨æŒ‡é’ˆâ€æŒ‡å‘è¡¨çš„å¼€å¤´</code>ã€‚</li></ul></li><li><p>Next()ï¼šæ‰§è¡Œé˜¶æ®µï¼š</p><ul><li>è¿™æ˜¯ Volcano æ¨¡å‹ä¸­çš„ Next() æ“ä½œã€‚çˆ¶èŠ‚ç‚¹ä¼šä¸æ–­è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥â€œæ‹‰å–â€æ•°æ®ã€‚</li><li>é€»è¾‘ï¼š<code>è·å–å½“å‰è¿­ä»£å™¨æŒ‡å‘çš„æ•°æ®</code>-&gt;<code>ä»£å™¨å‰ç§»ï¼Œä¸ºä¸‹ä¸€æ¬¡è°ƒç”¨åšå‡†å¤‡</code>-&gt;<code>å¾ªç¯ç›´åˆ°è¡¨è¯»å®Œ</code></li><li>æ³¨æ„ï¼šå¯¹å·²åˆ é™¤æ•°æ®çš„å¤„ç†ï¼Œå› ä¸ºç‰©ç†ä¸Šå­˜åœ¨çš„è¡Œï¼ˆåœ¨ç£ç›˜ Page ä¸Šï¼‰ï¼Œé€»è¾‘ä¸Šå¯èƒ½å·²ç»è¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥è¦æ£€æŸ¥is_deleted_ã€‚</li></ul></li></ol><hr><h3 id="InsertExecutorç±»"><a href="#InsertExecutorç±»" class="headerlink" title="InsertExecutorç±»"></a>InsertExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> InsertExecutor å°†å…ƒç»„æ’å…¥è¡¨å¹¶æ›´æ–°å—å½±å“çš„ç´¢å¼•ã€‚å®ƒæ°å¥½æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œç”¨äºç”Ÿæˆè¦æ’å…¥è¡¨ä¸­çš„å€¼ã€‚è§„åˆ’å™¨å°†ç¡®ä¿è¿™äº›å€¼ä¸è¡¨çš„æ¶æ„ç›¸åŒã€‚æ‰§è¡Œå™¨å°†äº§ç”Ÿä¸€ä¸ªæ•´æ•°ç±»å‹çš„å•ä¸ªå…ƒç»„ä½œä¸ºè¾“å‡ºï¼ŒæŒ‡ç¤ºå·²æ’å…¥è¡¨ä¸­çš„è¡Œæ•°ã€‚åœ¨å‘è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œè¯·è®°ä½æ›´æ–°ç´¢å¼•ï¼Œå¦‚æœè¯¥è¡¨æœ‰å…³è”çš„ç´¢å¼•ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li>Init():åˆå§‹åŒ–å­èŠ‚ç‚¹ä»¥ä¾¿åç»­æ‹‰å–æ•°æ®</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">void InsertExecutor::<span class="hljs-built_in">Init</span>() &#123; <br>    child_-&gt;<span class="hljs-built_in">Init</span>(); <span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œè®©å­èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ ValuesExecutor æˆ– SeqScanï¼‰å‡†å¤‡å¥½æ•°æ®</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>Next()ï¼šæ‰§è¡Œé˜¶æ®µï¼š<ul><li>æ’å…¥æ“ä½œæœ€ç»ˆåªè¿”å›ä¸€è¡Œæ•°æ®ï¼ˆå³å—å½±å“çš„è¡Œæ•° insert_countï¼‰ï¼Œæ‰€ä»¥å¦‚æœ Next è¢«ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œå¿…é¡»ç›´æ¥è¿”å› falseï¼Œè¡¨ç¤ºæ‰§è¡Œç»“æŸã€‚</li><li>é€»è¾‘ï¼š<code>æ£€æŸ¥ is_end_ æ ‡å¿—</code>-&gt;<code>å¾ªç¯æ‹‰å–ä¸ç‰©ç†å†™å…¥(ä»å­èŠ‚ç‚¹è·å–æ•°æ®ã€å†™å…¥å †è¡¨ã€åŒæ­¥æ›´æ–°æ‰€æœ‰ç´¢å¼•)</code>-&gt;<code>æ„é€ è¿”å›ç»“æœ</code></li></ul></li></ol><hr><h3 id="UpdateExecutorç±»"><a href="#UpdateExecutorç±»" class="headerlink" title="UpdateExecutorç±»"></a>UpdateExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> UpdateExecutor ä¿®æ”¹æŒ‡å®šè¡¨ä¸­çš„ç°æœ‰å…ƒç»„ã€‚æ‰§è¡Œå™¨å°†äº§ç”Ÿä¸€ä¸ªæ•´æ•°ç±»å‹çš„å•ä¸ªå…ƒç»„ä½œä¸ºè¾“å‡ºï¼ŒæŒ‡ç¤ºå·²æ›´æ–°çš„è¡Œæ•°ã€‚è¯·è®°ä½æ›´æ–°å—æ›´æ–°å½±å“çš„ä»»ä½•ç´¢å¼•ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong><br>å’Œ InsertExecutor ä¸€æ ·ï¼ŒUpdate ä¹Ÿæ˜¯ä¸€ä¸ª<strong>Pipeline Breakerï¼ˆæµæ°´çº¿é˜»æ–­ç‚¹ï¼‰</strong>ã€‚</p><ul><li>å®ƒä¼šä¸€æ¬¡æ€§å¤„ç†å®Œå­èŠ‚ç‚¹ä¼ æ¥çš„æ‰€æœ‰éœ€è¦æ›´æ–°çš„æ•°æ®ã€‚</li><li>æœ€ç»ˆåªè¿”å›ä¸€è¡Œç»“æœï¼šæ›´æ–°æˆåŠŸçš„æ¡æ•° (count)ã€‚</li></ul><p>Next()ï¼šæ‰§è¡Œé˜¶æ®µï¼š<br><code>éå†è¦æ›´æ–°çš„æ•°æ®</code>-&gt;<code>é€»è¾‘åˆ é™¤æ—§æ•°æ®</code>-&gt;<code>æ„é€ æ–°æ•°æ®</code>-&gt;<code>æ’å…¥æ–°æ•°æ®</code>-&gt;<code>æ›´æ–°ç´¢å¼•</code></p><hr><h3 id="DeleteExecutorç±»"><a href="#DeleteExecutorç±»" class="headerlink" title="DeleteExecutorç±»"></a>DeleteExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> å®ƒä¸è¦ä»è¡¨ä¸­åˆ é™¤çš„è®°å½•æ°å¥½æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚åˆ é™¤æ‰§è¡Œå™¨åº”äº§ç”Ÿä¸€ä¸ªæ•´æ•°è¾“å‡ºï¼Œè¡¨ç¤ºå®ƒä»è¡¨ä¸­åˆ é™¤çš„è¡Œæ•°ã€‚å®ƒè¿˜éœ€è¦æ›´æ–°ä»»ä½•å—å½±å“çš„ç´¢å¼•ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li>Init():åˆå§‹åŒ–å­èŠ‚ç‚¹ä»¥ä¾¿åç»­æ‹‰å–æ•°æ®</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">void InsertExecutor::<span class="hljs-built_in">Init</span>() &#123; <br>    child_-&gt;<span class="hljs-built_in">Init</span>(); <span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œè®©å­èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ ValuesExecutor æˆ– SeqScanï¼‰å‡†å¤‡å¥½æ•°æ®</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>Next():<br><code>éå†å¾…åˆ é™¤æ•°æ®</code>-&gt;<code>è·å–å½“å‰è¡Œçš„å…ƒæ•°æ®ã€å°†åˆ é™¤æ ‡è®°ç½®ä¸º trueã€å†™å›å…ƒæ•°æ®</code>-&gt;<code>æ›´æ–°ç´¢å¼•</code></li></ol><hr><h3 id="IndexScanExecutorç±»"><a href="#IndexScanExecutorç±»" class="headerlink" title="IndexScanExecutorç±»"></a>IndexScanExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> IndexScanExecutor éå†ç´¢å¼•ä»¥æ£€ç´¢ RIDs ä»¥è·å–å…ƒç»„ã€‚ç„¶åï¼Œè¯¥æ“ä½œå‘˜ä½¿ç”¨è¿™äº› RID æ¥æ£€ç´¢ç›¸åº”è¡¨ä¸­çš„å…ƒç»„ã€‚æ¥ç€é€ä¸ªå‘å‡ºè¿™äº›å…ƒç»„ã€‚</p><p>å¦‚æœè¯´ä¹‹å‰çš„ SeqScan æ˜¯â€œå‚»ç“œå¼â€åœ°ä»ç¬¬ä¸€é¡µç¿»åˆ°æœ€åä¸€é¡µï¼Œé‚£ä¹ˆ IndexScan å°±æ˜¯ <strong>â€œæŸ¥å­—å…¸â€</strong> ï¼šå…ˆé€šè¿‡ B+æ ‘ç´¢å¼•æ‰¾åˆ°æ•°æ®çš„ <strong>ç‰©ç†åœ°å€ï¼ˆRIDï¼‰</strong>ï¼Œç„¶åå†å»å †è¡¨ï¼ˆTable Heapï¼‰é‡ŒæŠ“å–çœŸæ­£çš„æ•°æ®ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><p>Next():</p><ul><li>è¿™ä¸ªç®—å­çš„å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<code>éå† B+æ ‘å¶å­èŠ‚ç‚¹</code> -&gt; <code>æ‹¿åˆ° RID</code> -&gt; <code>å›è¡¨æŸ¥æ•°æ®</code>ã€‚</li><li>ä¸ºä»€ä¹ˆéœ€è¦å›è¡¨?:B+æ ‘é‡Œåªå­˜äº† &lt;Key, RID&gt;ï¼Œå…‰æœ‰ Key æ˜¯ä¸å¤Ÿçš„ã€‚æ‰€ä»¥å¿…é¡»é€šè¿‡ RID å» Heap ä¸­è¯»å–å®Œæ•´æ•°æ®</li></ul><hr><h2 id="éƒ¨ä»¶å®ç°ï¼šèšåˆä¸è¿æ¥æ‰§è¡Œå™¨"><a href="#éƒ¨ä»¶å®ç°ï¼šèšåˆä¸è¿æ¥æ‰§è¡Œå™¨" class="headerlink" title="éƒ¨ä»¶å®ç°ï¼šèšåˆä¸è¿æ¥æ‰§è¡Œå™¨"></a>éƒ¨ä»¶å®ç°ï¼šèšåˆä¸è¿æ¥æ‰§è¡Œå™¨</h2><p>éœ€è¦æ·»åŠ ä¸€ä¸ªèšåˆæ‰§è¡Œå™¨ã€å¤šä¸ªè¿æ¥æ‰§è¡Œå™¨ï¼Œå¹¶ä½¿ä¼˜åŒ–å™¨åœ¨è§„åˆ’æŸ¥è¯¢æ—¶èƒ½å¤Ÿåœ¨åµŒå¥—å¾ªç¯è¿æ¥å’Œå“ˆå¸Œè¿æ¥ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</p><hr><h3 id="AggregationExecutorç±»"><a href="#AggregationExecutorç±»" class="headerlink" title="AggregationExecutorç±»"></a>AggregationExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> èšåˆæ‰§è¡Œå™¨ä¸ºæ¯ä¸ªè¾“å…¥åˆ†ç»„è®¡ç®—èšåˆå‡½æ•°ã€‚å®ƒæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚è¾“å‡ºæ¨¡å¼ç”±åˆ†ç»„åˆ—å’Œèšåˆåˆ—ç»„æˆã€‚BusTub é‡‡ç”¨çš„æ˜¯ <strong>å“ˆå¸Œèšåˆ</strong> ï¼Œä»¥åˆ†ç»„åˆ—ä¸ºé”®ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br>å‡è®¾æœ‰ä¸€å¼ è¡¨ Studentï¼Œæˆ‘ä»¬è¦æ‰§è¡Œï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> Major, <span class="hljs-built_in">COUNT</span>(*), <span class="hljs-built_in">AVG</span>(GPA) <br><span class="hljs-keyword">FROM</span> Student <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Major;<br></code></pre></td></tr></table></figure><p>è¾“å…¥æ•°æ®æµï¼š</p><pre><code class="hljs">&#123;CS, 3.5&#125;&#123;Math, 3.8&#125;&#123;CS, 3.9&#125;&#123;English, 3.2&#125;</code></pre><p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ul><li><p>è¯»ç¬¬ 1 è¡Œ {CS, 3.5}:</p><ul><li><p>å“ˆå¸Œè¡¨ä¸­æ²¡æœ‰ â€œCSâ€ã€‚</p></li><li><p>æ’å…¥: Key&#x3D;â€CSâ€, Val&#x3D;{Count&#x3D;1, SumGPA&#x3D;3.5}</p></li></ul></li><li><p>è¯»ç¬¬ 2 è¡Œ {Math, 3.8}:</p><ul><li><p>å“ˆå¸Œè¡¨ä¸­æ²¡æœ‰ â€œMathâ€ã€‚</p></li><li><p>æ’å…¥: Key&#x3D;â€Mathâ€, Val&#x3D;{Count&#x3D;1, SumGPA&#x3D;3.8}</p></li></ul></li><li><p>è¯»ç¬¬ 3 è¡Œ {CS, 3.9}:</p><ul><li><p>å“ˆå¸Œè¡¨ä¸­å·²æœ‰ â€œCSâ€ã€‚</p></li><li><p>æ›´æ–°: æ‹¿å‡ºæ—§å€¼ï¼ŒCountå˜æˆ 1+1&#x3D;2ï¼ŒSumGPAå˜æˆ 3.5+3.9&#x3D;7.4ã€‚</p></li><li><p>å½“å‰ â€œCSâ€ æ¡ç›®: Val&#x3D;{Count&#x3D;2, SumGPA&#x3D;7.4}</p></li></ul></li><li><p>è¯»ç¬¬ 4 è¡Œ {English, 3.2}:</p><ul><li>æ’å…¥: Key&#x3D;â€Englishâ€, Val&#x3D;{Count&#x3D;1, SumGPA&#x3D;3.2}</li></ul></li></ul><p>æœ€ç»ˆè¾“å‡º: éå†å“ˆå¸Œè¡¨ï¼Œè®¡ç®— AVG (Sum&#x2F;Count)ï¼Œè¾“å‡ºç»“æœ</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li>Init():<ul><li>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚åœ¨ Init ç»“æŸå‰ï¼Œçˆ¶èŠ‚ç‚¹æ‹¿ä¸åˆ°ä»»ä½•æ•°æ®ã€‚</li><li>é€»è¾‘ï¼š <code>éå†å­èŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®</code>-&gt;<code>ç”Ÿæˆ Key (åˆ†ç»„ä¾æ®)ã€ç”Ÿæˆ Value (å¾…èšåˆçš„å€¼)</code>-&gt;<code>æ’å…¥æˆ–æ›´æ–°å“ˆå¸Œè¡¨</code>-&gt;<code>å‡†å¤‡è¿­ä»£å™¨ï¼Œä¾› Next é˜¶æ®µä½¿ç”¨</code></li></ul></li><li>Next():<ul><li>å½“ Init æŠŠå“ˆå¸Œè¡¨å»ºå¥½åï¼ŒNext çš„å·¥ä½œå°±å¾ˆç®€å•äº†ï¼šéå†å“ˆå¸Œè¡¨ï¼ŒæŠŠç»“æœåå‡ºæ¥ã€‚<br> é€»è¾‘ï¼š</li><li><code>æƒ…å†µ A: å“ˆå¸Œè¡¨é‡Œæœ‰æ•°æ®</code>-&gt;<code>è·å– Group By çš„åˆ— (Key)</code>-&gt;<code>è·å–èšåˆåçš„ç»“æœ (Value)</code>-&gt;<code>å°è£…æˆ Tuple è¿”å›</code></li><li><code>æƒ…å†µ B: å“ˆå¸Œè¡¨æ˜¯ç©ºçš„</code>-&gt;<code>æ²¡æœ‰â€˜GROUP BYâ€™ï¼Œä¾‹å¦‚ï¼šSELECT COUNT(*) FROM empty_table; -&gt; ç»“æœåº”è¯¥æ˜¯ 0</code>ã€<code>æœ‰â€˜GROUP BYâ€™ï¼ŒSELECT COUNT(*) FROM empty_table GROUP BY id; -&gt; ç»“æœåº”è¯¥æ˜¯null</code></li></ul></li></ol><hr><h3 id="HashJoinExecutorç±»"><a href="#HashJoinExecutorç±»" class="headerlink" title="HashJoinExecutorç±»"></a>HashJoinExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> HashJoinExecutor å®ç°å†…è¿æ¥å’Œå¤–è¿æ¥ã€‚è¯¥æ“ä½œç¬¦çš„è¾“å‡ºæ¨¡å¼æ˜¯å·¦è¡¨çš„æ‰€æœ‰åˆ—ï¼Œç„¶åæ˜¯å³è¡¨çš„æ‰€æœ‰åˆ—ã€‚ä¸èšåˆç±»ä¼¼ï¼Œä½ å¯ä»¥å‡è®¾ç”¨äºè¿æ¥çš„å“ˆå¸Œè¡¨å¯ä»¥å®Œå…¨æ”¾å…¥å†…å­˜ä¸­ã€‚</p><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li><p>Init():</p><ul><li>é€»è¾‘ï¼š<code>åˆå§‹åŒ–å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œå‡†å¤‡å¥½ä»å®ƒä»¬é‚£é‡Œæ‹‰å–æ•°æ®</code>-&gt;<code>æ„å»ºé˜¶æ®µ (Build Phase) - å¤„ç†å³è¡¨(éå†å³è¡¨-&gt;è®¡ç®— Key-&gt;æ’å…¥å“ˆå¸Œè¡¨)</code>-&gt;<code>æ¢æµ‹é˜¶æ®µ (Probe Phase) - å¤„ç†å·¦è¡¨(è¿™ä¸€æ­¥éå†å·¦è¡¨ï¼ˆLeft Childï¼‰ï¼Œå¹¶æ ¹æ®è¿æ¥ç±»å‹ï¼ˆInner vs Leftï¼‰æ‰§è¡Œä¸åŒçš„é€»è¾‘)</code></li></ul></li><li><p>Next():</p><ul><li>Initå‡½æ•°å·²ç»å¾—åˆ°è¿æ¥åçš„ç»“æœï¼Œæ‰€ä»¥Nextå‡½æ•°åªè¿›è¡Œè¿­ä»£å™¨é€’å¢å’Œåˆ¤æ–­æ˜¯å¦åˆ°æœ€å</li></ul></li></ol><hr><h2 id="éƒ¨ä»¶å®ç°ï¼šæ’åºã€é™åˆ¶æ‰§è¡Œå™¨"><a href="#éƒ¨ä»¶å®ç°ï¼šæ’åºã€é™åˆ¶æ‰§è¡Œå™¨" class="headerlink" title="éƒ¨ä»¶å®ç°ï¼šæ’åºã€é™åˆ¶æ‰§è¡Œå™¨"></a>éƒ¨ä»¶å®ç°ï¼šæ’åºã€é™åˆ¶æ‰§è¡Œå™¨</h2><p>å¦‚æœè¡¨ä¸Šæœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢å¤„ç†å±‚å°†è‡ªåŠ¨é€‰æ‹©å®ƒè¿›è¡Œæ’åºã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ’åºæ‰§è¡Œå™¨æ¥å®Œæˆæ­¤æ“ä½œã€‚</p><hr><h3 id="SortExecutorç±»"><a href="#SortExecutorç±»" class="headerlink" title="SortExecutorç±»"></a>SortExecutorç±»</h3><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li>Init():<ul><li>é€»è¾‘ï¼š<code>å¾ªç¯è¯»å–å­èŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®,æ”¾å…¥å†…å­˜å˜é‡</code>-&gt;<code>åœ¨å†…å­˜ä¸­æ ¹æ®ç‰¹å®šçš„è§„åˆ™é‡æ’é¡ºåº</code>-&gt;<code>å°†è¿­ä»£å™¨æŒ‡å‘æ’åºåç»“æœçš„å¼€å¤´</code></li></ul></li><li>Next():<ul><li>åªè¿›è¡Œè¿­ä»£å™¨é€’å¢å’Œåˆ¤æ–­æ˜¯å¦ç»§ç»­</li></ul></li></ol><hr><h3 id="LimitExecutorç±»"><a href="#LimitExecutorç±»" class="headerlink" title="LimitExecutorç±»"></a>LimitExecutorç±»</h3><p><strong>åŠŸèƒ½ï¼š</strong> LimitExecutoré™åˆ¶äº†å…¶å­æ‰§è¡Œå™¨è¾“å‡ºçš„å…ƒç»„æ•°é‡ã€‚å¦‚æœå…¶å­æ‰§è¡Œå™¨äº§ç”Ÿçš„å…ƒç»„æ•°é‡å°‘äºè®¡åˆ’èŠ‚ç‚¹ä¸­æŒ‡å®šçš„é™åˆ¶ï¼Œåˆ™è¯¥æ‰§è¡Œå™¨æ— æ•ˆï¼Œå¹¶è¾“å‡ºå®ƒæ¥æ”¶åˆ°çš„æ‰€æœ‰å…ƒç»„ã€‚</p><p>ä¸ Sort æˆ– Aggregation ä¸åŒï¼ŒLimitExecutor ä¸æ˜¯ Pipeline Breakerã€‚ å®ƒä¸éœ€è¦ç­‰å¾…å­èŠ‚ç‚¹æŠŠæ•°æ®å…¨è¯»å®Œæ‰å¼€å§‹å·¥ä½œã€‚ç›¸åï¼Œå®ƒæ˜¯ä¸€ä¸ª <strong>â€œè®¡æ•°å™¨ + é—¸é—¨â€</strong>ï¼š</p><ul><li><p>å­èŠ‚ç‚¹ç»™ä¸€æ¡ï¼Œå®ƒå°±æ•°ä¸€æ¡ï¼Œæ”¾è¡Œä¸€æ¡ã€‚</p></li><li><p>ä¸€æ—¦æ•°åˆ°äº†é™åˆ¶å€¼ï¼ˆLimitï¼‰ï¼Œç«‹åˆ»å…³é—¸ã€‚</p></li></ul><p><strong>ç±»å‡½æ•°ï¼š</strong></p><ol><li><p>Init()</p><ul><li>è®©å­ç±»åšå¥½å‡†,è®¡æ•°å™¨å½’é›¶</li></ul></li><li><p>Next()</p><ul><li>é€»è¾‘ï¼š<code>æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸Šé™,åˆ°è¾¾ä¸Šé™ä¸è¿”å›æ•°æ®</code>-&gt;<code>è®¡æ•°å™¨+1</code>-&gt;<code>ç›´æ¥è°ƒç”¨å­èŠ‚ç‚¹çš„ Nextï¼Œå°è¯•æ‹‰å–ä¸€æ¡æ•°æ®</code></li><li>è®¡æ•°å™¨cursor_:ä½œä¸ºæˆå‘˜å˜é‡ï¼ˆè€Œä¸æ˜¯å±€éƒ¨å˜é‡ï¼‰ï¼Œå°±èµ·åˆ°äº† <strong>â€œè®°å¿†â€</strong> çš„ä½œç”¨ã€‚å®ƒè®°å½•äº†ä» Init() å¼€å§‹åˆ°ç°åœ¨ï¼Œå·²ç»æˆåŠŸå‘ä¸Šä¼ é€’äº†å¤šå°‘è¡Œæ•°æ®ï¼Œåˆ°è¾¾ä¸Šé™å°±æˆªæ­¢ã€‚</li></ul></li></ol><p><strong>æ³¨æ„ï¼š</strong> ä¸ Sort çš„é…åˆ (Top-N æŸ¥è¯¢)<br>é€šå¸¸ LIMIT ä¼šå’Œ ORDER BY ä¸€èµ·å‡ºç°ï¼ˆä¾‹å¦‚ ORDER BY score DESC LIMIT 10ï¼‰ã€‚</p><ul><li><p>åœ¨ç›®å‰çš„å®ç°ä¸­ï¼š æŸ¥è¯¢è®¡åˆ’é€šå¸¸æ˜¯ Limit -&gt; Sort -&gt; Scanã€‚ ç”±äº Sort æ˜¯ Pipeline Breakerï¼ˆå¿…é¡»è¯»å®Œæ‰€æœ‰æ•°æ®æ‰èƒ½æ’åºï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™ç§æ¶æ„ä¸‹ï¼ŒLimit æ— æ³• èŠ‚çœ Scan çš„ I&#x2F;Oã€‚Sort ä¾ç„¶ä¼šæŠŠ 1000 ä¸‡è¡Œè¯»å‡ºæ¥æ’å¥½åºï¼Œç„¶å Limit ä»å†…å­˜é‡Œå–å‰ 10 ä¸ªã€‚</p></li><li><p>ä¼˜åŒ–æ–¹å‘ (Top-N Optimization)ï¼š åœ¨æ›´é«˜çº§çš„ä¼˜åŒ–ä¸­ï¼Œä¼šå°† Limit å‹å…¥ Sort å†…éƒ¨ï¼Œä½¿ç”¨ å †æ’åº (Heap Sort) ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º N çš„å †ã€‚è¿™æ ·è™½ç„¶è¿˜æ˜¯è¦è¯»å®Œæ•°æ®ï¼Œä½†ä¸éœ€è¦å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œå…¨é‡æ’åºï¼Œèƒ½èŠ‚çœå†…å­˜å’Œ CPUã€‚</p></li></ul><hr><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><img src="/img/CMU15-445-Bustub-project3å®ç°ç¬”è®°/result.png" alt="æµ‹è¯•ç»“æœ" style="display: block; margin: 0 auto; width: 70%; height:70%;">]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Bustub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(Bustub):project2å®ç°ç¬”è®°</title>
    <link href="/2025/12/03/CMU15-445-Bustub-project2%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/12/03/CMU15-445-Bustub-project2%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="CMU-15-445-Project-2-B-Tree-Index-å®ç°è¿‡ç¨‹æ–‡æ¡£"><a href="#CMU-15-445-Project-2-B-Tree-Index-å®ç°è¿‡ç¨‹æ–‡æ¡£" class="headerlink" title="CMU 15-445 Project 2: B+Tree Index å®ç°è¿‡ç¨‹æ–‡æ¡£"></a>CMU 15-445 Project 2: B+Tree Index å®ç°è¿‡ç¨‹æ–‡æ¡£</h1><h2 id="1-é¡¹ç›®æ¦‚è§ˆ"><a href="#1-é¡¹ç›®æ¦‚è§ˆ" class="headerlink" title="1. é¡¹ç›®æ¦‚è§ˆ"></a>1. é¡¹ç›®æ¦‚è§ˆ</h2><p>æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªæ”¯æŒé«˜å¹¶å‘ã€åŸºäºç£ç›˜çš„ B+ æ ‘åŠ¨æ€ç´¢å¼•ç»“æ„ã€‚å®ƒæ”¯æŒæ’å…¥ã€ç‚¹æŸ¥è¯¢ï¼ˆSearchï¼‰ã€åˆ é™¤ä»¥åŠèŒƒå›´æ‰«æï¼ˆIteratorï¼‰ã€‚æ ¸å¿ƒéš¾ç‚¹åœ¨äºé¡µé¢å¸ƒå±€çš„è®¾è®¡ã€é€’å½’çš„åˆ†è£‚ä¸åˆå¹¶é€»è¾‘ã€ä»¥åŠä½¿ç”¨ <strong>Latch Crabbing</strong> æŠ€æœ¯å®ç°çš„ç»†ç²’åº¦é”å¹¶å‘æ§åˆ¶ã€‚</p><h2 id="2-æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡-Page-Layout"><a href="#2-æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡-Page-Layout" class="headerlink" title="2. æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡ (Page Layout)"></a>2. æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡ (Page Layout)</h2><p>B+ æ ‘çš„èŠ‚ç‚¹åˆ†ä¸º <strong>å†…éƒ¨é¡µ (Internal Page)</strong> å’Œ <strong>å¶å­é¡µ (Leaf Page)</strong>ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿è‡ªåŸºç¡€é¡µç±»ã€‚</p><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/B+TreeSt.png" alt="B+æ ‘æ•°æ®ç»“æ„" style="display: block; margin: 0 auto; width: 70%; height:70%;"><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/B+TreeLayout.png" alt="B+æ ‘å®ç°" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h3 id="2-1-åŸºç¡€é¡µç±»-b-plus-tree-page-cpp"><a href="#2-1-åŸºç¡€é¡µç±»-b-plus-tree-page-cpp" class="headerlink" title="2.1 åŸºç¡€é¡µç±» (b_plus_tree_page.cpp)"></a>2.1 åŸºç¡€é¡µç±» (<code>b_plus_tree_page.cpp</code>)</h3><ul><li><p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹å…±æœ‰çš„å…ƒæ•°æ®ã€‚</p></li><li><p><strong>æ ¸å¿ƒå­—æ®µ</strong>ï¼š</p><ul><li><code>page_type_</code>: æšä¸¾ç±»å‹ï¼Œæ ‡è®°å½“å‰æ˜¯ Internal è¿˜æ˜¯ Leafã€‚</li><li><code>size_</code>: å½“å‰é¡µé¢å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ã€‚</li><li><code>max_size_</code>: é¡µé¢æœ€å¤§å®¹é‡ã€‚</li></ul></li><li><p><strong>å…³é”®é€»è¾‘</strong>ï¼š</p><ul><li><code>GetMinSize()</code>: è®¡ç®—èŠ‚ç‚¹åˆå¹¶çš„é˜ˆå€¼ã€‚</li><li><strong>æ ¹èŠ‚ç‚¹</strong>ï¼šç‰¹æ®Šå¤„ç†ï¼ŒInternal æ ¹è‡³å°‘ 2 ä¸ªå­èŠ‚ç‚¹ï¼ŒLeaf æ ¹å¯ä»¥æ˜¯ 0ã€‚</li><li><strong>Internal</strong>ï¼š$\lceil (MaxSize + 1) &#x2F; 2 \rceil$ (è¿™æ˜¯å› ä¸º Internal èŠ‚ç‚¹å­˜å‚¨ N ä¸ªé”®ï¼ŒN+1 ä¸ªæŒ‡é’ˆ)ã€‚</li><li><strong>Leaf</strong>ï¼šMaxSize &#x2F; 2ã€‚</li></ul></li></ul><h3 id="2-2-å†…éƒ¨é¡µ-b-plus-tree-internal-page-cpp"><a href="#2-2-å†…éƒ¨é¡µ-b-plus-tree-internal-page-cpp" class="headerlink" title="2.2 å†…éƒ¨é¡µ (b_plus_tree_internal_page.cpp)"></a>2.2 å†…éƒ¨é¡µ (<code>b_plus_tree_internal_page.cpp</code>)</h3><ul><li><p><strong>å­˜å‚¨ç»“æ„</strong>ï¼šå­˜å‚¨ <code>MappingType</code> ä¸º <code>std::pair&lt;KeyType, page_id_t&gt;</code>ã€‚</p></li><li><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p></li><li><p>ç¬¬ 0 ä¸ª Key æ˜¯æ— æ•ˆçš„ï¼ˆInvalidï¼‰ï¼Œåªæœ‰ Valueï¼ˆæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼‰æ˜¯æœ‰æ•ˆçš„ã€‚</p></li><li><p><strong>æ ¸å¿ƒå‡½æ•°è§£æ</strong>ï¼š</p><ul><li><p><code>Lookup(key, comparator)</code>: ä½¿ç”¨ <strong>äºŒåˆ†æŸ¥æ‰¾ (Binary Search)</strong>ã€‚</p></li><li><p>è¿”å›æŒ‡å‘ <strong>ç¬¬ä¸€ä¸ª Key &gt; target</strong> çš„å‰ä¸€ä¸ªä½ç½®çš„ Valueã€‚è¿™ä¿è¯äº†èƒ½å¤Ÿæ­£ç¡®å¯¼èˆªåˆ°åŒ…å«è¯¥ Key çš„å­æ ‘ã€‚</p></li><li><p><code>MoveHalfTo(recipient)</code>: <strong>åˆ†è£‚ (Split)</strong> é€»è¾‘ã€‚</p></li><li><p>å°†å½“å‰é¡µé¢ååŠéƒ¨åˆ†ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„å…„å¼Ÿé¡µé¢ (<code>recipient</code>)ã€‚</p></li><li><p>Internal èŠ‚ç‚¹åˆ†è£‚æ—¶ï¼Œä¸­é—´çš„ Key ä¼šè¢«<strong>ä¸Šæ (Push Up)</strong> åˆ°çˆ¶èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç•™åœ¨å¶å­ä¸­ã€‚</p></li><li><p><code>MoveAllTo(recipient)</code>: <strong>åˆå¹¶ (Merge)</strong> é€»è¾‘ã€‚</p></li><li><p>å°†å½“å‰é¡µé¢çš„æ‰€æœ‰å†…å®¹ç§»åŠ¨åˆ°å…„å¼Ÿé¡µé¢ä¸­ï¼Œç”¨äºèŠ‚ç‚¹è¢«åˆ é™¤åçš„åˆå¹¶æ“ä½œã€‚</p></li></ul></li></ul><h3 id="2-3-å¶å­é¡µ-b-plus-tree-leaf-page-cpp"><a href="#2-3-å¶å­é¡µ-b-plus-tree-leaf-page-cpp" class="headerlink" title="2.3 å¶å­é¡µ (b_plus_tree_leaf_page.cpp)"></a>2.3 å¶å­é¡µ (<code>b_plus_tree_leaf_page.cpp</code>)</h3><ul><li><p><strong>å­˜å‚¨ç»“æ„</strong>ï¼šå­˜å‚¨ <code>MappingType</code> ä¸º <code>std::pair&lt;KeyType, ValueType&gt;</code> (å³ <code>RID</code>)ã€‚</p></li><li><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p><ul><li>ç»´æŠ¤ <code>next_page_id_</code>ï¼Œå°†æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¸²è”æˆå•å‘é“¾è¡¨ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>æ ¸å¿ƒå‡½æ•°è§£æ</strong>ï¼š</p><ul><li><p><code>Lookup(key, comparator)</code>: <strong>äºŒåˆ†æŸ¥æ‰¾</strong>ã€‚</p><ul><li>æ‰¾åˆ°ç¬¬ä¸€ä¸ª <code>Key &gt;= target</code> çš„ä½ç½®ï¼ˆ<code>lower_bound</code> è¯­ä¹‰ï¼‰ã€‚</li></ul></li><li><p><code>Insert(key, value)</code>: æ’å…¥æ—¶ä¿æŒæœ‰åºæ€§ã€‚</p><ul><li>å› ä¸ºæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œæ’å…¥éœ€è¦ O(N) çš„æ•°æ®æ¬ç§»ã€‚</li></ul></li><li><p><code>MoveHalfTo(recipient)</code>:</p><ul><li>å¶å­èŠ‚ç‚¹åˆ†è£‚æ—¶ï¼Œä¸­é—´ Key <strong>å¤åˆ¶ (Copy Up)</strong> åˆ°çˆ¶èŠ‚ç‚¹ï¼ˆä»ç„¶ä¿ç•™åœ¨å¶å­ä¸­ï¼‰ã€‚æ›´æ–° <code>next_page_id_</code> é“¾è¡¨ã€‚</li></ul></li></ul></li></ul><hr><h2 id="3-å¹¶å‘æ§åˆ¶-Concurrency-Control"><a href="#3-å¹¶å‘æ§åˆ¶-Concurrency-Control" class="headerlink" title="3. å¹¶å‘æ§åˆ¶ (Concurrency Control)"></a>3. å¹¶å‘æ§åˆ¶ (Concurrency Control)</h2><p>ä¸ºäº†æ”¯æŒå¤šçº¿ç¨‹ï¼Œé¿å…ä½¿ç”¨å…¨å±€å¤§é”ï¼Œé¡¹ç›®é‡‡ç”¨äº† <strong>Latch Crabbing (é”è€¦åˆ)</strong> åè®®ã€‚</p><h3 id="3-1-Page-Guardæœºåˆ¶"><a href="#3-1-Page-Guardæœºåˆ¶" class="headerlink" title="3.1 Page Guardæœºåˆ¶"></a>3.1 Page Guardæœºåˆ¶</h3><p>(<code>page_guard.cpp</code>)è¿™æ˜¯ä¸€ä¸ª RAII (Resource Acquisition Is Initialization) é£æ ¼çš„å°è£…ç±»ï¼Œç”¨äºç®¡ç† <code>BufferPoolManager</code> çš„é¡µé¢å¼•è„š (Pin) å’Œé” (Latch)ã€‚</p><ul><li><strong>BasicPageGuard</strong>: è´Ÿè´£ <code>UnpinPage</code>ã€‚ææ„æ—¶è‡ªåŠ¨ Unpinï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li><li><strong>ReadPageGuard &#x2F; WritePageGuard</strong>: ç»§æ‰¿è‡ª Basicï¼Œé¢å¤–è´Ÿè´£ <code>RUnlatch</code> &#x2F; <code>WUnlatch</code>ã€‚ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé˜²æ­¢æ­»é”ã€‚</li></ul><h3 id="3-2-é”è€¦åˆé€»è¾‘-Latch-Crabbing"><a href="#3-2-é”è€¦åˆé€»è¾‘-Latch-Crabbing" class="headerlink" title="3.2 é”è€¦åˆé€»è¾‘ (Latch Crabbing)"></a>3.2 é”è€¦åˆé€»è¾‘ (Latch Crabbing)</h3><p>åŸºæœ¬æ€æƒ³æ˜¯ï¼šåœ¨éå†æ ‘æ—¶ï¼Œå…ˆé”ä½å­èŠ‚ç‚¹ï¼Œå†é‡Šæ”¾çˆ¶èŠ‚ç‚¹çš„é”ã€‚</p><ul><li><strong>Search (è¯»æ“ä½œ)</strong>:</li></ul><ol><li>è·å–çˆ¶èŠ‚ç‚¹è¯»é”ã€‚</li><li>è·å–å­èŠ‚ç‚¹è¯»é”ã€‚</li><li>é‡Šæ”¾çˆ¶èŠ‚ç‚¹è¯»é”ã€‚</li></ol><ul><li><strong>Insert&#x2F;Delete (å†™æ“ä½œ)</strong>:</li></ul><ol><li><p>è·å–çˆ¶èŠ‚ç‚¹å†™é”ã€‚</p></li><li><p>è·å–å­èŠ‚ç‚¹å†™é”ã€‚</p></li><li><p><strong>å®‰å…¨æ£€æµ‹ (Safe Check)</strong>:</p><ul><li><strong>æ’å…¥å®‰å…¨</strong>ï¼šå½“å‰èŠ‚ç‚¹æœªæ»¡ (<code>Size &lt; MaxSize</code>)ã€‚</li><li><strong>åˆ é™¤å®‰å…¨</strong>ï¼šå½“å‰èŠ‚ç‚¹å¤§äºåŠæ»¡ (<code>Size &gt; MinSize</code>)ã€‚</li></ul></li><li><p>å¦‚æœå­èŠ‚ç‚¹æ˜¯â€œå®‰å…¨â€çš„ï¼Œè¯´æ˜æ“ä½œä¸ä¼šæ³¢åŠåˆ°çˆ¶èŠ‚ç‚¹ï¼ˆä¸ä¼šåˆ†è£‚æˆ–åˆå¹¶ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥<strong>æå‰é‡Šæ”¾æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„å†™é”</strong>ã€‚è¿™æå¤§åœ°æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</p></li></ol><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/LatchLogic.png" alt="é”é€»è¾‘" style="display: block; margin: 0 auto; width: 70%; height:70%;"><p>ä»£ç ä½“ç°è§ <code>b_plus_tree.cpp</code> ä¸­çš„ <code>InsertGetKeyAt</code> å’Œ <code>DeleteGetKeyAt</code> å‡½æ•°ä¸­çš„ <code>ctx.write_set_.clear()</code> é€»è¾‘ã€‚</p><hr><h2 id="4-B-æ ‘æ ¸å¿ƒæ“ä½œå®ç°åŸç†-b-plus-tree-cpp"><a href="#4-B-æ ‘æ ¸å¿ƒæ“ä½œå®ç°åŸç†-b-plus-tree-cpp" class="headerlink" title="4. B+æ ‘æ ¸å¿ƒæ“ä½œå®ç°åŸç† (b_plus_tree.cpp)"></a>4. B+æ ‘æ ¸å¿ƒæ“ä½œå®ç°åŸç† (<code>b_plus_tree.cpp</code>)</h2><h3 id="4-1-æŸ¥è¯¢æ“ä½œ-GetValue"><a href="#4-1-æŸ¥è¯¢æ“ä½œ-GetValue" class="headerlink" title="4.1 æŸ¥è¯¢æ“ä½œ (GetValue)"></a>4.1 æŸ¥è¯¢æ“ä½œ (<code>GetValue</code>)</h3><ol><li><p><strong>åˆå§‹åŒ–</strong>ï¼šåˆ›å»ºä¸€ä¸ª <code>Context</code> ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</p></li><li><p><strong>å®šä½å¶å­</strong>ï¼šè°ƒç”¨ <code>GetKeyAt</code>ï¼Œä» Root å¼€å§‹å‘ä¸‹éå†ã€‚</p><ul><li>ä½¿ç”¨ <code>FetchPageRead</code> è·å–è¯»é”ã€‚</li><li>æ¯è¿›å…¥ä¸‹ä¸€å±‚ï¼Œé‡Šæ”¾ä¸Šä¸€å±‚çš„é”ï¼ˆé€šè¿‡ <code>read_set_.pop_front()</code>ï¼‰ã€‚</li></ul></li><li><p><strong>é¡µå†…æŸ¥æ‰¾</strong>ï¼šåœ¨å¶å­èŠ‚ç‚¹è°ƒç”¨ <code>LeafPage::Lookup</code> æ‰¾åˆ° Valueã€‚</p></li><li><p><strong>è¿”å›ç»“æœ</strong>ï¼šè¯»å–åé‡Šæ”¾å¶å­èŠ‚ç‚¹çš„é”ã€‚</p></li></ol><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/GetValue.png" alt="æŸ¥è¯¢æ“ä½œ" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h3 id="4-2-æ’å…¥æ“ä½œ-Insert"><a href="#4-2-æ’å…¥æ“ä½œ-Insert" class="headerlink" title="4.2 æ’å…¥æ“ä½œ (Insert)"></a>4.2 æ’å…¥æ“ä½œ (<code>Insert</code>)</h3><ol><li><p><strong>å®šä½å¹¶é”å®š</strong>ï¼šè°ƒç”¨ <code>InsertGetKeyAt</code>ã€‚</p><ul><li><strong>Pessimistic Locking</strong>: ä¹Ÿå°±æ˜¯ä»£ç ä¸­ä½¿ç”¨çš„ç­–ç•¥ï¼Œä¸€è·¯åŠ <strong>å†™é”</strong>ã€‚</li><li>è‹¥é‡åˆ°å®‰å…¨èŠ‚ç‚¹ï¼Œæ¸…ç©º <code>write_set_</code>ï¼ˆé‡Šæ”¾ç¥–å…ˆé”ï¼‰ã€‚</li></ul></li><li><p><strong>å¶å­æ’å…¥</strong>ï¼š</p><ul><li><strong>Case A: ä¹Ÿå°±æ˜¯æœªæ»¡</strong>ï¼šç›´æ¥ <code>leaf_page-&gt;Insert</code>ï¼ŒæˆåŠŸåè¿”å›ã€‚</li><li><strong>Case B: å¶å­å·²æ»¡ (Split)</strong>ï¼š</li></ul></li><li><p>åˆ›å»ºæ–°å¶å­é¡µ <code>NewPageGuarded</code>ã€‚</p></li><li><p><code>MoveHalfTo</code>: å°†ä¸€åŠæ•°æ®ç§»åˆ°æ–°é¡µã€‚</p></li><li><p>æ›´æ–°é“¾è¡¨ <code>next_page_id</code>ã€‚</p></li><li><p><strong>å‘ä¸Šé€’å½’</strong>ï¼šè°ƒç”¨ <code>InsertIntoParent</code> å°†ä¸­é—´ Key (<code>mid_key</code>) æ’å…¥çˆ¶èŠ‚ç‚¹ã€‚</p></li><li><p><strong>çˆ¶èŠ‚ç‚¹æ’å…¥ (<code>InsertIntoParent</code>)</strong>:</p><ul><li>å¦‚æœçˆ¶èŠ‚ç‚¹æœªæ»¡ï¼šç›´æ¥æ’å…¥ï¼Œç»“æŸã€‚</li><li>å¦‚æœçˆ¶èŠ‚ç‚¹å·²æ»¡ï¼š<ol><li>åˆ†è£‚çˆ¶èŠ‚ç‚¹ï¼ˆInternal Page Splitï¼‰ã€‚</li><li>æ³¨æ„ï¼šInternal Split ä¼šå°†ä¸­é—´ Key <strong>ææ‹”</strong> åˆ°æ›´ä¸Šä¸€å±‚ï¼Œè€Œä¸æ˜¯åƒ Leaf é‚£æ ·å¤åˆ¶ã€‚</li><li>é€’å½’è°ƒç”¨ <code>InsertIntoParent</code> ç›´åˆ°æ ¹èŠ‚ç‚¹ã€‚</li></ol></li></ul></li></ol><ul><li><strong>æ ¹åˆ†è£‚</strong>ï¼šå¦‚æœæ ¹èŠ‚ç‚¹åˆ†è£‚ï¼Œåˆ›å»ºæ–°çš„ Rootï¼Œæ›´æ–° Header Page çš„ <code>root_page_id</code>ã€‚</li></ul><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/Insert.png" alt="æ’å…¥æ“ä½œ" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h3 id="4-3-åˆ é™¤æ“ä½œ-Remove"><a href="#4-3-åˆ é™¤æ“ä½œ-Remove" class="headerlink" title="4.3 åˆ é™¤æ“ä½œ (Remove)"></a>4.3 åˆ é™¤æ“ä½œ (<code>Remove</code>)</h3><p>è¿™æ˜¯æœ€å¤æ‚çš„é€»è¾‘ã€‚</p><ol><li><strong>å®šä½å¹¶é”å®š</strong>ï¼šè°ƒç”¨ <code>DeleteGetKeyAt</code>ï¼Œä¸€è·¯åŠ å†™é”ï¼Œå¦‚æœèŠ‚ç‚¹å®‰å…¨ï¼ˆåˆ é™¤ä¸€ä¸ªå…ƒç´ åä»å¤§äº MinSizeï¼‰ï¼Œåˆ™é‡Šæ”¾ç¥–å…ˆé”ã€‚</li><li><strong>å¶å­åˆ é™¤</strong>ï¼šè°ƒç”¨ <code>leaf_page-&gt;RemoveKeyAt</code>ã€‚</li><li><strong>å¤„ç†ä¸‹æº¢ (Underflow)</strong>ï¼šå¦‚æœåˆ é™¤å <code>Size &lt; MinSize</code>ï¼Œéœ€è¦è°ƒæ•´ã€‚</li></ol><ul><li><p>è·å–å…„å¼ŸèŠ‚ç‚¹ï¼šè°ƒç”¨ <code>GetSiblingPageId</code>ã€‚ä¼˜å…ˆæ‰¾å·¦å…„å¼Ÿï¼Œæ²¡æœ‰åˆ™æ‰¾å³å…„å¼Ÿã€‚</p></li><li><p><strong>ç­–ç•¥ 1ï¼šå€Ÿè°ƒ (Redistribute &#x2F; Borrow)</strong>ï¼š</p><ul><li>å¦‚æœå…„å¼ŸèŠ‚ç‚¹æœ‰å¤šä½™çš„é”® (<code>Size &gt; MinSize</code>)ã€‚</li><li><strong>ä»å…„å¼Ÿå€Ÿä¸€ä¸ª</strong>ï¼šå¦‚æœæ˜¯å·¦å…„å¼Ÿï¼Œå€Ÿæœ€å¤§çš„ï¼›å³å…„å¼Ÿï¼Œå€Ÿæœ€å°çš„ã€‚</li><li><strong>æ›´æ–°çˆ¶èŠ‚ç‚¹</strong>ï¼šå€Ÿè°ƒåï¼Œçˆ¶èŠ‚ç‚¹çš„åˆ†éš” Key éœ€è¦æ›´æ–°ï¼ˆ<code>ReplaceKeyAt</code>ï¼‰ã€‚</li></ul></li><li><p><strong>ç­–ç•¥ 2ï¼šåˆå¹¶ (Merge &#x2F; Coalesce)</strong>ï¼š</p><ul><li><p>å¦‚æœå…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ˜¯åˆšè¿‡åŠæ ¼çº¿ï¼Œä¸å¤Ÿå€Ÿã€‚</p></li><li><p>å°†å½“å‰èŠ‚ç‚¹å’Œå…„å¼ŸèŠ‚ç‚¹åˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹ã€‚</p></li><li><p><strong>æ ‡è®°åˆ é™¤</strong>ï¼šå°†å…¶ä¸­ä¸€ä¸ªé¡µé¢æ ‡è®°ä¸ºåˆ é™¤ (<code>bpm_-&gt;DeletePage</code>)ã€‚</p></li><li><p><strong>é€’å½’åˆ é™¤</strong>ï¼šåˆå¹¶å¯¼è‡´çˆ¶èŠ‚ç‚¹å°‘äº†ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨çˆ¶èŠ‚ç‚¹ä¸­åˆ é™¤å¯¹åº”çš„ Key å’Œ Pointerã€‚è¿™å¯èƒ½è§¦å‘çˆ¶èŠ‚ç‚¹çš„é€’å½’åˆå¹¶ã€‚</p></li><li><p><strong>æ ¹èŠ‚ç‚¹å¤„ç†</strong>ï¼šå¦‚æœæ ¹èŠ‚ç‚¹è¢«åˆ ç©ºï¼Œæˆ–è€… Internal ç±»å‹çš„æ ¹èŠ‚ç‚¹åªå‰© 1 ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™å°†è¯¥å­èŠ‚ç‚¹è®¾ä¸ºæ–°æ ¹ï¼ˆæ ‘å±‚é«˜ -1ï¼‰ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/Remove.png" alt="æ“ä½œ" style="display: block; margin: 0 auto; width: 70%; height:70%;"><hr><h2 id="5-è¿­ä»£å™¨-IndexIterator-æ–‡ä»¶ï¼šindex-iterator-cpp"><a href="#5-è¿­ä»£å™¨-IndexIterator-æ–‡ä»¶ï¼šindex-iterator-cpp" class="headerlink" title="5. è¿­ä»£å™¨ (IndexIterator)æ–‡ä»¶ï¼šindex_iterator.cpp"></a>5. è¿­ä»£å™¨ (<code>IndexIterator</code>)æ–‡ä»¶ï¼š<code>index_iterator.cpp</code></h2><ul><li><p><strong>å®ç°æ ‡å‡†</strong>ï¼šå®ç°äº† C++ STL é£æ ¼çš„è¿­ä»£å™¨ï¼Œæ”¯æŒ <code>begin()</code>, <code>end()</code>, <code>++</code>, <code>*</code>, <code>==</code>ã€‚</p></li><li><p><strong>çŠ¶æ€ä¿æŒ</strong>ï¼š</p><ul><li><code>B_PLUS_TREE_LEAF_PAGE_TYPE *page_</code>: å½“å‰æ‰€åœ¨çš„å¶å­é¡µæŒ‡é’ˆã€‚</li><li><code>int index_</code>: å½“å‰åœ¨å¶å­é¡µä¸­çš„ä¸‹æ ‡ã€‚</li><li><code>ReadPageGuard page_guard_</code>: <strong>å…³é”®</strong>ã€‚è¿­ä»£å™¨æŒæœ‰å½“å‰é¡µé¢çš„è¯»é”ã€‚</li></ul></li><li><p><strong>è·¨é¡µéå† (<code>operator++</code>)</strong>:</p><ul><li>å½“ <code>index_</code> è¾¾åˆ°å½“å‰é¡µæœ«å°¾æ—¶ï¼Œé€šè¿‡ <code>page_-&gt;GetNextPageId()</code> è·å–ä¸‹ä¸€é¡µ IDã€‚</li></ul></li><li><p><strong>é”äº¤æ¥</strong>ï¼šå…ˆè·å–ä¸‹ä¸€é¡µçš„é”ï¼Œå†é‡Šæ”¾å½“å‰é¡µçš„é”ï¼ˆé€šè¿‡ Guard çš„ç§»åŠ¨èµ‹å€¼è‡ªåŠ¨å¤„ç†ï¼‰ï¼Œä¿è¯å¹¶å‘æ‰«æçš„å®‰å…¨æ€§ã€‚</p></li></ul><hr><h2 id="6-æ€»ç»“è¯¥é¡¹ç›®é€šè¿‡ä¸‰ä¸ªå±‚æ¬¡å®ç°äº†é«˜æ€§èƒ½ç´¢å¼•ï¼š"><a href="#6-æ€»ç»“è¯¥é¡¹ç›®é€šè¿‡ä¸‰ä¸ªå±‚æ¬¡å®ç°äº†é«˜æ€§èƒ½ç´¢å¼•ï¼š" class="headerlink" title="6. æ€»ç»“è¯¥é¡¹ç›®é€šè¿‡ä¸‰ä¸ªå±‚æ¬¡å®ç°äº†é«˜æ€§èƒ½ç´¢å¼•ï¼š"></a>6. æ€»ç»“è¯¥é¡¹ç›®é€šè¿‡ä¸‰ä¸ªå±‚æ¬¡å®ç°äº†é«˜æ€§èƒ½ç´¢å¼•ï¼š</h2><ol><li><strong>å­˜å‚¨å±‚</strong>ï¼šç²¾å¿ƒè®¾è®¡çš„ Internal&#x2F;Leaf Page å¸ƒå±€ï¼Œåˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–é¡µå†…æœç´¢ã€‚</li><li><strong>é€»è¾‘å±‚</strong>ï¼šå®Œæ•´çš„ Split (è‡ªåº•å‘ä¸Šç”Ÿé•¿) å’Œ Merge (è‡ªåº•å‘ä¸Šæ”¶ç¼©) ç®—æ³•ï¼Œç»´æŒ B+ æ ‘å¹³è¡¡ç‰¹æ€§ã€‚</li><li><strong>æ§åˆ¶å±‚</strong>ï¼šä½¿ç”¨ <code>PageGuard</code> å’Œ <code>Context</code> å®ç° Latch Crabbingï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹æœ€å¤§åŒ–å¹¶å‘åº¦ã€‚</li></ol><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</strong></p><img src="/img/CMU15-445-Bustub-project2å®ç°ç¬”è®°/result.png" alt="ç»“æœ" style="display: block; margin: 0 auto; width: 70%; height:70%;">]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Bustub</tag>
      
      <tag>B+Tree</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GDBå‘½ä»¤å¤§å…¨</title>
    <link href="/2025/11/26/GDB%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/"/>
    <url>/2025/11/26/GDB%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="GDB-å‘½ä»¤å¤§å…¨ï¼ˆè¶…å…¨ç‰ˆï¼‰"><a href="#GDB-å‘½ä»¤å¤§å…¨ï¼ˆè¶…å…¨ç‰ˆï¼‰" class="headerlink" title="GDB å‘½ä»¤å¤§å…¨ï¼ˆè¶…å…¨ç‰ˆï¼‰"></a>GDB å‘½ä»¤å¤§å…¨ï¼ˆè¶…å…¨ç‰ˆï¼‰</h1><h2 id="ä¸€ã€å¯åŠ¨ä¸é€€å‡º"><a href="#ä¸€ã€å¯åŠ¨ä¸é€€å‡º" class="headerlink" title="ä¸€ã€å¯åŠ¨ä¸é€€å‡º"></a>ä¸€ã€å¯åŠ¨ä¸é€€å‡º</h2><ul><li><p><code>gdb &lt;program&gt;</code><br>å¯åŠ¨ GDB å¹¶åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li><li><p><code>gdb &lt;program&gt; &lt;core&gt;</code><br>è°ƒè¯• core dump æ–‡ä»¶ã€‚</p></li><li><p><code>gdb -tui &lt;program&gt;</code><br>ä½¿ç”¨ TUI æ¨¡å¼ï¼ˆåˆ†å±æ˜¾ç¤ºä»£ç å’Œè°ƒè¯•ä¿¡æ¯ï¼‰ã€‚</p></li><li><p><code>file &lt;program&gt;</code><br>åœ¨ GDB å†…åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li><li><p><code>quit</code> &#x2F; <code>q</code><br>é€€å‡º GDBã€‚</p></li></ul><hr><h2 id="äºŒã€è¿è¡Œä¸è¿›ç¨‹æ§åˆ¶"><a href="#äºŒã€è¿è¡Œä¸è¿›ç¨‹æ§åˆ¶" class="headerlink" title="äºŒã€è¿è¡Œä¸è¿›ç¨‹æ§åˆ¶"></a>äºŒã€è¿è¡Œä¸è¿›ç¨‹æ§åˆ¶</h2><ul><li><p><code>run</code> &#x2F; <code>r</code><br>è¿è¡Œç¨‹åºï¼ˆå¯é™„å¸¦å‚æ•°ï¼‰ã€‚</p></li><li><p><code>run arg1 arg2</code><br>è¿è¡Œç¨‹åºå¹¶ä¼ å‚ã€‚</p></li><li><p><code>set args arg1 arg2</code><br>è®¾ç½®ç¨‹åºè¿è¡Œæ—¶çš„é»˜è®¤å‚æ•°ã€‚</p></li><li><p><code>show args</code><br>æŸ¥çœ‹å½“å‰å‚æ•°è®¾ç½®ã€‚</p></li><li><p><code>attach &lt;pid&gt;</code><br>é™„åŠ è°ƒè¯•æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚</p></li><li><p><code>detach</code><br>ä»è¿›ç¨‹åˆ†ç¦»ï¼Œä¸ç»ˆæ­¢ç¨‹åºã€‚</p></li><li><p><code>kill</code><br>ç»ˆæ­¢æ­£åœ¨è°ƒè¯•çš„ç¨‹åºã€‚</p></li></ul><hr><h2 id="ä¸‰ã€æ–­ç‚¹ï¼ˆBreakpointsï¼‰"><a href="#ä¸‰ã€æ–­ç‚¹ï¼ˆBreakpointsï¼‰" class="headerlink" title="ä¸‰ã€æ–­ç‚¹ï¼ˆBreakpointsï¼‰"></a>ä¸‰ã€æ–­ç‚¹ï¼ˆBreakpointsï¼‰</h2><h3 id="1-è®¾ç½®æ–­ç‚¹"><a href="#1-è®¾ç½®æ–­ç‚¹" class="headerlink" title="1. è®¾ç½®æ–­ç‚¹"></a>1. è®¾ç½®æ–­ç‚¹</h3><ul><li><p><code>break &lt;line&gt;</code> &#x2F; <code>b &lt;line&gt;</code><br>åœ¨æŒ‡å®šè¡Œè®¾ç½®æ–­ç‚¹ã€‚</p></li><li><p><code>break &lt;function&gt;</code><br>åœ¨å‡½æ•°å…¥å£å¤„è®¾ç½®æ–­ç‚¹ã€‚</p></li><li><p><code>break &lt;file:line&gt;</code><br>æŒ‡å®šæ–‡ä»¶ä¸­çš„æŸä¸€è¡Œæ–­ç‚¹ã€‚</p></li><li><p><code>break *&lt;address&gt;</code><br>åœ¨æŒ‡å®šå†…å­˜åœ°å€è®¾ç½®æ–­ç‚¹ã€‚</p></li><li><p><code>tbreak &lt;location&gt;</code><br>è®¾ç½®ä¸€æ¬¡æ€§æ–­ç‚¹ï¼ˆè§¦å‘ä¸€æ¬¡åè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚</p></li></ul><h3 id="2-æ¡ä»¶æ–­ç‚¹"><a href="#2-æ¡ä»¶æ–­ç‚¹" class="headerlink" title="2. æ¡ä»¶æ–­ç‚¹"></a>2. æ¡ä»¶æ–­ç‚¹</h3><ul><li><code>condition &lt;num&gt; &lt;expr&gt;</code><br>ç»™æ–­ç‚¹åŠ æ¡ä»¶ã€‚</li></ul><h3 id="3-ç®¡ç†æ–­ç‚¹"><a href="#3-ç®¡ç†æ–­ç‚¹" class="headerlink" title="3. ç®¡ç†æ–­ç‚¹"></a>3. ç®¡ç†æ–­ç‚¹</h3><ul><li><p><code>info breakpoints</code> &#x2F; <code>i b</code><br>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹ã€‚</p></li><li><p><code>delete &lt;num&gt;</code> &#x2F; <code>d &lt;num&gt;</code><br>åˆ é™¤æ–­ç‚¹ã€‚</p></li><li><p><code>disable &lt;num&gt;</code><br>ç¦ç”¨æ–­ç‚¹ã€‚</p></li><li><p><code>enable &lt;num&gt;</code><br>å¯ç”¨æ–­ç‚¹ã€‚</p></li></ul><hr><h2 id="å››ã€ç¨‹åºæ‰§è¡Œæ§åˆ¶"><a href="#å››ã€ç¨‹åºæ‰§è¡Œæ§åˆ¶" class="headerlink" title="å››ã€ç¨‹åºæ‰§è¡Œæ§åˆ¶"></a>å››ã€ç¨‹åºæ‰§è¡Œæ§åˆ¶</h2><ul><li><p><code>continue</code> &#x2F; <code>c</code><br>æ¢å¤æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚</p></li><li><p><code>next</code> &#x2F; <code>n</code><br>å•æ­¥æ‰§è¡Œï¼ˆä¸è¿›å…¥å‡½æ•°ï¼‰ã€‚</p></li><li><p><code>step</code> &#x2F; <code>s</code><br>å•æ­¥æ‰§è¡Œï¼ˆä¼šè¿›å…¥å‡½æ•°ï¼‰ã€‚</p></li><li><p><code>finish</code><br>æ‰§è¡Œç›´åˆ°å½“å‰å‡½æ•°è¿”å›ã€‚</p></li><li><p><code>until</code><br>è¿è¡Œç›´åˆ°å½“å‰å¾ªç¯æˆ–å‡½æ•°çš„ä¸‹ä¸€è¡Œã€‚</p></li><li><p><code>jump &lt;line/address&gt;</code><br>å¼ºåˆ¶è·³è½¬åˆ°æŸè¡Œæˆ–æŸåœ°å€ã€‚</p></li></ul><hr><h2 id="äº”ã€æŸ¥çœ‹æºç "><a href="#äº”ã€æŸ¥çœ‹æºç " class="headerlink" title="äº”ã€æŸ¥çœ‹æºç "></a>äº”ã€æŸ¥çœ‹æºç </h2><ul><li><p><code>list</code> &#x2F; <code>l</code><br>æŸ¥çœ‹æºç ï¼ˆæ¯æ¬¡æ˜¾ç¤º 10 è¡Œï¼‰ã€‚</p></li><li><p><code>list &lt;line&gt;</code><br>æŸ¥çœ‹ç‰¹å®šè¡Œé™„è¿‘çš„ä»£ç ã€‚</p></li><li><p><code>list &lt;function&gt;</code><br>æ˜¾ç¤ºæŸå‡½æ•°ä»£ç ã€‚</p></li><li><p>é‡å¤ <code>list</code><br>æ˜¾ç¤ºä¸‹ä¸€æ®µä»£ç ã€‚</p></li></ul><hr><h2 id="å…­ã€æŸ¥çœ‹æ ˆä¸è°ƒç”¨ä¿¡æ¯"><a href="#å…­ã€æŸ¥çœ‹æ ˆä¸è°ƒç”¨ä¿¡æ¯" class="headerlink" title="å…­ã€æŸ¥çœ‹æ ˆä¸è°ƒç”¨ä¿¡æ¯"></a>å…­ã€æŸ¥çœ‹æ ˆä¸è°ƒç”¨ä¿¡æ¯</h2><ul><li><p><code>backtrace</code> &#x2F; <code>bt</code><br>æ‰“å°è°ƒç”¨æ ˆã€‚</p></li><li><p><code>backtrace full</code><br>æ‰“å°è°ƒç”¨æ ˆå’Œæ¯ä¸€å¸§çš„å±€éƒ¨å˜é‡ã€‚</p></li><li><p><code>frame &lt;num&gt;</code> &#x2F; <code>f &lt;num&gt;</code><br>åˆ‡æ¢åˆ°æŒ‡å®šæ ˆå¸§ã€‚</p></li><li><p><code>up</code><br>åˆ‡æ¢åˆ°ä¸Šå±‚æ ˆå¸§ã€‚</p></li><li><p><code>down</code><br>åˆ‡æ¢åˆ°ä¸‹å±‚æ ˆå¸§ã€‚</p></li><li><p><code>info args</code><br>æ˜¾ç¤ºå½“å‰å‡½æ•°çš„å‚æ•°ã€‚</p></li><li><p><code>info locals</code><br>æ˜¾ç¤ºå½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</p></li></ul><hr><h2 id="ä¸ƒã€æ‰“å°å˜é‡-å†…å­˜-ç±»å‹"><a href="#ä¸ƒã€æ‰“å°å˜é‡-å†…å­˜-ç±»å‹" class="headerlink" title="ä¸ƒã€æ‰“å°å˜é‡ &#x2F; å†…å­˜ &#x2F; ç±»å‹"></a>ä¸ƒã€æ‰“å°å˜é‡ &#x2F; å†…å­˜ &#x2F; ç±»å‹</h2><h3 id="1-æ‰“å°å˜é‡"><a href="#1-æ‰“å°å˜é‡" class="headerlink" title="1. æ‰“å°å˜é‡"></a>1. æ‰“å°å˜é‡</h3><ul><li><p><code>print &lt;expr&gt;</code> &#x2F; <code>p &lt;expr&gt;</code><br>æ‰“å°å˜é‡æˆ–è¡¨è¾¾å¼å€¼ã€‚</p></li><li><p><code>p /x &lt;expr&gt;</code><br>ä»¥åå…­è¿›åˆ¶æ‰“å°ã€‚</p></li><li><p><code>display &lt;expr&gt;</code><br>æ¯æ¬¡å•æ­¥åè‡ªåŠ¨æ˜¾ç¤ºè¡¨è¾¾å¼ã€‚</p></li><li><p><code>undisplay &lt;num&gt;</code><br>åˆ é™¤è‡ªåŠ¨æ˜¾ç¤ºé¡¹ã€‚</p></li></ul><h3 id="2-æŸ¥çœ‹å†…å­˜ï¼ˆx-å‘½ä»¤ï¼‰"><a href="#2-æŸ¥çœ‹å†…å­˜ï¼ˆx-å‘½ä»¤ï¼‰" class="headerlink" title="2. æŸ¥çœ‹å†…å­˜ï¼ˆx å‘½ä»¤ï¼‰"></a>2. æŸ¥çœ‹å†…å­˜ï¼ˆx å‘½ä»¤ï¼‰</h3><p>æ ¼å¼ï¼š <code>x /&lt;n&gt;&lt;format&gt;&lt;size&gt; &lt;address&gt;</code></p><p>å¸¸ç”¨æ ¼å¼ï¼š</p><ul><li><code>x/10xb &lt;addr&gt;</code> â€” æŸ¥çœ‹ 10 ä¸ªå­—èŠ‚ï¼ˆhexï¼‰</li><li><code>x/4i &lt;addr&gt;</code> â€” åæ±‡ç¼– 4 æ¡æŒ‡ä»¤</li><li><code>x/20xw &lt;addr&gt;</code> â€” æŸ¥çœ‹ 20 ä¸ª 4 å­—èŠ‚å­—(word)</li></ul><h3 id="3-æŸ¥çœ‹ç±»å‹"><a href="#3-æŸ¥çœ‹ç±»å‹" class="headerlink" title="3. æŸ¥çœ‹ç±»å‹"></a>3. æŸ¥çœ‹ç±»å‹</h3><ul><li><p><code>ptype &lt;var&gt;</code><br>æ˜¾ç¤ºå˜é‡ç±»å‹ã€‚</p></li><li><p><code>whatis &lt;expr&gt;</code><br>æ˜¾ç¤ºè¡¨è¾¾å¼ç±»å‹ã€‚</p></li></ul><hr><h2 id="å…«ã€å¯„å­˜å™¨å’Œæ±‡ç¼–çº§è°ƒè¯•ï¼ˆé‡è¦ï¼‰"><a href="#å…«ã€å¯„å­˜å™¨å’Œæ±‡ç¼–çº§è°ƒè¯•ï¼ˆé‡è¦ï¼‰" class="headerlink" title="å…«ã€å¯„å­˜å™¨å’Œæ±‡ç¼–çº§è°ƒè¯•ï¼ˆé‡è¦ï¼‰"></a>å…«ã€å¯„å­˜å™¨å’Œæ±‡ç¼–çº§è°ƒè¯•ï¼ˆé‡è¦ï¼‰</h2><h3 id="1-æ±‡ç¼–çº§å•æ­¥"><a href="#1-æ±‡ç¼–çº§å•æ­¥" class="headerlink" title="1. æ±‡ç¼–çº§å•æ­¥"></a>1. æ±‡ç¼–çº§å•æ­¥</h3><ul><li><p><code>stepi</code> &#x2F; <code>si</code><br>æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ã€‚</p></li><li><p><code>nexti</code> &#x2F; <code>ni</code><br>è·³è¿‡å‡½æ•°æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ã€‚</p></li></ul><h3 id="2-æŸ¥çœ‹æ±‡ç¼–"><a href="#2-æŸ¥çœ‹æ±‡ç¼–" class="headerlink" title="2. æŸ¥çœ‹æ±‡ç¼–"></a>2. æŸ¥çœ‹æ±‡ç¼–</h3><ul><li><p><code>disassemble</code><br>åæ±‡ç¼–å½“å‰å‡½æ•°ã€‚</p></li><li><p><code>disassemble &lt;address&gt;</code><br>åæ±‡ç¼–æŒ‡å®šåœ°å€èŒƒå›´ã€‚</p></li></ul><h3 id="3-å¯„å­˜å™¨"><a href="#3-å¯„å­˜å™¨" class="headerlink" title="3. å¯„å­˜å™¨"></a>3. å¯„å­˜å™¨</h3><ul><li><p><code>info registers</code><br>æŸ¥çœ‹æ‰€æœ‰å¯„å­˜å™¨ã€‚</p></li><li><p><code>p $rax</code><br>æ‰“å°å¯„å­˜å™¨ï¼ˆå¦‚ x86_64 çš„ raxï¼‰ã€‚</p></li></ul><hr><h2 id="ä¹ã€çº¿ç¨‹è°ƒè¯•ï¼ˆå¤šçº¿ç¨‹ç¨‹åºï¼‰"><a href="#ä¹ã€çº¿ç¨‹è°ƒè¯•ï¼ˆå¤šçº¿ç¨‹ç¨‹åºï¼‰" class="headerlink" title="ä¹ã€çº¿ç¨‹è°ƒè¯•ï¼ˆå¤šçº¿ç¨‹ç¨‹åºï¼‰"></a>ä¹ã€çº¿ç¨‹è°ƒè¯•ï¼ˆå¤šçº¿ç¨‹ç¨‹åºï¼‰</h2><ul><li><p><code>info threads</code><br>æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ã€‚</p></li><li><p><code>thread &lt;id&gt;</code><br>åˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹ã€‚</p></li><li><p><code>thread apply all &lt;cmd&gt;</code><br>å¯¹æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå‘½ä»¤ã€‚</p></li><li><p><code>thread apply &lt;id&gt; &lt;cmd&gt;</code><br>åªå¯¹æŸçº¿ç¨‹æ‰§è¡Œå‘½ä»¤ã€‚</p></li></ul><hr><h2 id="åã€å¤šè¿›ç¨‹ï¼ˆfork-execï¼‰"><a href="#åã€å¤šè¿›ç¨‹ï¼ˆfork-execï¼‰" class="headerlink" title="åã€å¤šè¿›ç¨‹ï¼ˆfork &#x2F; execï¼‰"></a>åã€å¤šè¿›ç¨‹ï¼ˆfork &#x2F; execï¼‰</h2><ul><li><p><code>set follow-fork-mode child|parent</code><br>è®¾ç½®è°ƒè¯• fork åè·Ÿè¸ªè°ã€‚</p></li><li><p><code>set detach-on-fork on|off</code><br>æ§åˆ¶æ˜¯å¦åŒæ—¶è°ƒè¯•ä¸¤è¿›ç¨‹ã€‚</p></li><li><p><code>info inferiors</code><br>æŸ¥çœ‹å½“å‰æ‰€æœ‰è¢«è°ƒè¯•çš„è¿›ç¨‹ã€‚</p></li><li><p><code>inferior &lt;id&gt;</code><br>åˆ‡æ¢å½“å‰è¿›ç¨‹ã€‚</p></li></ul><hr><h2 id="åä¸€ã€Watchpointï¼ˆç›‘è§†å˜é‡ï¼‰"><a href="#åä¸€ã€Watchpointï¼ˆç›‘è§†å˜é‡ï¼‰" class="headerlink" title="åä¸€ã€Watchpointï¼ˆç›‘è§†å˜é‡ï¼‰"></a>åä¸€ã€Watchpointï¼ˆç›‘è§†å˜é‡ï¼‰</h2><ul><li><p><code>watch &lt;expr&gt;</code><br>å½“è¡¨è¾¾å¼çš„å€¼å‘ç”Ÿå˜åŒ–åœæ­¢ã€‚</p></li><li><p><code>rwatch &lt;expr&gt;</code><br>è¯»è¡¨è¾¾å¼æ—¶åœæ­¢ã€‚</p></li><li><p><code>awatch &lt;expr&gt;</code><br>è¯»å†™ä»»ä½•è®¿é—®éƒ½åœæ­¢ã€‚</p></li><li><p><code>info watchpoints</code><br>æŸ¥çœ‹æ‰€æœ‰ watchpointsã€‚</p></li></ul><hr><h2 id="åäºŒã€è„šæœ¬-è‡ªåŠ¨åŒ–"><a href="#åäºŒã€è„šæœ¬-è‡ªåŠ¨åŒ–" class="headerlink" title="åäºŒã€è„šæœ¬ &#x2F; è‡ªåŠ¨åŒ–"></a>åäºŒã€è„šæœ¬ &#x2F; è‡ªåŠ¨åŒ–</h2><ul><li><p><code>source &lt;file&gt;</code><br>è¿è¡Œä¸€ç»„ GDB å‘½ä»¤ï¼ˆè„šæœ¬ï¼‰ã€‚</p></li><li><p><code>.gdbinit</code><br>åœ¨å½“å‰ç›®å½•æˆ–ä¸»ç›®å½•ä¸‹è‡ªåŠ¨æ‰§è¡Œã€‚</p></li></ul><hr><h2 id="åä¸‰ã€å…¶ä»–å¸¸ç”¨å‘½ä»¤"><a href="#åä¸‰ã€å…¶ä»–å¸¸ç”¨å‘½ä»¤" class="headerlink" title="åä¸‰ã€å…¶ä»–å¸¸ç”¨å‘½ä»¤"></a>åä¸‰ã€å…¶ä»–å¸¸ç”¨å‘½ä»¤</h2><ul><li><p><code>help</code><br>æ˜¾ç¤ºå¸®åŠ©ã€‚</p></li><li><p><code>help &lt;command&gt;</code><br>æŸ¥çœ‹æŸå‘½ä»¤å¸®åŠ©ã€‚</p></li><li><p><code>set pagination off</code><br>å…³é—­åˆ†é¡µæ˜¾ç¤ºï¼ˆæ‰“å°é•¿è¾“å‡ºä¸éœ€æŒ‰å›è½¦ï¼‰ã€‚</p></li><li><p><code>set print pretty on</code><br>æ ¼å¼åŒ–è¾“å‡ºç»“æ„ä½“å†…å®¹ã€‚</p></li><li><p><code>info functions</code><br>æ˜¾ç¤ºæ‰€æœ‰å‡½æ•°åˆ—è¡¨ã€‚</p></li><li><p><code>info variables</code><br>æ˜¾ç¤ºæ‰€æœ‰å…¨å±€å˜é‡ã€‚</p></li></ul><hr>]]></content>
    
    
    <categories>
      
      <category>GDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GDB</tag>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Anacondaçš„ä½¿ç”¨</title>
    <link href="/2025/11/10/Anaconda%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/11/10/Anaconda%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="æ ¸å¿ƒåŸç†"><a href="#æ ¸å¿ƒåŸç†" class="headerlink" title="æ ¸å¿ƒåŸç†"></a>æ ¸å¿ƒåŸç†</h2><p>Anaconda çš„è¿ä½œä¸»è¦åŸºäºä»¥ä¸‹ä¸¤ä¸ªæ ¸å¿ƒæœºåˆ¶ï¼š</p><ul><li><strong>ç¯å¢ƒéš”ç¦»</strong></li></ul><p>Anaconda é€šè¿‡åˆ›å»ºç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒæ¥å®ç°éš”ç¦»ã€‚æ¯ä¸ªç¯å¢ƒéƒ½æ‹¥æœ‰è‡ªå·±çš„ Python è§£é‡Šå™¨ã€ä¾èµ–åŒ…ä»¥åŠå…¶å„è‡ªçš„å®‰è£…è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ anaconda3&#x2F;envs&#x2F;ä½ çš„ç¯å¢ƒåç§°&#x2F;ç›®å½•ï¼‰ã€‚å½“ä½ åˆ‡æ¢ç¯å¢ƒæ—¶ï¼ŒAnaconda ä¼šé€šè¿‡è°ƒæ•´ç³»ç»Ÿçš„ PATH ç­‰ç¯å¢ƒå˜é‡ï¼Œæ¥ç¡®ä¿å‘½ä»¤æŒ‡å‘çš„æ˜¯å½“å‰æ´»è·ƒç¯å¢ƒä¸­çš„æ­£ç¡®ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šä¸ºä¸åŒçš„é¡¹ç›®ç»´æŠ¤å¤šä¸ªäº’ä¸å¹²æ‰°çš„ç‹¬ç«‹ç¯å¢ƒï¼Œä¾‹å¦‚ä¸€ä¸ªä½¿ç”¨ Python 3.7 é…åˆ TensorFlow 1.x çš„ç¯å¢ƒï¼Œå’Œå¦ä¸€ä¸ªä½¿ç”¨ Python 3.9 é…åˆ TensorFlow 2.x çš„ç¯å¢ƒã€‚</p><ul><li><strong>åŒ…ç®¡ç†ä¸ç¼“å­˜æœºåˆ¶</strong></li></ul><p>Conda ä¸ä»…æ˜¯ç¯å¢ƒç®¡ç†å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŒ…ç®¡ç†å™¨ã€‚å®ƒä¼šè‡ªåŠ¨å¤„ç†è½¯ä»¶åŒ…ä¹‹é—´å¤æ‚çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å®‰è£…çš„æ‰€æœ‰åº“ç‰ˆæœ¬å…¼å®¹ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒConda åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªåŒ…ç¼“å­˜ç›®å½•ï¼ˆé€šå¸¸æ˜¯ anaconda3&#x2F;pkgs&#x2F;ï¼‰ã€‚å½“ä½ åœ¨æŸä¸ªç¯å¢ƒä¸­å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼ŒConda ä¼šå…ˆæ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­å­˜åœ¨ï¼Œåˆ™ç›´æ¥å°†å…¶é“¾æ¥æˆ–å¤åˆ¶åˆ°å½“å‰ç¯å¢ƒ site-packagesç›®å½•ä¸‹ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å…ˆä»ä»“åº“ä¸‹è½½åˆ°ç¼“å­˜ï¼Œå†è¿›è¡Œå®‰è£…ã€‚è¿™ç§æœºåˆ¶é¿å…äº†åœ¨ä¸åŒç¯å¢ƒä¸­é‡å¤ä¸‹è½½åŒä¸€ä¸ªåŒ…ï¼ŒèŠ‚çœäº†æ—¶é—´å’Œç£ç›˜ç©ºé—´ã€‚</p><h2 id="Conda-ä¸-Pip-çš„å¯¹æ¯”"><a href="#Conda-ä¸-Pip-çš„å¯¹æ¯”" class="headerlink" title="Conda ä¸ Pip çš„å¯¹æ¯”"></a>Conda ä¸ Pip çš„å¯¹æ¯”</h2><p>è™½ç„¶ Python è‡ªå¸¦çš„ pip ä¹Ÿèƒ½å®‰è£…åŒ…ï¼Œä½† Conda åœ¨ç®¡ç†ç§‘å­¦è®¡ç®—é¢†åŸŸçš„åº“æ—¶æ›´å…·ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é Python ä¾èµ–ï¼ˆå¦‚ C&#x2F;C++ åº“ï¼‰æ–¹é¢ã€‚ä¸ºäº†æ¸…æ™°åœ°å±•ç¤ºå®ƒä»¬çš„åŒºåˆ«ï¼Œè¯·çœ‹ä¸‹è¡¨ï¼š</p><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">conda</th><th align="left">pip</th></tr></thead><tbody><tr><td align="left">ç®¡ç†èŒƒå›´</td><td align="left">å¯ç®¡ç† Python åŒ…å’Œé Python ä¾èµ–ï¼ˆå¦‚ C åº“ï¼‰</td><td align="left">ä¸»è¦ç®¡ç†pythonåŒ…</td></tr><tr><td align="left">ç¯å¢ƒç®¡ç†</td><td align="left">å†…ç½®è™šæ‹Ÿç¯å¢ƒç®¡ç†åŠŸèƒ½</td><td align="left">ä¾èµ–virtualenv</td></tr><tr><td align="left">ä¾èµ–è§£å†³</td><td align="left">ä¸¥æ ¼çš„ä¾èµ–å…³ç³»æ£€æµ‹æœºåˆ¶</td><td align="left">ä¾èµ–è§£å†³èƒ½åŠ›å¼±</td></tr><tr><td align="left">åŒ…æ¥æº</td><td align="left">ä¸»è¦ä» Conda æ¸ é“ï¼ˆå¦‚ conda-forgeï¼‰å®‰è£…</td><td align="left">ä» Python Package Index (PyPI)å®‰è£…</td></tr></tbody></table><p>ä¸€ä¸ªé‡è¦çš„å»ºè®®æ˜¯ï¼š<strong>åœ¨åŒä¸€ä¸ªé¡¹ç›®ç¯å¢ƒä¸­ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ Conda å®‰è£…åŒ…</strong>ã€‚å¦‚æœæŸä¸ªåŒ…åœ¨ Conda æ¸ é“ä¸­æ‰¾ä¸åˆ°ï¼Œå†ä½¿ç”¨ pip å®‰è£…ï¼Œè¿™æœ‰åŠ©äºå‡å°‘æ½œåœ¨çš„ä¾èµ–å†²çªã€‚</p><h2 id="æ ¸å¿ƒç»„ä»¶ä¸å·¥ä½œæµç¨‹"><a href="#æ ¸å¿ƒç»„ä»¶ä¸å·¥ä½œæµç¨‹" class="headerlink" title="æ ¸å¿ƒç»„ä»¶ä¸å·¥ä½œæµç¨‹"></a>æ ¸å¿ƒç»„ä»¶ä¸å·¥ä½œæµç¨‹</h2><ul><li><p>Conda: è¿™æ˜¯ Anaconda çš„çµé­‚ï¼Œæ˜¯å‘½ä»¤è¡Œå·¥å…·çš„æ ¸å¿ƒã€‚ä½ é€šè¿‡å®ƒæ‰§è¡Œåˆ›å»ºç¯å¢ƒã€å®‰è£…åŒ…ç­‰æ‰€æœ‰æ“ä½œã€‚</p></li><li><p>Anaconda Navigator: è¿™æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–ç•Œé¢ï¼ˆGUIï¼‰ï¼Œä¸ºä¸ä¹ æƒ¯å‘½ä»¤è¡Œçš„ç”¨æˆ·æä¾›äº†ç›´è§‚çš„ç¯å¢ƒå’Œåº”ç”¨ç¨‹åºç®¡ç†æ–¹å¼ã€‚</p></li><li><p>å·¥ä½œæµç¨‹: å…¸å‹çš„å¼€å‘æµç¨‹æ˜¯ï¼šä½¿ç”¨ <strong>conda create -n ç¯å¢ƒå python&#x3D;ç‰ˆæœ¬å·åˆ›å»ºæ–°ç¯å¢ƒ</strong> -&gt; ä½¿ç”¨ <strong>conda activate ç¯å¢ƒåæ¿€æ´»ç¯å¢ƒ</strong> -&gt; åœ¨è¯¥ç¯å¢ƒä¸‹ä½¿ç”¨ <strong>conda install</strong>æˆ– pip installå®‰è£…æ‰€éœ€åŒ… -&gt; å¼€å§‹å¼€å‘å·¥ä½œã€‚</p></li></ul><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="ç¯å¢ƒç®¡ç†"><a href="#ç¯å¢ƒç®¡ç†" class="headerlink" title="ç¯å¢ƒç®¡ç†"></a>ç¯å¢ƒç®¡ç†</h3><p>è™šæ‹Ÿç¯å¢ƒæ˜¯ Anaconda çš„æ ¸å¿ƒï¼Œå®ƒå…è®¸ä½ ä¸ºä¸åŒé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„ã€äº’ä¸å¹²æ‰°çš„ Python è¿è¡Œç©ºé—´ã€‚</p><table><thead><tr><th align="left">æ“ä½œ</th><th align="left">å‘½ä»¤</th><th align="left">å¤‡æ³¨&amp;ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left">åˆ›å»ºç¯å¢ƒ</td><td align="left">conda create -n ç¯å¢ƒå [python&#x3D;ç‰ˆæœ¬å·] [åŒ…å]</td><td align="left">ä¾‹å¦‚ï¼šconda create -n my_project python&#x3D;3.9 numpy pandasä¼šåˆ›å»ºä¸€ä¸ªåä¸º my_projectã€Python ç‰ˆæœ¬ä¸º 3.9 å¹¶é¢„å®‰è£… numpy å’Œ pandas åŒ…çš„ç¯å¢ƒ</td></tr><tr><td align="left">æ¿€æ´»ç¯å¢ƒ</td><td align="left">conda activate ç¯å¢ƒå</td><td align="left">æ¿€æ´»åï¼Œå‘½ä»¤è¡Œçš„æç¤ºç¬¦å‰ä¼šæ˜¾ç¤ºå½“å‰ç¯å¢ƒåï¼Œå¦‚ (my_project)</td></tr><tr><td align="left">é€€å‡ºç¯å¢ƒ</td><td align="left">conda deactivate</td><td align="left">é€€å‡ºå½“å‰ç¯å¢ƒï¼Œå›åˆ°åŸºç¡€ï¼ˆbaseï¼‰ç¯å¢ƒ</td></tr><tr><td align="left">æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒ</td><td align="left">conda env listæˆ– conda info â€“envs</td><td align="left">åˆ—è¡¨ä¸­å¸¦æœ‰ *å·æ ‡è¯†çš„ä¸ºå½“å‰æ‰€åœ¨ç¯å¢ƒ</td></tr><tr><td align="left">åˆ é™¤ç¯å¢ƒ</td><td align="left">conda remove -n ç¯å¢ƒå â€“all</td><td align="left">è¿™ä¼šå½»åº•åˆ é™¤è¯¥ç¯å¢ƒåŠå…¶ä¸­å®‰è£…çš„æ‰€æœ‰åŒ…</td></tr><tr><td align="left">å…‹éš†ç¯å¢ƒ</td><td align="left">conda create -n æ–°ç¯å¢ƒå â€“clone è¢«å…‹éš†ç¯å¢ƒå</td><td align="left">å¿«é€Ÿå¤åˆ¶ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„ç¯å¢ƒï¼Œé€‚ç”¨äºå¤‡ä»½æˆ–åˆ›å»ºç›¸ä¼¼ç¯å¢ƒ</td></tr><tr><td align="left">å¯¼å‡ºç¯å¢ƒ</td><td align="left">conda env export â€“name ç¯å¢ƒå &gt; environment.yml</td><td align="left">å°†ç¯å¢ƒçš„è¯¦ç»†é…ç½®ï¼ˆåŒ…æ‹¬æ‰€æœ‰åŒ…çš„ç‰ˆæœ¬ï¼‰å¯¼å‡ºåˆ° YAML æ–‡ä»¶ï¼Œä¾¿äºå…±äº«å’Œå¤ç°</td></tr><tr><td align="left">å¯¼å…¥ç¯å¢ƒ</td><td align="left">conda env create -f environment.yml</td><td align="left">æ ¹æ® YAML æ–‡ä»¶å¿«é€Ÿåˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç¯å¢ƒ</td></tr></tbody></table><h3 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h3><table><thead><tr><th align="left">æ“ä½œ</th><th align="left">å‘½ä»¤</th><th align="left">å¤‡æ³¨&amp;ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left">å®‰è£…åŒ…</td><td align="left">conda install åŒ…å[&#x3D;ç‰ˆæœ¬å·]</td><td align="left">ä¾‹å¦‚ï¼šconda install numpy&#x3D;1.21ä¼šå®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ numpyã€‚å¯ä»¥åŒæ—¶å®‰è£…å¤šä¸ªåŒ…ï¼Œç”¨ç©ºæ ¼éš”å¼€</td></tr><tr><td align="left">ä»ç‰¹å®šæ¸ é“å®‰è£…</td><td align="left">conda install åŒ…å -c æ¸ é“å</td><td align="left">ä¾‹å¦‚ä» conda-forgeç¤¾åŒºå®‰è£…ï¼šconda install pkg_name -c conda_forge</td></tr><tr><td align="left">ä½¿ç”¨ pip å®‰è£…</td><td align="left">pip install åŒ…å&#x3D;&#x3D;ç‰ˆæœ¬å·</td><td align="left">å½“æŸä¸ªåŒ…æ— æ³•é€šè¿‡ conda å®‰è£…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ pip ä½œä¸ºè¡¥å……ã€‚æ³¨æ„ï¼šå»ºè®®åœ¨åŒä¸€ä¸ªç¯å¢ƒä¸­ä¼˜å…ˆä½¿ç”¨ condaï¼Œæ··åˆä½¿ç”¨ conda å’Œ pip å¯èƒ½å¯¼è‡´ä¾èµ–å†²çª</td></tr><tr><td align="left">æŸ¥çœ‹å·²å®‰è£…åŒ…</td><td align="left">conda list</td><td align="left">åˆ—å‡ºå½“å‰ç¯å¢ƒä¸­æ‰€æœ‰å·²å®‰è£…çš„åŒ…ã€‚</td></tr><tr><td align="left">æœç´¢åŒ…</td><td align="left">conda search æœç´¢è¯</td><td align="left">æŸ¥çœ‹å¯ä¾›å®‰è£…çš„åŒ…ç‰ˆæœ¬ã€‚</td></tr><tr><td align="left">æ›´æ–°åŒ…</td><td align="left">conda update åŒ…å</td><td align="left">æ›´æ–°å•ä¸ªåŒ…ã€‚ä½¿ç”¨ conda update â€“allå¯ä»¥æ›´æ–°ç¯å¢ƒä¸­çš„æ‰€æœ‰åŒ…ã€‚</td></tr><tr><td align="left">å¸è½½åŒ…</td><td align="left">conda remove åŒ…å</td><td align="left">ä»å½“å‰ç¯å¢ƒä¸­ç§»é™¤æŒ‡å®šçš„åŒ…</td></tr></tbody></table><h3 id="é…ç½®ä¸ç»´æŠ¤"><a href="#é…ç½®ä¸ç»´æŠ¤" class="headerlink" title="é…ç½®ä¸ç»´æŠ¤"></a>é…ç½®ä¸ç»´æŠ¤</h3><table><thead><tr><th align="left">æ“ä½œ</th><th align="left">å‘½ä»¤</th><th align="left">å¤‡æ³¨&amp;ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left">æŸ¥çœ‹ Conda ä¿¡æ¯</td><td align="left">conda â€“version</td><td align="left">æŸ¥çœ‹ Conda ç‰ˆæœ¬</td></tr><tr><td align="left">æ›´æ–° Conda</td><td align="left">conda update conda</td><td align="left">å°† Conda è‡ªèº«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬</td></tr><tr><td align="left">é…ç½®é•œåƒæº</td><td align="left">æ·»åŠ ï¼šconda config â€“add channels é•œåƒåœ°å€</td><td align="left">ä¸ºäº†æå‡ä¸‹è½½é€Ÿåº¦ï¼Œå¯ä»¥é…ç½®å›½å†…é•œåƒæºï¼ˆå¦‚æ¸…åã€ä¸­ç§‘å¤§é•œåƒï¼‰ã€‚æ·»åŠ åï¼Œå»ºè®®æ‰§è¡Œ conda config â€“set show_channel_urls yesä»¥ä¾¿å®‰è£…æ—¶æ˜¾ç¤ºåŒ…æ¥æº</td></tr><tr><td align="left">æŸ¥çœ‹å½“å‰æº</td><td align="left">conda config â€“get channels</td><td align="left">æŸ¥çœ‹å½“å‰å·²é…ç½®çš„æ¸ é“ï¼ˆchannelsï¼‰åˆ—è¡¨</td></tr><tr><td align="left">æ¢å¤é»˜è®¤æº</td><td align="left">conda config â€“remove-key channels</td><td align="left">ç§»é™¤æ‰€æœ‰æ·»åŠ çš„é•œåƒæºï¼Œæ¢å¤ä¸º Anaconda å®˜æ–¹æº</td></tr><tr><td align="left">æ¸…ç†ç¼“å­˜</td><td align="left">conda clean -pconda clean -tconda clean -y â€“all</td><td align="left">-pï¼šåˆ é™¤æ— ç”¨çš„åŒ…ã€‚-tï¼šåˆ é™¤ tar æ‰“åŒ…æ–‡ä»¶ã€‚-y â€“allï¼šæ¸…ç†æ‰€æœ‰å®‰è£…åŒ…å’Œç¼“å­˜ï¼ˆç´¢å¼•ç¼“å­˜ã€é”å®šæ–‡ä»¶ã€æœªä½¿ç”¨è¿‡çš„åŒ…å’ŒtaråŒ…ï¼‰ã€‚è¿™å¯ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´</td></tr></tbody></table><h2 id="ä½¿ç”¨æµç¨‹å»ºè®®"><a href="#ä½¿ç”¨æµç¨‹å»ºè®®" class="headerlink" title="ä½¿ç”¨æµç¨‹å»ºè®®"></a>ä½¿ç”¨æµç¨‹å»ºè®®</h2><ol><li><p>åˆ›å»ºç¯å¢ƒï¼šä¸ºä½ çš„æ–°é¡¹ç›®åˆ›å»ºä¸€ä¸ªæŒ‡å®š Python ç‰ˆæœ¬çš„ç¯å¢ƒï¼Œä¾‹å¦‚ conda create -n my_analysis python&#x3D;3.11</p></li><li><p>æ¿€æ´»ç¯å¢ƒï¼šå¼€å§‹å·¥ä½œå‰ï¼Œå…ˆæ¿€æ´»å®ƒï¼šconda activate my_analysis</p></li><li><p>å®‰è£…ä¾èµ–ï¼šåœ¨æ¿€æ´»çš„ç¯å¢ƒä¸­å®‰è£…æ‰€éœ€çš„åŒ…ï¼Œä¾‹å¦‚ conda install pandas matplotlib jupyter</p></li><li><p>å¼€å±•å·¥ä½œï¼šåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­è¿›è¡Œç¼–ç ã€æ•°æ®åˆ†æç­‰</p></li><li><p>é€€å‡ºç¯å¢ƒï¼šå·¥ä½œå®Œæˆåï¼Œä½¿ç”¨ conda deactivateé€€å‡º</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Anaconda</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Anaconda</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(Bustub):è¯¾ç¨‹å­¦ä¹ ç¬”è®°1</title>
    <link href="/2025/11/07/CMU15-445-Bustub-%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"/>
    <url>/2025/11/07/CMU15-445-Bustub-%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</url>
    
    <content type="html"><![CDATA[<h2 id="è¯¾ç¨‹ç¬¬ä¸ƒè®²ï¼šå“ˆå¸Œè¡¨"><a href="#è¯¾ç¨‹ç¬¬ä¸ƒè®²ï¼šå“ˆå¸Œè¡¨" class="headerlink" title="è¯¾ç¨‹ç¬¬ä¸ƒè®²ï¼šå“ˆå¸Œè¡¨"></a>è¯¾ç¨‹ç¬¬ä¸ƒè®²ï¼šå“ˆå¸Œè¡¨</h2><h3 id="æ•°æ®ç»“æ„åœ¨DBMSä¸­çš„è§’è‰²"><a href="#æ•°æ®ç»“æ„åœ¨DBMSä¸­çš„è§’è‰²" class="headerlink" title="æ•°æ®ç»“æ„åœ¨DBMSä¸­çš„è§’è‰²"></a>æ•°æ®ç»“æ„åœ¨DBMSä¸­çš„è§’è‰²</h3><p>å“ˆå¸Œè¡¨æ˜¯DBMSå†…éƒ¨ä½¿ç”¨çš„å¤šç§æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºï¼š</p><ul><li><p><strong>å†…éƒ¨å…ƒæ•°æ®ç®¡ç†</strong>ï¼šå¦‚é¡µè¡¨ã€é¡µç›®å½•ã€‚</p></li><li><p><strong>æ ¸å¿ƒæ•°æ®å­˜å‚¨</strong>ï¼šå­˜å‚¨å…ƒç»„æœ¬èº«ã€‚</p></li><li><p><strong>ä¸´æ—¶æ•°æ®ç»“æ„</strong>ï¼šç”¨äºåŠ é€ŸæŸ¥è¯¢æ‰§è¡Œï¼Œå¦‚è¿æ¥æ“ä½œä¸­çš„å“ˆå¸Œè¡¨ã€‚</p></li><li><p><strong>è¡¨ç´¢å¼•</strong>ï¼šå¸®åŠ©å¿«é€Ÿå®šä½ç‰¹å®šå…ƒç»„ã€‚</p></li></ul><p>è®¾è®¡æ•°æ®ç»“æ„æ—¶éœ€è€ƒè™‘ä¸¤ä¸ªå…³é”®å› ç´ ï¼š<strong>æ•°æ®ç»„ç»‡</strong>ï¼ˆå¸ƒå±€å¯¹æ€§èƒ½çš„å½±å“ï¼‰å’Œ<strong>å¹¶å‘æ§åˆ¶</strong>ï¼ˆå¤šçº¿ç¨‹å®‰å…¨è®¿é—®ï¼‰ã€‚</p><h3 id="å“ˆå¸Œè¡¨åŸºç¡€"><a href="#å“ˆå¸Œè¡¨åŸºç¡€" class="headerlink" title="å“ˆå¸Œè¡¨åŸºç¡€"></a>å“ˆå¸Œè¡¨åŸºç¡€</h3><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å°†é”®æ˜ å°„åˆ°å€¼çš„æ•°æ®ç»“æ„ï¼Œæä¾›å¹³å‡O(1)æ—¶é—´å¤æ‚åº¦çš„æ“ä½œã€‚å®ƒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š</p><ul><li><p><strong>å“ˆå¸Œå‡½æ•°</strong>ï¼šå°†é”®æ˜ å°„åˆ°è¾ƒå°èŒƒå›´çš„æ•´æ•°ã€‚å…³é”®æ˜¯åœ¨<strong>é€Ÿåº¦</strong>å’Œ<strong>ç¢°æ’ç‡</strong>ä¹‹é—´å–å¾—å¹³è¡¡ã€‚æ¨èä½¿ç”¨åƒFacebook XXHash3è¿™æ ·é«˜é€Ÿä¸”ä½ç¢°æ’ç‡çš„éåŠ å¯†å“ˆå¸Œå‡½æ•°ã€‚</p></li><li><p><strong>å“ˆå¸Œæ–¹æ¡ˆ</strong>ï¼šå®šä¹‰å¦‚ä½•å¤„ç†å“ˆå¸Œç¢°æ’ã€‚</p></li></ul><h3 id="é™æ€å“ˆå¸Œæ–¹æ¡ˆ"><a href="#é™æ€å“ˆå¸Œæ–¹æ¡ˆ" class="headerlink" title="é™æ€å“ˆå¸Œæ–¹æ¡ˆ"></a>é™æ€å“ˆå¸Œæ–¹æ¡ˆ</h3><p>é™æ€å“ˆå¸Œè¡¨çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚å¦‚æœç©ºé—´ä¸è¶³ï¼Œéœ€è¦æ˜‚è´µåœ°é‡å»ºæ•´ä¸ªè¡¨ï¼ˆé€šå¸¸åŠ å€å¤§å°ï¼‰ã€‚</p><ul><li><p><strong>çº¿æ€§æ¢æµ‹æ³•</strong></p><ul><li><p><strong>åŸç†</strong>ï¼šå‘ç”Ÿç¢°æ’æ—¶ï¼Œ<strong>æŒ‰é¡ºåºçº¿æ€§æ‰«æåç»­çš„æ§½ä½ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºä½</strong>ã€‚</p></li><li><p><strong>æ“ä½œ</strong>ï¼š</p><ul><li><p><strong>æ’å…¥</strong>ï¼šå“ˆå¸Œåçº¿æ€§æŸ¥æ‰¾ç©ºä½æˆ–å¢“ç¢‘æ ‡è®°çš„ä½ç½®æ’å…¥ã€‚</p></li><li><p><strong>æŸ¥æ‰¾</strong>ï¼šå“ˆå¸Œåçº¿æ€§æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°é”®æˆ–é‡åˆ°ç©ºä½ã€‚</p></li><li><p><strong>åˆ é™¤</strong>ï¼šä½¿ç”¨<strong>å¢“ç¢‘æ ‡è®°</strong>æ¥é¿å…ç ´ååç»­çš„æŸ¥æ‰¾é“¾ï¼ˆå¢“ç¢‘æ ‡è®°è¿™ä½è¢«åˆ é™¤ï¼‰ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</p></li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œé€šå¸¸æœ€å¿«ã€‚æ˜¯è®¸å¤šç°ä»£å®ç°ï¼ˆå¦‚Googleçš„<code>absl::flat_hash_map</code>ï¼‰çš„åŸºç¡€ã€‚</p></li></ul></li><li><p><strong>å¸ƒè°·é¸Ÿå“ˆå¸Œæ³•</strong><br>å¸ƒè°·é¸Ÿçš„å«ä¹‰ï¼š</p></li></ul><ol><li><p>å¸ƒè°·é¸Ÿå¦ˆå¦ˆä»ä¸ç­‘å·¢ï¼Œå®ƒå°†è‡ªå·±çš„é¸Ÿè›‹ç”Ÿåœ¨å…¶ä»–é¸Ÿç±»çš„å·¢ç©´é‡Œï¼Œè¦åˆ«çš„é¸Ÿç»™å®ƒå­µè›‹</p></li><li><p><strong>æ–°å‡ºç”Ÿçš„å¸ƒè°·é¸Ÿä¼šæœ¬èƒ½åœ°å°†å·¢ç©´é‡Œçš„å…¶ä»–è›‹è¸¢å¼€ï¼ˆkick out ï¼‰</strong>ï¼Œ<strong>æ¨å‡ºé¸Ÿå·¢</strong>ï¼Œä»¥ç¡®ä¿è‡ªå·±åœ¨é¸Ÿå·¢é‡Œå¯ä»¥ç‹¬äº«å® çˆ±</p><ul><li><p><strong>åŸç†</strong>ï¼šä½¿ç”¨<strong>å¤šä¸ªå“ˆå¸Œè¡¨</strong>ï¼ˆæˆ–åŒä¸€è¡¨çš„ä¸åŒå“ˆå¸Œå‡½æ•°ï¼‰ã€‚æ’å…¥æ—¶æ£€æŸ¥æ‰€æœ‰è¡¨ï¼Œé€‰æ‹©æœ‰ç©ºä½çš„è¡¨ï¼›è‹¥å‡æ»¡ï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¡¨ï¼Œé©±é€åŸæœ‰æ¡ç›®ï¼Œå¹¶å°†åŸæœ‰æ¡ç›®é‡æ–°å“ˆå¸Œåˆ°å¦ä¸€ä¸ªè¡¨ä¸­ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šä¿è¯O(1)çš„æŸ¥æ‰¾å’Œåˆ é™¤ï¼Œä½†æ’å…¥å¯èƒ½æ›´æ˜‚è´µï¼Œä¸”åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½éœ€è¦é‡å»ºè¡¨ã€‚</p></li></ul></li></ol><h3 id="åŠ¨æ€å“ˆå¸Œæ–¹æ¡ˆ"><a href="#åŠ¨æ€å“ˆå¸Œæ–¹æ¡ˆ" class="headerlink" title="åŠ¨æ€å“ˆå¸Œæ–¹æ¡ˆ"></a>åŠ¨æ€å“ˆå¸Œæ–¹æ¡ˆ</h3><p>åŠ¨æ€å“ˆå¸Œè¡¨å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€è°ƒæ•´å¤§å°ï¼Œè€Œæ— éœ€é‡å»ºæ•´ä¸ªè¡¨ã€‚</p><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/hash.jpg" alt="é“¾å¼å“ˆå¸Œ" style="display: block; margin: 0 auto; width: 50%; height:50%;"><ul><li><p><strong>é“¾å¼å“ˆå¸Œ</strong></p><ul><li><p><strong>åŸç†</strong>ï¼šæ¯ä¸ªæ§½ä½ç»´æŠ¤ä¸€ä¸ªæ¡¶çš„é“¾è¡¨ã€‚å“ˆå¸Œåˆ°åŒä¸€æ§½ä½çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½å­˜å‚¨åœ¨å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¸¸è§ã€æœ€ç®€å•çš„åŠ¨æ€æ–¹æ¡ˆï¼Œä½†é“¾è¡¨å¯èƒ½å˜å¾—å¾ˆé•¿ï¼Œå½±å“æ€§èƒ½ã€‚</p></li></ul></li></ul><p><a href="https://blog.csdn.net/MelroseLbt/article/details/129329316">å¯æ‰©å±•å“ˆå¸Œæ¡ˆä¾‹</a></p><ul><li><p><strong>å¯æ‰©å±•å“ˆå¸Œ</strong></p><ul><li><p><strong>åŸç†</strong>ï¼šæ ¸å¿ƒæ¦‚å¿µæ˜¯<strong>ç›®å½•</strong>å’Œ<strong>æ¡¶</strong>ï¼Œç›®å½•å‚¨å­˜æŒ‡å‘æ¡¶æ˜¯æŒ‡é’ˆã€‚é€šè¿‡ä¸€ä¸ªç›®å½•æŒ‡é’ˆæ•°ç»„æ¥æŒ‡å‘æ¡¶ã€‚ä½¿ç”¨<strong>å…¨å±€æ·±åº¦-ç›®å½•</strong>å’Œ<strong>å±€éƒ¨æ·±åº¦-æ¡¶</strong>æ¥æ§åˆ¶éœ€è¦æ£€æŸ¥çš„æ¯”ç‰¹ä½æ•°ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå½“æ¡¶æº¢å‡ºæ—¶ï¼Œ<strong>åªåˆ†è£‚æº¢å‡ºçš„æ¡¶</strong>ï¼Œå¹¶å¯èƒ½<strong>å€å¢ç›®å½•æ•°ç»„</strong>ã€‚ä¼˜ç‚¹æ˜¯<strong>é‡å“ˆå¸Œåªæ¶‰åŠåˆ†è£‚çš„æ¡¶</strong>ï¼Œè€Œéæ•´ä¸ªè¡¨ã€‚</p></li><li><p><strong>æŸ¥æ‰¾</strong>ï¼šè®¡ç®—å“ˆå¸Œå€¼-&gt;æˆªå–ä½ä½ï¼ˆé•¿åº¦ä¸ºå…¨å±€æ·±åº¦ï¼‰-&gt;å®šä½ç›®å½•é¡µ-&gt;è®¿é—®ç›®æ ‡æ¡¶-&gt;æ‰«æç›®æ ‡æ¡¶</p></li></ul></li><li><p><strong>çº¿æ€§å“ˆå¸Œ</strong></p><ul><li><p><strong>åŸç†</strong>ï¼š<strong>ç»´æŠ¤ä¸€ä¸ªåˆ†è£‚æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè¦åˆ†è£‚çš„æ¡¶</strong>ã€‚å½“ä»»ä½•æ¡¶æº¢å‡ºæ—¶ï¼Œå¹¶ä¸ç«‹å³åˆ†è£‚å®ƒï¼Œè€Œæ˜¯åˆ†è£‚æŒ‡é’ˆå½“å‰æ‰€æŒ‡çš„æ¡¶ã€‚é€šè¿‡<strong>å¢åŠ æ–°çš„å“ˆå¸Œå‡½æ•°æ¥é€æ­¥æ‰©å±•è¡¨</strong>ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šé€šè¿‡åˆ†è£‚æŒ‡é’ˆçš„çº¿æ€§ç§»åŠ¨æ¥å®ç°å¹³æ»‘çš„æ‰©å±•å’Œæ”¶ç¼©ï¼Œé¿å…äº†å¯æ‰©å±•å“ˆå¸Œä¸­å¯èƒ½å‡ºç°çš„é›†ä¸­å¼åˆ†è£‚ã€‚</p></li></ul></li></ul><h3 id="å…³é”®è¦ç‚¹ä¸å¯¹æ¯”"><a href="#å…³é”®è¦ç‚¹ä¸å¯¹æ¯”" class="headerlink" title="å…³é”®è¦ç‚¹ä¸å¯¹æ¯”"></a>å…³é”®è¦ç‚¹ä¸å¯¹æ¯”</h3><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">é™æ€å“ˆå¸Œ</th><th align="left">åŠ¨æ€å“ˆå¸Œ</th></tr></thead><tbody><tr><td align="left"><strong>å¤§å°</strong></td><td align="left">å›ºå®šï¼Œéœ€é¢„çŸ¥æ•°æ®é‡</td><td align="left">åŠ¨æ€å¢é•¿&#x2F;æ”¶ç¼©</td></tr><tr><td align="left"><strong>æ‰©å®¹æˆæœ¬</strong></td><td align="left">é«˜ï¼ˆéœ€è¦é‡å»ºæ•´ä¸ªè¡¨ï¼‰</td><td align="left">ä½ï¼ˆå±€éƒ¨è°ƒæ•´ï¼‰</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">æ•°æ®é‡å·²çŸ¥æˆ–å˜åŒ–ä¸å¤§</td><td align="left">æ•°æ®é‡æœªçŸ¥æˆ–å˜åŒ–é¢‘ç¹</td></tr></tbody></table><ul><li><p><strong>çº¿æ€§æ¢æµ‹</strong>ä¸<strong>é“¾å¼å“ˆå¸Œ</strong>æ˜¯ä¸¤ç§æœ€åŸºç¡€ä¸”å¹¿æ³›åº”ç”¨çš„æ–¹æ¡ˆï¼Œåˆ†åˆ«ä»£è¡¨äº†å¼€æ”¾å¯»å€å’Œé“¾åœ°å€æ³•ä¸¤ç§æ€æƒ³ã€‚</p></li><li><p><strong>å¯æ‰©å±•å“ˆå¸Œ</strong>å’Œ<strong>çº¿æ€§å“ˆå¸Œ</strong>æ˜¯æ›´å¤æ‚çš„åŠ¨æ€æ–¹æ¡ˆï¼Œæ—¨åœ¨å‡å°‘æ‰©å®¹æ—¶çš„å¼€é”€ï¼Œåˆ†åˆ«é€‚ç”¨äºè¯»ä¼˜åŒ–å’Œå†™ä¼˜åŒ–çš„åœºæ™¯ã€‚</p></li></ul><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å°†é”®æ˜ å°„åˆ°å€¼çš„æ•°æ®ç»“æ„ï¼Œæä¾›å¹³å‡O(1)æ—¶é—´å¤æ‚åº¦çš„æ“ä½œã€‚å®ƒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š</p><ul><li><p><strong>å“ˆå¸Œå‡½æ•°</strong>ï¼šå°†é”®æ˜ å°„åˆ°è¾ƒå°èŒƒå›´çš„æ•´æ•°ã€‚å…³é”®æ˜¯åœ¨<strong>é€Ÿåº¦</strong>å’Œ<strong>ç¢°æ’ç‡</strong>ä¹‹é—´å–å¾—å¹³è¡¡ã€‚æ¨èä½¿ç”¨åƒFacebook XXHash3è¿™æ ·é«˜é€Ÿä¸”ä½ç¢°æ’ç‡çš„éåŠ å¯†å“ˆå¸Œå‡½æ•°ã€‚</p></li><li><p><strong>å“ˆå¸Œæ–¹æ¡ˆ</strong>ï¼šå®šä¹‰å¦‚ä½•å¤„ç†å“ˆå¸Œç¢°æ’ã€‚</p></li></ul><h2 id="è¯¾ç¨‹ç¬¬å…«è®²ï¼šç´¢å¼•1"><a href="#è¯¾ç¨‹ç¬¬å…«è®²ï¼šç´¢å¼•1" class="headerlink" title="è¯¾ç¨‹ç¬¬å…«è®²ï¼šç´¢å¼•1"></a>è¯¾ç¨‹ç¬¬å…«è®²ï¼šç´¢å¼•1</h2><h3 id="è¡¨ç´¢å¼•"><a href="#è¡¨ç´¢å¼•" class="headerlink" title="è¡¨ç´¢å¼•"></a>è¡¨ç´¢å¼•</h3><p>è¡¨ç´¢å¼•æ˜¯è¡¨ä¸­éƒ¨åˆ†åˆ—çš„<strong>å‰¯æœ¬</strong>ï¼Œè¿™äº›åˆ—ç»è¿‡ç‰¹æ®Šç»„ç»‡æˆ–æ’åºï¼Œæ—¨åœ¨é€šè¿‡ç‰¹å®šå±æ€§å®ç°é«˜æ•ˆæ•°æ®è®¿é—®ã€‚å®ƒæ˜¯é¿å…å…¨è¡¨é¡ºåºæ‰«æã€æå‡æŸ¥è¯¢æ€§èƒ½çš„å…³é”®æŠ€æœ¯</p><ul><li><p>ä½œç”¨ï¼š<strong>DBMSé€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½ç›®æ ‡å…ƒç»„ï¼Œå¹¶ç¡®ä¿è¡¨æ•°æ®ä¸ç´¢å¼•æ•°æ®åœ¨é€»è¾‘ä¸Šå§‹ç»ˆåŒæ­¥</strong>ã€‚</p></li><li><p>æƒè¡¡ï¼šç´¢å¼•è¶Šå¤šï¼ŒæŸ¥è¯¢å¯èƒ½è¶Šå¿«ï¼Œä½†ä¼šå ç”¨æ›´å¤šå­˜å‚¨ç©ºé—´ï¼Œå¢åŠ ç»´æŠ¤å¼€é”€ï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ—¶éœ€åŒæ­¥æ›´æ–°ç´¢å¼•ï¼‰ï¼Œå¹¶å¼•å…¥å¹¶å‘æ§åˆ¶å¤æ‚åº¦ã€‚DBMSçš„æŸ¥è¯¢ä¼˜åŒ–å™¨è´Ÿè´£é€‰æ‹©æœ€ä½³ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ã€‚</p></li></ul><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B Tree"></a>B Tree</h3><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/bTree.png" alt="3é˜¶B Tree" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p>Bæ ‘ï¼ˆB-treeï¼‰ï¼Œå…¨ç§°å¹³è¡¡æ ‘ï¼ˆBalanced Treeï¼‰ï¼Œæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºä¼˜åŒ–å¯¹ç£ç›˜ç­‰è¾…åŠ©å­˜å‚¨è®¾å¤‡çš„æ•°æ®è®¿é—®ã€‚ä¸äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼ˆé€šå¸¸ä¸º2åˆ°mä¸ªï¼‰ï¼Œä»è€Œæ˜¾è‘—é™ä½äº†æ ‘çš„é«˜åº¦ï¼Œå‡å°‘äº†æ˜‚è´µçš„ç£ç›˜I&#x2F;Oæ“ä½œæ¬¡æ•°ï¼Œæé«˜äº†æ•°æ®æ£€ç´¢æ•ˆç‡ã€‚</p><ul><li>ä¸»è¦ç‰¹ç‚¹<ul><li>å¤šè·¯æŸ¥æ‰¾æ ‘: æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨å¤šä¸ªé”®ï¼ˆkeyï¼‰å’Œæ‹¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ã€‚</li><li>è‡ªå¹³è¡¡: æ ‘ç»“æ„å§‹ç»ˆä¿æŒå¹³è¡¡ï¼Œç¡®ä¿æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºåŒä¸€æ·±åº¦ï¼ˆåŒä¸€å±‚ï¼‰ï¼Œä»è€Œä¿è¯ä¸€è‡´çš„æŸ¥æ‰¾æ—¶é—´ã€‚</li><li>å‡å°‘ç£ç›˜I&#x2F;O: Bæ ‘çš„è®¾è®¡è€ƒè™‘äº†ç£ç›˜è¯»å†™æ˜¯ä»¥æ•°æ®å—ï¼ˆblockï¼‰ä¸ºå•ä½çš„ç‰¹æ€§ï¼Œå°†ç›¸å…³æ•°æ®å°½é‡é›†ä¸­å­˜å‚¨åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªç£ç›˜å—ï¼‰ä¸­ï¼Œä¸€æ¬¡æ€§è¯»å–ï¼Œæœ‰æ•ˆå‡å°‘äº†ç£ç›˜è®¿é—®æ¬¡æ•°ã€‚</li><li>æœ‰åºæ€§: èŠ‚ç‚¹å†…çš„é”®å€¼æŒ‰å‡åºæ’åˆ—ï¼Œå¹¶ä¸”å­èŠ‚ç‚¹ä¸­çš„å€¼ä¹Ÿéµå¾ªå·¦å°å³å¤§çš„è§„åˆ™ã€‚</li><li>é«˜æ•ˆæ“ä½œ: æœç´¢ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºå¯¹æ•°æ—¶é—´ O(log n)ï¼Œæ€§èƒ½ç¨³å®šã€‚</li></ul></li></ul><h3 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h3><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/b+Tree.png" alt="3é˜¶B+ Tree" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p>B+Treeæ˜¯ä¸€ç§è‡ªå¹³è¡¡æ ‘çŠ¶æ•°æ®ç»“æ„ï¼Œé€‚ç”¨äºç£ç›˜å¯¼å‘çš„DBMSï¼Œæ”¯æŒåœ¨O(log(n))æ—¶é—´å¤æ‚åº¦å†…è¿›è¡Œæœç´¢ã€é¡ºåºè®¿é—®ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å®ƒæ˜¯ç°ä»£DBMSä¸­å®ç°æœ‰åºç´¢å¼•çš„äº‹å®æ ‡å‡†ã€‚</p><ul><li>åŸºæœ¬ç‰¹æ€§<ul><li><p>å®Œç¾å¹³è¡¡ï¼š<strong>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€æ·±åº¦</strong>ã€‚</p></li><li><p>åŠæ»¡çº¦æŸï¼šé™¤æ ¹èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è‡³å°‘åŠæ»¡ï¼ˆé”®æ•°åœ¨ M&#x2F;2 - 1åˆ° M-1ä¹‹é—´ï¼‰ã€‚</p></li><li><p>é”®å€¼å¯¹ï¼šæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé”®å€¼å¯¹æ•°ç»„ã€‚</p></li><li><p>å¶å­èŠ‚ç‚¹ï¼š<strong>å€¼åªå­˜äºå¶å­èŠ‚ç‚¹</strong>ã€‚å€¼å¯ä»¥æ˜¯è®°å½•IDï¼ˆæŒ‡å‘å…ƒç»„ä½ç½®çš„æŒ‡é’ˆï¼‰æˆ–å…ƒç»„æ•°æ®æœ¬èº«ã€‚</p></li><li><p>å†…éƒ¨èŠ‚ç‚¹ï¼šå€¼æ˜¯æŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œé”®ä½œä¸ºè·¯æ ‡ï¼ˆguide postsï¼‰æŒ‡å¯¼éå†ã€‚</p></li></ul></li></ul><p><strong>æ’å…¥æ“ä½œ</strong><br>B+æ ‘ä¸­åšæ’å…¥å…³é”®å­—çš„æ“ä½œï¼Œæœ‰ä»¥ä¸‹ 3 ç§æƒ…å†µ:</p><ul><li><p><a href="https://pic4.zhimg.com/v2-386cefe3c3c93b726387ee2abc577691_b.webp">è‹¥è¢«æ’å…¥å…³é”®å­—æ‰€åœ¨çš„ç»“ç‚¹ï¼Œå…¶å«æœ‰å…³é”®å­—æ•°ç›®å°äºé˜¶æ•° Mï¼Œåˆ™ç›´æ¥æ’å…¥ã€‚</a></p></li><li><p><a href="https://pic1.zhimg.com/v2-4e621ab9044dcb42643066f6031226b0_b.webp">è‹¥è¢«æ’å…¥å…³é”®å­—æ‰€åœ¨çš„ç»“ç‚¹ï¼Œå…¶å«æœ‰å…³é”®å­—æ•°ç›®ç­‰äºé˜¶æ•° Mï¼Œåˆ™éœ€è¦å°†è¯¥ç»“ç‚¹åˆ†è£‚ä¸ºä¸¤ä¸ªç»“ç‚¹ï¼Œä¸€ä¸ªç»“ç‚¹åŒ…å« âŒŠM&#x2F;2âŒ‹ ï¼Œå¦ä¸€ä¸ªç»“ç‚¹åŒ…å« âŒˆM&#x2F;2âŒ‰ ã€‚åŒæ—¶ï¼Œå°†âŒˆM&#x2F;2âŒ‰çš„å…³é”®å­—ä¸Šç§»è‡³å…¶åŒäº²ç»“ç‚¹ã€‚å‡è®¾å…¶åŒäº²ç»“ç‚¹ä¸­åŒ…å«çš„å…³é”®å­—ä¸ªæ•°å°äº Mï¼Œåˆ™æ’å…¥æ“ä½œå®Œæˆã€‚</a></p></li></ul><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/b+Tree01.png" alt="3é˜¶B+ Treeæ’å…¥" style="display: block; margin: 0 auto; width: 50%; height:50%;"><ul><li><a href="https://pica.zhimg.com/v2-85fb69b1f6d5134f45808fc884ad2e4a_b.webp">è‹¥æ’å…¥çš„å…³é”®å­—æ¯”å½“å‰ç»“ç‚¹ä¸­çš„æœ€å¤§å€¼è¿˜å¤§ï¼Œç ´åäº†B+æ ‘ä¸­ä»æ ¹ç»“ç‚¹åˆ°å½“å‰ç»“ç‚¹çš„æ‰€æœ‰ç´¢å¼•å€¼ï¼Œæ­¤æ—¶éœ€è¦åŠæ—¶ä¿®æ­£åï¼Œå†åšå…¶ä»–æ“ä½œã€‚</a></li></ul><p><strong>åˆ é™¤æ“ä½œ</strong></p><ul><li><p><a href="https://pic3.zhimg.com/v2-7607b34265b14b3527101d53ce9c2b70_b.webp">æ‰¾åˆ°å­˜å‚¨æœ‰è¯¥å…³é”®å­—æ‰€åœ¨çš„ç»“ç‚¹æ—¶ï¼Œç”±äºè¯¥ç»“ç‚¹ä¸­å…³é”®å­—ä¸ªæ•°å¤§äºâŒˆM&#x2F;2âŒ‰ï¼Œåšåˆ é™¤æ“ä½œä¸ä¼šç ´å B+æ ‘ï¼Œåˆ™å¯ä»¥ç›´æ¥åˆ é™¤ã€‚</a></p></li><li><p><a href="https://pic2.zhimg.com/v2-3aee225a4ba3e3a1b428e3f30e312637_b.webp">å½“åˆ é™¤æŸç»“ç‚¹ä¸­æœ€å¤§æˆ–è€…æœ€å°çš„å…³é”®å­—ï¼Œå°±ä¼šæ¶‰åŠåˆ°æ›´æ”¹å…¶åŒäº²ç»“ç‚¹ä¸€ç›´åˆ°æ ¹ç»“ç‚¹ä¸­æ‰€æœ‰ç´¢å¼•å€¼çš„æ›´æ”¹ã€‚</a></p></li><li><p><a href="https://pic2.zhimg.com/v2-8dae05b8aa006d6d1fc6bb54c24169a5_b.webp">å½“åˆ é™¤è¯¥å…³é”®å­—ï¼Œå¯¼è‡´å½“å‰ç»“ç‚¹ä¸­å…³é”®å­—ä¸ªæ•°å°äº âŒˆM&#x2F;2âŒ‰ï¼Œè‹¥å…¶å…„å¼Ÿç»“ç‚¹ä¸­å«æœ‰å¤šä½™çš„å…³é”®å­—ï¼Œå¯ä»¥ä»å…„å¼Ÿç»“ç‚¹ä¸­å€Ÿå…³é”®å­—å®Œæˆåˆ é™¤æ“ä½œã€‚</a></p></li><li><p><a href="https://pic1.zhimg.com/v2-c33a70c8eaa38e96c3052a6bddc9d0d4_b.webp">ç¬¬3ç§æƒ…å†µä¸­ï¼Œå¦‚æœå…¶å…„å¼Ÿç»“ç‚¹æ²¡æœ‰å¤šä½™çš„å…³é”®å­—ï¼Œåˆ™éœ€è¦åŒå…¶å…„å¼Ÿç»“ç‚¹è¿›è¡Œåˆå¹¶ã€‚</a></p></li><li><p><a href="https://pic3.zhimg.com/v2-ae4011609fdf74e80d10fefb9e47dbb8_b.webp"> å½“è¿›è¡Œåˆå¹¶æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå› åˆå¹¶ä½¿å…¶åŒäº²ç»“ç‚¹ç ´å B+æ ‘çš„ç»“æ„ï¼Œéœ€è¦ä¾ç…§ä»¥ä¸Šè§„å¾‹å¤„ç†å…¶åŒäº²ç»“ç‚¹ã€‚</a></p></li></ul><p><strong>Bæ ‘&amp;B+æ ‘ æ ¸å¿ƒåŒºåˆ«é€Ÿè§ˆ</strong></p><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Bæ ‘</th><th align="left">B+æ ‘</th></tr></thead><tbody><tr><td align="left">æ•°æ®å­˜å‚¨ä½ç½®</td><td align="left">æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å†…éƒ¨èŠ‚ç‚¹ï¼‰éƒ½å¯èƒ½å­˜å‚¨æ•°æ®æŒ‡é’ˆ&#x2F;å®Œæ•´æ•°æ®ã€‚</td><td align="left">ä»…å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®æŒ‡é’ˆ&#x2F;å®Œæ•´æ•°æ®ã€‚å†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨é”®ï¼ˆç´¢å¼•ï¼‰ã€‚</td></tr><tr><td align="left">å¶å­èŠ‚ç‚¹è¿æ¥</td><td align="left">å¶å­èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰æŒ‡é’ˆè¿æ¥ã€‚</td><td align="left">æ‰€æœ‰å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥åœ¨ä¸€èµ·ã€‚</td></tr><tr><td align="left">æŸ¥æ‰¾æ€§èƒ½</td><td align="left">å¹³å‡æŸ¥æ‰¾å¯èƒ½æ›´å¿«ï¼ˆå¯èƒ½åœ¨å†…éƒ¨èŠ‚ç‚¹å°±å‘½ä¸­ï¼‰ã€‚</td><td align="left">ä»»ä½•æŸ¥æ‰¾éƒ½å¿…é¡»èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„é•¿åº¦ç¨³å®šã€‚</td></tr><tr><td align="left">èŒƒå›´æŸ¥è¯¢&#x2F;å…¨è¡¨æ‰«æ</td><td align="left">æ•ˆç‡ä½ã€‚éœ€è¦è¿›è¡Œå¤æ‚çš„ä¸­åºéå†ã€‚</td><td align="left">æ•ˆç‡æé«˜ã€‚æ‰¾åˆ°èµ·å§‹ç‚¹åï¼Œæ²¿é“¾è¡¨é¡ºåºæ‰«æå³å¯ã€‚</td></tr><tr><td align="left">ç»“æ„ç¨³å®šæ€§</td><td align="left">åˆ é™¤æ“ä½œå¯èƒ½å¯¼è‡´å†…éƒ¨èŠ‚ç‚¹æ•°æ®è¢«ç§»é™¤ï¼Œæ ‘ç»“æ„å˜åŒ–æ›´é¢‘ç¹ã€‚</td><td align="left">åˆ é™¤æ“ä½œåªåœ¨å¶å­èŠ‚ç‚¹è¿›è¡Œï¼Œæ ‘ç»“æ„æ›´åŠ ç¨³å®šã€‚</td></tr><tr><td align="left">ç©ºé—´åˆ©ç”¨ç‡</td><td align="left">å†…éƒ¨èŠ‚ç‚¹ä¹Ÿå­˜å‚¨æ•°æ®ï¼Œå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹èƒ½å®¹çº³çš„é”®æ›´å°‘ï¼Œæ ‘å¯èƒ½æ›´é«˜ã€‚</td><td align="left">å†…éƒ¨èŠ‚ç‚¹åªå­˜é”®ï¼Œèƒ½å®¹çº³æ›´å¤šé”®ï¼Œæ ‘æ›´çŸ®èƒ–ï¼Œå‡å°‘I&#x2F;Oæ¬¡æ•°ã€‚</td></tr></tbody></table><h2 id="è¯¾ç¨‹ç¬¬ä¹è®²ï¼šç´¢å¼•2"><a href="#è¯¾ç¨‹ç¬¬ä¹è®²ï¼šç´¢å¼•2" class="headerlink" title="è¯¾ç¨‹ç¬¬ä¹è®²ï¼šç´¢å¼•2"></a>è¯¾ç¨‹ç¬¬ä¹è®²ï¼šç´¢å¼•2</h2><h3 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h3><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œ<strong>ç”¨äºå¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦ä¸åœ¨æŸä¸ªé›†åˆä¸­</strong>ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„æŸ¥æ‰¾å¼€é”€ã€‚å®ƒ<strong>ä½¿ç”¨ä¸€ä¸ªä½å›¾å’Œå¤šä¸ªå“ˆå¸Œå‡½æ•°</strong>ã€‚</p><ul><li><p><strong>å·¥ä½œåŸç†</strong>ï¼šæ’å…¥å…ƒç´ æ—¶ï¼Œé€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—å…¶ä½ç½®å¹¶å°†ä½å›¾ä¸­å¯¹åº”ä½è®¾ä¸º1ã€‚æŸ¥è¯¢æ—¶ï¼Œè‹¥æ‰€æœ‰å“ˆå¸Œå‡½æ•°å¯¹åº”çš„ä½å‡ä¸º1ï¼Œåˆ™å…ƒç´ å¯èƒ½å­˜åœ¨ï¼ˆå¯èƒ½å­˜åœ¨è¯¯åˆ¤ï¼‰ï¼›è‹¥æœ‰ä»»ä¸€ä½ä¸º0ï¼Œåˆ™å…ƒç´ è‚¯å®šä¸å­˜åœ¨ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼šç¡®ä¿æ— å‡é˜´æ€§ï¼Œä½†å¯èƒ½å­˜åœ¨å‡é˜³æ€§ã€‚å¯é€šè¿‡è°ƒæ•´ä½å›¾å¤§å°å’Œå“ˆå¸Œå‡½æ•°æ•°é‡æ§åˆ¶è¯¯åˆ¤ç‡ã€‚</p></li><li><p>å˜ç§ï¼š</p><ul><li><p>è®¡æ•°å¸ƒéš†è¿‡æ»¤å™¨ï¼šæ”¯æŒåˆ é™¤æ“ä½œã€‚</p></li><li><p>å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼šåŸºäºå¸ƒè°·é¸Ÿå“ˆå¸Œï¼Œå­˜å‚¨å…ƒç´ æŒ‡çº¹ã€‚</p></li><li><p>ç®€æ´èŒƒå›´è¿‡æ»¤å™¨ï¼šä¸å¯å˜ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/bloomFilter.png" alt="å¸ƒéš†è¿‡æ»¤å™¨" style="display: block; margin: 0 auto; width: 50%; height:50%;"><h3 id="è·³è¡¨"><a href="#è·³è¡¨" class="headerlink" title="è·³è¡¨"></a>è·³è¡¨</h3><p>è·³è¡¨æ˜¯ä¸€ç§å¤šå±‚çº§æœ‰åºé“¾è¡¨ï¼Œç”¨äºå†…å­˜æ•°æ®ï¼ˆå¦‚MemTableï¼‰ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ï¼Œæ— éœ€é‡æ–°å¹³è¡¡ã€‚</p><ul><li><p>æŸ¥æ‰¾ï¼šä»é¡¶å±‚é“¾è¡¨å¼€å§‹éå†ï¼Œå½“ä¸‹ä¸€èŠ‚ç‚¹å€¼å¤§äºç›®æ ‡å€¼æ—¶ï¼Œä¸‹é™è‡³ä¸‹ä¸€å±‚ç»§ç»­éå†ï¼Œç›´è‡³åº•å±‚ã€‚</p></li><li><p>æ’å…¥ï¼š<strong>é€šè¿‡æŠ›ç¡¬å¸å†³å®šæ–°èŠ‚ç‚¹çš„å±‚çº§</strong>ï¼Œå¹¶ä»åº•å±‚å‘ä¸Šé€å±‚æ’å…¥ï¼Œé€šå¸¸é€šè¿‡åŸå­æŒ‡é’ˆäº¤æ¢å®ç°æ— é”æ“ä½œã€‚</p></li><li><p>åˆ é™¤ï¼šå…ˆæ ‡è®°èŠ‚ç‚¹ä¸ºå·²åˆ é™¤ï¼Œå¾…åç»­ç‰©ç†åˆ é™¤ï¼›åˆ é™¤é¡ºåºä¸ºè‡ªä¸Šè€Œä¸‹ï¼Œä»¥ä¿æŒç»“æ„å®Œæ•´æ€§ã€‚</p></li><li><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li><p>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å¯èƒ½ä½äºB+æ ‘ï¼ˆæ— åå‘æŒ‡é’ˆï¼‰ï¼Œæ— éœ€é‡æ–°å¹³è¡¡ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šå¯¹ç£ç›˜&#x2F;ç¼“å­˜ä¸å‹å¥½ï¼ˆå±€éƒ¨æ€§å·®ï¼‰ï¼Œåå‘æ‰«æå®ç°å¤æ‚ã€‚</p></li></ul></li></ul><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/skipList.png" alt="è·³è¡¨" style="display: block; margin: 0 auto; width: 50%; height:50%;"><h3 id="å­—å…¸æ ‘"><a href="#å­—å…¸æ ‘" class="headerlink" title="å­—å…¸æ ‘"></a>å­—å…¸æ ‘</h3><p>å­—å…¸æ ‘æ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œå°†é”®æŒ‰ä½ï¼ˆå¦‚å­—ç¬¦æˆ–æ¯”ç‰¹ï¼‰æ‹†åˆ†ä¸ºå‰ç¼€æ ‘ï¼ŒæŸ¥è¯¢å¤æ‚åº¦å–å†³äºé”®é•¿ã€‚</p><ul><li><p>å‹ç¼©æŠ€æœ¯ï¼š</p><ul><li><p>æ°´å¹³å‹ç¼©ï¼šå°†èŠ‚ç‚¹å‹ç¼©ä¸ºæ•°ç»„ï¼ˆå·²çŸ¥è·¨åº¦æ—¶ï¼‰ã€‚</p></li><li><p>å‚ç›´å‹ç¼©ï¼ˆRadixæ ‘ï¼‰ï¼šåˆå¹¶å•åˆ†æ”¯èŠ‚ç‚¹ï¼Œä½†å¯èƒ½å¯¼è‡´å‡é˜³æ€§ï¼ˆéœ€éªŒè¯å®é™…æ•°æ®ï¼‰ã€‚</p></li></ul></li></ul><h3 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h3><p>ä¸“ç”¨äº<strong>å…³é”®è¯æœç´¢</strong>ï¼ˆå¦‚å…¨æ–‡æ£€ç´¢ï¼‰ï¼Œå»ºç«‹è¯é¡¹åˆ°åŒ…å«è¯¥è¯é¡¹çš„è®°å½•åˆ—è¡¨ï¼ˆç§°ä¸º<strong>å€’æ’åˆ—è¡¨</strong>ï¼‰çš„æ˜ å°„ã€‚</p><ul><li><p>Luceneå®ç°ï¼šä½¿ç”¨ç±»ä¼¼å­—å…¸æ ‘çš„æœ‰é™çŠ¶æ€è½¬æ¢å™¨å­˜å‚¨è¯é¡¹å­—å…¸ï¼Œé€šè¿‡è¾¹æƒé‡å®šä½æ•°æ®ä½ç½®ï¼Œå¹¶é‡‡ç”¨å¢é‡å‹ç¼©ã€ä½æ‰“åŒ…ç­‰å‹ç¼©æŠ€æœ¯ã€‚</p></li><li><p>PostgreSQLå®ç°ï¼šåŸºäºB+æ ‘æ„å»ºè¯é¡¹å­—å…¸ï¼›å°å€’æ’åˆ—è¡¨ç”¨æœ‰åºæ•°ç»„å­˜å‚¨ï¼Œå¤§åˆ—è¡¨åˆ™ç”¨é¢å¤–B+æ ‘ç®¡ç†ã€‚é€šè¿‡å¾…å¤„ç†åˆ—è¡¨ç§¯ç´¯å°æ‰¹é‡æ›´æ–°ã€‚</p></li></ul><p>æ¥è¯¦ç»†æ¢è®¨å€’æ’ç´¢å¼•ä¸­çš„å…³é”®ç»„ä»¶â€”â€”æœ‰é™çŠ¶æ€è½¬æ¢å™¨ã€‚<br>å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªç»è¿‡é«˜åº¦ä¼˜åŒ–çš„ã€ç¡®å®šæ€§çš„å­—å…¸æ ‘ã€‚ä¸æ™®é€šå­—å…¸æ ‘ä¸åŒçš„æ˜¯ï¼Œ<strong>FST</strong>åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ•ˆç‡ä¸Šåšäº†é‡å¤§æ”¹è¿›ï¼š</p><ul><li>ç¡®å®šæ€§ï¼šå¯¹äºä»»æ„ç»™å®šçš„è¾“å…¥è¯é¡¹ï¼ŒFSTæ€»ä¼šæ²¿ç€å”¯ä¸€çš„ä¸€æ¡è·¯å¾„è¿›è¡Œè½¬æ¢ã€‚</li><li><strong>å…±äº«å‰ç¼€ä¸åç¼€</strong>ï¼šFSTèƒ½å¤Ÿæœ€å¤§é™åº¦åœ°å‹ç¼©å…±äº«ç›¸åŒå‰ç¼€å’Œåç¼€çš„è¯é¡¹ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ã€‚ä¾‹å¦‚ï¼Œå•è¯ â€œsportâ€ å’Œ â€œsportsâ€ å…±äº«å‰ç¼€ â€œsportâ€ï¼ŒFSTä¼šåˆå¹¶å­˜å‚¨è¿™ä¸ªå…¬å…±éƒ¨åˆ†ã€‚</li><li><strong>è¾“å‡ºå€¼</strong>ï¼šFSTçš„æ¯æ¡è¾¹ï¼ˆæˆ–æ¯ä¸ªçŠ¶æ€è½¬æ¢ï¼‰ä¸ä»…å¯ä»¥æ¥å—ä¸€ä¸ªè¾“å…¥å­—ç¬¦ï¼Œè¿˜å¯ä»¥äº§ç”Ÿä¸€ä¸ªè¾“å‡ºå€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæƒé‡æˆ–<strong>åç§»é‡</strong>ï¼‰ã€‚åœ¨å€’æ’ç´¢å¼•çš„åº”ç”¨ä¸­ï¼Œè¿™äº›è¾“å‡ºå€¼æœ€ç»ˆä¼šç´¯ç§¯èµ·æ¥ï¼ŒæŒ‡å‘è¯é¡¹å¯¹åº”çš„å€’æ’åˆ—è¡¨åœ¨æ–‡ä»¶ä¸­çš„å­˜å‚¨ä½ç½®ã€‚</li></ul><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/fst.png" alt="å€’æ’ç´¢å¼•--FST" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æŸ¥è¯¢è¯é¡¹ â€œpavâ€ æ—¶ï¼ŒFSTä¼šæ²¿ç€è·¯å¾„ p -&gt; a -&gt; vè¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œè·¯å¾„ä¸Šå„è¾¹çš„è¾“å‡ºå€¼ï¼ˆæƒé‡ï¼‰ä¼šè¢«ç´¯åŠ ã€‚è¿™ä¸ªæœ€ç»ˆçš„ç´¯åŠ å€¼ï¼ˆä¾‹å¦‚ 3ï¼‰å¯èƒ½å°±æ˜¯ â€œpavâ€ è¿™ä¸ªè¯é¡¹å…¶å€’æ’åˆ—è¡¨åœ¨ç´¢å¼•æ–‡ä»¶ä¸­çš„èµ·å§‹åç§»é‡ã€‚</p><h3 id="å‘é‡ç´¢å¼•"><a href="#å‘é‡ç´¢å¼•" class="headerlink" title="å‘é‡ç´¢å¼•"></a>å‘é‡ç´¢å¼•</h3><p>ç”¨äºè¯­ä¹‰ç›¸ä¼¼æ€§æœç´¢ï¼ˆå¦‚åŸºäºLLMç”Ÿæˆçš„åµŒå…¥å‘é‡ï¼‰ï¼Œæ”¯æŒæœ€è¿‘é‚»æŸ¥è¯¢ã€‚</p><ul><li><p>å€’æ’æ–‡ä»¶ï¼šé€šè¿‡èšç±»å°†å‘é‡åˆ†ç»„ï¼ŒæŸ¥è¯¢æ—¶æœç´¢æœ€è¿‘ç°‡ï¼ˆå¦‚IVFFlatï¼‰ã€‚å¯ç»“åˆé‡åŒ–æŠ€æœ¯é™ç»´åŠ é€Ÿã€‚</p></li><li><p>å¯å¯¼èˆªå°ä¸–ç•Œï¼šæ„å»ºå‘é‡è¿‘é‚»å›¾ï¼Œé€šè¿‡è´ªå©ªéå†é€¼è¿‘æŸ¥è¯¢å‘é‡ï¼ˆå¦‚FAISSã€HNSWlibï¼‰ã€‚</p></li><li><p>æŒ‘æˆ˜ï¼šæŸ¥è¯¢ç»“æœæ— ç»å¯¹æ­£ç¡®æ€§ï¼Œä¸”å¸¸éœ€ç»“åˆè¿‡æ»¤æ¡ä»¶ã€‚</p></li></ul><h2 id="è¯¾ç¨‹ç¬¬åè®²ï¼šç´¢å¼•å¹¶å‘æ§åˆ¶"><a href="#è¯¾ç¨‹ç¬¬åè®²ï¼šç´¢å¼•å¹¶å‘æ§åˆ¶" class="headerlink" title="è¯¾ç¨‹ç¬¬åè®²ï¼šç´¢å¼•å¹¶å‘æ§åˆ¶"></a>è¯¾ç¨‹ç¬¬åè®²ï¼šç´¢å¼•å¹¶å‘æ§åˆ¶</h2><h3 id="é”ï¼ˆlocksï¼‰ä¸é—¨é—©-latches-çš„åŒºåˆ«"><a href="#é”ï¼ˆlocksï¼‰ä¸é—¨é—©-latches-çš„åŒºåˆ«" class="headerlink" title="é”ï¼ˆlocksï¼‰ä¸é—¨é—©(latches)çš„åŒºåˆ«"></a>é”ï¼ˆlocksï¼‰ä¸é—¨é—©(latches)çš„åŒºåˆ«</h3><ul><li><p>é”(<strong>locks</strong>)ï¼šé«˜çº§é€»è¾‘åŸè¯­ï¼Œä¿æŠ¤æ•°æ®åº“é€»è¾‘å†…å®¹ï¼ˆå¦‚<strong>å…ƒç»„ã€è¡¨</strong>ï¼‰ï¼Œäº‹åŠ¡ä¼šåœ¨å…¶æ•´ä¸ªæŒç»­æœŸé—´æŒæœ‰é”ï¼Œç³»ç»Ÿæœ‰æ­»é”æ£€æµ‹å’Œå›æ»šæœºåˆ¶ã€‚</p></li><li><p>é—¨é—©(<strong>latches</strong>)ï¼šä½çº§ä¿æŠ¤åŸè¯­ï¼Œä¿æŠ¤DBMSå†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå¦‚<strong>æ•°æ®ç»“æ„ã€å†…å­˜åŒºåŸŸ</strong>ï¼‰ï¼ŒæŒæœ‰æ—¶é—´æçŸ­ï¼Œç”±å¼€å‘è€…è´Ÿè´£é¿å…æ­»é”ã€‚é—¨é—©æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>è¯»é—¨é—©ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ã€‚</p></li><li><p>å†™é—¨é—©ï¼šå…·æœ‰æ’ä»–æ€§ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–ã€‚</p></li></ul></li></ul><h3 id="é—¨é—©çš„å®ç°æ–¹å¼"><a href="#é—¨é—©çš„å®ç°æ–¹å¼" class="headerlink" title="é—¨é—©çš„å®ç°æ–¹å¼"></a>é—¨é—©çš„å®ç°æ–¹å¼</h3><table><thead><tr><th align="left">å®ç°æ–¹å¼</th><th align="left">æè¿°</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th></tr></thead><tbody><tr><td align="left">æµ‹è¯•å¹¶è®¾ç½®è‡ªæ—‹é—¨é—©</td><td align="left">åŸºäºCPUåŸå­æŒ‡ä»¤ï¼ˆå¦‚CASï¼Œç¤ºä¾‹ï¼šstd::atomicï¼‰ï¼Œçº¿ç¨‹åœ¨æ— æ³•è·å–é—¨é—©æ—¶å¾ªç¯å°è¯•æˆ–è®©å‡ºCPUã€‚</td><td align="left">ç”±DBMSæ§åˆ¶ï¼Œæ“ä½œé«˜æ•ˆï¼ˆå•æ¡æŒ‡ä»¤ï¼‰ã€‚</td><td align="left">é«˜å¹¶å‘ä¸‹ä¸å…·æ‰©å±•æ€§ï¼Œå¤§é‡CASæŒ‡ä»¤å¯¼è‡´ç¼“å­˜ä¸€è‡´æ€§é£æš´ã€‚</td></tr><tr><td align="left">é˜»å¡å¼OSäº’æ–¥é”</td><td align="left">ç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”ï¼ˆå¦‚std::mutexï¼‰ã€‚</td><td align="left">ç®€å•æ˜“ç”¨ï¼Œæ— éœ€é¢å¤–ç¼–ç ã€‚</td><td align="left">å¼€é”€å¤§ï¼Œä¸å¯æ‰©å±•ï¼ˆçº¦25ns&#x2F;æ¬¡ï¼‰ï¼Œå—OSè°ƒåº¦å½±å“ã€‚</td></tr><tr><td align="left">è¯»å†™è€…é—¨é—©</td><td align="left">åœ¨åŸºç¡€é—¨é—©ä¸Šå¢åŠ é€»è¾‘ï¼ŒåŒºåˆ†è¯»&#x2F;å†™æ¨¡å¼ï¼Œç®¡ç†ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¦‚std::shared_mutexï¼‰ã€‚</td><td align="left">å…è®¸å¹¶å‘è¯»å–ï¼Œé€‚åˆè¯»å¤šå†™å°‘åœºæ™¯ã€‚</td><td align="left">éœ€ç®¡ç†é˜Ÿåˆ—ä»¥é˜²é¥¥é¥¿ï¼Œå…ƒæ•°æ®å­˜å‚¨å¼€é”€å¤§äºè‡ªæ—‹é—¨é—©ã€‚</td></tr></tbody></table><ul><li><strong>std::atomic</strong>:ç¡¬ä»¶çº§åˆ«çš„åŸå­æ€§<ul><li>æœ¬è´¨ï¼šæ˜¯C++11å¼•å…¥çš„ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯¹æ•°æ®è¿›è¡Œ<strong>åŸå­æ“ä½œ</strong>ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ã€‚<strong>è¿™æ„å‘³ç€è¿™äº›æ“ä½œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­çœ‹èµ·æ¥æ˜¯ç¬é—´å®Œæˆçš„ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹çš„æ“ä½œæ‰“æ–­</strong>ã€‚</li><li>å·¥ä½œæ–¹å¼ï¼šå®ƒç›´æ¥åˆ©ç”¨ç°ä»£CPUçš„åŸå­æŒ‡ä»¤ï¼ˆå¦‚Compare-And-Swap, Fetch-And-Addï¼‰ã€‚ä¾‹å¦‚ï¼Œi++è¿™ä¸ªæ“ä½œåœ¨éåŸå­æƒ…å†µä¸‹æ˜¯â€œè¯»å–-ä¿®æ”¹-å†™å…¥â€ä¸‰æ­¥ï¼Œå¯èƒ½è¢«ä¸­æ–­ã€‚è€Œ atomic_int i; i++ï¼›åˆ™é€šè¿‡ä¸€æ¡åŸå­æŒ‡ä»¤å®Œæˆã€‚</li><li>ä¼˜ç‚¹ï¼šé€Ÿåº¦æœ€å¿«ï¼Œæ²¡æœ‰é”çš„äº‰ç”¨å’Œè°ƒåº¦å¼€é”€ã€‚</li><li>ç¼ºç‚¹ï¼šåªèƒ½ä¿æŠ¤å•ä¸ªå˜é‡æˆ–éå¸¸ç®€å•çš„æ•°æ®ç»“æ„ã€‚æ— æ³•ä¿æŠ¤ä¸€ä¸ªéœ€è¦å¤šæ­¥æ›´æ–°æ‰èƒ½ä¿æŒé€»è¾‘ä¸€è‡´æ€§çš„ä»£ç å—ã€‚ä¾‹å¦‚ï¼Œå®ƒæ— æ³•ä¿è¯â€œä»é“¾è¡¨Aä¸­å–å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†æ”¾å…¥é“¾è¡¨Bâ€è¿™ä¸ªè¿‡ç¨‹çš„åŸå­æ€§ã€‚</li></ul></li></ul><p>ç®€å•ç¤ºä¾‹ï¼šè®¡æ•°å™¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::atomic&lt;<span class="hljs-type">int</span>&gt; counter&#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-comment">// è¦è¯»å–std::atomicå˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨loadå‡½æ•°</span><br>counter.<span class="hljs-built_in">load</span>();<br><span class="hljs-comment">// è¦ä¿®æ”¹std::atomicå˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨storeå‡½æ•°</span><br>counter.<span class="hljs-built_in">store</span>(<span class="hljs-number">1</span>);<br><span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ˜¯å®‰å…¨çš„</span><br>counter.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>);<br>counter.<span class="hljs-built_in">fetch_sub</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><ul><li><p><strong>std::mutex</strong>ï¼šé€šç”¨çš„äº’æ–¥é”</p><ul><li><p>æœ¬è´¨ï¼š<strong>äº’æ–¥é”ï¼Œç”¨äºä¿æŠ¤ä¸´ç•ŒåŒºâ€”â€”ä¸€æ®µéœ€è¦ç‹¬å è®¿é—®çš„ä»£ç </strong>ã€‚çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºå‰å¿…é¡»å…ˆé”å®šäº’æ–¥é”ï¼Œå¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼ˆè¿›å…¥ç¡çœ çŠ¶æ€ï¼‰ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p></li><li><p>å·¥ä½œæ–¹å¼ï¼šå½“äº‰ç”¨å‘ç”Ÿæ—¶ï¼Œä¼šæ¶‰åŠæ“ä½œç³»ç»Ÿçš„è°ƒåº¦ï¼Œå¯¼è‡´çº¿ç¨‹æŒ‚èµ·å’Œå”¤é†’ï¼Œè¿™å¸¦æ¥è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ã€‚</p></li><li><p>ä¼˜ç‚¹ï¼šé€šç”¨æ€§å¼ºï¼Œå¯ä»¥ä¿æŠ¤ä»»ä½•å¤æ‚çš„ä»£ç æ®µå’Œæ•°æ®ç»“æ„ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šæ€§èƒ½å¼€é”€å¤§ã€‚å³ä½¿æ²¡æœ‰å®é™…äº‰ç”¨ï¼ŒåŠ é”è§£é”æ“ä½œæœ¬èº«ä¹Ÿæœ‰æˆæœ¬ã€‚å¹¶ä¸”ï¼Œä¸åŒºåˆ†è¯»å†™æ“ä½œï¼Œå³ä½¿æ˜¯åªè¯»æ“ä½œä¹Ÿéœ€è¦ä¸²è¡Œè¿›è¡Œï¼Œåœ¨é«˜å¹¶å‘è¯»åœºæ™¯ä¸‹æ•ˆç‡ä½ä¸‹ã€‚</p></li></ul></li></ul><p>ç®€å•ç¤ºä¾‹ï¼šä¿æŠ¤ä¸€ä¸ªå‘é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::vector&lt;<span class="hljs-type">int</span>&gt; shared_data;<br>std::mutex mtx;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_push</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>&#123;<br>    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>; <span class="hljs-comment">// é”å®šï¼Œç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨è§£é”</span><br>    shared_data.<span class="hljs-built_in">push_back</span>(value);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>std::shared_mutex</strong>ï¼ˆC++17ï¼‰ï¼šè¯»å†™é”<ul><li><p>æœ¬è´¨ï¼šæ˜¯ std::mutexçš„å¢å¼ºç‰ˆï¼Œå¼•å…¥äº†ä¸¤ç§é”æ¨¡å¼ï¼š</p><ul><li><p>å…±äº«é”ï¼šç”¨äºè¯»å–æ“ä½œã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å¾—å…±äº«é”ã€‚</p></li><li><p>ç‹¬å é”ï¼šç”¨äºå†™å…¥æ“ä½œã€‚ä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†ç‹¬å é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹ï¼ˆæ— è®ºæ˜¯è¯»è¿˜æ˜¯å†™ï¼‰éƒ½æ— æ³•å†è·å¾—é”ã€‚</p></li></ul></li><li><p>å·¥ä½œæ–¹å¼ï¼š<strong>å½“åªæœ‰è¯»è€…æ—¶ï¼Œæ‰€æœ‰è¯»è€…å¹¶è¡Œå·¥ä½œã€‚ä¸€æ—¦æœ‰å†™è€…ç”³è¯·é”ï¼Œå®ƒä¼šç­‰å¾…ç°æœ‰çš„æ‰€æœ‰è¯»è€…å®Œæˆï¼Œç„¶åç‹¬å è®¿é—®ï¼Œå¹¶é˜»å¡åç»­æ‰€æœ‰çš„è¯»è€…å’Œå†™è€…ï¼Œç›´åˆ°å†™æ“ä½œå®Œæˆ</strong>ã€‚</p></li><li><p>ä¼˜ç‚¹ï¼šåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„å¹¶è¡Œæ€§å’Œååé‡ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šå®ç°æ¯” std::mutexå¤æ‚ï¼Œæœ¬èº«æœ‰ç¨å¤§çš„å¼€é”€ã€‚å¦‚æœå†™æ“ä½œé¢‘ç¹ï¼Œç”±äºå†™é”çš„æ’ä»–æ€§ï¼Œæ€§èƒ½å¯èƒ½åè€Œä¸å¦‚ç®€å•çš„ std::mutexï¼Œå› ä¸ºéœ€è¦ç®¡ç†æ›´å¤æ‚çš„é˜Ÿåˆ—ã€‚</p></li></ul></li></ul><p>ç®€å•ç¤ºä¾‹ï¼šä¿æŠ¤ä¸€ä¸ªé…ç½®è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::map&lt;std::string, <span class="hljs-type">int</span>&gt; config;<br>std::shared_mutex rw_mtx;<br><br><span class="hljs-comment">// è¯»æ“ä½œï¼šä½¿ç”¨ shared_lock</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get_config</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; key)</span> </span>&#123;<br>    <span class="hljs-function">std::shared_lock <span class="hljs-title">lock</span><span class="hljs-params">(rw_mtx)</span></span>; <span class="hljs-comment">// è·å–å…±äº«é”</span><br>    <span class="hljs-keyword">return</span> config[key];<br>&#125;<br><br><span class="hljs-comment">// å†™æ“ä½œï¼šä½¿ç”¨ unique_lock</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_config</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; key, <span class="hljs-type">int</span> value)</span> </span>&#123;<br>    <span class="hljs-function">std::unique_lock <span class="hljs-title">lock</span><span class="hljs-params">(rw_mtx)</span></span>; <span class="hljs-comment">// è·å–ç‹¬å é”</span><br>    config[key] = value;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å…·ä½“ç´¢å¼•ç»“æ„çš„å¹¶å‘æ§åˆ¶"><a href="#å…·ä½“ç´¢å¼•ç»“æ„çš„å¹¶å‘æ§åˆ¶" class="headerlink" title="å…·ä½“ç´¢å¼•ç»“æ„çš„å¹¶å‘æ§åˆ¶"></a>å…·ä½“ç´¢å¼•ç»“æ„çš„å¹¶å‘æ§åˆ¶</h3><h4 id="å“ˆå¸Œè¡¨çš„é—¨é—©æ§åˆ¶"><a href="#å“ˆå¸Œè¡¨çš„é—¨é—©æ§åˆ¶" class="headerlink" title="å“ˆå¸Œè¡¨çš„é—¨é—©æ§åˆ¶"></a>å“ˆå¸Œè¡¨çš„é—¨é—©æ§åˆ¶</h4><ul><li><p>é™æ€å“ˆå¸Œè¡¨ï¼šå¹¶å‘æ§åˆ¶ç®€å•ï¼Œå› ä¸ºçº¿ç¨‹è®¿é—®è·¯å¾„ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚è°ƒæ•´å¤§å°æ—¶åªéœ€ä¸€ä¸ªå…¨å±€é—¨é—©ã€‚</p></li><li><p>åŠ¨æ€å“ˆå¸Œè¡¨ï¼šæ›´å¤æ‚ï¼Œä½†æ€è·¯ç±»ä¼¼ã€‚</p></li><li><p>é—¨é—©ç²’åº¦ï¼š</p><ul><li><p>é¡µçº§é—¨é—©ï¼šæ¯ä¸ªé¡µä¸€ä¸ªè¯»å†™é—¨é—©ã€‚å¹¶è¡Œæ€§è¾ƒä½ï¼Œä½†å•ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€é¡µå†…å¤šä¸ªæ§½æ—¶é€Ÿåº¦å¿«ã€‚</p></li><li><p>æ§½çº§é—¨é—©ï¼šæ¯ä¸ªæ§½ä¸€ä¸ªé—¨é—©ã€‚å¹¶è¡Œæ€§é«˜ï¼Œä½†å­˜å‚¨å’Œè®¡ç®—å¼€é”€å¤§ã€‚å¯ä½¿ç”¨è½»é‡è‡ªæ—‹é—¨é—©å¹³è¡¡å¼€é”€ã€‚</p></li><li><p>æ— é—¨é—©å®ç°ï¼šå¯é€šè¿‡CASæŒ‡ä»¤ç›´æ¥æ„å»ºæ— é”çš„çº¿æ€§æ¢æµ‹å“ˆå¸Œè¡¨ã€‚</p></li></ul></li></ul><h4 id="B-æ ‘çš„å¹¶å‘æ§åˆ¶ï¼ˆé‡ç‚¹ä¸éš¾ç‚¹ï¼‰"><a href="#B-æ ‘çš„å¹¶å‘æ§åˆ¶ï¼ˆé‡ç‚¹ä¸éš¾ç‚¹ï¼‰" class="headerlink" title="B+æ ‘çš„å¹¶å‘æ§åˆ¶ï¼ˆé‡ç‚¹ä¸éš¾ç‚¹ï¼‰"></a>B+æ ‘çš„å¹¶å‘æ§åˆ¶ï¼ˆé‡ç‚¹ä¸éš¾ç‚¹ï¼‰</h4><p>B+æ ‘å¹¶å‘çš„ä¸»è¦æŒ‘æˆ˜æ˜¯é˜²æ­¢çº¿ç¨‹åŒæ—¶ä¿®æ”¹èŠ‚ç‚¹ï¼Œä»¥åŠé˜²æ­¢éå†çº¿ç¨‹é‡åˆ°æ­£åœ¨åˆ†è£‚&#x2F;åˆå¹¶çš„èŠ‚ç‚¹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é—¨é—©æ”€çˆ¬åè®®ã€‚</p><ul><li><p>åŸºæœ¬é—¨é—©æ”€çˆ¬åè®®ï¼š</p><ul><li><p>æ ¸å¿ƒæ€æƒ³ï¼šæ²¿æ ‘å‘ä¸‹éå†æ—¶ï¼Œå…ˆé”ä½çˆ¶èŠ‚ç‚¹ï¼Œå†é”ä½å­èŠ‚ç‚¹ã€‚å¦‚æœå­èŠ‚ç‚¹æ˜¯â€œå®‰å…¨â€çš„ï¼Œå³å¯é‡Šæ”¾æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„é—¨é—©ã€‚</p></li><li><p>å®‰å…¨èŠ‚ç‚¹å®šä¹‰ï¼š</p><ul><li><p>æ’å…¥æ—¶ï¼šèŠ‚ç‚¹æœªæ»¡ã€‚</p></li><li><p>åˆ é™¤æ—¶ï¼šèŠ‚ç‚¹è¶…è¿‡åŠæ»¡ã€‚</p></li></ul></li><li><p>æ“ä½œæµç¨‹ï¼š</p><ul><li><p>æŸ¥æ‰¾ï¼šä½¿ç”¨è¯»é—¨é—©ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå±‚å±‚æ”€çˆ¬ï¼ˆé”å­èŠ‚ç‚¹ï¼Œé‡Šæ”¾çˆ¶èŠ‚ç‚¹ï¼‰ã€‚</p></li><li><p>æ’å…¥&#x2F;åˆ é™¤ï¼šä½¿ç”¨å†™é—¨é—©ï¼Œå‘ä¸‹æ”€çˆ¬ã€‚é‡åˆ°â€œå®‰å…¨â€å­èŠ‚ç‚¹åï¼Œé‡Šæ”¾æ‰€æœ‰ç¥–å…ˆé—¨é—©ã€‚</p></li></ul></li></ul></li><li><p>æ”¹è¿›çš„é—¨é—©æ”€çˆ¬åè®®ï¼š</p><ul><li><p>ç›®çš„ï¼šè§£å†³åŸºæœ¬åè®®ä¸­æ¯æ¬¡æ’å…¥&#x2F;åˆ é™¤éƒ½éœ€å†™é”æ ¹èŠ‚ç‚¹ï¼Œé™åˆ¶å¹¶è¡Œæ€§çš„é—®é¢˜ã€‚</p></li><li><p>æ–¹æ³•ï¼šå‡è®¾åˆ†è£‚&#x2F;åˆå¹¶ç½•è§ï¼Œäº‹åŠ¡å…ˆä½¿ç”¨è¯»é—¨é—©ï¼ˆå¦‚åŒæŸ¥æ‰¾æ“ä½œï¼‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ã€‚ç„¶åå°è¯•è·å–å¶å­èŠ‚ç‚¹çš„å†™é—¨é—©ã€‚</p></li><li><p>éªŒè¯ï¼šè‹¥å¶å­èŠ‚ç‚¹æ˜¯â€œå®‰å…¨â€çš„ï¼Œåˆ™ç›´æ¥æ“ä½œã€‚</p></li><li><p>é‡è¯•ï¼šè‹¥å¶å­èŠ‚ç‚¹â€œä¸å®‰å…¨â€ï¼Œåˆ™é‡Šæ”¾æ‰€æœ‰é—¨é—©ï¼Œé‡å¯äº‹åŠ¡å¹¶ä½¿ç”¨åŸºæœ¬åè®®ï¼ˆä»å¤´è·å–å†™é—¨é—©ï¼‰æ¥æ‰§è¡Œã€‚</p></li></ul></li><li><p>å¶å­èŠ‚ç‚¹æ‰«æä¸æ­»é”ï¼š</p><ul><li><p>é—¨é—©æ”€çˆ¬ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼‰æœ¬èº«ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚</p></li><li><p>ä½†å¶å­èŠ‚ç‚¹æ‰«æï¼ˆæ¨ªå‘éå†ï¼‰å¯èƒ½å¼•å‘æ­»é”ï¼Œå› ä¸ºçº¿ç¨‹å¯èƒ½ä»ä¸¤ä¸ªæ–¹å‘åŒæ—¶è¯·æ±‚æ’ä»–é—¨é—©ã€‚</p></li><li><p>è§£å†³æ–¹æ¡ˆï¼šç¼–ç æ—¶é‡‡ç”¨ â€œä¸ç­‰å¾…â€æ¨¡å¼ã€‚è‹¥æ— æ³•ç«‹å³è·å–å…„å¼ŸèŠ‚ç‚¹çš„é—¨é—©ï¼Œåˆ™æ“ä½œåº”ä¸­æ­¢å¹¶é‡å¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…ã€‚è¿™éœ€è¦ç”±æ›´é«˜å±‚æ¬¡çš„ç³»ç»Ÿè°ƒåº¦å™¨æ¥å¤„ç†é«˜ç«äº‰åœºæ™¯ã€‚</p></li></ul></li></ul><h4 id="èŸ¹è¡Œåè®®"><a href="#èŸ¹è¡Œåè®®" class="headerlink" title="èŸ¹è¡Œåè®®"></a>èŸ¹è¡Œåè®®</h4><p>èŸ¹è¡Œåè®®æ˜¯ä¸€ç§åŸºäºé”çš„æ‚²è§‚å¹¶å‘æ§åˆ¶æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨å‘ä¸‹éå†æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆè·å–å­èŠ‚ç‚¹çš„é”ï¼Œç„¶åå†é‡Šæ”¾çˆ¶èŠ‚ç‚¹çš„é”</strong>ã€‚å°±åƒèƒèŸ¹èµ°è·¯ä¸€æ ·ï¼Œä¸€åªé’³å­ï¼ˆé”ï¼‰å…ˆæŠ“ä½å‰æ–¹ï¼Œåé¢çš„é’³å­ï¼ˆé”ï¼‰æ‰æ¾å¼€ã€‚</p><p><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼š</p><ol><li>æœç´¢æ“ä½œï¼š</li></ol><ul><li><p>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹å…¶åŠ <strong>å…±äº«é”</strong>ã€‚</p></li><li><p>åˆ°æ­£ç¡®çš„å­èŠ‚ç‚¹åï¼Œå¯¹å­èŠ‚ç‚¹åŠ <strong>å…±äº«é”</strong>ã€‚</p></li><li><p>é‡Šæ”¾çˆ¶èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰çš„é”ã€‚</p></li><li><p>é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°å¶å­èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œæœç´¢è·¯å¾„ä¸Šæ€»æ˜¯è‡³å°‘æŒæœ‰ä¸€ä¸ªé”ï¼Œé˜²æ­¢éå†è¿‡ç¨‹ä¸­æ ‘ç»“æ„è¢«ä¿®æ”¹</p></li></ul><ol><li>æ’å…¥&#x2F;åˆ é™¤æ“ä½œï¼š</li></ol><ul><li>å‰åŠéƒ¨åˆ†ä¸æœç´¢ç±»ä¼¼ï¼Œä½†ä½¿ç”¨<strong>äº’æ–¥é”</strong>ï¼šå¯¹çˆ¶èŠ‚ç‚¹åŠ äº’æ–¥é”ï¼Œç„¶åå¯¹å­èŠ‚ç‚¹åŠ äº’æ–¥é”ï¼Œé‡Šæ”¾çˆ¶èŠ‚ç‚¹ï¼Œç»§ç»­å‘ä¸‹ã€‚</li><li>å…³é”®ç‚¹ï¼šå½“çº¿ç¨‹åˆ°è¾¾å¶å­èŠ‚ç‚¹å¹¶åŠ äº’æ–¥é”åï¼Œå®ƒéœ€è¦æ£€æŸ¥æ˜¯å¦ä¼šè§¦å‘ç»“æ„ä¿®æ”¹ï¼ˆå¦‚åˆ†è£‚æˆ–åˆå¹¶ï¼‰ã€‚</li><li>å®‰å…¨æ£€æŸ¥ï¼šå¦‚æœä¸ä¼šè§¦å‘ï¼ˆä¾‹å¦‚ï¼Œæ’å…¥åå¶å­èŠ‚ç‚¹ä»æœ‰ç©ºé—´ï¼‰ï¼Œåˆ™ç›´æ¥æ“ä½œï¼Œé‡Šæ”¾é”ã€‚</li><li>å¦‚æœä¼šè§¦å‘ï¼ˆæœ€å¤æ‚çš„æƒ…å†µï¼‰ï¼šçº¿ç¨‹å¿…é¡»ä»æ ¹èŠ‚ç‚¹å¼€å§‹é‡æ–°éå†ï¼Œä½†è¿™æ¬¡åœ¨å‘ä¸‹è¿‡ç¨‹ä¸­ï¼Œå®ƒå¯¹å¯èƒ½éœ€è¦è¿›è¡Œç»“æ„ä¿®æ”¹çš„æ‰€æœ‰è·¯å¾„ä¸Šçš„èŠ‚ç‚¹éƒ½æŒæœ‰äº’æ–¥é”ã€‚è¿™ç¡®ä¿äº†åœ¨ä¿®æ”¹å¶å­èŠ‚ç‚¹å¹¶å‘ä¸Šé€’å½’åˆ†è£‚çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹èƒ½å¹²æ‰°è¿™æ¡è·¯å¾„ã€‚</li></ul><h4 id="B-Link-Tree-åè®®"><a href="#B-Link-Tree-åè®®" class="headerlink" title="B-Link Tree åè®®"></a>B-Link Tree åè®®</h4><p>B-Link Treeæ˜¯å¯¹B+æ ‘çš„ä¸€ç§æ”¹è¿›ï¼Œå®ƒé‡‡ç”¨äº†æ›´ä¹è§‚çš„ã€é”è€¦åˆç¨‹åº¦æ›´ä½çš„æ–¹æ³•ã€‚å®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­å¢åŠ ä¸€ä¸ªâ€œæŒ‡å‘å³å…„å¼ŸèŠ‚ç‚¹â€çš„æŒ‡é’ˆï¼ˆå³ Link æŒ‡é’ˆï¼‰æ¥é¿å…åœ¨æ’å…¥&#x2F;åˆ é™¤æ—¶é•¿æœŸæŒæœ‰é«˜å±‚èŠ‚ç‚¹çš„é”ã€‚</p><p><strong>æ ¸å¿ƒè®¾è®¡</strong>ï¼š</p><ul><li><p>èŠ‚ç‚¹ç»“æ„å˜åŒ–ï¼šæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ª high-keyï¼ˆå½“å‰å­æ ‘çš„æœ€å¤§é”®ï¼‰å’Œä¸€ä¸ª pointer-to-next-right-siblingï¼ˆæŒ‡å‘å³å…„å¼Ÿçš„æŒ‡é’ˆï¼‰ã€‚</p></li><li><p>æœç´¢ä¼˜åŒ–ï¼šå¦‚æœæœç´¢æ—¶åœ¨å½“å‰èŠ‚ç‚¹æ‰¾ä¸åˆ°é”®ï¼Œå¹¶ä¸”é”®å€¼å¤§äºèŠ‚ç‚¹çš„ high-keyï¼Œè¯´æ˜å®ƒå¯èƒ½è¢«åˆ†è£‚åˆ°äº†å³è¾¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œäºæ˜¯é¡ºç€ Link æŒ‡é’ˆå‘å³æŸ¥æ‰¾ã€‚è¿™å…è®¸æœç´¢æ“ä½œåœ¨æ— éœ€é”ä¿æŠ¤çš„æƒ…å†µä¸‹åº”å¯¹å¹¶å‘çš„åˆ†è£‚ã€‚</p></li></ul><p><strong>æ€»ç»“å¯¹æ¯”</strong></p><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">èŸ¹è¡Œåè®®</th><th align="left">B-Link Tree åè®®</th></tr></thead><tbody><tr><td align="left">å“²å­¦</td><td align="left">æ‚²è§‚ï¼šå‡è®¾å†²çªä¼šå‘ç”Ÿï¼Œé€šè¿‡é”æå‰é¢„</td><td align="left">é˜²ä¹è§‚ï¼šå‡è®¾å†²çªä¸å¸¸å‘ç”Ÿï¼Œå‘ç”Ÿæ—¶å†è§£å†³</td></tr><tr><td align="left">è¯»æ“ä½œ</td><td align="left">éœ€è¦è·å–å…±äº«é”</td><td align="left">å®Œå…¨æ— é”ï¼Œæ€§èƒ½æé«˜</td></tr><tr><td align="left">å†™æ“ä½œ</td><td align="left">é”ç²’åº¦å¤§ï¼Œå¯èƒ½éœ€è¦é‡æ–°éå†å¹¶é”å®šæ•´æ¡è·¯å¾„</td><td align="left">é”ç²’åº¦å°ï¼ˆä»…å¶å­èŠ‚ç‚¹ï¼‰ï¼Œæ“ä½œå±€éƒ¨åŒ–</td></tr><tr><td align="left">å¤æ‚åº¦</td><td align="left">ç›¸å¯¹ç®€å•ï¼Œæ˜“äºç†è§£</td><td align="left">å®ç°å¤æ‚ï¼Œéœ€è¦å¤„ç†é“¾æ¥æŒ‡é’ˆå’Œè¾¹ç•Œæ¡ä»¶æ€§èƒ½é”ç«äº‰å¯èƒ½æˆä¸ºç“¶é¢ˆåœ¨é«˜å¹¶å‘è¯»åœºæ™¯ä¸‹æ€§èƒ½ä¼˜å¼‚</td></tr></tbody></table><h2 id="ç¬¬åä¸€è®²ï¼šæ’åºä¸èšåˆç®—æ³•"><a href="#ç¬¬åä¸€è®²ï¼šæ’åºä¸èšåˆç®—æ³•" class="headerlink" title="ç¬¬åä¸€è®²ï¼šæ’åºä¸èšåˆç®—æ³•"></a>ç¬¬åä¸€è®²ï¼šæ’åºä¸èšåˆç®—æ³•</h2><h3 id="æŸ¥è¯¢è®¡åˆ’ï¼ˆquery-planï¼‰"><a href="#æŸ¥è¯¢è®¡åˆ’ï¼ˆquery-planï¼‰" class="headerlink" title="æŸ¥è¯¢è®¡åˆ’ï¼ˆquery planï¼‰"></a>æŸ¥è¯¢è®¡åˆ’ï¼ˆquery planï¼‰</h3><p>æ•°æ®åº“ç³»ç»Ÿå°† SQL ç¼–è¯‘æˆæŸ¥è¯¢è®¡åˆ’ã€‚<strong>æŸ¥è¯¢è®¡åˆ’æ˜¯ä¸€æ£µæ“ä½œç¬¦æ ‘</strong>ã€‚</p><p>å¯¹äºé¢å‘ç£ç›˜çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå°†ä½¿ç”¨ç¼“å†²æ± æ¥å®ç°éœ€è¦æº¢å‡ºåˆ°ç£ç›˜çš„ç®—æ³•ã€‚</p><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œå› ä¸ºåœ¨å…³ç³»æ¨¡å‹ä¸­ï¼Œè¡¨ä¸­çš„å…ƒç»„æ²¡æœ‰ç‰¹å®šçš„é¡ºåºã€‚æ’åºï¼ˆå¯èƒ½ï¼‰ç”¨äº ORDER BYã€GROUP BYã€JOIN å’Œ DISTINCT è¿ç®—ç¬¦ä¸­ã€‚</p><ul><li>å¦‚æœéœ€è¦æ’åºçš„æ•°æ®é€‚åˆå†…å­˜ï¼Œé‚£ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå¯ä»¥ä½¿ç”¨æ ‡å‡†æ’åºç®—æ³•ï¼ˆä¾‹å¦‚<strong>å¿«é€Ÿæ’åº</strong>ï¼‰ã€‚</li><li>å¦‚æœæ•°æ®ä¸é€‚åˆå†…å­˜ï¼Œé‚£ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿéœ€è¦ä½¿ç”¨<strong>å¤–éƒ¨æ’åº</strong>ï¼Œè¯¥æ’åºèƒ½å¤Ÿæ ¹æ®éœ€è¦æº¢å‡ºåˆ°ç£ç›˜ï¼Œå¹¶å€¾å‘äºé¡ºåº I&#x2F;O è€Œä¸æ˜¯éšæœº I&#x2F;Oã€‚</li></ul><h4 id="Top-N-å †æ’åº"><a href="#Top-N-å †æ’åº" class="headerlink" title="Top-N å †æ’åº"></a>Top-N å †æ’åº</h4><p><strong>ä¸€ã€æ¦‚å¿µ</strong></p><p><strong>Top-N å †æ’åº</strong> æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿæ‰¾å‡ºæ•°æ®é›†ä¸­<strong>æœ€å¤§æˆ–æœ€å°çš„ N ä¸ªå…ƒç´ çš„ç®—æ³•</strong>ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p><ul><li><p><strong>ä¸éœ€è¦</strong> å¯¹å…¨éƒ¨æ•°æ®è¿›è¡Œå®Œæ•´çš„æ’åºã€‚</p></li><li><p>åªéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º <strong>N</strong> çš„æ•°æ®ç»“æ„ï¼ˆé€šå¸¸æ˜¯ <strong>å †</strong>ï¼Œå³ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ï¼Œé€šè¿‡å•æ¬¡æ‰«ææ•°æ®ï¼Œä¸æ–­æ›´æ–°è¿™ä¸ªç»“æ„ï¼Œæœ€ç»ˆå¾—åˆ° Top-N çš„ç»“æœã€‚</p></li></ul><p><strong>äºŒã€åŸç†</strong></p><p>æ•°æ®åº“åœ¨å¤„ç†ç±»ä¼¼ <code>SELECT ... FROM ... ORDER BY score DESC LIMIT N;</code> çš„æŸ¥è¯¢æ—¶ï¼Œä¼šä½¿ç”¨æ­¤ç®—æ³•ã€‚</p><p><strong>æ•°æ®ç»“æ„ï¼šå †</strong></p><ul><li><p><strong>æœ€å¤§å †</strong>ï¼šå †é¡¶å…ƒç´ æ˜¯å †ä¸­æœ€å¤§çš„ã€‚ç”¨äºå¿«é€Ÿè·å–æœ€å¤§å€¼ã€‚</p></li><li><p><strong>æœ€å°å †</strong>ï¼šå †é¡¶å…ƒç´ æ˜¯å †ä¸­æœ€å°çš„ã€‚ç”¨äºå¿«é€Ÿè·å–æœ€å°å€¼ã€‚</p></li></ul><p><strong>å…³é”®é€‰æ‹©ï¼šä½¿ç”¨å“ªç§å †å–å†³äºæˆ‘ä»¬è¦æ‰¾çš„æ˜¯æœ€å¤§çš„ N ä¸ªè¿˜æ˜¯æœ€å°çš„ N ä¸ªã€‚</strong></p><p><strong>ç®—æ³•æ­¥éª¤</strong>ï¼ˆä»¥æŸ¥æ‰¾ <strong>æœ€å¤§çš„ N ä¸ªå…ƒç´ </strong> ä¸ºä¾‹ï¼‰</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª <strong>æœ€å°å †</strong>ã€‚</p><ol><li><p><strong>åˆå§‹åŒ–</strong>ï¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ã€å¤§å°ä¸º N çš„æœ€å°å †ã€‚</p></li><li><p><strong>é¦–æ¬¡å¡«å……</strong>ï¼šä»æ•°æ®æºï¼ˆè¡¨æ‰«æï¼‰ä¸­è¯»å–å‰ N ä¸ªå…ƒç»„ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨æ’å…¥æœ€å°å †ã€‚æ­¤æ—¶ï¼Œå †é¡¶å…ƒç´ æ˜¯è¿™ N ä¸ªå…ƒç´ ä¸­æœ€å°çš„ï¼Œä¹Ÿå°±æ˜¯å½“å‰çœ‹åˆ°çš„â€œç¬¬ N å¤§â€çš„å€™é€‰è€…ã€‚</p></li><li><p><strong>æ‰«æä¸æ¯”è¾ƒ</strong>ï¼šç»§ç»­æ‰«æå‰©ä½™çš„æ¯ä¸€ä¸ªå…ƒç»„ã€‚</p><ul><li><p>å°†å½“å‰å…ƒç»„çš„æ’åºé”®ï¼ˆå¦‚ <code>score</code>ï¼‰ä¸å †é¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p></li><li><p><strong>å¦‚æœå½“å‰å…ƒç»„æ¯”å †é¡¶å…ƒç´ æ›´å°ï¼ˆæˆ–ç­‰äºï¼‰</strong>ï¼šè¯´æ˜å®ƒä¸å¯èƒ½è¿›å…¥æœ€å¤§çš„ N ä¸ªä¹‹åˆ—ï¼Œç›´æ¥ä¸¢å¼ƒã€‚</p></li><li><p><strong>å¦‚æœå½“å‰å…ƒç»„æ¯”å †é¡¶å…ƒç´ æ›´å¤§</strong>ï¼šè¯´æ˜å®ƒåº”è¯¥è¿›å…¥ Top-Nã€‚æ­¤æ—¶æˆ‘ä»¬ï¼š</p><p>  a. å°†å½“å‰çš„å †é¡¶å…ƒç´ ï¼ˆå½“å‰æœ€å°çš„ Top-N å…ƒç´ ï¼‰ç§»é™¤ã€‚</p><p>  b. å°†æ–°çš„ã€æ›´å¤§çš„å…ƒç»„æ’å…¥å †ä¸­ã€‚</p><p>  c. å †ä¼šé‡æ–°è°ƒæ•´ç»“æ„ï¼Œæ–°çš„å †é¡¶å…ƒç´ ä¼šæˆä¸ºæ–°çš„â€œé—¨æ§›â€ï¼ˆå³æ–°çš„â€œç¬¬ N å¤§â€çš„å€™é€‰è€…ï¼‰ã€‚</p></li></ul></li><li><p><strong>æœ€ç»ˆç»“æœ</strong>ï¼šå½“æ•´ä¸ªè¡¨æ‰«æå®Œæ¯•åï¼Œå †ä¸­å‰©ä¸‹çš„ N ä¸ªå…ƒç´ å°±æ˜¯æ•´ä¸ªæ•°æ®é›†ä¸­æœ€å¤§çš„ N ä¸ªå…ƒç´ ã€‚</p></li><li><p><strong>è¾“å‡º</strong>ï¼šå¦‚æœéœ€è¦æŒ‰ä»å¤§åˆ°å°è¾“å‡ºï¼Œå¯ä»¥å°†å †ä¸­çš„å…ƒç´ ä¾æ¬¡å¼¹å‡ºï¼ˆæˆ–åå‘æ’åºï¼‰ã€‚</p></li></ol><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æœ€å°å †ï¼Ÿ</strong></p><p>å› ä¸ºæœ€å°å †çš„å †é¡¶æ˜¯â€œå®ˆé—¨å‘˜â€ï¼Œå®ƒä»£è¡¨äº†å½“å‰ Top-N é›†åˆä¸­çš„æœ€å°å€¼ã€‚ä»»ä½•æ–°æ¥çš„å…ƒç´ ï¼Œåªæœ‰èƒ½æ‰“è´¥è¿™ä¸ªâ€œå®ˆé—¨å‘˜â€ï¼Œæ‰æœ‰èµ„æ ¼è¿›å…¥é›†åˆã€‚è¿™ä¿è¯äº†é›†åˆä¸­å§‹ç»ˆæ˜¯è¿„ä»Šä¸ºæ­¢çœ‹åˆ°çš„æœ€å¤§çš„ N ä¸ªå…ƒç´ ã€‚</p><p><strong>ï¼ˆåä¹‹äº¦ç„¶ï¼‰</strong>ï¼šå¦‚æœè¦æ‰¾ <strong>æœ€å°çš„ N ä¸ªå…ƒç´ </strong>ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸€ä¸ª <strong>æœ€å¤§å †</strong>ã€‚å †é¡¶æ˜¯å½“å‰ Top-N é›†åˆä¸­çš„æœ€å¤§å€¼ï¼Œä½œä¸ºâ€œé—¨æ§›â€ã€‚æ–°å…ƒç´ åªæœ‰æ¯”è¿™ä¸ªé—¨æ§›æ›´å°ï¼Œæ‰èƒ½è¿›å…¥ã€‚</p><p><strong>ä¸‰ã€ä¼˜åŠ¿</strong></p><ul><li><p><strong>æä½çš„å†…å­˜å ç”¨</strong>ï¼šå†…å­˜ä¸­åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º N çš„å †ã€‚åªè¦ N ä¸å¤§ï¼Œæ•´ä¸ªæ“ä½œå¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå®Œå…¨é¿å…äº†æ˜‚è´µçš„ç£ç›˜æº¢å‡ºï¼ˆSpill to Diskï¼‰ã€‚</p></li><li><p><strong>é«˜æ•ˆçš„æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p><ul><li><p>æ„å»ºåˆå§‹å †ï¼š<code>O(N)</code></p></li><li><p>å¤„ç†å‰©ä½™æ¯ä¸ªå…ƒç´ ï¼ˆæœ€åæƒ…å†µï¼‰ï¼š<code>O((M-N) * log N)</code>ï¼Œå…¶ä¸­ M æ˜¯æ€»å…ƒç»„æ•°ã€‚</p></li><li><p>æ€»å¤æ‚åº¦çº¦ä¸º <code>O(M log N)</code>ï¼Œè¿™æ¯”å…¨æ’åºçš„ <code>O(M log M)</code> è¦é«˜æ•ˆå¾—å¤šï¼Œå°¤å…¶æ˜¯å½“ M è¿œå¤§äº N æ—¶ï¼ˆè¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µï¼‰ã€‚</p></li></ul></li><li><p><strong>I&#x2F;O ä¼˜åŠ¿</strong>ï¼šåªéœ€è¦å¯¹æ•°æ®è¿›è¡Œ <strong>å•æ¬¡é¡ºåºæ‰«æ</strong>ï¼Œè¿™å¯¹ç£ç›˜I&#x2F;Oéå¸¸å‹å¥½ã€‚</p></li></ul><h4 id="å¤–éƒ¨å½’å¹¶æ’åº"><a href="#å¤–éƒ¨å½’å¹¶æ’åº" class="headerlink" title="å¤–éƒ¨å½’å¹¶æ’åº"></a>å¤–éƒ¨å½’å¹¶æ’åº</h4><p>å¤–éƒ¨å½’å¹¶æ’åºæ˜¯æ•°æ®åº“ç³»ç»Ÿä¸­å¤„ç†æ— æ³•ä¸€æ¬¡æ€§è£…å…¥å†…å­˜çš„å¤§æ•°æ®é›†æ’åºé—®é¢˜çš„æ ¸å¿ƒç®—æ³•ã€‚<br><a href="https://www.bilibili.com/video/BV1V94y1q7cC/?spm_id_from=333.337.search-card.all.click">å¤–éƒ¨å½’å¹¶æ’åº</a></p><p><strong>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</strong></p><p><strong>é—®é¢˜èƒŒæ™¯</strong></p><ul><li><p><strong>å†…å­˜é™åˆ¶</strong>ï¼šå½“éœ€è¦æ’åºçš„æ•°æ®é‡è¿œå¤§äºå¯ç”¨å†…å­˜æ—¶ï¼Œæ— æ³•ä½¿ç”¨å¿«é€Ÿæ’åºç­‰å†…å­˜æ’åºç®—æ³•</p></li><li><p><strong>ç£ç›˜I&#x2F;Oç‰¹æ€§</strong>ï¼šç£ç›˜é¡ºåºè¯»å†™è¿œå¿«äºéšæœºè¯»å†™ï¼Œç®—æ³•è®¾è®¡è¦æœ€å¤§åŒ–é¡ºåºI&#x2F;O</p></li><li><p><strong>ç¼“å†²åŒºç®¡ç†</strong>ï¼šæ•°æ®åº“æœ‰å›ºå®šæ•°é‡çš„ç¼“å†²é¡µï¼ˆå¦‚Bä¸ªï¼‰ï¼Œç®—æ³•éœ€è¦åœ¨æ­¤çº¦æŸä¸‹å·¥ä½œ</p></li></ul><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><p><strong>åˆ†è€Œæ²»ä¹‹</strong>ï¼šå°†å¤§æ•°æ®é›†åˆ†è§£ä¸ºèƒ½æ”¾å…¥å†…å­˜çš„å°å—ï¼Œåˆ†åˆ«æ’åºåå†åˆå¹¶ã€‚</p><p><strong>äºŒã€ç®—æ³•åŸç†ä¸æ­¥éª¤</strong></p><p><strong>ä¸¤é˜¶æ®µè®¾è®¡</strong></p><p><strong>é˜¶æ®µ1ï¼šæ’åºé˜¶æ®µ</strong></p><ol><li><p><strong>åˆ†å—è¯»å–</strong>ï¼šæ¯æ¬¡ä»ç£ç›˜è¯»å–æ°å¥½èƒ½å¡«æ»¡å†…å­˜ç¼“å†²åŒºçš„æ•°æ®é¡µï¼ˆBé¡µï¼‰</p></li><li><p><strong>å†…éƒ¨æ’åº</strong>ï¼šåœ¨å†…å­˜ä¸­ä½¿ç”¨å¿«é€Ÿæ’åºç­‰ç®—æ³•å¯¹è¿™æ‰¹æ•°æ®æ’åº</p></li><li><p><strong>å†™å…¥è¿è¡Œ</strong>ï¼šå°†æ’åºåçš„æ•°æ®ä½œä¸ºä¸€ä¸ª<strong>æœ‰åºè¿è¡Œ</strong>å†™å›ç£ç›˜</p></li><li><p><strong>é‡å¤</strong>ï¼šç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½è¢«å¤„ç†å®Œï¼Œç”ŸæˆMä¸ªæœ‰åºçš„è¿è¡Œæ–‡ä»¶</p></li></ol><p><strong>å…³é”®ç‚¹</strong>ï¼šæ¯ä¸ªè¿è¡Œå†…éƒ¨æœ‰åºï¼Œä½†è¿è¡Œä¹‹é—´æ— åºã€‚</p><p><strong>é˜¶æ®µ2ï¼šåˆå¹¶é˜¶æ®µ</strong></p><ol><li><p><strong>å¤šè·¯åˆå¹¶</strong>ï¼šåŒæ—¶ä»Kä¸ªè¿è¡Œä¸­å„è¯»å…¥ä¸€é¡µåˆ°å†…å­˜ç¼“å†²åŒº</p></li><li><p><strong>å½’å¹¶æ¯”è¾ƒ</strong>ï¼šæ¯”è¾ƒå„ç¼“å†²åŒºçš„å½“å‰æœ€å°å…ƒç´ ï¼Œé€‰æ‹©æœ€å°çš„è¾“å‡º</p></li><li><p><strong>ç¼“å†²åŒºç®¡ç†</strong>ï¼šæŸä¸ªç¼“å†²åŒºçš„æ•°æ®ç”¨å®Œåï¼Œä»å¯¹åº”è¿è¡Œè¯»å…¥ä¸‹ä¸€é¡µ</p></li><li><p><strong>ç”Ÿæˆæ–°è¿è¡Œ</strong>ï¼šåˆå¹¶ç»“æœå†™å›ç£ç›˜ï¼Œå½¢æˆæ›´å¤§çš„æœ‰åºè¿è¡Œ</p></li><li><p><strong>é€’å½’åˆå¹¶</strong>ï¼šé‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®åˆå¹¶æˆä¸€ä¸ªå®Œæ•´æœ‰åºæ•°æ®é›†</p></li></ol><h3 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h3><p>æŸ¥è¯¢è®¡åˆ’ä¸­çš„èšåˆæ“ä½œç¬¦å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç»„çš„å€¼èšåˆæˆå•ä¸ªæ ‡é‡å€¼ã€‚å®ç°èšåˆæœ‰ä¸¤ç§æ–¹æ³•ï¼š(1) æ’åºå’Œ (2) å“ˆå¸Œã€‚</p><h4 id="æ’åº-1"><a href="#æ’åº-1" class="headerlink" title="æ’åº"></a>æ’åº</h4><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰é¦–å…ˆæ ¹æ® GROUP BY é”®å¯¹å…ƒç»„è¿›è¡Œæ’åºã€‚å¦‚æœæ‰€æœ‰æ•°æ®éƒ½èƒ½é€‚åº”ç¼“å†²æ± ï¼ˆä¾‹å¦‚ï¼Œå¿«é€Ÿæ’åºï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å†…å­˜ä¸­çš„æ’åºç®—æ³•ï¼›å¦‚æœæ•°æ®é‡è¶…è¿‡å†…å­˜ï¼Œåˆ™ä½¿ç”¨å¤–éƒ¨å½’å¹¶æ’åºç®—æ³•ã€‚DBMS éšåå¯¹æ’åºåçš„æ•°æ®è¿›è¡Œé¡ºåºæ‰«æä»¥è®¡ç®—èšåˆã€‚è¯¥æ“ä½œå™¨çš„è¾“å‡ºå°†æŒ‰é”®æ’åºã€‚</p><p>åœ¨è¿›è¡Œæ’åºèšåˆæ—¶ï¼Œé‡è¦çš„æ˜¯å¯¹æŸ¥è¯¢æ“ä½œè¿›è¡Œæ’åºä»¥æœ€å¤§åŒ–æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸ¥è¯¢éœ€è¦è¿‡æ»¤ï¼Œæœ€å¥½å…ˆæ‰§è¡Œè¿‡æ»¤ï¼Œç„¶åå†å¯¹è¿‡æ»¤åçš„æ•°æ®è¿›è¡Œæ’åºï¼Œä»¥å‡å°‘éœ€è¦æ’åºçš„æ•°æ®é‡ã€‚</p><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/sort.png" alt="æ’åºèšåˆ" style="display: block; margin: 0 auto; width: 50%; height:50%;"><h4 id="å“ˆå¸Œ-æ•£åˆ—"><a href="#å“ˆå¸Œ-æ•£åˆ—" class="headerlink" title="å“ˆå¸Œ(æ•£åˆ—)"></a>å“ˆå¸Œ(æ•£åˆ—)</h4><p>å¯¹äºè®¡ç®—èšåˆè€Œè¨€ï¼Œå“ˆå¸Œçš„æ•ˆç‡å¯èƒ½æ¯”æ’åºæ›´é«˜ï¼Œå°¤å…¶æ˜¯åœ¨è¾“å‡ºé¡ºåºä¸é‡è¦çš„æƒ…å†µä¸‹ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰åœ¨æ‰«æè¡¨æ—¶ä¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ªä¸´æ—¶å“ˆå¸Œè¡¨ã€‚å¯¹äºæ¯æ¡è®°å½•ï¼Œæ£€æŸ¥å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å·²å­˜åœ¨æ¡ç›®ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚å¦‚æœå“ˆå¸Œè¡¨çš„å¤§å°è¶…å‡ºå†…å­˜å®¹é‡ï¼ŒDBMS éœ€è¦å°†å…¶æº¢å†™åˆ°ç£ç›˜ä¸Šã€‚å½“æ•°æ®ä¸é€‚åˆå†…å­˜æ—¶ï¼Œé€šå¸¸é‡‡ç”¨åˆ†æ²»ç­–ç•¥æ¥è®¡ç®—èšåˆï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>å¤„ç†å¤§æ•°æ®ï¼ˆå¤–éƒ¨å“ˆå¸Œèšåˆï¼‰</strong>ï¼šå½“å“ˆå¸Œè¡¨å¤ªå¤§æ— æ³•æ”¾å…¥å†…å­˜æ—¶ï¼Œé‡‡ç”¨ä¸¤é˜¶æ®µæ³•ï¼š<ul><li><strong>é˜¶æ®µ1ï¼šåˆ†åŒº</strong>ï¼šä½¿ç”¨å“ˆå¸Œå‡½æ•° <strong>h1</strong> å°†å…ƒç»„åˆ†å‰²åˆ°ç£ç›˜ä¸Šçš„å¤šä¸ªåˆ†åŒºä¸­ã€‚ä¿è¯åŒä¸€ç»„çš„å…ƒç»„è¿›å…¥åŒä¸€åˆ†åŒºã€‚</li><li><strong>é˜¶æ®µ2ï¼šé‡å“ˆå¸Œ</strong>ï¼šå¯¹äºæ¯ä¸ªåˆ†åŒºï¼Œå°†å…¶è¯»å…¥å†…å­˜ï¼Œå¹¶ä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•° <strong>h2</strong> æ„å»ºä¸€ä¸ªå†…å­˜å“ˆå¸Œè¡¨ã€‚ç„¶ååœ¨è¿™ä¸ªå“ˆå¸Œè¡¨å†…è®¡ç®—æ¯ä¸ªåˆ†ç»„çš„èšåˆå€¼ã€‚æ­¤é˜¶æ®µå‡è®¾æ¯ä¸ªåˆ†åŒºéƒ½èƒ½æ”¾å…¥å†…å­˜ã€‚</li></ul></li></ul><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/hash1.png" alt="å“ˆå¸Œèšåˆ1" style="display: block; margin: 0 auto; width: 50%; height:50%;"><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/hash2.png" alt="å“ˆå¸Œèšåˆ2" style="display: block; margin: 0 auto; width: 50%; height:50%;"><h3 id="æ€»ç»“å¯¹æ¯”"><a href="#æ€»ç»“å¯¹æ¯”" class="headerlink" title="æ€»ç»“å¯¹æ¯”"></a>æ€»ç»“å¯¹æ¯”</h3><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">æ’åºæ³•</th><th align="left">å“ˆå¸Œæ³•</th></tr></thead><tbody><tr><td align="left"><strong>è¾“å‡º</strong></td><td align="left">ç»“æœæœ‰åº</td><td align="left">ç»“æœæ— åº</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">æ•°æ®å·²æ’åºæˆ–éœ€è¦æœ‰åºè¾“å‡ºæ—¶</td><td align="left">é»˜è®¤é€‰æ‹©ï¼Œå°¤å…¶å½“é¡ºåºä¸é‡è¦æ—¶</td></tr><tr><td align="left"><strong>å¤§æ•°æ®å¤„ç†</strong></td><td align="left">å¤–éƒ¨å½’å¹¶æ’åº</td><td align="left">å¤–éƒ¨å“ˆå¸Œèšåˆï¼ˆåˆ†åŒº+é‡å“ˆå¸Œï¼‰</td></tr><tr><td align="left"><strong>ä¸€èˆ¬æ•ˆç‡</strong></td><td align="left">é€šå¸¸æ¯”å“ˆå¸Œæ³•æ…¢</td><td align="left"><strong>é€šå¸¸æ›´é«˜æ•ˆ</strong>ï¼Œé™¤éæ•°æ®å·²é¢„å…ˆæ’åº</td></tr></tbody></table><p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™ä»½æ–‡æ¡£è¯¦ç»†é˜è¿°äº†æ•°æ®åº“åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¦‚ä½•åœ¨å—é™çš„å†…å­˜æ¡ä»¶ä¸‹ï¼Œé€šè¿‡ç²¾å·§çš„ç®—æ³•è®¾è®¡ï¼ˆä¸»è¦æ˜¯å¤–éƒ¨å½’å¹¶æ’åºå’Œå¤–éƒ¨å“ˆå¸Œèšåˆï¼‰é«˜æ•ˆåœ°å®Œæˆæ’åºå’Œèšåˆä»»åŠ¡ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä»½<strong>æ ¹æ®ä½ æä¾›çš„ PDF å†…å®¹æ•´ç†çš„ Markdownï¼ˆMDï¼‰æ ¼å¼ç¬”è®°</strong>ã€‚<br>å†…å®¹ç»è¿‡ç»“æ„åŒ–æ•´ç†ï¼Œä½†<strong>ä¸ä¼šæ”¹å˜åŸå§‹å†…å®¹å«ä¹‰</strong>ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ã€‚</p><h2 id="ç¬¬åäºŒè®²ï¼šè¿æ¥"><a href="#ç¬¬åäºŒè®²ï¼šè¿æ¥" class="headerlink" title="ç¬¬åäºŒè®²ï¼šè¿æ¥"></a>ç¬¬åäºŒè®²ï¼šè¿æ¥</h2><p>æ•°æ®åº“è®¾è®¡çš„ç›®æ ‡ä¹‹ä¸€ï¼š<strong>å‡å°‘é‡å¤ä¿¡æ¯</strong>ã€‚<br>å› æ­¤ä½¿ç”¨è§„èŒƒåŒ–ç†è®ºå°†æ•°æ®æ‹†åˆ†ä¸ºå¤šä¸ªè¡¨ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦é€šè¿‡ <strong>JOIN</strong> æ¢å¤åŸå§‹æ•°æ®ã€‚</p><p>æœ¬èŠ‚ä¸»è¦å…³æ³¨ <strong>inner equijoinï¼ˆç­‰å€¼å†…è¿æ¥ï¼‰</strong> çš„å®ç°ç®—æ³•ã€‚<br>åœ¨æ‰§è¡Œ join æ—¶é€šå¸¸è®© <strong>è¾ƒå°çš„è¡¨ä½œä¸º outer table</strong>ï¼ˆå¤–è¡¨ï¼‰ã€‚<br>å¤šè·¯ joinï¼ˆmulti-way joinsï¼‰ä¸»è¦å‡ºç°åœ¨ç ”ç©¶é¢†åŸŸï¼ˆå¦‚ WCOJï¼‰ã€‚</p><h3 id="Join-Operators"><a href="#Join-Operators" class="headerlink" title="Join Operators"></a>Join Operators</h3><p>æŸ¥è¯¢è®¡åˆ’æ˜¯ä¸€ä¸ª<strong>è‡ªåº•å‘ä¸Šçš„æ ‘ç»“æ„</strong>, join è¾“å‡ºæ˜¯è¿æ¥ä¸¤ä¸ªåŒ¹é…å…ƒç»„ã€‚</p><img src="/img/CMU15-445-Bustub-project-è¯¾ç¨‹å­¦ä¹ ç¬”è®°1/joinOperator.png" alt="æ ‘ç»“æ„" style="display: block; margin: 0 auto; width: 30%; height:30%;"><h3 id="Join-è¾“å‡ºæ–¹å¼"><a href="#Join-è¾“å‡ºæ–¹å¼" class="headerlink" title="Join è¾“å‡ºæ–¹å¼"></a>Join è¾“å‡ºæ–¹å¼</h3><p>DBMS è®¾è®¡ join è¾“å‡ºæ—¶æœ‰ä¸¤ç§ä¸»è¦ç­–ç•¥ï¼š</p><h4 id="æ—©ç‰©åŒ–ï¼ˆEarly-Materializationï¼‰"><a href="#æ—©ç‰©åŒ–ï¼ˆEarly-Materializationï¼‰" class="headerlink" title="æ—©ç‰©åŒ–ï¼ˆEarly Materializationï¼‰"></a>æ—©ç‰©åŒ–ï¼ˆEarly Materializationï¼‰</h4><ul><li>å°† outer ä¸ inner ä¸­éœ€è¦çš„æ‰€æœ‰å±æ€§å¤åˆ¶åˆ°ä¸­é—´ç»“æœã€‚</li><li>ä¼˜ç‚¹ï¼šåç»­æ“ä½œæ— éœ€å†æ¬¡è®¿é—®åº•è¡¨ã€‚</li><li>ç¼ºç‚¹ï¼šéœ€è¦æ›´å¤šå†…å­˜ã€‚</li></ul><h4 id="æ™šç‰©åŒ–ï¼ˆLate-Materializationï¼‰"><a href="#æ™šç‰©åŒ–ï¼ˆLate-Materializationï¼‰" class="headerlink" title="æ™šç‰©åŒ–ï¼ˆLate Materializationï¼‰"></a>æ™šç‰©åŒ–ï¼ˆLate Materializationï¼‰</h4><ul><li>åªå¤åˆ¶ join key å’Œ record idsã€‚</li><li>ç‰¹åˆ«é€‚åˆ <strong>åˆ—å­˜å‚¨ï¼ˆcolumn storeï¼‰</strong>ã€‚</li></ul><blockquote><p>ç°å®ä¸­ DBMS å¾€å¾€æ··åˆä½¿ç”¨æ—©ç‰©åŒ–ä¸æ™šç‰©åŒ–ã€‚</p></blockquote><h3 id="Cost-Modelï¼ˆæˆæœ¬æ¨¡å‹ï¼‰"><a href="#Cost-Modelï¼ˆæˆæœ¬æ¨¡å‹ï¼‰" class="headerlink" title="Cost Modelï¼ˆæˆæœ¬æ¨¡å‹ï¼‰"></a>Cost Modelï¼ˆæˆæœ¬æ¨¡å‹ï¼‰</h3><p>I&#x2F;O æ˜¯æœ€ä¸»è¦çš„æˆæœ¬ï¼ˆå¿½ç•¥è®¡ç®—ä¸ç½‘ç»œä»£ä»·ï¼‰ã€‚<br>æˆæœ¬åŒ…å«ï¼š</p><ul><li>ä»ç£ç›˜è¯»å–é¡µé¢</li><li>å†™å‡ºä¸­é—´ç»“æœ</li></ul><p>ä¸åŒ…å«ï¼š</p><ul><li>è¾“å‡ºæœ€ç»ˆç»“æœçš„ I&#x2F;Oï¼ˆä¸åŒç®—æ³•è¾“å‡ºä¸€è‡´ï¼Œç›¸äº’æ²¡å·®åˆ«ï¼‰</li></ul><p>å‡è®¾ï¼š</p><ul><li>Rï¼ˆouter tableï¼‰æœ‰ M pagesï¼Œm tuples</li><li>Sï¼ˆinner tableï¼‰æœ‰ N pagesï¼Œn tuples</li></ul><p>JOIN é€šå¸¸æ˜¯è‡ªç„¶è¿æ¥ï¼šR â–·â— Sã€‚</p><h3 id="Nested-Loop-Joinï¼ˆåµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#Nested-Loop-Joinï¼ˆåµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="Nested Loop Joinï¼ˆåµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>Nested Loop Joinï¼ˆåµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h3><p>æœ€åŸºæœ¬çš„æƒ³æ³•ï¼šåŒå±‚å¾ªç¯æ¯”è¾ƒæ‰€æœ‰å…ƒç»„ã€‚</p><h4 id="Naive-Nested-Loop-Join"><a href="#Naive-Nested-Loop-Join" class="headerlink" title="Naive Nested Loop Join"></a>Naive Nested Loop Join</h4><p>å¯¹ outer ä¸­æ¯ä¸€ä¸ªå…ƒç»„ï¼Œæ‰«æ inner å…¨è¡¨ã€‚</p><p><strong>Cost:</strong></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">M + (m Ã— <span class="hljs-built_in">N</span>)<br></code></pre></td></tr></table></figure><h4 id="Block-Nested-Loop-Join"><a href="#Block-Nested-Loop-Join" class="headerlink" title="Block Nested Loop Join"></a>Block Nested Loop Join</h4><p>æŒ‰ block å¤„ç†ï¼Œè€Œä¸æ˜¯å•ä¸ª tupleã€‚</p><p>å¦‚æœ buffer æœ‰ B é¡µå¯ç”¨ï¼š</p><ul><li>B-2 é¡µç”¨äº outer</li><li>1 é¡µç”¨äº inner</li><li>1 é¡µç”¨äºç»“æœè¾“å‡º</li></ul><p><strong>Cost:</strong></p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">M + (<span class="hljs-name">ceil</span>(<span class="hljs-name">M</span> / (<span class="hljs-name">B-2</span>)) Ã— N)<br></code></pre></td></tr></table></figure><h4 id="Index-Nested-Loop-Join"><a href="#Index-Nested-Loop-Join" class="headerlink" title="Index Nested Loop Join"></a>Index Nested Loop Join</h4><p>å¦‚æœ inner table ä¸Šæœ‰ join key çš„ç´¢å¼•ï¼š</p><ul><li>outer æ— ç´¢å¼•</li><li>inner æœ‰ç´¢å¼•ï¼ˆæˆ–ä¸´æ—¶æ„å»ºï¼‰</li></ul><p>æ¯ä¸ªå…ƒç»„è¿›è¡Œç´¢å¼• probeï¼Œæˆæœ¬ä¸º Cã€‚</p><p><strong>Cost:</strong></p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">M + (<span class="hljs-name">m</span> Ã— C)<br></code></pre></td></tr></table></figure><p>ç´¢å¼• greatly reduces costã€‚</p><h3 id="Sort-Merge-Join"><a href="#Sort-Merge-Join" class="headerlink" title="Sort-Merge Join"></a>Sort-Merge Join</h3><p>æµç¨‹ï¼š</p><ol><li>å¯¹ R ä¸ S æŒ‰ join key æ’åºï¼ˆå¸¸ç”¨å¤–éƒ¨å½’å¹¶æ’åºï¼‰</li><li>åƒ merge sort ä¸€æ ·çº¿æ€§æ‰«æä¸¤ä¸ªè¡¨è¿›è¡ŒåŒ¹é…</li></ol><p>ä¼˜åŠ¿ï¼š</p><ul><li>å¦‚æœå·²æœ‰ clustered indexï¼Œåˆ™æ— éœ€æ’åº</li><li>æˆ–è€…ç»“æœæœ¬èº«éœ€è¦æŒ‰ join key æ’åº</li></ul><p>ä»£ä»·ï¼ˆå‡è®¾ B é¡µ bufferï¼‰ï¼š</p><ul><li>æ’åºæˆæœ¬ï¼ˆRï¼‰ï¼š</li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-number">2</span><span class="hljs-variable">M</span> Ã— (<span class="hljs-number">1</span> + <span class="hljs-function"><span class="hljs-title">ceil</span>(<span class="hljs-variable">log_</span>&#123;<span class="hljs-variable">B</span>-<span class="hljs-number">1</span>&#125;(<span class="hljs-title">ceil</span>(<span class="hljs-variable">M</span> / <span class="hljs-variable">B</span>))))</span><br></code></pre></td></tr></table></figure><ul><li>æ’åºæˆæœ¬ï¼ˆSï¼‰ï¼š</li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-number">2</span><span class="hljs-variable">N</span> Ã— (<span class="hljs-number">1</span> + <span class="hljs-function"><span class="hljs-title">ceil</span>(<span class="hljs-variable">log_</span>&#123;<span class="hljs-variable">B</span>-<span class="hljs-number">1</span>&#125;(<span class="hljs-title">ceil</span>(<span class="hljs-variable">N</span> / <span class="hljs-variable">B</span>))))</span><br></code></pre></td></tr></table></figure><ul><li>merge æˆæœ¬ï¼š<code>M + N</code></li></ul><h3 id="Hash-Join"><a href="#Hash-Join" class="headerlink" title="Hash Join"></a>Hash Join</h3><p>hash join ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†å…ƒç»„ç»„ç»‡æˆå¤šä¸ªæ¡¶ï¼Œå½“ join key ç›¸ç­‰æ—¶ï¼Œå¿…ç„¶è½å…¥åŒä¸€ä¸ªæ¡¶ã€‚</p><p>é€‚ç”¨èŒƒå›´ï¼š<strong>ç­‰å€¼è¿æ¥(equi-join)</strong>ã€‚</p><h4 id="Basic-Hash-Join"><a href="#Basic-Hash-Join" class="headerlink" title="Basic Hash Join"></a>Basic Hash Join</h4><h5 id="Phase-1ï¼šBuild"><a href="#Phase-1ï¼šBuild" class="headerlink" title="Phase 1ï¼šBuild"></a>Phase 1ï¼šBuild</h5><ul><li>ä½¿ç”¨ outer å»ºç«‹å“ˆå¸Œè¡¨ï¼ˆh1ï¼‰</li></ul><h5 id="Phase-2ï¼šProbe"><a href="#Phase-2ï¼šProbe" class="headerlink" title="Phase 2ï¼šProbe"></a>Phase 2ï¼šProbe</h5><ul><li>å¯¹ inner ä½¿ç”¨ç›¸åŒ h1 å¹¶æŸ¥æ‰¾å¯¹åº”è®°å½•</li></ul><p>ä¼˜åŒ–ï¼š<br>å¯åœ¨ build é˜¶æ®µæ„å»º <strong>Bloom Filter</strong> é¿å…ä¸å¿…è¦çš„ I&#x2F;Oã€‚</p><h4 id="Grace-Hash-Join-ï¼ˆåˆ†åŒºå“ˆå¸Œè¿æ¥ï¼‰"><a href="#Grace-Hash-Join-ï¼ˆåˆ†åŒºå“ˆå¸Œè¿æ¥ï¼‰" class="headerlink" title="Grace Hash Join ï¼ˆåˆ†åŒºå“ˆå¸Œè¿æ¥ï¼‰"></a>Grace Hash Join ï¼ˆåˆ†åŒºå“ˆå¸Œè¿æ¥ï¼‰</h4><p>é€‚åˆæ•°æ®æ”¾ä¸è¿›å†…å­˜çš„æƒ…å†µã€‚</p><h5 id="Phase-1ï¼šPartition"><a href="#Phase-1ï¼šPartition" class="headerlink" title="Phase 1ï¼šPartition"></a>Phase 1ï¼šPartition</h5><ul><li>outer å’Œ inner éƒ½æŒ‰ h1 åˆ†åŒº</li><li>åˆ†åŒºå†™å›ç£ç›˜ï¼ˆå¿…è¦æ—¶é€’å½’åˆ†åŒºï¼‰</li></ul><h5 id="Phase-2ï¼šProbe-1"><a href="#Phase-2ï¼šProbe-1" class="headerlink" title="Phase 2ï¼šProbe"></a>Phase 2ï¼šProbe</h5><ul><li>å¯¹æ¯ä¸ªåˆ†åŒºæ‰§è¡ŒåµŒå¥—å¾ªç¯è¿æ¥ï¼ˆå°è§„æ¨¡ï¼Œå› æ­¤æ˜¯ in-memoryï¼‰</li></ul><p><strong>Cost:</strong></p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Partition</span><span class="hljs-operator">:</span> <span class="hljs-number">2</span> Ã— <span class="hljs-punctuation">(</span><span class="hljs-variable">M</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">N</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">Probe</span><span class="hljs-operator">:</span>     <span class="hljs-variable">M</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">N</span><br><span class="hljs-built_in">Total</span><span class="hljs-operator">:</span>     <span class="hljs-number">3</span> Ã— <span class="hljs-punctuation">(</span><span class="hljs-variable">M</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">N</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><p>çŸ©é˜µå€¾æ–œï¼ˆskewï¼‰æƒ…å†µä¸‹å¯é‡‡ç”¨ Hybrid Hash Joinï¼Œä½†éš¾ä»¥å®ç°ã€‚</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>ä¸åŒ join ç®—æ³•æ€§èƒ½æ€»ç»“ï¼š</p><table><thead><tr><th>Algorithm</th><th>Cost</th><th>Example Time</th></tr></thead><tbody><tr><td>Simple Nested Loop</td><td>M + mÂ·N</td><td>1.4h</td></tr><tr><td>Block Nested Loop</td><td>M + (MÂ·N)</td><td>50s</td></tr><tr><td>Index Nested Loop</td><td>M + mÂ·C</td><td>depends</td></tr><tr><td>Sort-Merge Join</td><td>M + N + sort cost</td><td>0.75s</td></tr><tr><td>Hash Join</td><td>3(M+N)</td><td>0.45s</td></tr></tbody></table><p>ç»“è®ºï¼š</p><ul><li><p>Hash Join é€šå¸¸æœ€å¿«</p></li><li><p>Sort-Merge åœ¨ä»¥ä¸‹æƒ…å†µæ›´å¥½ï¼š</p><ul><li>key åˆ†å¸ƒä¸å‡åŒ€</li><li>æ•°æ®å·²æ’åº</li><li>è¾“å‡ºéœ€è¦æ’åº</li></ul></li><li><p>DBMS é€šå¸¸ä¼šåŠ¨æ€é€‰æ‹©æ’åºæˆ–å“ˆå¸Œ join</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Bustub</tag>
      
      <tag>B+Tree</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-445(Bustub):project1å®ç°ç¬”è®°</title>
    <link href="/2025/09/04/CMU15-445-Bustub-project1%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/09/04/CMU15-445-Bustub-project1%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®åº“å‚¨å­˜åŸç†"><a href="#æ•°æ®åº“å‚¨å­˜åŸç†" class="headerlink" title="æ•°æ®åº“å‚¨å­˜åŸç†"></a>æ•°æ®åº“å‚¨å­˜åŸç†</h2><p>å¦‚ä»Šå‚¨å­˜è®¾å¤‡å¯ä»¥å¤§è‡´åˆ†ä¸º<strong>æ˜“å¤±æ€§è®¾å¤‡</strong>å’Œ<strong>éæ˜“å¤±æ€§è®¾å¤‡</strong>ï¼š</p><ol><li>æ˜“å¤±æ€§è®¾å¤‡(Volatile Devices)â€‹â€‹:</li></ol><ul><li>æ–­ç”µåæ•°æ®ä¸¢å¤±</li><li>æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œå­—èŠ‚å¯»å€</li><li>åœ¨æœ¬è¯¾ç¨‹ä¸­ç»Ÿç§°ä¸ºâ€å†…å­˜â€</li></ul><ol start="2"><li>éæ˜“å¤±æ€§è®¾å¤‡(Non-Volatile Devices)â€‹â€‹:</li></ol><ul><li>æ–­ç”µåæ•°æ®ä¿ç•™</li><li>å—&#x2F;é¡µå¯»å€(é€šå¸¸4KB)</li><li>æ›´é€‚åˆé¡ºåºè®¿é—®</li><li>åœ¨æœ¬è¯¾ç¨‹ä¸­ç»Ÿç§°ä¸ºâ€ç£ç›˜â€(åŒ…æ‹¬SSDå’ŒHDD)</li></ul><p>æœ¬è¯¾ç¨‹å®ç°çš„Bustubæ•°æ®åº“æ˜¯<strong>ç£ç›˜å¯¼å‘çš„DBMS</strong>ï¼š</p><ul><li>æ•°æ®åº“å…¨éƒ¨å­˜å‚¨åœ¨ç£ç›˜ä¸Š</li><li>æ•°æ®ç»„ç»‡ä¸ºé¡µ(page)</li><li>é€šè¿‡ç¼“å†²æ± (buffer pool)ç®¡ç†æ•°æ®åœ¨ç£ç›˜å’Œå†…å­˜é—´çš„ç§»åŠ¨</li><li>æ‰§è¡Œå¼•æ“é€šè¿‡ç¼“å†²æ± è·å–ç‰¹å®šé¡µè¿›è¡Œæ“ä½œ</li></ul><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/interactionProcessesDBMS.png" alt="å…³é”®äº¤äº’æµç¨‹ï¼ˆDBMSè§†è§’ï¼‰" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h3 id="æ—¥å¿—ç»“æ„å­˜å‚¨"><a href="#æ—¥å¿—ç»“æ„å­˜å‚¨" class="headerlink" title="æ—¥å¿—ç»“æ„å­˜å‚¨"></a>æ—¥å¿—ç»“æ„å­˜å‚¨</h3><p>æ—¥å¿—ç»“æ„åˆå¹¶æ ‘(Log-Structured Merge-Tree,<strong>LSM-Tree</strong>)æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„ç£ç›˜å­˜å‚¨æ•°æ®ç»“æ„ï¼Œä¸“é—¨ä¸ºâ€‹â€‹å†™å…¥å¯†é›†å‹â€‹â€‹å·¥ä½œè´Ÿè½½è®¾è®¡ï¼Œå¹¿æ³›åº”ç”¨äºç°ä»£æ•°æ®åº“ç³»ç»Ÿå¦‚LevelDBã€RocksDBã€Cassandraç­‰ã€‚<br>å®ƒçš„è®¾è®¡ç†å¿µæ˜¯<strong>å°†éšæœºå†™å…¥è½¬åŒ–ä¸ºé¡ºåºå†™å…¥</strong>ï¼Œä»¥æé«˜å†™å…¥æ€§èƒ½ã€‚å› ä¸ºåœ¨ä¼ ç»Ÿçš„ç£ç›˜å­˜å‚¨ä¸­ï¼Œé¡ºåºå†™å…¥çš„é€Ÿåº¦è¦æ¯”éšæœºå†™å…¥å¿«å¾—å¤šã€‚</p><h4 id="ç»“æ„ç»„æˆ"><a href="#ç»“æ„ç»„æˆ" class="headerlink" title="ç»“æ„ç»„æˆ"></a>ç»“æ„ç»„æˆ</h4><ul><li><strong>MemTableï¼ˆå†…å­˜è¡¨ï¼‰</strong>ï¼šè¿™æ˜¯ LSM - Tree å­˜å‚¨ç»“æ„çš„æœ€ä¸Šå±‚ã€‚æ–°çš„æ•°æ®é¦–å…ˆä¼šè¢«å†™å…¥åˆ° MemTable ä¸­ã€‚MemTable é€šå¸¸æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æœ‰åºæ•°æ®ç»“æ„ï¼Œæ¯”å¦‚çº¢é»‘æ ‘æˆ–è€…è·³è¡¨ã€‚</li><li><strong>SSTablesï¼ˆSorted String Tablesï¼‰</strong>ï¼šå½“ MemTable è¾¾åˆ°ä¸€å®šçš„å¤§å°åï¼Œå…¶æ•°æ®ä¼šè¢«åˆ·æ–°ï¼ˆflushï¼‰åˆ°ç£ç›˜ä¸Šçš„ SSTablesã€‚SSTables æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„æœ‰åºé”®å€¼å¯¹é›†åˆï¼Œå…¶å†…éƒ¨çš„æ•°æ®æ˜¯æŒ‰ç…§é”®ï¼ˆkeyï¼‰è¿›è¡Œæ’åºçš„ã€‚SSTables å¹¶ä¸æ˜¯å•ä¸ªçš„å¤§æ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„èŒƒå›´ï¼ˆkey çš„åŒºé—´ï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ•°æ®åº“ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ª SSTable è´Ÿè´£å­˜å‚¨å§“åä»¥ A - F å¼€å¤´çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦ä¸€ä¸ª SSTable å­˜å‚¨å§“åä»¥ G - L å¼€å¤´çš„ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</li></ul><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/LogStructuredStorage.png" alt="æ—¥å¿—ç»“æ„å­˜å‚¨" style="display: block; margin: 0 auto; width: 70%; height:70%;"><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>ä¸ç›´æ¥å­˜å‚¨å…ƒç»„ï¼Œè€Œæ˜¯å­˜å‚¨å˜æ›´æ—¥å¿—è®°å½•</li><li>å…ˆåœ¨å†…å­˜æ•°æ®ç»“æ„(MemTable)ä¸­åº”ç”¨å˜æ›´</li><li>ç„¶åé¡ºåºå†™å…¥ç£ç›˜(SSTable)</li><li>è®°å½•åŒ…å«ï¼šå…ƒç»„å”¯ä¸€IDã€æ“ä½œç±»å‹(PUT&#x2F;DELETE)ã€å…ƒç»„å†…å®¹(å¯¹äºPUT)</li></ul><h3 id="ç´¢å¼•ç»„ç»‡å­˜å‚¨"><a href="#ç´¢å¼•ç»„ç»‡å­˜å‚¨" class="headerlink" title="ç´¢å¼•ç»„ç»‡å­˜å‚¨"></a>ç´¢å¼•ç»„ç»‡å­˜å‚¨</h3><p>ç´¢å¼•ç»„ç»‡å­˜å‚¨(IOS, Index-Organized Storage)æ˜¯ä¸€ç§å°†â€‹<strong>â€‹è¡¨æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•ç»“æ„â€‹</strong>â€‹ä¸­çš„æ•°æ®åº“å­˜å‚¨æ–¹å¼ï¼Œä¸ä¼ ç»Ÿå †æ–‡ä»¶(Heap File)å­˜å‚¨å½¢æˆé²œæ˜å¯¹æ¯”ã€‚å¸¸ç”¨ç´¢å¼•ç»“æ„ä¸º<strong>B+æ ‘</strong>ã€‚</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/IOS.png" alt="ä¸ä¼ ç»Ÿå †æ–‡ä»¶å¯¹æ¯”" style="display: block; margin: 0 auto; width: 60%; height:60%;"><h2 id="Bustubçš„ç¼“å­˜æ± ç»“æ„"><a href="#Bustubçš„ç¼“å­˜æ± ç»“æ„" class="headerlink" title="Bustubçš„ç¼“å­˜æ± ç»“æ„"></a>Bustubçš„ç¼“å­˜æ± ç»“æ„</h2><p><img src="/img/CMU15-445-Bustub-project1%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/bpm.png" alt="ç¼“å†²æ± ç®¡ç†"></p><ul><li><strong>pageå¯¹è±¡</strong>ï¼šå†…å­˜ä¸­çš„é¡µè¡¨ç¤ºï¼ŒåŒ…å«è„ä½æ ‡è®°</li><li><strong>â€‹â€‹LRU-Kæ›¿æ¢å™¨</strong>ï¼šæ”¹è¿›çš„LRUç®—æ³•ï¼Œè€ƒè™‘æœ€è¿‘Kæ¬¡è®¿é—®å†å²ï¼Œç”¨äºåˆ·æ–°ä¸å¸¸ç”¨çš„å†…å­˜é¡µ</li></ul><h2 id="Project-1"><a href="#Project-1" class="headerlink" title="Project #1"></a>Project #1</h2><p>å®éªŒä¸€æ˜¯è¦å®ç°ä¸€ä¸ªç¼“å­˜æ± ç®¡ç†å™¨ï¼Œä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªç¨‹åºï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>LRU-Kæ›´æ–°ç­–ç•¥</li><li>ç£ç›˜ç®¡ç†</li><li>ç¼“å­˜æ± ç®¡ç†</li></ul><p><a href="https://15445.courses.cs.cmu.edu/fall2024/project1/">è¦å®Œæˆçš„ä»»åŠ¡è¯¦æƒ…</a></p><h3 id="Task-1-LRU-K-Replacement-Policy"><a href="#Task-1-LRU-K-Replacement-Policy" class="headerlink" title="Task #1 - LRU-K Replacement Policy"></a>Task #1 - LRU-K Replacement Policy</h3><p><strong>â€‹LRU-Kâ€‹â€‹</strong>ï¼ˆLeast Recently Used-Kï¼‰æ˜¯ä¼ ç»ŸLRUç®—æ³•çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œé€šè¿‡è®°å½•æœ€è¿‘Kæ¬¡è®¿é—®çš„å†å²ä¿¡æ¯ï¼Œæ›´å‡†ç¡®åœ°åˆ¤æ–­æ•°æ®çš„â€å†·çƒ­â€ç¨‹åº¦ï¼Œä»è€Œå‡å°‘ç¼“å†²æ± çš„â€ç¼“å­˜æ±¡æŸ“â€é—®é¢˜ã€‚</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/LRU_K.png" alt="LRU-Kç®—æ³•" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p><strong>1) ä»¥ä¸‹ä¸ºLRUâ€”Kç®—æ³•çš„å·¥ä½œæµç¨‹</strong></p><p>è®°å½•å„ä¸ªframeçš„è®¿é—®æ¬¡æ•°</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/LRURecordAccess.png" alt="è®°å½•è®¿é—®" style="display: block; margin: 0 auto; width: 70%; height:70%;"><p>é©±é€è®¿é—®è·ç¦»å¤§äºç­‰äºKçš„ä¸€ä¸ªframe</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/LRUEvict.png" alt="æ·˜æ±°ç•Œé¢" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p><strong>2) LRUKNodeå’ŒLRUKReplacer</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUKNode</span> &#123;<br><br> <span class="hljs-keyword">public</span>:<br>  <span class="hljs-comment">/** History of last seen K timestamps of this page. Least recent timestamp stored in front. */</span><br>  <span class="hljs-comment">// Remove maybe_unused if you start using them. Feel free to change the member variables as you want.</span><br><br>  [[maybe_unused]] std::list&lt;<span class="hljs-type">size_t</span>&gt; history_;<br>  [[maybe_unused]] <span class="hljs-type">size_t</span> k_;<br>  [[maybe_unused]] <span class="hljs-type">frame_id_t</span> fid_;<br>  [[maybe_unused]] <span class="hljs-type">bool</span> is_evictable_&#123;<span class="hljs-literal">false</span>&#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>LRUKNode</strong>è´Ÿè´£â€‹â€‹è·Ÿè¸ªå•ä¸ªå¸§çš„è®¿é—®å†å²â€‹â€‹ï¼Œæ˜¯LRU-Kç®—æ³•çš„åŸºæœ¬æ•°æ®å•å…ƒã€‚</p><table><thead><tr><th align="left">å˜é‡å</th><th align="center">ç±»å‹</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">history_</td><td align="center">std::list<size_t></td><td align="center">æŒ‰æ—¶é—´é¡ºåºå­˜å‚¨æœ€è¿‘Kæ¬¡è®¿é—®çš„æ—¶é—´æˆ³ï¼Œæœ€æ—©çš„æ—¶é—´æˆ³åœ¨åˆ—è¡¨å‰ç«¯</td></tr><tr><td align="left">k_</td><td align="center">size_t</td><td align="center">è®°å½•è¯¥èŠ‚ç‚¹ä½¿ç”¨çš„Kå€¼ï¼ˆå†å²è®¿é—®æ¬¡æ•°é˜ˆå€¼ï¼‰</td></tr><tr><td align="left">fid_</td><td align="center">frame_id_t</td><td align="center">è¯¥èŠ‚ç‚¹å¯¹åº”çš„ç¼“å†²æ± å¸§ID</td></tr><tr><td align="left">is_evictable_</td><td align="center">bool</td><td align="center">æ ‡è®°è¯¥å¸§æ˜¯å¦å¯è¢«æ·˜æ±°ï¼Œåˆå§‹ä¸ºfalse</td></tr></tbody></table><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * LRUKReplacer implements the LRU-k replacement policy.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The LRU-k algorithm evicts a frame whose backward k-distance is maximum</span><br><span class="hljs-comment"> * of all frames. Backward k-distance is computed as the difference in time between</span><br><span class="hljs-comment"> * current timestamp and the timestamp of kth previous access.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * A frame with less than k historical references is given</span><br><span class="hljs-comment"> * +inf as its backward k-distance. When multiple frames have +inf backward k-distance,</span><br><span class="hljs-comment"> * classical LRU algorithm is used to choose victim.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUKReplacer</span> &#123;<br> <span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">LRUKReplacer</span><span class="hljs-params">(<span class="hljs-type">size_t</span> num_frames, <span class="hljs-type">size_t</span> k)</span></span>;<br><br>  <span class="hljs-built_in">DISALLOW_COPY_AND_MOVE</span>(LRUKReplacer);<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * TODO(P1): Add implementation</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * @brief Destroys the LRUReplacer.</span><br><span class="hljs-comment">   */</span><br>  ~<span class="hljs-built_in">LRUKReplacer</span>() = <span class="hljs-keyword">default</span>;<br><br>  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Evict</span><span class="hljs-params">()</span> -&gt; std::optional&lt;<span class="hljs-type">frame_id_t</span>&gt;</span>;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RecordAccess</span><span class="hljs-params">(<span class="hljs-type">frame_id_t</span> frame_id, AccessType access_type = AccessType::Unknown)</span></span>;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SetEvictable</span><span class="hljs-params">(<span class="hljs-type">frame_id_t</span> frame_id, <span class="hljs-type">bool</span> set_evictable)</span></span>;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Remove</span><span class="hljs-params">(<span class="hljs-type">frame_id_t</span> frame_id)</span></span>;<br><br>  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Size</span><span class="hljs-params">()</span> -&gt; <span class="hljs-type">size_t</span></span>;<br><br> <span class="hljs-keyword">private</span>:<br>  <span class="hljs-comment">// TODO(student): implement me! You can replace these member variables as you like.</span><br>  <span class="hljs-comment">// Remove maybe_unused if you start using them.</span><br>  [[maybe_unused]] std::unordered_map&lt;<span class="hljs-type">frame_id_t</span>, LRUKNode&gt; node_store_;<br>  [[maybe_unused]] <span class="hljs-type">size_t</span> current_timestamp_&#123;<span class="hljs-number">0</span>&#125;;<br>  [[maybe_unused]] <span class="hljs-type">size_t</span> curr_size_&#123;<span class="hljs-number">0</span>&#125;;<br>  [[maybe_unused]] <span class="hljs-type">size_t</span> replacer_size_;<br>  [[maybe_unused]] <span class="hljs-type">size_t</span> k_;<br>  [[maybe_unused]] std::mutex latch_;<br>&#125;;<br></code></pre></td></tr></table></figure><p><img src="/img/CMU15-445-Bustub-project1%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/LRUUse.png" alt="LRUKReplacerç»„ä»¶çš„ä½œç”¨"></p><h3 id="Task-2-Disk-Scheduler"><a href="#Task-2-Disk-Scheduler" class="headerlink" title="Task #2 - Disk Scheduler"></a>Task #2 - Disk Scheduler</h3><p>è¯¥ç»„ä»¶è´Ÿè´£å¯¹DiskManagerè¿›è¡Œè¯»å†™æ“ä½œè°ƒåº¦ã€‚ç£ç›˜è°ƒåº¦å™¨å¯ä»¥è¢«å…¶ä»–ç»„ä»¶ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºä»»åŠ¡#3ä¸­çš„BufferPoolManagerï¼‰ä½¿ç”¨ï¼Œä»¥å¯¹ç£ç›˜è¯·æ±‚è¿›è¡Œæ’é˜Ÿï¼Œè¿™äº›è¯·æ±‚ç”±ä¸€ä¸ªDiskRequestç»“æ„ä½“è¡¨ç¤ºã€‚ç£ç›˜è°ƒåº¦å™¨å°†ç»´æŠ¤ä¸€ä¸ªåå°å·¥ä½œçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è´Ÿè´£å¤„ç†å·²è°ƒåº¦çš„è¯·æ±‚ã€‚</p><p><strong>1) æ•´ä½“æ¶æ„</strong><br><strong>Disk Scheduleré‡‡ç”¨äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š</strong></p><ul><li><strong>â€‹â€‹ç”Ÿäº§è€…â€‹</strong>â€‹ï¼šæ•°æ®åº“ç³»ç»Ÿä¸­çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ Buffer Pool Managerï¼‰é€šè¿‡Schedule()æ–¹æ³•æäº¤ç£ç›˜ I&#x2F;O è¯·æ±‚</li><li><strong>æ¶ˆè´¹è€…â€‹â€‹</strong>ï¼šåå°å·¥ä½œçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚å¹¶æ‰§è¡Œå®é™…çš„ç£ç›˜æ“ä½œ</li></ul><p><strong>2) æ ¸å¿ƒç»„ä»¶</strong></p><ul><li>è¯·æ±‚é˜Ÿåˆ— (request_queue_):æ˜¯çº¿ç¨‹å®‰å…¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ é€’è¯·æ±‚</li><li>åå°å·¥ä½œçº¿ç¨‹ (background_thread_):åœ¨æ„é€ å‡½æ•°ä¸­å¯åŠ¨ï¼Œè¿è¡ŒStartWorkerThread()æ–¹æ³•,æŒç»­ä»é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚å¹¶å¤„ç†ï¼Œç›´åˆ°æ”¶åˆ°ç»ˆæ­¢ä¿¡å·ã€‚</li><li>ç£ç›˜ç®¡ç†å™¨ (disk_manager_):å®é™…æ‰§è¡Œç£ç›˜ I&#x2F;O æ“ä½œçš„æ ¸å¿ƒç»„ä»¶,ä¾› ReadPage()å’Œ WritePage()æ–¹æ³•ã€‚</li></ul><p><strong>3) å·¥ä½œæµç¨‹</strong></p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/DiskSch.png" alt="Disk Schedulerçš„å·¥ä½œæµç¨‹" style="display: block; margin: 0 auto; width: 50%; height:50%;"><h3 id="Task-3-Buffer-Pool-Manager"><a href="#Task-3-Buffer-Pool-Manager" class="headerlink" title="Task #3 - Buffer Pool Manager"></a>Task #3 - Buffer Pool Manager</h3><p>æœ€åå®ç°ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆ BufferPoolManager ï¼‰ã€‚BufferPoolManager è´Ÿè´£ä½¿ç”¨ DiskScheduler ä»ç£ç›˜è·å–æ•°æ®åº“é¡µé¢ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ BufferPoolManagerè¿˜å¯ä»¥åœ¨æ”¶åˆ°æ˜ç¡®æŒ‡ç¤ºæˆ–éœ€è¦é©±é€é¡µé¢ä»¥è…¾å‡ºç©ºé—´æ—¶ï¼Œè°ƒåº¦è„é¡µé¢çš„å†™å…¥åˆ°ç£ç›˜ã€‚</p><p>LRUKReplacer å°†è·Ÿè¸ªé¡µé¢è®¿é—®æ—¶é—´ï¼Œä»¥ä¾¿åœ¨éœ€è¦ä¸ºæ–°é¡µé¢è…¾å‡ºç©ºé—´æ—¶å†³å®šè¦é©±é€å“ªä¸ªå¸§ã€‚DiskScheduler å°†åœ¨ DiskManager ä¸Šè°ƒåº¦å¯¹ç£ç›˜çš„å†™å…¥å’Œè¯»å–ã€‚</p><p>åŒæ—¶ï¼Œè¿˜è¦å®ç° ReadPageGuard å’Œ WritePageGuard ã€‚è¿™äº›ç±»æ˜¯ RAII å¯¹è±¡ï¼Œæä¾›å¯¹åº•å±‚é¡µé¢çš„çº¿ç¨‹å®‰å…¨è¯»å†™è®¿é—®ã€‚â€‹<strong>RAIIï¼ˆResource Acquisition Is Initializationï¼‰â€‹â€‹</strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†èµ„æºï¼ˆå†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€é”ã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸€ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚â€‹â€‹â€‹â€‹è·å–èµ„æºâ€‹â€‹ï¼šåœ¨â€‹â€‹å¯¹è±¡çš„æ„é€ å‡½æ•°â€‹â€‹ä¸­è·å–èµ„æºï¼›â€‹â€‹é‡Šæ”¾èµ„æºâ€‹â€‹ï¼šåœ¨â€‹â€‹å¯¹è±¡çš„ææ„å‡½æ•°â€‹â€‹ä¸­é‡Šæ”¾èµ„æºã€‚</p><p><strong>1) page_guard</strong></p><p>PageGuard æ˜¯ BusTub æ•°æ®åº“ç³»ç»Ÿä¸­åŸºäº â€‹â€‹RAIIï¼ˆResource Acquisition Is Initializationï¼‰â€‹â€‹ æ€æƒ³è®¾è®¡çš„æ™ºèƒ½æŒ‡é’ˆï¼Œç”¨äºå®‰å…¨åœ°ç®¡ç†ç¼“å†²æ± é¡µé¢çš„è®¿é—®ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/page_guard1.png" alt="page_guardçš„RAIIè®¾è®¡" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p>page_guardçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å¦‚ä¸‹ï¼š</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/page_guard2.png" alt="ç”Ÿå‘½å‘¨æœŸç®¡ç†" style="display: block; margin: 0 auto; width: 60%; height:60%;"><p>é™¤äº†å®Œæˆèµ„æºè‡ªåŠ¨åˆ†é…ï¼Œæœ€é‡è¦çš„æ˜¯page_guardçš„çº¿ç¨‹å®‰å…¨ã€‚</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/page_guard3.png" alt="çº¿ç¨‹å®‰å…¨ä¿è¯" style="display: block; margin: 0 auto; width: 50%; height:50%;"><p><strong>2) buffer_pool_manager</strong></p><p>BufferPoolManagerå®ç°å±•ç¤ºäº†æ•°æ®åº“ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶çš„å…¸å‹è®¾è®¡æ–¹æ³•ï¼Œå…¶åˆ†å±‚è®¾è®¡ã€èµ„æºç®¡ç†ç­–ç•¥å’Œå¹¶å‘æ§åˆ¶æœºåˆ¶å°¤å…¶å€¼å¾—å­¦ä¹ ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½å­˜å‚¨ç³»ç»Ÿçš„ä¼˜ç§€èŒƒä¾‹ã€‚</p><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/bpm1.png" alt="é¡µé¢è·å–æµç¨‹" style="display: block; margin: 0 auto; width: 70%; height:70%;"><p>åœ¨å®Œæˆbuffer_pool_manageræ—¶ï¼Œéœ€è¦ç”¨åˆ°è®¸å¤šå…³é”®çš„è®¾è®¡æ€æƒ³ï¼š</p><ul><li><strong>RAII (Resource Acquisition Is Initialization)</strong></li><li><strong>åˆ†å±‚è®¾è®¡</strong></li></ul><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/bpm2.png" alt="åˆ†å±‚è®¾è®¡" style="display: block; margin: 0 auto; width: 50%; height:50%;"><ul><li><strong>çº¿ç¨‹å®‰å…¨è®¾è®¡</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferPoolManager</span> &#123;<br>    ...<br>    std::shared_ptr&lt;std::mutex&gt; bpm_latch_;<br>    ...<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameHeader</span> &#123;<br>    ...<br>    <span class="hljs-comment">/** @brief The readers / writer latch for this frame. */</span><br>    std::shared_mutex rwlatch_;<br>    ...<br>&#125;<br><span class="hljs-comment">// ä½¿ç”¨ç»„åˆé”ç­–ç•¥</span><br><span class="hljs-function">std::scoped_lock <span class="hljs-title">lock</span><span class="hljs-params">(*bpm_latch_)</span></span>;  <span class="hljs-comment">// ç²—ç²’åº¦é”</span><br><span class="hljs-function">std::scoped_lock <span class="hljs-title">frame_lock</span><span class="hljs-params">(frame-&gt;rwlatch_)</span></span>;  <span class="hljs-comment">// ç»†ç²’åº¦é”</span><br>frame-&gt;pin_count_.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// æ— é”åŸå­æ“ä½œ,æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å¼•ç”¨</span><br></code></pre></td></tr></table></figure><img src="/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/result.png" alt="æµ‹è¯•ç»“æœ" style="display: block; margin: 0 auto; width: 50%; height:50%;">]]></content>
    
    
    <categories>
      
      <category>CMU15-445</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Bustub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitä½¿ç”¨</title>
    <link href="/2025/08/07/git%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/08/07/git%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯git"><a href="#ä»€ä¹ˆæ˜¯git" class="headerlink" title="ä»€ä¹ˆæ˜¯git"></a>ä»€ä¹ˆæ˜¯git</h2><p>Git æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºæ•æ·é«˜æ•ˆåœ°å¤„ç†ä»»ä½•æˆ–å°æˆ–å¤§çš„é¡¹ç›®ã€‚<br>Git æ˜¯ Linus Torvalds ä¸ºäº†å¸®åŠ©ç®¡ç† Linux å†…æ ¸å¼€å‘è€Œå¼€å‘çš„ä¸€ä¸ªå¼€æ”¾æºç çš„ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ã€‚<br>Git ä¸å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…· CVS, Subversion ç­‰ä¸åŒï¼Œå®ƒé‡‡ç”¨äº†åˆ†å¸ƒå¼ç‰ˆæœ¬åº“çš„æ–¹å¼ï¼Œä¸å¿…æœåŠ¡å™¨ç«¯è½¯ä»¶æ”¯æŒã€‚</p><p><img src="/img/git%E4%BD%BF%E7%94%A8/git%E5%8E%9F%E7%90%86.png" alt="gitåŸç†"></p><h2 id="gitçš„åŸºæœ¬ä½¿ç”¨æ“ä½œ"><a href="#gitçš„åŸºæœ¬ä½¿ç”¨æ“ä½œ" class="headerlink" title="gitçš„åŸºæœ¬ä½¿ç”¨æ“ä½œ"></a>gitçš„åŸºæœ¬ä½¿ç”¨æ“ä½œ</h2><h3 id="æ·»åŠ å’Œæäº¤"><a href="#æ·»åŠ å’Œæäº¤" class="headerlink" title="æ·»åŠ å’Œæäº¤"></a>æ·»åŠ å’Œæäº¤</h3><p>ä½ çš„æœ¬åœ°ä»“åº“ç”± git ç»´æŠ¤çš„ä¸‰æ£µâ€œæ ‘â€ç»„æˆã€‚ç¬¬ä¸€ä¸ªæ˜¯ä½ çš„<strong>å·¥ä½œç›®å½•</strong>ï¼Œå®ƒæŒæœ‰å®é™…æ–‡ä»¶ï¼›ç¬¬äºŒä¸ªæ˜¯<strong>æš‚å­˜åŒºï¼ˆIndexï¼‰</strong>ï¼Œå®ƒåƒä¸ªç¼“å­˜åŒºåŸŸï¼Œä¸´æ—¶ä¿å­˜ä½ çš„æ”¹åŠ¨ï¼›æœ€åæ˜¯<strong>HEAD</strong>ï¼Œå®ƒæŒ‡å‘ä½ æœ€åä¸€æ¬¡æäº¤çš„ç»“æœã€‚</p><p><img src="/img/git%E4%BD%BF%E7%94%A8/%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93.png" alt="æœ¬åœ°ä»“åº“"></p><p>ä½ å¯ä»¥æå‡ºæ›´æ”¹ï¼ˆæŠŠå®ƒä»¬æ·»åŠ åˆ°æš‚å­˜åŒºï¼‰ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;filename&gt;<br>git add .<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ git åŸºæœ¬å·¥ä½œæµç¨‹çš„ç¬¬ä¸€æ­¥ï¼›<br>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä»¥å®é™…æäº¤æ”¹åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git commit -m <span class="hljs-string">&quot;æäº¤ä¿¡æ¯&quot;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ çš„æ”¹åŠ¨å·²ç»æäº¤åˆ°äº†HEADï¼Œä½†æ˜¯è¿˜æ²¡åˆ°ä½ çš„è¿œç«¯ä»“åº“ã€‚</p><h3 id="æ¨é€æ”¹åŠ¨"><a href="#æ¨é€æ”¹åŠ¨" class="headerlink" title="æ¨é€æ”¹åŠ¨"></a>æ¨é€æ”¹åŠ¨</h3><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä»¥å°†è¿™äº›æ”¹åŠ¨æäº¤åˆ°è¿œç«¯ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin master<br></code></pre></td></tr></table></figure><p>å¯ä»¥æŠŠ master æ¢æˆä½ æƒ³è¦æ¨é€çš„ä»»ä½•åˆ†æ”¯ã€‚<br>å¦‚æœä½ è¿˜æ²¡æœ‰å…‹éš†ç°æœ‰ä»“åº“ï¼Œå¹¶æ¬²å°†ä½ çš„ä»“åº“è¿æ¥åˆ°æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin &lt;server&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æ­¤ä½ å°±èƒ½å¤Ÿå°†ä½ çš„æ”¹åŠ¨æ¨é€åˆ°æ‰€æ·»åŠ çš„æœåŠ¡å™¨ä¸Šå»äº†ã€‚</p><ul><li><p>serverï¼š<br>HTTPSï¼š<a href="https://github.com/%E7%94%A8%E6%88%B7%E5%90%8D/%E4%BB%93%E5%BA%93%E5%90%8D.git">https://github.com/ç”¨æˆ·å/ä»“åº“å.git</a><br>SSHï¼š<a href="mailto:&#x67;&#x69;&#116;&#x40;&#x67;&#105;&#116;&#x68;&#x75;&#98;&#x2e;&#x63;&#111;&#109;">git@github.com</a>:ç”¨æˆ·å&#x2F;ä»“åº“å.git</p></li><li><p>originï¼š<br>è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ«åï¼ˆå¯è‡ªå®šä¹‰ï¼Œä½†é€šå¸¸ç”¨originï¼‰ã€‚</p></li></ul><h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><p>åˆ†æ”¯æ˜¯ç”¨æ¥å°†ç‰¹æ€§å¼€å‘ç»ç¼˜å¼€æ¥çš„ã€‚åœ¨ä½ åˆ›å»ºä»“åº“çš„æ—¶å€™ï¼Œ<strong>master</strong>æ˜¯â€œé»˜è®¤çš„â€åˆ†æ”¯ã€‚åœ¨å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œå®Œæˆåå†å°†å®ƒä»¬åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚</p><p><img src="/img/git%E4%BD%BF%E7%94%A8/%E5%88%86%E6%94%AF.png" alt="åˆ†æ”¯"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªå«åšâ€œfeature_xâ€çš„åˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢è¿‡å»ï¼š</span><br>git checkout -b feature_x<br><span class="hljs-comment"># åˆ‡æ¢å›ä¸»åˆ†æ”¯ï¼š</span><br>git checkout master<br><span class="hljs-comment"># å†æŠŠæ–°å»ºçš„åˆ†æ”¯åˆ æ‰ï¼š</span><br>git branch -d feature_x<br><span class="hljs-comment"># é™¤éä½ å°†åˆ†æ”¯æ¨é€åˆ°è¿œç«¯ä»“åº“ï¼Œä¸ç„¶è¯¥åˆ†æ”¯å°±æ˜¯ä¸ä¸ºä»–äººæ‰€è§çš„ï¼š</span><br>git push origin &lt;branch&gt;<br></code></pre></td></tr></table></figure><h3 id="æ›´æ–°ä¸åˆå¹¶"><a href="#æ›´æ–°ä¸åˆå¹¶" class="headerlink" title="æ›´æ–°ä¸åˆå¹¶"></a>æ›´æ–°ä¸åˆå¹¶</h3><p>è¦æ›´æ–°ä½ çš„æœ¬åœ°ä»“åº“è‡³æœ€æ–°æ”¹åŠ¨ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull<br></code></pre></td></tr></table></figure><p>ä»¥åœ¨ä½ çš„å·¥ä½œç›®å½•ä¸­<strong>è·å–ï¼ˆfetchï¼‰</strong> å¹¶ <strong>åˆå¹¶(merge)</strong> è¿œç«¯çš„æ”¹åŠ¨ã€‚<br>è¦åˆå¹¶å…¶ä»–åˆ†æ”¯åˆ°ä½ çš„å½“å‰åˆ†æ”¯ï¼ˆä¾‹å¦‚ masterï¼‰ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git merge &lt;branch&gt;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œgitéƒ½ä¼šå°è¯•å»è‡ªåŠ¨åˆå¹¶æ”¹åŠ¨ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™å¯èƒ½å¹¶éæ¯æ¬¡éƒ½æˆåŠŸï¼Œå¹¶å¯èƒ½å‡ºç°å†²çªï¼ˆconflictsï¼‰ã€‚è¿™æ—¶å€™å°±éœ€è¦ä½ ä¿®æ”¹è¿™äº›æ–‡ä»¶æ¥æ‰‹åŠ¨åˆå¹¶è¿™äº›å†²çªï¼ˆconflictsï¼‰ã€‚<br>æ”¹å®Œä¹‹åï¼Œä½ éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä»¥å°†å®ƒä»¬æ ‡è®°ä¸ºåˆå¹¶æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>åœ¨åˆå¹¶æ”¹åŠ¨ä¹‹å‰ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é¢„è§ˆå·®å¼‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff &lt;source_branch&gt; &lt;target_branch&gt;<br></code></pre></td></tr></table></figure><h3 id="æ›¿æ¢æœ¬åœ°æ”¹åŠ¨"><a href="#æ›¿æ¢æœ¬åœ°æ”¹åŠ¨" class="headerlink" title="æ›¿æ¢æœ¬åœ°æ”¹åŠ¨"></a>æ›¿æ¢æœ¬åœ°æ”¹åŠ¨</h3><p>å‡å¦‚ä½ æ“ä½œå¤±è¯¯ï¼ˆå½“ç„¶ï¼Œè¿™æœ€å¥½æ°¸è¿œä¸è¦å‘ç”Ÿï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ›¿æ¢æ‰æœ¬åœ°æ”¹åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>ä¸¢å¼ƒå¯¹æŒ‡å®šæ–‡ä»¶çš„æœªæäº¤ä¿®æ”¹â€‹â€‹å°†å·¥ä½œåŒºä¸­çš„æ–‡ä»¶æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡æäº¤ï¼ˆHEADï¼‰æˆ–æš‚å­˜åŒºï¼ˆå¦‚æœå·² git addï¼‰çš„çŠ¶æ€ï¼Œâ€‹â€‹ä¸å¯é€†â€‹â€‹ã€‚<br>â€‹é€‚ç”¨åœºæ™¯â€‹â€‹</p><ul><li>ä¿®æ”¹äº†æ–‡ä»¶ä½†æœª git addï¼ˆæœªæš‚å­˜ï¼‰â†’ æ¢å¤åˆ° HEADç‰ˆæœ¬ã€‚</li><li>ä¿®æ”¹äº†æ–‡ä»¶ä¸”å·² git addï¼ˆå·²æš‚å­˜ï¼‰â†’ æ¢å¤åˆ°æš‚å­˜åŒºç‰ˆæœ¬ã€‚</li><li>è¯¯åˆ äº†æ–‡ä»¶ â†’ æ¢å¤æ–‡ä»¶åˆ°ç‰ˆæœ¬åº“ä¸­çš„çŠ¶æ€ã€‚</li><li></li></ul><p>å‡å¦‚ä½ æƒ³ä¸¢å¼ƒä½ åœ¨æœ¬åœ°çš„æ‰€æœ‰æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å†å²ï¼Œå¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘å®ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä»è¿œç¨‹ä»“åº“ï¼ˆoriginï¼‰ä¸‹è½½æœ€æ–°çš„æäº¤è®°å½•å’Œåˆ†æ”¯ä¿¡æ¯ï¼Œä½†â€‹â€‹ä¸ä¼šè‡ªåŠ¨åˆå¹¶æˆ–ä¿®æ”¹æœ¬åœ°ä»£ç â€‹â€‹ã€‚</span><br>git fetch origin<br><span class="hljs-comment"># å¼ºåˆ¶å°†å½“å‰åˆ†æ”¯é‡ç½®åˆ° origin/masterçš„æäº¤ã€‚</span><br><span class="hljs-comment"># --hardï¼šå½»åº•é‡ç½®å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼ŒåŒ¹é…è¿œç¨‹åˆ†æ”¯ã€‚</span><br>git reset --hard origin/master<br></code></pre></td></tr></table></figure><h2 id="æœ¬åœ°ä»“åº“gitåˆå§‹åŒ–"><a href="#æœ¬åœ°ä»“åº“gitåˆå§‹åŒ–" class="headerlink" title="æœ¬åœ°ä»“åº“gitåˆå§‹åŒ–"></a>æœ¬åœ°ä»“åº“gitåˆå§‹åŒ–</h2><h3 id="ä½¿ç”¨sshç™»é™†"><a href="#ä½¿ç”¨sshç™»é™†" class="headerlink" title="ä½¿ç”¨sshç™»é™†"></a>ä½¿ç”¨sshç™»é™†</h3><ol><li>å…ˆç”Ÿæˆsshå¯†é’¥ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -t rsa -b 4096 -C <span class="hljs-string">&quot;your_email@example.com&quot;</span><br><br><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub<br></code></pre></td></tr></table></figure><ul><li>ç§é’¥ï¼š~&#x2F;.ssh&#x2F;id_rsaï¼ˆâ€‹â€‹åˆ‡å‹¿æ³„éœ²â€‹â€‹ï¼‰</li><li>å…¬é’¥ï¼š~&#x2F;.ssh&#x2F;id_rsa.pubï¼ˆéœ€ä¸Šä¼ åˆ° Git æœåŠ¡å•†ï¼‰</li></ul><ol start="2"><li>å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹ä»“åº“</li><li>æµ‹è¯•sshè¿æ¥</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -T git@github.com  <span class="hljs-comment"># GitHub</span><br>ssh -T git@gitlab.com  <span class="hljs-comment"># GitLab</span><br></code></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸè¿”å›ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Hi TARScn! You<span class="hljs-string">&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒå‰æ ‘æ„é€ å’Œéå†ç¨‹åº</title>
    <link href="/2025/07/10/%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9E%84%E9%80%A0%E5%92%8C%E9%81%8D%E5%8E%86%E7%A8%8B%E5%BA%8F/"/>
    <url>/2025/07/10/%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9E%84%E9%80%A0%E5%92%8C%E9%81%8D%E5%8E%86%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="ç»“æ„ä½“å®šä¹‰"><a href="#ç»“æ„ä½“å®šä¹‰" class="headerlink" title="ç»“æ„ä½“å®šä¹‰"></a>ç»“æ„ä½“å®šä¹‰</h2><p>äºŒå‰æ ‘æ„é€ å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TreeNode</span> &#123;<br>    <span class="hljs-type">int</span> val;                <span class="hljs-comment">// èŠ‚ç‚¹å€¼</span><br>    TreeNode *left;         <span class="hljs-comment">// å·¦å­æ ‘</span><br>    TreeNode *right;        <span class="hljs-comment">// å³å­æ ‘</span><br>    <span class="hljs-comment">// æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">TreeNode</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">left</span>(<span class="hljs-literal">NULL</span>), <span class="hljs-built_in">right</span>(<span class="hljs-literal">NULL</span>) &#123;&#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h2><h3 id="å…ˆåºéå†"><a href="#å…ˆåºéå†" class="headerlink" title="å…ˆåºéå†"></a>å…ˆåºéå†</h3><p>é¡ºåºä¸º<strong>æ ¹-&gt;å·¦å­æ ‘-&gt;å³å­æ ‘</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">preorder</span><span class="hljs-params">(TreeNode* node)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>;<br>    cout &lt;&lt; node-&gt;val &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    <span class="hljs-built_in">preorder</span>(node-&gt;left);<br>    <span class="hljs-built_in">preorder</span>(node-&gt;right);<br>&#125;<br></code></pre></td></tr></table></figure><pre><code class="hljs"> æ„é€ å¦‚ä¸‹äºŒå‰æ ‘ï¼š       1      / \     2   3    / \   4   5</code></pre><p>éå†ç»“æœä¸º<strong>1 2 4 5 3</strong></p><h3 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h3><p>é¡ºåºä¸º<strong>å·¦å­æ ‘-&gt;æ ¹-&gt;å³å­æ ‘</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">inorder</span><span class="hljs-params">(TreeNode* node)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-built_in">inorder</span>(node-&gt;left);                 <span class="hljs-comment">// å…ˆéå†å·¦å­æ ‘</span><br>    std::cout &lt;&lt; node-&gt;val &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;       <span class="hljs-comment">// å†è®¿é—®æ ¹èŠ‚ç‚¹</span><br>    <span class="hljs-built_in">inorder</span>(node-&gt;right);                <span class="hljs-comment">// æœ€åéå†å³å­æ ‘</span><br>&#125;<br></code></pre></td></tr></table></figure><p>éå†ç»“æœä¸º<strong>4 2 5 1 3</strong></p><h3 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h3><p>é¡ºåºä¸º<strong>å·¦å­æ ‘-&gt;å³å­æ ‘-&gt;æ ¹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">postorder</span><span class="hljs-params">(TreeNode* node)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-built_in">postorder</span>(node-&gt;left);      <span class="hljs-comment">// å…ˆéå†å·¦å­æ ‘</span><br>    <span class="hljs-built_in">postorder</span>(node-&gt;right);     <span class="hljs-comment">// å†éå†å³å­æ ‘</span><br>    std::cout &lt;&lt; node-&gt;val &lt;&lt; <span class="hljs-string">&quot; &quot;</span>; <span class="hljs-comment">// æœ€åè®¿é—®æ ¹èŠ‚ç‚¹</span><br>&#125;<br></code></pre></td></tr></table></figure><p>éå†ç»“æœä¸º<strong>4 5 2 3 1</strong></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äºŒå‰æ ‘éå†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hot100ç»ƒä¹ </title>
    <link href="/2025/07/09/hot100%E7%BB%83%E4%B9%A0/"/>
    <url>/2025/07/09/hot100%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›¸äº¤é“¾è¡¨-160"><a href="#ç›¸äº¤é“¾è¡¨-160" class="headerlink" title="ç›¸äº¤é“¾è¡¨(160)"></a>ç›¸äº¤é“¾è¡¨(160)</h2><p>ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headB ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› null ã€‚(é¢˜ç›®æ•°æ® ä¿è¯ æ•´ä¸ªé“¾å¼ç»“æ„ä¸­ä¸å­˜åœ¨ç¯)</p><p>ä¾æ¬¡éå†æ‰€æœ‰èŠ‚ç‚¹<br>å‡è®¾é“¾è¡¨Aé•¿åº¦ä¸º<strong>m+c</strong>ï¼Œé“¾è¡¨Bwé•¿åº¦ä¸º<strong>n+c</strong>ï¼Œæ‰€ä»¥éå†é•¿åº¦ä¸º<strong>m+n+c</strong>å°±å¯å®Œæˆæ‰€æœ‰é“¾è¡¨èŠ‚ç‚¹éå†ã€‚<br>å¯¹é“¾è¡¨Aï¼Œéå†m+c+n<br>å¯¹é“¾è¡¨Bï¼Œéå†n+c+m</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ListNode *<span class="hljs-title">getIntersectionNode</span><span class="hljs-params">(ListNode *headA, ListNode *headB)</span> </span>&#123;<br>        ListNode *a = headA;<br>        ListNode *b = headB;<br>        <br>        <span class="hljs-keyword">while</span>(a != b)<br>        &#123;<br>            a = a?a-&gt;next:headB;<br>            b = b?b-&gt;next:headA;<br>        &#125;<br>        <span class="hljs-keyword">return</span> a;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æš´åŠ›æ‰‹æ’•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ListNode *<span class="hljs-title">getIntersectionNode</span><span class="hljs-params">(ListNode *headA, ListNode *headB)</span> </span>&#123;<br>        ListNode *a = headA;<br>        ListNode *b = headB;<br>        <br>        <span class="hljs-keyword">while</span>(a != <span class="hljs-literal">NULL</span>)<br>        &#123;<br>            <span class="hljs-keyword">while</span>(b != <span class="hljs-literal">NULL</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(a == b)  <span class="hljs-keyword">return</span> a;<br>                b = b-&gt;next;<br>            &#125;<br>            a = a-&gt;next;<br>            b = headB;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆ236ï¼‰ï¼ˆé€’å½’ï¼‰"><a href="#äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆ236ï¼‰ï¼ˆé€’å½’ï¼‰" class="headerlink" title="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆ236ï¼‰ï¼ˆé€’å½’ï¼‰"></a>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆ236ï¼‰ï¼ˆé€’å½’ï¼‰</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p><pre><code class="hljs"> æ„é€ å¦‚ä¸‹äºŒå‰æ ‘ï¼š        1      /   \     2     3    / \   / \   4   5 6   7   </code></pre><p>å¦‚4ï¼Œ5çš„å…¬å…±ç¥–å…ˆä¸º2ï¼› 1ï¼Œ6çš„å…¬å…±ç¥–å…ˆä¸º1ã€‚</p><p>æ€è·¯ï¼šä½¿ç”¨é€’å½’<br>æŸä¸ªæ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘ä¸­æ˜¯å¦æœ‰å­©å­ï¼Œå³å­æ ‘ä¸­æ˜¯å¦æœ‰å­©å­ã€‚<br>è‹¥å·¦å³å­æ ‘éƒ½æœ‰å­©å­ï¼Œé‚£è¿™ä¸ªæ ¹èŠ‚ç‚¹æ˜¯å…¬å…±ç¥–å…ˆï¼›<br>è‹¥å•ä¾§æœ‰å­©å­ï¼Œé‚£å•ä¾§çš„æŸä¸ªå­©å­ä¸ºå…¬å…±ç¥–å…ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * struct TreeNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     TreeNode *left;</span><br><span class="hljs-comment"> *     TreeNode *right;</span><br><span class="hljs-comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">lowestCommonAncestor</span><span class="hljs-params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(!root) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// æ ¹ä¸ºç©ºåˆ™å‘ä¸Šè¿”å›</span><br>        <span class="hljs-comment">// å½“å‰æ ¹èŠ‚ç‚¹æ˜¯å­©å­ï¼Œè¿”å›ä¸Šä¸€å±‚ï¼Œä¸”è¿™ä¾§æœ‰å­©å­ï¼›</span><br>        <span class="hljs-keyword">if</span>(p == root || q == root) <span class="hljs-keyword">return</span> root; <br>        <span class="hljs-comment">// éå†å·¦å­æ ‘ï¼Œçœ‹æ˜¯å¦æœ‰å­©å­</span><br>        TreeNode* left = <span class="hljs-built_in">lowestCommonAncestor</span>(root-&gt;left,p,q);<br>        TreeNode* right = <span class="hljs-built_in">lowestCommonAncestor</span>(root-&gt;right,p,q);<br>        <span class="hljs-comment">// åˆ¤æ–­å½“å‰æ ¹èŠ‚ç‚¹æ˜¯å¦æ˜¯å…¬å…±ç¥–å…ˆï¼Œæ˜¯åˆ™ä¸€ç›´è¿”å›ä¸Šå±‚ç›´åˆ°è§£é™¤é€’å½’</span><br>        <span class="hljs-keyword">if</span>(left &amp;&amp; right) <span class="hljs-keyword">return</span> root;<br>        <span class="hljs-comment">// ä¸æ˜¯ç¥–å…ˆåˆ™å‘ä¸Šè¿”å›éç©ºä¾§</span><br>        <span class="hljs-keyword">return</span> left?left:right;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="å›æ–‡é“¾è¡¨ï¼ˆ234ï¼‰-åŒæŒ‡é’ˆ"><a href="#å›æ–‡é“¾è¡¨ï¼ˆ234ï¼‰-åŒæŒ‡é’ˆ" class="headerlink" title="å›æ–‡é“¾è¡¨ï¼ˆ234ï¼‰(åŒæŒ‡é’ˆ)"></a>å›æ–‡é“¾è¡¨ï¼ˆ234ï¼‰(åŒæŒ‡é’ˆ)</h2><p>ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·ä½ åˆ¤æ–­è¯¥é“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</p><p>æš´åŠ›æ‰‹æ’•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isPalindrome</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        stack&lt;<span class="hljs-type">int</span>&gt; st;<br>        ListNode* p = head;<br>        <br>        <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(p)<br>        &#123;<br>            st.<span class="hljs-built_in">push</span>(p-&gt;val);<br>            p = p-&gt;next;<br>            i++;<br>        &#125;<br>        p = head;<br>        i /= <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">if</span>(i)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> l=<span class="hljs-number">0</span>;l&lt;i;l++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(p-&gt;val == st.<span class="hljs-built_in">top</span>())&#123;<br>                    p = p-&gt;next;<br>                    st.<span class="hljs-built_in">pop</span>();<br>                &#125;<span class="hljs-keyword">else</span> <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>é‡‡ç”¨æ•°ç»„åŠ åŒæŒ‡é’ˆçš„æ€æƒ³</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isPalindrome</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        vector&lt;<span class="hljs-type">int</span>&gt; vt;<br>        <span class="hljs-keyword">while</span>(head != <span class="hljs-literal">nullptr</span>)&#123;<br>            vt.<span class="hljs-built_in">emplace_back</span>(head-&gt;val);<br>            head = head-&gt;next;<br>        &#125;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>, j=(<span class="hljs-type">int</span>)vt.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>; i&lt;j; i++,j--)&#123;<br>            <span class="hljs-keyword">if</span>(vt[i] != vt[j])<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="æ¯æ—¥æ¸©åº¦ï¼ˆ739ï¼‰ï¼ˆå•è°ƒæ ˆï¼‰"><a href="#æ¯æ—¥æ¸©åº¦ï¼ˆ739ï¼‰ï¼ˆå•è°ƒæ ˆï¼‰" class="headerlink" title="æ¯æ—¥æ¸©åº¦ï¼ˆ739ï¼‰ï¼ˆå•è°ƒæ ˆï¼‰"></a>æ¯æ—¥æ¸©åº¦ï¼ˆ739ï¼‰ï¼ˆå•è°ƒæ ˆï¼‰</h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ temperatures ï¼Œè¡¨ç¤ºæ¯å¤©çš„æ¸©åº¦ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ answer ï¼Œå…¶ä¸­ answer[i] æ˜¯æŒ‡å¯¹äºç¬¬ i å¤©ï¼Œä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚</p><p>æš´åŠ›æ‰‹æ’•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(N^2)$ï¼Œè¶…æ—¶æ— æ³•é€šè¿‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dailyTemperatures</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; temperatures)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = <span class="hljs-number">0</span>;<br>        vector&lt;<span class="hljs-type">int</span>&gt; answer;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> i = temperatures.<span class="hljs-built_in">begin</span>(); i != temperatures.<span class="hljs-built_in">end</span>(); i++)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> j = i<span class="hljs-number">+1</span>; j != temperatures.<span class="hljs-built_in">end</span>(); j++)&#123;<br>                n++;<br>                <span class="hljs-comment">// åç»­å‡ºç°æ›´é«˜æ¸©åº¦</span><br>                <span class="hljs-keyword">if</span>(*i &lt; *j)&#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">//åç»­æ²¡æœ‰æœ€é«˜æ¸©åº¦</span><br>                <span class="hljs-keyword">if</span>(j == temperatures.<span class="hljs-built_in">end</span>()<span class="hljs-number">-1</span>)&#123;<br>                    n = <span class="hljs-number">0</span>;<br>                &#125;<br>            &#125;<br>            answer.<span class="hljs-built_in">emplace_back</span>(n);<br>            n = <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> answer;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<strong>å•è°ƒæ ˆ</strong></p><p>å•è°ƒæ ˆï¼ˆMonotonic Stackï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆç»“æ„ï¼Œå®ƒä¿æŒæ ˆå†…å…ƒç´ çš„å•è°ƒé€’å¢ï¼ˆIncreasingï¼‰æˆ–å•è°ƒé€’å‡ï¼ˆDecreasingï¼‰æ€§è´¨ã€‚å®ƒå¸¸ç”¨äºè§£å†³ â€‹â€‹â€œä¸‹ä¸€ä¸ªæ›´å¤§&#x2F;æ›´å°å…ƒç´ â€â€‹â€‹ ç±»é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦é€šå¸¸ä¸º $O(N)$ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dailyTemperatures</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; temperatures)</span> </span>&#123;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ans</span><span class="hljs-params">(temperatures.size(), <span class="hljs-number">0</span>)</span></span>;<br>        stack&lt;<span class="hljs-type">int</span>&gt; st; <span class="hljs-comment">// åªéœ€å­˜å‚¨ç´¢å¼•</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; temperatures.<span class="hljs-built_in">size</span>(); ++i) &#123;<br>            <span class="hljs-comment">// ç»´æŠ¤å•è°ƒé€’å‡æ ˆï¼ˆæ ˆé¡¶æœ€å°ï¼‰</span><br>            <span class="hljs-keyword">while</span> (!st.<span class="hljs-built_in">empty</span>() &amp;&amp; temperatures[i] &gt; temperatures[st.<span class="hljs-built_in">top</span>()]) &#123;<br>                ans[st.<span class="hljs-built_in">top</span>()] = i - st.<span class="hljs-built_in">top</span>(); <span class="hljs-comment">// è®¡ç®—ç­‰å¾…å¤©æ•°</span><br>                st.<span class="hljs-built_in">pop</span>();<br>            &#125;<br>            st.<span class="hljs-built_in">push</span>(i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å•è°ƒæ ˆçš„å…¶å®ƒä¾‹é¢˜</p><h2 id="æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢ï¼ˆ84ï¼‰-å•è°ƒæ ˆ"><a href="#æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢ï¼ˆ84ï¼‰-å•è°ƒæ ˆ" class="headerlink" title="æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢ï¼ˆ84ï¼‰(å•è°ƒæ ˆ)"></a>æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢ï¼ˆ84ï¼‰(å•è°ƒæ ˆ)</h2><p>ç»™å®š n ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚<br>æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚</p><p><img src="/img/hot100%E7%BB%83%E4%B9%A0/84.png" alt="ç¤ºä¾‹"></p><p>åˆ©ç”¨å•è°ƒæ ˆæ‰¾ä¸¤è¾¹æ›´ä½çš„å·¦å³è¾¹ç•Œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">largestRectangleArea</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; heights)</span> </span>&#123;<br>        <span class="hljs-type">int</span> maxS;<br>        stack&lt;<span class="hljs-type">int</span>&gt; stkr,stkl;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">leftSmaller</span><span class="hljs-params">(heights.size(),<span class="hljs-number">-1</span>)</span></span>;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">rightSmaller</span><span class="hljs-params">(heights.size(),heights.size())</span></span>;<br><br>        <span class="hljs-keyword">if</span>(heights.<span class="hljs-built_in">size</span>()==<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> heights[<span class="hljs-number">0</span>];<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;heights.<span class="hljs-built_in">size</span>();i++)&#123;<br>            <span class="hljs-keyword">while</span>(!stkr.<span class="hljs-built_in">empty</span>() &amp;&amp; heights[i]&lt;heights[stkr.<span class="hljs-built_in">top</span>()])<br>            &#123;<br>                rightSmaller[stkr.<span class="hljs-built_in">top</span>()] = i;<br>                stkr.<span class="hljs-built_in">pop</span>(); <br>            &#125;<br>            stkr.<span class="hljs-built_in">push</span>(i);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=heights.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>;i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>            <span class="hljs-keyword">while</span>(!stkl.<span class="hljs-built_in">empty</span>() &amp;&amp; heights[i]&lt;heights[stkl.<span class="hljs-built_in">top</span>()])<br>            &#123;<br>                leftSmaller[stkl.<span class="hljs-built_in">top</span>()] = i;<br>                stkl.<span class="hljs-built_in">pop</span>();<br>            &#125;<br>            stkl.<span class="hljs-built_in">push</span>(i);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;heights.<span class="hljs-built_in">size</span>();i++)&#123;<br>            <span class="hljs-type">int</span> nowS = heights[i]*(rightSmaller[i]-leftSmaller[i]<span class="hljs-number">-1</span>);<br>            <span class="hljs-keyword">if</span>(nowS&gt;maxS) maxS = nowS;<br>        &#125;<br>        <span class="hljs-keyword">return</span> maxS;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="ç››æœ€å¤šæ°´çš„å®¹å™¨ï¼ˆ11ï¼‰-åŒæŒ‡é’ˆ"><a href="#ç››æœ€å¤šæ°´çš„å®¹å™¨ï¼ˆ11ï¼‰-åŒæŒ‡é’ˆ" class="headerlink" title="ç››æœ€å¤šæ°´çš„å®¹å™¨ï¼ˆ11ï¼‰(åŒæŒ‡é’ˆ)"></a>ç››æœ€å¤šæ°´çš„å®¹å™¨ï¼ˆ11ï¼‰(åŒæŒ‡é’ˆ)</h2><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ height ã€‚æœ‰ n æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ (i, 0) å’Œ (i, height[i]) ã€‚</p><p>æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p>è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p><p><img src="/img/hot100%E7%BB%83%E4%B9%A0/11.png" alt="ç¤ºä¾‹"></p><p>æš´åŠ›æ±‚è§£ï¼Œä½†æ˜¯æäº¤è¶…æ—¶ï¼Œå¤æ‚åº¦$O(N^2)$</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">maxArea</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; height)</span> </span>&#123;<br>        <span class="hljs-type">int</span> ret=<span class="hljs-number">0</span>,now=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;height.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>;i++)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = i<span class="hljs-number">+1</span>;j&lt;height.<span class="hljs-built_in">size</span>();j++)&#123;<br>                <span class="hljs-keyword">if</span>(height[j]&gt;height[i])&#123;<br>                    now = height[i]*(j-i);<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    now = height[j]*(j-i);<br>                &#125;<br>                <span class="hljs-keyword">if</span>(now&gt;ret) ret = now;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>é‡‡ç”¨åŒæŒ‡é’ˆï¼Œä»ä¸¤è¾¹å‘ä¸­é—´éå†ï¼Œå¤æ‚åº¦$O(N)$<br>åœ¨æ¯ä¸ªçŠ¶æ€ä¸‹ï¼Œæ— è®ºé•¿æ¿æˆ–çŸ­æ¿å‘ä¸­é—´æ”¶çª„ä¸€æ ¼ï¼Œéƒ½ä¼šå¯¼è‡´æ°´æ§½ åº•è¾¹å®½åº¦ âˆ’1â€‹ å˜çŸ­ï¼š</p><p>è‹¥å‘å†… ç§»åŠ¨çŸ­æ¿ ï¼Œæ°´æ§½çš„çŸ­æ¿ min(h[i],h[j]) å¯èƒ½å˜å¤§ï¼Œå› æ­¤ä¸‹ä¸ªæ°´æ§½çš„é¢ç§¯ å¯èƒ½å¢å¤§ ã€‚<br>è‹¥å‘å†… ç§»åŠ¨é•¿æ¿ ï¼Œæ°´æ§½çš„çŸ­æ¿ min(h[i],h[j])â€‹ ä¸å˜æˆ–å˜å°ï¼Œå› æ­¤ä¸‹ä¸ªæ°´æ§½çš„é¢ç§¯ ä¸€å®šå˜å° ã€‚<br>å› æ­¤ï¼Œåˆå§‹åŒ–åŒæŒ‡é’ˆåˆ†åˆ—æ°´æ§½å·¦å³ä¸¤ç«¯ï¼Œå¾ªç¯æ¯è½®å°†çŸ­æ¿å‘å†…ç§»åŠ¨ä¸€æ ¼ï¼Œå¹¶æ›´æ–°é¢ç§¯æœ€å¤§å€¼ï¼Œç›´åˆ°ä¸¤æŒ‡é’ˆç›¸é‡æ—¶è·³å‡ºï¼›å³å¯è·å¾—æœ€å¤§é¢ç§¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">maxArea</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; height)</span> </span>&#123;<br>        <span class="hljs-type">int</span> ret=<span class="hljs-number">0</span>,h;<br>        <span class="hljs-type">int</span> left=<span class="hljs-number">0</span>,right=height.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>;<br><br>        <span class="hljs-keyword">while</span>(left&lt;right)&#123;<br>            h = height[left]&lt;height[right] ? height[left]:height[right];<br>            ret = ret&gt;(h*(right-left)) ? ret:h*(right-left);<br>            <span class="hljs-keyword">if</span>(height[left]&lt;height[right])<br>                left++;<br>            <span class="hljs-keyword">else</span><br>                right--;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure><h2 id="æœ€å¤§æ­£æ–¹å½¢ï¼ˆ221ï¼‰ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰"><a href="#æœ€å¤§æ­£æ–¹å½¢ï¼ˆ221ï¼‰ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰" class="headerlink" title="æœ€å¤§æ­£æ–¹å½¢ï¼ˆ221ï¼‰ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰"></a>æœ€å¤§æ­£æ–¹å½¢ï¼ˆ221ï¼‰ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰</h2><p>åœ¨ä¸€ä¸ªç”± â€˜0â€™ å’Œ â€˜1â€™ ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« â€˜1â€™ çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚<br>è¿™é¢˜ä¸»è¦æ˜¯æƒ³åˆ°dpçš„é€’æ¨å…¬å¼ã€‚</p><p><img src="/img/hot100%E7%BB%83%E4%B9%A0/221.png" alt="è®¡ç®—dp"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">dp</span><span class="hljs-params">(i,j)</span></span>=<span class="hljs-built_in">min</span>(<span class="hljs-built_in">dp</span>(iâˆ’<span class="hljs-number">1</span>,j),<span class="hljs-built_in">dp</span>(iâˆ’<span class="hljs-number">1</span>,jâˆ’<span class="hljs-number">1</span>),<span class="hljs-built_in">dp</span>(<span class="hljs-selector-tag">i</span>,jâˆ’<span class="hljs-number">1</span>))+<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">maximalSquare</span><span class="hljs-params">(vector&lt;vector&lt;<span class="hljs-type">char</span>&gt;&gt;&amp; matrix)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (matrix.<span class="hljs-built_in">empty</span>() || matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-type">int</span> m = matrix.<span class="hljs-built_in">size</span>(), n = matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>();<br>        vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">dp</span>(m, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(n, <span class="hljs-number">0</span>));<br>        <span class="hljs-type">int</span> max_side = <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; ++j) &#123;<br>                <span class="hljs-keyword">if</span> (matrix[i][j] == <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> || j == <span class="hljs-number">0</span>) &#123;<br>                        dp[i][j] = <span class="hljs-number">1</span>; <span class="hljs-comment">// ç¬¬ä¸€è¡Œæˆ–ç¬¬ä¸€åˆ—ï¼Œè¾¹é•¿æœ€å¤§ä¸º 1</span><br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        dp[i][j] = <span class="hljs-built_in">min</span>(&#123;dp[i<span class="hljs-number">-1</span>][j], dp[i][j<span class="hljs-number">-1</span>], dp[i<span class="hljs-number">-1</span>][j<span class="hljs-number">-1</span>]&#125;) + <span class="hljs-number">1</span>;<br>                    &#125;<br>                    max_side = <span class="hljs-built_in">max</span>(max_side, dp[i][j]);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> max_side * max_side;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>åˆ·é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AVLæ ‘å’Œçº¢é»‘æ ‘ä»‹ç»</title>
    <link href="/2025/07/02/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/"/>
    <url>/2025/07/02/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="AVLæ ‘ä»‹ç»"><a href="#AVLæ ‘ä»‹ç»" class="headerlink" title="AVLæ ‘ä»‹ç»"></a>AVLæ ‘ä»‹ç»</h1><h2 id="ä»€ä¹ˆæ˜¯AVLæ ‘ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯AVLæ ‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯AVLæ ‘ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯AVLæ ‘ï¼Ÿ</h2><p><strong>AVLæ ‘</strong>ï¼ˆAdelson-Velsky and Landis Treeï¼‰æ˜¯ä¸€ç§<strong>è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘</strong>ï¼ˆSelf-Balancing Binary Search Treeï¼‰ã€‚<br>å®ƒç”±è‹è”æ•°å­¦å®¶ <strong>G.M. Adelson-Velsky</strong> å’Œ <strong>E.M. Landis</strong> äº1962å¹´å‘æ˜ï¼Œæ˜¯æœ€æ—©æå‡ºçš„è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¹‹ä¸€ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ï¼ˆå¹³è¡¡å› å­ï¼‰æœ€å¤šä¸º1ã€‚</li><li>ä¿è¯æ ‘çš„é«˜åº¦å§‹ç»ˆä¸ºO(log n)ï¼Œæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œéƒ½å¯ä»¥åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆã€‚</li></ul><h2 id="AVLæ ‘çš„å®šä¹‰"><a href="#AVLæ ‘çš„å®šä¹‰" class="headerlink" title="AVLæ ‘çš„å®šä¹‰"></a>AVLæ ‘çš„å®šä¹‰</h2><p>å¯¹äºæ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®šä¹‰ï¼š</p><ul><li><strong>é«˜åº¦ï¼ˆHeightï¼‰</strong>ï¼šä»è¯¥èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„é•¿åº¦ï¼ˆå¶å­é«˜åº¦ä¸º0ï¼‰ã€‚</li><li><strong>å¹³è¡¡å› å­ï¼ˆBalance Factor, BFï¼‰</strong>ï¼š<br>[<br>BF &#x3D; \text{å·¦å­æ ‘é«˜åº¦} - \text{å³å­æ ‘é«˜åº¦}<br>]</li><li>AVLæ ‘è¦æ±‚ï¼šæ‰€æœ‰èŠ‚ç‚¹çš„å¹³è¡¡å› å­å¿…é¡»æ»¡è¶³ï¼š<br>[<br>BF \in {-1, 0, +1}<br>]</li></ul><h2 id="æ—‹è½¬ç¤ºæ„å›¾"><a href="#æ—‹è½¬ç¤ºæ„å›¾" class="headerlink" title="æ—‹è½¬ç¤ºæ„å›¾"></a>æ—‹è½¬ç¤ºæ„å›¾</h2><p>ä»¥ä¸‹ç¤ºæ„å±•ç¤ºä¸¤ç§æœ€å¸¸ç”¨çš„æ—‹è½¬ï¼š</p><p><strong>å³æ—‹ (Right Rotation)ï¼š</strong></p><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/youxuan.jpg" alt="å³æ—‹"></p><blockquote><p>å·¦æ—‹ä¸ºå³æ—‹çš„é•œåƒ</p></blockquote><h2 id="AVLæ ‘çš„åŸºæœ¬æ“ä½œ"><a href="#AVLæ ‘çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="AVLæ ‘çš„åŸºæœ¬æ“ä½œ"></a>AVLæ ‘çš„åŸºæœ¬æ“ä½œ</h2><h3 id="1-æ’å…¥"><a href="#1-æ’å…¥" class="headerlink" title="1. æ’å…¥"></a>1. æ’å…¥</h3><p>æ’å…¥èŠ‚ç‚¹åï¼Œå¯èƒ½ç ´åæ ‘çš„å¹³è¡¡æ€§ã€‚éœ€è¦æ²¿æ’å…¥è·¯å¾„å‘ä¸Šå›æº¯ï¼Œå¹¶è¿›è¡Œ**æ—‹è½¬ï¼ˆRotationï¼‰**ä¿®å¤ã€‚</p><p>å¸¸è§çš„å››ç§æƒ…å†µï¼š</p><ul><li><strong>LLå‹ï¼ˆå·¦-å·¦ï¼‰ï¼š</strong> å¯¹ä¸å¹³è¡¡èŠ‚ç‚¹è¿›è¡Œ<strong>å³æ—‹</strong>ã€‚</li><li><strong>RRå‹ï¼ˆå³-å³ï¼‰ï¼š</strong> å¯¹ä¸å¹³è¡¡èŠ‚ç‚¹è¿›è¡Œ<strong>å·¦æ—‹</strong>ã€‚</li><li><strong>LRå‹ï¼ˆå·¦-å³ï¼‰ï¼š</strong> å…ˆå¯¹å·¦å­èŠ‚ç‚¹è¿›è¡Œ<strong>å·¦æ—‹</strong>ï¼Œå†å¯¹ä¸å¹³è¡¡èŠ‚ç‚¹è¿›è¡Œ<strong>å³æ—‹</strong>ã€‚</li><li><strong>RLå‹ï¼ˆå³-å·¦ï¼‰ï¼š</strong> å…ˆå¯¹å³å­èŠ‚ç‚¹è¿›è¡Œ<strong>å³æ—‹</strong>ï¼Œå†å¯¹ä¸å¹³è¡¡èŠ‚ç‚¹è¿›è¡Œ<strong>å·¦æ—‹</strong>ã€‚</li></ul><h3 id="2-åˆ é™¤"><a href="#2-åˆ é™¤" class="headerlink" title="2. åˆ é™¤"></a>2. åˆ é™¤</h3><p>åˆ é™¤èŠ‚ç‚¹åä¹Ÿå¯èƒ½å¯¼è‡´å¹³è¡¡æ€§ç ´åï¼Œéœ€è¦ä»åˆ é™¤ä½ç½®å¾€ä¸Šå›æº¯ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æ—‹è½¬ä¿®å¤ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><a href="https://www.bilibili.com/video/BV1uuFpeKEGd?spm_id_from=333.788.videopod.sections&vd_source=1a88fb46407c6a5cc8a52eb1ea305721">AVLæ ‘æ’å…¥ç¤ºä¾‹</a><br><a href="https://www.bilibili.com/video/BV1rufJYyEms/?spm_id_from=333.337.search-card.all.click&vd_source=1a88fb46407c6a5cc8a52eb1ea305721">AVLæ ‘åˆ é™¤ç¤ºä¾‹</a></p><h1 id="çº¢é»‘æ ‘ä»‹ç»"><a href="#çº¢é»‘æ ‘ä»‹ç»" class="headerlink" title="çº¢é»‘æ ‘ä»‹ç»"></a>çº¢é»‘æ ‘ä»‹ç»</h1><h2 id="ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ</h2><p><strong>çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰</strong> æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„<strong>äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰</strong>ã€‚<br>å®ƒåœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹åï¼Œé€šè¿‡ç‰¹å®šçš„è§„åˆ™è¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—æ•´æ£µæ ‘ä¿æŒâ€œè¿‘ä¼¼å¹³è¡¡â€ï¼Œä»è€Œä¿è¯æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º <strong>O(log n)</strong>ã€‚</p><h2 id="çº¢é»‘æ ‘çš„æ€§è´¨"><a href="#çº¢é»‘æ ‘çš„æ€§è´¨" class="headerlink" title="çº¢é»‘æ ‘çš„æ€§è´¨"></a>çº¢é»‘æ ‘çš„æ€§è´¨</h2><p>çº¢é»‘æ ‘æ¯ä¸ªèŠ‚ç‚¹ä¸Šé™„åŠ ä¸€ä¸ªé¢œè‰²å±æ€§ï¼š<strong>çº¢è‰²ï¼ˆRedï¼‰<strong>æˆ–</strong>é»‘è‰²ï¼ˆBlackï¼‰</strong>ï¼Œå¹¶æ»¡è¶³ä»¥ä¸‹äº”æ¡æ€§è´¨ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ã€‚</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ã€‚</li><li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆä¸ä¼šå‡ºç°è¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ï¼‰ã€‚</li><li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œ<strong>é»‘è‰²èŠ‚ç‚¹æ•°é‡ç›¸åŒ</strong>ã€‚</li></ol><p><strong>çº¢é»‘æ ‘çš„å®è´¨æ˜¯é»‘è‰²èŠ‚ç‚¹çš„é«˜åº¦å¹³è¡¡</strong></p><h2 id="çº¢é»‘æ ‘çš„åŸºæœ¬æ“ä½œ"><a href="#çº¢é»‘æ ‘çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="çº¢é»‘æ ‘çš„åŸºæœ¬æ“ä½œ"></a>çº¢é»‘æ ‘çš„åŸºæœ¬æ“ä½œ</h2><h3 id="1-æ’å…¥ï¼ˆInsertï¼‰"><a href="#1-æ’å…¥ï¼ˆInsertï¼‰" class="headerlink" title="1. æ’å…¥ï¼ˆInsertï¼‰"></a>1. æ’å…¥ï¼ˆInsertï¼‰</h3><p>æ’å…¥èŠ‚ç‚¹åˆå§‹ä¸º<strong>çº¢è‰²</strong>ï¼Œç„¶åæ ¹æ®çº¢é»‘æ ‘æ€§è´¨è¿›è¡Œä¿®å¤ï¼š</p><ul><li>æƒ…å†µ1ï¼šæ–°èŠ‚ç‚¹çš„å”å”æ˜¯çº¢è‰² â†’ å˜è‰² + å‘ä¸Šé€’å½’</li><li>æƒ…å†µ2ï¼šå”å”æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯â€œå¤–ä¾§â€ â†’ å˜è‰² + æ—‹è½¬</li><li>æƒ…å†µ3ï¼šå”å”æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯â€œå†…ä¾§â€ â†’ æ—‹è½¬ + å˜è‰² + æ—‹è½¬</li></ul><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯çº¢é»‘æ ‘çš„å¶å­æ˜¯é»‘è‰²çš„NIL</strong><br>å› ä¸ºæ’å…¥èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œæ‰€ä»¥<strong>æ’å…¥ä¼šç ´åçš„æ€§è´¨åªå¯èƒ½æ˜¯æ€§è´¨2å’Œæ€§è´¨4</strong>ã€‚</p><p>å…³æ³¨ç‚¹åœ¨äº<strong>çº¢çº¢å†²çª</strong>ï¼Œç„¶åè€ƒè™‘å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²è¿˜æ˜¯é»‘è‰²ã€‚</p><p>å¦‚æœ<strong>å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²</strong>åˆ™ç¬¦åˆæƒ…å†µ1ï¼Œç›´æ¥å°†<strong>å”å”èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹æŸ“é»‘ï¼Œç¥–çˆ¶èŠ‚ç‚¹æŸ“çº¢ï¼Œæ¥ç€æ£€æŸ¥ç¥–çˆ¶èŠ‚ç‚¹å¦‚æœæ˜¯æ ¹èŠ‚ç‚¹åˆ™æŸ“é»‘</strong>ï¼Œé€’å½’å‘ä¸Šã€‚</p><p>å¦‚æœ<strong>å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²</strong>åˆ™è€ƒè™‘æƒ…å†µ2ã€3ï¼Œå…¶å®æƒ…å†µ3å¯ä»¥é€šè¿‡é€‰æ‹©è½¬æ¢ä¸ºæƒ…å†µ2ã€‚</p><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/ranse.jpg" alt="å”å”èŠ‚ç‚¹ä¸ºé»‘è‰²çš„å¤„ç†"></p><p>ä¾æ¬¡æ’å…¥1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ç”Ÿæˆçš„çº¢é»‘æ ‘æ­¥éª¤å¦‚ä¸‹</p><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/exp1.jpg" alt="ä¾‹å­1"></p><h3 id="2-åˆ é™¤ï¼ˆDeleteï¼‰"><a href="#2-åˆ é™¤ï¼ˆDeleteï¼‰" class="headerlink" title="2. åˆ é™¤ï¼ˆDeleteï¼‰"></a>2. åˆ é™¤ï¼ˆDeleteï¼‰</h3><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ç ´åé»‘è‰²å¹³è¡¡ï¼Œéœ€è¦ä½¿ç”¨â€œ<strong>åŒé‡é»‘è‰²</strong>â€å¤„ç†æœºåˆ¶ï¼Œå¹¶é€šè¿‡ï¼š</p><ul><li>å…„å¼Ÿå˜è‰²</li><li>æ—‹è½¬</li><li>ä¼ é€’åŒé»‘ç­‰æ–¹å¼è¿›è¡Œä¿®å¤</li></ul><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/rbtRe.png" alt="çº¢é»‘æ ‘åˆ é™¤èŠ‚ç‚¹çš„æƒ…å†µ"></p><p>ç¬¬ä¸‰ç§æƒ…å†µæ˜¯<strong>æœ‰å·¦å­©å­å’Œå³å­©å­</strong>ï¼Œå¯ä»¥é€šè¿‡<strong>ç›´æ¥åç»§</strong>ï¼ˆç›´æ¥å‰ç»§ï¼‰æ›¿ä»£ï¼Œå†åˆ é™¤åç»§ï¼ˆå‰ç»§ï¼‰çš„æ–¹å¼ï¼Œè½¬æ¢ æˆå…¶ä»–æƒ…å†µã€‚</p><h4 id="åªæœ‰å·¦å­©å­æˆ–è€…å³å­©å­"><a href="#åªæœ‰å·¦å­©å­æˆ–è€…å³å­©å­" class="headerlink" title="åªæœ‰å·¦å­©å­æˆ–è€…å³å­©å­"></a><strong>åªæœ‰å·¦å­©å­æˆ–è€…å³å­©å­</strong></h4><blockquote><p>ç›´æ¥åˆ å»åï¼Œå­©å­æŸ“é»‘æ›¿æ¢</p></blockquote><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re1.jpg" alt="å¤„ç†æ–¹å¼"></p><h4 id="æ²¡æœ‰å­©å­"><a href="#æ²¡æœ‰å­©å­" class="headerlink" title="æ²¡æœ‰å­©å­"></a><strong>æ²¡æœ‰å­©å­</strong></h4><ol><li>è‡ªèº«æ˜¯çº¢èŠ‚ç‚¹</li></ol><blockquote><p>ç›´æ¥åˆ é™¤å³å¯</p></blockquote><ol start="2"><li>è‡ªèº«æ˜¯é»‘èŠ‚ç‚¹ï¼ˆåˆ é™¤åå˜åŒé»‘ï¼‰ï¼Œå…„å¼Ÿæ˜¯çº¢è‰²ã€‚</li></ol><blockquote><p>å…„çˆ¶å˜è‰²ï¼ŒæœåŒé»‘æ—‹è½¬ã€‚ä¿æŒåŒé»‘ï¼Œç»§ç»­æ¶ˆé™¤ã€‚</p></blockquote><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re2.jpg" alt="å¤„ç†æ–¹å¼"></p><ol><li>è‡ªèº«æ˜¯é»‘èŠ‚ç‚¹ï¼ˆåˆ é™¤åå˜åŒé»‘ï¼‰ï¼Œå…„å¼Ÿæ˜¯é»‘è‰²ï¼Œå…„å¼Ÿå­˜åœ¨çº¢å­©å­ã€‚</li></ol><blockquote><p>å¦‚æœå…„å¼Ÿå¤–ä¾§æ˜¯çº¢å­©å­ã€‚r-&gt;sï¼Œs-&gt;pï¼Œpå˜é»‘ï¼Œæ—‹è½¬</p></blockquote><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re3.jpg" alt="å¤„ç†æ–¹å¼"></p><blockquote><p>å¦‚æœå…„å¼Ÿåªæœ‰å†…ä¾§æœ‰å­©å­ï¼Œä¸”æ˜¯çº¢å­©å­ã€‚r-&gt;pï¼Œpå˜é»‘ï¼Œæ—‹è½¬å­©å­ï¼Œæ—‹è½¬ã€‚</p></blockquote><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re4.jpg" alt="å¤„ç†æ–¹å¼"></p><ol start="4"><li>è‡ªèº«æ˜¯é»‘èŠ‚ç‚¹ï¼ˆåˆ é™¤åå˜åŒé»‘ï¼‰ï¼Œå…„å¼Ÿæ˜¯é»‘è‰²ï¼Œå…„å¼Ÿéƒ½æ˜¯é»‘å­©å­ã€‚</li></ol><blockquote><p>å…„å¼Ÿå˜çº¢ï¼ŒåŒé»‘ä¸Šç§»ï¼ˆé‡çº¢é‡æ ¹å˜é»‘ï¼‰ã€‚</p></blockquote><p><a href="https://www.bilibili.com/video/BV16m421u7Tb?spm_id_from=333.788.videopod.sections&vd_source=1a88fb46407c6a5cc8a52eb1ea305721">çº¢é»‘æ ‘åˆ é™¤ç¤ºä¾‹</a></p><p>ä¾æ¬¡ä»çº¢é»‘æ ‘åˆ é™¤18ï¼Œ25ï¼Œ15ï¼Œ6ï¼Œ13ï¼Œ37ï¼Œ27ï¼Œ17ï¼Œ34ï¼Œ9ï¼Œ10</p><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re5.png" alt="ç¤ºä¾‹"></p><p><img src="/img/AVL%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8B%E7%BB%8D/re6.png" alt="ç¤ºä¾‹"></p><h3 id="3-æŸ¥æ‰¾ï¼ˆSearchï¼‰"><a href="#3-æŸ¥æ‰¾ï¼ˆSearchï¼‰" class="headerlink" title="3. æŸ¥æ‰¾ï¼ˆSearchï¼‰"></a>3. æŸ¥æ‰¾ï¼ˆSearchï¼‰</h3><p>å’Œæ™®é€šçš„äºŒå‰æœç´¢æ ‘ä¸€æ ·ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ä¸ºä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œé€å±‚æ¯”è¾ƒå…³é”®å­—ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çº¢é»‘æ ‘</tag>
      
      <tag>AVLæ ‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisè®¾è®¡ä¸å®ç°è¯»ä¹¦ç¬”è®°äºŒ--å•æœºæ•°æ®åº“</title>
    <link href="/2025/06/27/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2025/06/27/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><h3 id="æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“"><a href="#æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“" class="headerlink" title="æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“"></a>æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisServer</span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// æ•°æ®åº“æ•°ç»„ï¼Œä¿å­˜æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ•°æ®åº“</span><br>    redisDb *db;<br>    <span class="hljs-comment">// æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“æ•°é‡</span><br>    <span class="hljs-type">int</span> dbnum;<br>    <span class="hljs-comment">// ...</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>dbnumçš„å€¼æœ‰æœåŠ¡å™¨é…ç½®çš„databaseé€‰é¡¹å†³å®šï¼Œé»˜è®¤ä¸º16ã€‚</p><p>å®¢æˆ·ç«¯çŠ¶æ€redisClientç»“æ„çš„dbå±æ€§è®°å½•äº†å®¢æˆ·ç«¯å½“å‰çš„ç›®æ ‡æ•°æ®åº“ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisClient</span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// è®°å½•å®¢æˆ·ç«¯å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</span><br>    redisDb *db;<br>    <span class="hljs-comment">// ...</span><br>&#125; redisClient;<br></code></pre></td></tr></table></figure><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/redisDb.png" alt="å®¢æˆ·ç«¯çš„ç›®æ ‡æ•°æ®åº“ä¸º1å·æ•°æ®åº“"></p><h3 id="æ•°æ®åº“é”®ç©ºé—´"><a href="#æ•°æ®åº“é”®ç©ºé—´" class="headerlink" title="æ•°æ®åº“é”®ç©ºé—´"></a>æ•°æ®åº“é”®ç©ºé—´</h3><p>redisæ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®å™¨ç»“æ„redisDbä¸­çš„<strong>dict</strong>å­—å…¸ä¿å­˜äº†æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œè¿™ä¸ªå­—å…¸è¢«ç§°ä¸º<strong>é”®ç©ºé—´</strong>ï¼ˆkey spaceï¼‰ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/keySpace.png" alt="é”®ç©ºé—´ä¾‹å­"></p><p>æ•°æ®åº“çš„æ“ä½œå¦‚æ·»åŠ ã€åˆ é™¤ã€æ›´æ–°ã€å–å€¼ç­‰éƒ½æ˜¯é”®ç©ºé—´æ“ä½œã€‚</p><h3 id="é”®çš„è¿‡æœŸæœºåˆ¶"><a href="#é”®çš„è¿‡æœŸæœºåˆ¶" class="headerlink" title="é”®çš„è¿‡æœŸæœºåˆ¶"></a>é”®çš„è¿‡æœŸæœºåˆ¶</h3><p>redisDbä¸­çš„<strong>expires</strong>å­—å…¸ä¿å­˜äº†æ•°æ®åº“ä¸­æ‰€æœ‰é”®çš„è¿‡æœŸæ—¶é—´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisDb</span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// æ•°æ®é”®ç©ºé—´ï¼Œä¿å­˜é”®ç©ºé—´æ‰€æœ‰çš„é”®å€¼å¯¹</span><br>    dict *dict;<br>    <span class="hljs-comment">// è¿‡æœŸå­—å…¸ï¼Œä¿å­˜é”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´</span><br>    dict *expires;<br>    <span class="hljs-comment">// ...</span><br>&#125;redisDb;<br></code></pre></td></tr></table></figure><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/expires.png" alt="å¸¦è¿‡æœŸå­—å…¸çš„æ•°æ®åº“ä¾‹å­"></p><ul><li>è¿‡æœŸå­—å…¸çš„é”®æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘é”®ç©ºé—´ä¸­çš„æŸä¸ªé”®å¯¹è±¡</li><li>è¿‡æœŸå­—å…¸çš„å€¼æ˜¯ä¸€ä¸ªlong longç±»å‹çš„æ•´æ•°ï¼Œè¿‡æœŸæ—¶é—´â€“ä¸€ä¸ªæ¯«ç§’ç²¾åº¦çš„UNIXæ—¶é—´æˆ³</li></ul><h3 id="è¿‡æœŸé”®çš„åˆ é™¤"><a href="#è¿‡æœŸé”®çš„åˆ é™¤" class="headerlink" title="è¿‡æœŸé”®çš„åˆ é™¤"></a>è¿‡æœŸé”®çš„åˆ é™¤</h3><p>redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥ä¸º<strong>å®šæœŸåˆ é™¤</strong>å’Œ<strong>æƒ°æ€§åˆ é™¤</strong>ã€‚</p><h4 id="å®šæœŸåˆ é™¤"><a href="#å®šæœŸåˆ é™¤" class="headerlink" title="å®šæœŸåˆ é™¤"></a>å®šæœŸåˆ é™¤</h4><p>å®šæœŸåˆ é™¤ç­–ç•¥æ¯éš”ä¸€æ®µå›ºå®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ é™¤è¿‡æœŸé”®æ“ä½œï¼Œå¹¶é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘å¯¹CPUæ—¶é—´çš„å½±å“ã€‚</p><p>rediså‘¨æœŸæ€§æ“ä½œè¿›è¡Œæ—¶ï¼ŒactivaExpireCycleå‡½æ•°ä¼šåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œåˆ†å¤šæ¬¡éå†æœåŠ¡å™¨ä¸­çš„å„ä¸ªæ•°æ®åº“ï¼Œä»æ•°æ®åº“çš„<strong>expires</strong>å­—å…¸ä¸­éšæœºæ£€æŸ¥éƒ¨åˆ†é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸé”®ã€‚</p><h4 id="æƒ°æ€§åˆ é™¤"><a href="#æƒ°æ€§åˆ é™¤" class="headerlink" title="æƒ°æ€§åˆ é™¤"></a>æƒ°æ€§åˆ é™¤</h4><p>æƒ°æ€§åˆ é™¤æ˜¯æŒ‡ç¨‹åºåªä¼šåœ¨å–å‡ºé”®æ—¶æ‰ä¼šå¯¹é”®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œåˆ é™¤çš„ç›®æ ‡ä»…é™äºå½“å‰æ“ä½œé”®ï¼Œé¿å…äº†æµªè´¹CPUæ—¶é—´ï¼Œä½†æ˜¯redisæ˜¯å†…å­˜æœåŠ¡å™¨ï¼Œè¿™ä¸€ç­–ç•¥ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚</p><blockquote><p>redisåŒæ—¶é‡‡ç”¨äº†<strong>å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤å¹¶ç»“åˆ</strong>ã€‚</p></blockquote><h2 id="RDBæŒä¹…åŒ–"><a href="#RDBæŒä¹…åŒ–" class="headerlink" title="RDBæŒä¹…åŒ–"></a>RDBæŒä¹…åŒ–</h2><p>redisæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå½“æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ•°æ®åº“çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ã€‚redisæä¾›äº†RDBæŒä¹…åŒ–åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨å¼€å¯ï¼Œä¹Ÿå¯ä»¥å®šæœŸä¿å­˜ã€‚RDBæŒä¹…åŒ–åŠŸèƒ½ç”Ÿæˆçš„æ–‡ä»¶æ˜¯ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿˜åŸæ•°æ®åº“çŠ¶æ€ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/RDB.png" alt="æ•°æ®åº“å’ŒRDBæ–‡ä»¶äº’ç›¸è½¬æ¢"></p><blockquote><p>RDBæ–‡ä»¶é€šè¿‡æ¼”è¿›ï¼Œè€ç‰ˆæœ¬çš„redisæ— æ³•å…¼å®¹æ–°ç‰ˆæœ¬çš„RDBï¼Œå› ä¸ºæœ‰éƒ¨åˆ†æ•°æ®ç»“æ„ä¸åŒ¹é…ã€‚</p></blockquote><h3 id="ä¿å­˜ä¸è½½å…¥"><a href="#ä¿å­˜ä¸è½½å…¥" class="headerlink" title="ä¿å­˜ä¸è½½å…¥"></a>ä¿å­˜ä¸è½½å…¥</h3><p>å½“AOFæŒä¹…åŒ–åŠŸèƒ½å¼€å¯æ—¶ï¼Œredisä¼šä¼˜å…ˆä½¿ç”¨AOFï¼Œå› ä¸ºAOFæ›´æ–°é¢‘ç‡æ›´é«˜ã€‚<br>åˆ›å»ºRDBæ–‡ä»¶åˆ›å»ºRDBæ–‡ä»¶æœ‰<strong>SAVE</strong>å’Œ<strong>BGSAVE</strong>ä¸¤ä¸ªå‘½ä»¤ã€‚</p><ul><li><strong>SAVE</strong><br>ç›´æ¥åˆ›å»ºRDBæ–‡ä»¶ï¼Œä¼šä¸­æ–­æœåŠ¡å™¨ç¨‹åº</li><li><strong>BGSAVE</strong><br>çˆ¶ç¨‹åºä¼šforkä¸€ä¸ªå­ç¨‹åºï¼Œç”±å­ç¨‹åºåˆ›å»ºRDBæ–‡ä»¶ï¼Œä¸ä¼šä¸­æ–­æœåŠ¡å™¨ç¨‹åºã€‚</li></ul><p>ä¿å­˜çš„RDBæ–‡ä»¶åå­—å«åš<strong>dump.rdb</strong>ï¼Œå­˜æ”¾ä½ç½®éœ€è¦é€šè¿‡<strong>redis.conf</strong>è®¾ç½®ï¼Œå¦åˆ™é»˜è®¤å½“å‰çš„å·¥ä½œç›®å½•ä¸‹ã€‚<br>å¼€å¯redisæ—¶ï¼Œè‡ªåŠ¨è½½å…¥<strong>dump.rdb</strong>ï¼Œè½½å…¥RDBæ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šå‡ºäºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è½½å…¥å·¥ä½œå®Œæˆã€‚</p><p>ä¿å­˜æ¡ä»¶è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åªè¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼ŒBGSAVEéƒ½ä¼šæ‰§è¡Œ</span><br><span class="hljs-comment"># æœåŠ¡å™¨åœ¨900ç§’å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘1æ¬¡ä¿®æ”¹</span><br>save 900 1<br><span class="hljs-comment"># æœåŠ¡å™¨åœ¨300ç§’å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘10æ¬¡ä¿®æ”¹</span><br>save 300 10<br><span class="hljs-comment"># æœåŠ¡å™¨åœ¨60ç§’å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘10000æ¬¡ä¿®æ”¹</span><br>save 60 10000<br></code></pre></td></tr></table></figure><h3 id="RDBæ–‡ä»¶ç»“æ„"><a href="#RDBæ–‡ä»¶ç»“æ„" class="headerlink" title="RDBæ–‡ä»¶ç»“æ„"></a>RDBæ–‡ä»¶ç»“æ„</h3><p>ä¸‹å›¾ä¸ºä¸€ä¸ªå®Œæ•´çš„RDBæ–‡ä»¶ç»“æ„ï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/rdbfile.png" alt="RDBæ–‡ä»¶ç»“æ„"></p><p>databaseç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/rdbDatabase.png" alt="databaseç»“æ„"></p><p>key_value_pairsç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/key_value_pairs.png" alt="å¸¦è¿‡æœŸæ—¶é—´çš„key_value_pairsç»“æ„"></p><p>æ— è¿‡æœŸæ—¶é—´çš„ç»“æ„åªæœ‰TYPEã€keyã€valueã€‚</p><h2 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a>AOFæŒä¹…åŒ–</h2><p>AOFæŒä¹…åŒ–æ˜¯é€šè¿‡redisæœåŠ¡å™¨æ‰€æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/AOF.png" alt="AOFæŒä¹…åŒ–"></p><h3 id="AOFæŒä¹…åŒ–çš„å®ç°"><a href="#AOFæŒä¹…åŒ–çš„å®ç°" class="headerlink" title="AOFæŒä¹…åŒ–çš„å®ç°"></a>AOFæŒä¹…åŒ–çš„å®ç°</h3><p>AOFæŒä¹…åŒ–åˆ†ä¸ºå‘½ä»¤è¿½åŠ ã€æ–‡ä»¶å†™å…¥ã€æ–‡ä»¶åŒæ­¥ã€‚</p><ol><li><strong>å‘½ä»¤è¿½åŠ </strong></li></ol><p>AOFæŒä¹…åŒ–å¼€å¯åï¼Œå¦‚æœredisæ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤åï¼Œä¼šå°†å†™å‘½ä»¤ä»¥åè®®æ ¼å¼è¿½åŠ åˆ°æœåŠ¡å™¨çŠ¶æ€çš„<strong>aof_buf</strong>ç¼“å†²åŒºæœ«å°¾ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisServer</span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// AOFç¼“å†²åŒº</span><br>    sds aof_buf;<br>    <span class="hljs-comment">// ..</span><br>&#125;;<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>æ–‡ä»¶å†™å…¥ä¸åŒæ­¥</strong></li></ol><p>redisç¨‹åºæ˜¯ä¸€ä¸ª<strong>äº‹ä»¶å¾ªç¯</strong>ï¼Œå¾ªç¯ä¸­çš„æ–‡ä»¶äº‹ä»¶è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ï¼Œä»¥åŠå‘å®¢æˆ·ç«¯å‘é€å‘½ä»¤å›å¤ï¼Œå¾ªç¯ä¸­è¿˜åŒ…æ‹¬å®šæ—¶è¿è¡Œçš„å‡½æ•°ã€‚å¼€å¯AOFæŒä¹…åŒ–åï¼ŒæœåŠ¡å™¨åœ¨ç»“æŸä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¹‹å‰ï¼Œç¨‹åºä¼šè°ƒç”¨<strong>flushAppendOnlyFile</strong>å‡½æ•°ï¼Œé€‰æ‹©æ˜¯å¦å°†aof_bufä¸­çš„å†…å®¹å†™å…¥å’Œä¿å­˜åˆ°AOFæ–‡ä»¶é‡Œé¢ã€‚</p><p><strong>flushAppendOnlyFile</strong>å‡½æ•°çš„è¡Œä¸ºç”±æœåŠ¡å™¨é…ç½®çš„appendfsyncé€‰é¡¹å†³å®šï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/appendfsync.png" alt="appendfsyncé…ç½®ä¸åŒçš„æŒä¹…åŒ–è¡Œä¸º"></p><blockquote><p>å†™å…¥ï¼ˆ<strong>write</strong>ï¼‰åœ¨linuxä¸­åªæ˜¯æŠŠæ•°æ®å†™å…¥åˆ°å†…æ ¸é¡µç¼“å­˜ï¼Œå¹¶æœªçœŸæ­£è½ç›˜ã€‚åªæœ‰åŒæ­¥åˆ°ç¡¬ç›˜æ‰æ˜¯è½ç›˜ã€‚</p></blockquote><h3 id="AOFæ–‡ä»¶è½½å…¥å’Œæ•°æ®åº“è¿˜åŸ"><a href="#AOFæ–‡ä»¶è½½å…¥å’Œæ•°æ®åº“è¿˜åŸ" class="headerlink" title="AOFæ–‡ä»¶è½½å…¥å’Œæ•°æ®åº“è¿˜åŸ"></a>AOFæ–‡ä»¶è½½å…¥å’Œæ•°æ®åº“è¿˜åŸ</h3><p>å…³é”®ç‚¹åœ¨äºåˆ›å»ºä¸€ä¸ªä¸è”ç½‘çš„ä¼ªå®¢æˆ·ç«¯ï¼Œåˆ©ç”¨ä¼ªå®¢æˆ·ç«¯å†™å…¥å‘½ä»¤ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/aofLoad.png" alt="AOFæ–‡ä»¶è½½å…¥è¿‡ç¨‹"></p><h3 id="AOFé‡å†™"><a href="#AOFé‡å†™" class="headerlink" title="AOFé‡å†™"></a>AOFé‡å†™</h3><p>ä¸ºäº†é¿å…è®°å½•è¿‡å¤šå†™å‘½ä»¤å¯¼è‡´çš„AOFæ–‡ä»¶åºå¤§ï¼Œredisé‡æ–°ç”Ÿæˆæ–°çš„AOFæ–‡ä»¶æ›¿ä»£æ—§AOFæ–‡ä»¶è¢«ç§°ä¸º<strong>AOFé‡å†™</strong>ã€‚</p><p><strong>AOFé‡å†™æ˜¯é€šè¿‡è¯»å–å½“å‰çš„æ•°æ®åº“çŠ¶æ€æ¥å®ç°çš„</strong>ï¼Œè€Œä¸ç”¨åˆ†ææ—§AOFæ–‡ä»¶ã€‚æ•°æ®åº“ä¸­å­˜åœ¨ä»€ä¹ˆé”®å€¼å¯¹ï¼Œå°±å†™å…¥ä»€ä¹ˆï¼Œæ‰€ä»¥æ²¡æœ‰ä¸€å¥å‘½ä»¤å¤šä½™ã€‚</p><blockquote><p>ä¸ºäº†é¿å…åœ¨æ‰§è¡Œå‘½ä»¤æ—¶é€ æˆå®¢æˆ·ç«¯è¾“å…¥ç¼“å†²åŒºæº¢å‡ºï¼Œé‡å†™ç¨‹åºä¼šæ£€æŸ¥å¤šå…ƒç´ çš„æ•°é‡ï¼Œè¶…è¿‡å›ºå®šå€¼åˆ™é€šè¿‡æ‰§è¡Œå¤šæ¡å‘½ä»¤è®°å½•é”®çš„å€¼ã€‚</p></blockquote><p>ä¸ºäº†ä¿è¯æ‰§è¡ŒAOFé‡å†™æ—¶ï¼ŒæœåŠ¡å™¨ä¾ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œredisä½¿ç”¨<strong>AOFåå°é‡å†™</strong>æŠ€æœ¯ã€‚</p><p>redisä¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰å½“å‰æ•°æ®åº“æ‰€æœ‰æ•°æ®çš„<strong>å­è¿›ç¨‹</strong>ï¼Œçˆ¶è¿›ç¨‹ä¾æ—§æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯å‘½ä»¤ï¼Œå­è¿›ç¨‹æ‰§è¡ŒAOFé‡å†™ç¨‹åºã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/aofRewrite.png" alt="AOFé‡å†™"></p><p>è¦è®©å­è¿›ç¨‹é‡å†™ç»“æŸåçš„AOFæ–‡ä»¶ä¸å½“å‰çˆ¶è¿›ç¨‹ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼ŒredisæœåŠ¡å™¨åœ¨åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰ï¼Œä¼šç»´æŠ¤ä¸€ä¸ª<strong>AOFé‡å†™ç¼“å†²åŒº</strong>ã€‚è¿™ä¸ªç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹æ‰§è¡ŒAOFé‡å†™æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ï¼Œå½“å­è¿›ç¨‹å®Œæˆæ‰€æœ‰å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨å°†ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹æ·»åŠ åˆ°é‡å†™AOFæ–‡ä»¶çš„æœ«å°¾ï¼Œæœ€åç”¨è¿™ä¸ªæ–°AOFæ–‡ä»¶æ›¿ä»£æ—§æ–‡ä»¶ã€‚</p><h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h2><p>redisæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºã€‚æœåŠ¡å™¨å¤„ç†ä»¥ä¸‹ä¸¤ç±»äº‹ä»¶ï¼š<strong>æ–‡ä»¶äº‹ä»¶</strong>ã€<strong>æ—¶é—´äº‹ä»¶</strong>ã€‚</p><h3 id="æ–‡ä»¶äº‹ä»¶"><a href="#æ–‡ä»¶äº‹ä»¶" class="headerlink" title="æ–‡ä»¶äº‹ä»¶"></a>æ–‡ä»¶äº‹ä»¶</h3><p>redisä½¿ç”¨çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨è¢«ç§°ä¸º<strong>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨</strong>ã€‚</p><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨<strong>I&#x2F;Oå¤šè·¯å¤ç”¨ç¨‹åº</strong>åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œä¸ºå¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä¸åŒä»»åŠ¡<strong>å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨</strong>ã€‚è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡<strong>æ‰§è¡Œè¿æ¥åº”ç­”ã€è¯»å–ã€å†™å…¥ã€å…³é—­ç­‰æ“ä½œ</strong>æ—¶ï¼Œäº§ç”Ÿå¯¹åº”çš„æ–‡ä»¶äº‹ä»¶ï¼Œ<strong>æ–‡ä»¶å¤„ç†å™¨ä¼šè°ƒç”¨ä¹‹å‰å…³è”çš„äº‹ä»¶å¤„ç†å™¨</strong>ã€‚</p><blockquote><p><strong>I&#x2F;Oå¤šè·¯å¤ç”¨æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ªI&#x2F;Oæµ</strong>ï¼Œæ˜¯redisæ”¯æŒé«˜å¹¶å‘çš„å…³é”®<br>åŸç†æ˜¯å°†æ‰€æœ‰å…³æ³¨çš„å¥—æ¥å­—æ³¨å†Œåˆ°å†…æ ¸ï¼Œå†…æ ¸</p></blockquote><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/FEH.png" alt="æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„å››ä¸ªéƒ¨åˆ†"></p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/cAndS.png" alt="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„é€šä¿¡è¿‡ç¨‹"></p><h3 id="æ—¶é—´äº‹ä»¶"><a href="#æ—¶é—´äº‹ä»¶" class="headerlink" title="æ—¶é—´äº‹ä»¶"></a>æ—¶é—´äº‹ä»¶</h3><ul><li>æ—¶é—´äº‹ä»¶åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š</li></ul><p><strong>å®šæ—¶äº‹ä»¶</strong>ï¼šè®©ç¨‹åºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚</p><p><strong>å‘¨æœŸæ€§äº‹ä»¶</strong>ï¼šè®©ç¨‹åºæ¯éš”æŒ‡å®šæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ã€‚</p><ul><li>æ—¶é—´äº‹ä»¶ä¸»è¦ç”±ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ç»„æˆï¼š</li></ul><p><strong>id</strong>ï¼šå…¨å±€å”¯ä¸€IDï¼Œæ–°äº‹ä»¶IDæ¯”æ—§äº‹ä»¶IDå¤§ã€‚<br><strong>when</strong>ï¼šæ¯«ç§’ç²¾åº¦UNIXæ—¶é—´æˆ³ï¼Œè®°å½•åˆ°è¾¾æ—¶é—´ã€‚<br><strong>timeProc</strong>ï¼šæ—¶é—´äº‹ä»¶å¤„ç†å™¨ï¼Œæ—¶é—´äº‹ä»¶åˆ°è¾¾æ—¶ï¼ŒæœåŠ¡å™¨è°ƒç”¨ç›¸åº”å¤„ç†å™¨ã€‚</p><p>äº‹ä»¶å¤„ç†å™¨è¿”å›è¿”å›ae.h&#x2F;<strong>AE_NOMORE</strong>ï¼Œåˆ™äº‹ä»¶ä¸ºå®šæ—¶äº‹ä»¶ï¼šäº‹ä»¶åˆ°è¾¾ä¸€æ¬¡ä¹‹åè¢«åˆ é™¤ã€‚å¦‚æœæ˜¯ä¸€ä¸ª<strong>éAE_NOMORE</strong>çš„æ•°ï¼Œåˆ™ä¸ºå‘¨æœŸæ€§äº‹ä»¶ï¼Œæ ¹æ®è¿”å›çš„å€¼å¯¹<strong>when</strong>è¿›è¡Œæ›´æ–°ï¼Œè®©äº‹ä»¶åœ¨è¿™æ®µæ—¶é—´ä¹‹ååˆ°è¾¾ã€‚</p><h3 id="äº‹ä»¶çš„è°ƒåº¦å’Œæ‰§è¡Œ"><a href="#äº‹ä»¶çš„è°ƒåº¦å’Œæ‰§è¡Œ" class="headerlink" title="äº‹ä»¶çš„è°ƒåº¦å’Œæ‰§è¡Œ"></a>äº‹ä»¶çš„è°ƒåº¦å’Œæ‰§è¡Œ</h3><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/eventProc.png" alt="äº‹ä»¶å¤„ç†è§’åº¦ä¸‹çš„æœåŠ¡å™¨è¿è¡Œæµç¨‹"></p><p>æœåŠ¡å™¨è½®æµå¤„ç†æ–‡ä»¶äº‹ä»¶å’Œæ—¶é—´äº‹ä»¶ï¼Œå¤„ç†äº‹ä»¶çš„è¿‡ç¨‹ä¸­<strong>ä¸ä¼šè¿›è¡ŒæŠ¢å </strong>ï¼Œå› æ­¤äº‹ä»¶å¤„ç†å™¨ä¼šå°½å¯èƒ½å‡å°‘é˜»å¡æ—¶é—´ï¼Œå¿…è¦æ—¶ä¸»åŠ¨<strong>è®©å‡ºæ‰§è¡Œæƒ</strong>ï¼Œæ—¶é—´äº‹ä»¶ä¹Ÿä¼šæŠŠè€—æ—¶çš„æŒä¹…åŒ–æ“ä½œæ”¾åœ¨å­çº¿ç¨‹æˆ–å­è¿›ç¨‹æ‰§è¡Œã€‚<br>å› ä¸ºæœåŠ¡å™¨å…ˆå¤„ç†æ–‡ä»¶äº‹ä»¶ï¼Œæ‰€ä»¥<strong>æ—¶é—´äº‹ä»¶çš„å®é™…å¤„ç†æ—¶é—´é€šå¸¸æ¯”è®¾å®šçš„åˆ°è¾¾æ—¶é—´æ™šä¸€äº›</strong>ã€‚</p><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="å®¢æˆ·ç«¯å±æ€§"><a href="#å®¢æˆ·ç«¯å±æ€§" class="headerlink" title="å®¢æˆ·ç«¯å±æ€§"></a>å®¢æˆ·ç«¯å±æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisClient</span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-type">int</span> fd;<br>    ...<br>    <span class="hljs-type">int</span> flags;<br>    ...<br>    sds querybuf;<br>    ...<br>    robj **argv;<br>    <span class="hljs-type">int</span> argc;<br>    ...<br>    redisCommand *cmd;<br>    <span class="hljs-comment">// ...</span><br>&#125;redisClient;<br></code></pre></td></tr></table></figure><ul><li><strong>å¥—æ¥å­—æè¿°ç¬¦</strong></li></ul><p>å®¢æˆ·ç«¯çŠ¶æ€çš„<strong>fd</strong>å±æ€§è®°å½•å®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨çš„å¥—æ¥å­—æè¿°ç¬¦ï¼Œfdå±æ€§ä¸º-1åˆ™æ˜¯<strong>ä¼ªå®¢æˆ·ç«¯</strong>ï¼ˆAOFæŒä¹…åŒ–ã€Luaè„šæœ¬ï¼‰ï¼Œæ™®é€šå®¢æˆ·ç«¯çš„fdä¸ºå¤§äº-1çš„å€¼ã€‚</p><ul><li><strong>æ ‡å¿—</strong></li></ul><p>å®¢æˆ·ç«¯çŠ¶æ€çš„æ ‡å¿—å±æ€§<strong>flags</strong>è®°å½•å®¢æˆ·ç«¯çš„<strong>è§’è‰²ï¼ˆroleï¼‰</strong>ï¼Œä»¥åŠå®¢æˆ·ç«¯æ‰€å¤„çš„çŠ¶æ€ã€‚</p><ul><li><strong>è¾“å…¥ç¼“å†²åŒº</strong></li></ul><p>å®¢æˆ·ç«¯çŠ¶æ€çš„<strong>querybuf</strong>è¾“å…¥ç¼“å­˜åŒºç”¨äºä¿å­˜å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤è¯·æ±‚ã€‚è¾“å…¥ç¼“å­˜åŒºçš„å¤§å°ä¼šæ ¹æ®è¾“å…¥å†…å®¹åŠ¨æ€åœ°ç¼©å°æ”¾å¤§ï¼Œæœ€å¤§<strong>ä¸è¶…è¿‡1GBï¼Œå¦åˆ™æœåŠ¡å™¨å…³é—­è¿™ä¸ªå®¢æˆ·ç«¯</strong>ã€‚</p><ul><li><strong>å‘½ä»¤ä¸å‘½ä»¤å‚æ•°</strong></li></ul><p>æœåŠ¡å™¨å¯¹è¾“å…¥ç¼“å­˜åŒºä¸­çš„å‘½ä»¤è¯·æ±‚è¿›è¡Œåˆ†æï¼Œå¹¶å°†å¾—å‡ºçš„<strong>å‘½ä»¤å‚æ•°</strong>å’Œ<strong>å‚æ•°ä¸ªæ•°</strong>ä¿å­˜åœ¨å®¢æˆ·ç«¯çŠ¶æ€çš„argvå’Œargcå±æ€§ä¸­ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/cmdClient.png" alt="argvå’Œargcç¤ºä¾‹"></p><p>æœåŠ¡å™¨æ ¹æ®argv[0]çš„å€¼åœ¨<strong>å‘½ä»¤è¡¨</strong>ä¸­æŸ¥æ‰¾å‘½ä»¤æ‰€å¯¹åº”çš„<strong>å‘½ä»¤å®ç°å‡½æ•°</strong>ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/cmdTable.png" alt="å‘½ä»¤è¡¨"></p><p><strong>redisCommand</strong>ç»“æ„ä¿å­˜äº†å‘½ä»¤çš„å®ç°å‡½æ•°ã€å‘½ä»¤çš„æ ‡å¿—ã€å‘½ä»¤åº”ç»™å®šçš„å‚æ•°ä¸ªæ•°å’Œæ‰§è¡Œæ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>æœåŠ¡å™¨æ‰¾åˆ°å¯¹åº”redisCommandä¹‹åï¼Œä¼šå°†å®¢æˆ·ç«¯çŠ¶æ€çš„<strong>cmd</strong>æŒ‡é’ˆæŒ‡å‘å®ƒã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93/cmdSet.png" alt="æŸ¥æ‰¾å‘½ä»¤å¹¶è®¾ç½®cmdå±æ€§"></p><p>ä¹‹åï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡cmdè°ƒç”¨å‘½ä»¤å®ç°å‡½æ•°ï¼Œæ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚å‘½ä»¤ã€‚</p><ul><li><strong>è¾“å‡ºç¼“å†²åŒº</strong></li></ul><p>æ‰§è¡Œå‘½ä»¤æ‰€å¾—çš„å‘½ä»¤å›å¤ä¼šè¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯çŠ¶æ€çš„è¾“å‡ºç¼“å†²åŒºã€‚<br>æ¯ä¸ªå®¢æˆ·ç«¯æœ‰<strong>ä¸¤ä¸ªè¾“å‡ºç¼“å†²åŒºå¯ç”¨</strong>ï¼Œä¸€ä¸ª<strong>å¤§å°å›ºå®š</strong>ï¼ˆ16KBï¼‰ï¼Œå¦ä¸€ä¸ª<strong>å¤§å°å¯å˜</strong>çš„ã€‚</p><h3 id="å®¢æˆ·ç«¯çš„åˆ›å»ºå’Œå…³é—­"><a href="#å®¢æˆ·ç«¯çš„åˆ›å»ºå’Œå…³é—­" class="headerlink" title="å®¢æˆ·ç«¯çš„åˆ›å»ºå’Œå…³é—­"></a>å®¢æˆ·ç«¯çš„åˆ›å»ºå’Œå…³é—­</h3><h4 id="åˆ›å»ºæ™®é€šå®¢æˆ·ç«¯"><a href="#åˆ›å»ºæ™®é€šå®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»ºæ™®é€šå®¢æˆ·ç«¯"></a>åˆ›å»ºæ™®é€šå®¢æˆ·ç«¯</h4><p>å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œè¿æ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨connectå‡½æ•°è¿æ¥æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è°ƒç”¨<strong>è¿æ¥äº‹ä»¶å¤„ç†å™¨</strong>ï¼Œä¸ºå®¢æˆ·ç«¯åˆ›å»ºç›¸åº”çš„<strong>å®¢æˆ·ç«¯çŠ¶æ€</strong>ï¼Œå¹¶å°†æ–°å®¢æˆ·ç«¯çŠ¶æ€æ·»åŠ åˆ°æœåŠ¡å™¨çŠ¶æ€ç»“æ„<strong>clients</strong>é“¾è¡¨çš„æœ«å°¾ã€‚</p><h4 id="å…³é—­æ™®é€šå®¢æˆ·ç«¯"><a href="#å…³é—­æ™®é€šå®¢æˆ·ç«¯" class="headerlink" title="å…³é—­æ™®é€šå®¢æˆ·ç«¯"></a>å…³é—­æ™®é€šå®¢æˆ·ç«¯</h4><ul><li>å®¢æˆ·ç«¯è¿›ç¨‹é€€å‡ºæˆ–è¢«æ€æ­»ï¼Œå®¢ã€æœä¹‹é—´çš„ç½‘ç»œè¿æ¥å°†è¢«å…³é—­ï¼Œé€ æˆå®¢æˆ·ç«¯è¢«å…³é—­</li><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€äº†å¸¦æœ‰ä¸ç¬¦åˆåè®®æ ¼å¼çš„å‘½ä»¤è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šè¢«å…³é—­</li><li>ç”¨æˆ·ä¸ºæœåŠ¡å™¨è®¾ç½®äº†timeouté…ç½®é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ç©ºè½¬æ—¶é—´è¶…è¿‡ä¹‹åè¢«å…³é—­ï¼ˆå­˜åœ¨ä¸€äº›ä¾‹å¤–ï¼šä¸»æœåŠ¡å™¨ã€ä»æœåŠ¡å™¨ã€BLPOPå‘½ä»¤é˜»å¡ã€æ‰§è¡Œè®¢é˜…å‘½ä»¤ä¸­ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯å‘é€å‘½ä»¤è¯·æ±‚å¤§å°è¶…è¿‡è¾“å…¥ç¼“å†²åŒºçš„å¤§å°ï¼ˆé»˜è®¤1GBï¼‰</li><li>è¦å‘é€ç»™å®¢æˆ·ç«¯çš„å‘½ä»¤å›å¤å¤§å°è¶…è¿‡äº†è¾“å‡ºç¼“å†²åŒºçš„é™åˆ¶å¤§å°ï¼ˆç¡¬æ€§é™åˆ¶ã€è½¯ä»¶é™åˆ¶ï¼‰</li></ul><h2 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h2><h3 id="å‘½ä»¤è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#å‘½ä»¤è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="å‘½ä»¤è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹"></a>å‘½ä»¤è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹</h3><ol><li>å®¢æˆ·ç«¯å°†å‘½ä»¤è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨è¯»å–å‘½ä»¤ï¼Œå¹¶åˆ†æå‘½ä»¤å‚æ•°</li><li>å‘½ä»¤æ‰§è¡Œå™¨æ ¹æ®å‚æ•°æŸ¥æ‰¾å‘½ä»¤çš„å®ç°å‡½æ•°ï¼Œç„¶åæ‰§è¡Œå®ç°å‡½æ•°å¹¶å¾—å‡ºå‘½ä»¤å›å¤</li><li>æœåŠ¡å™¨å°†å‘½ä»¤å›å¤è¿”å›ç»™å®¢æˆ·ç«¯</li></ol><h3 id="serverCronå‡½æ•°"><a href="#serverCronå‡½æ•°" class="headerlink" title="serverCronå‡½æ•°"></a>serverCronå‡½æ•°</h3><p>é»˜è®¤æ¯éš”100æ¯«ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä¸»è¦ç”¨äºæ›´æ–°æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ï¼Œå¤„ç†æœåŠ¡å™¨æ¥æ”¶çš„SIGTERMä¿¡å·ï¼Œç®¡ç†å®¢æˆ·ç«¯èµ„æºå’Œæ•°æ®åº“çŠ¶æ€ï¼Œæ‰§è¡ŒæŒä¹…åŒ–æ“ä½œç­‰ç­‰ã€‚</p><h3 id="æœåŠ¡å™¨åˆå§‹åŒ–"><a href="#æœåŠ¡å™¨åˆå§‹åŒ–" class="headerlink" title="æœåŠ¡å™¨åˆå§‹åŒ–"></a>æœåŠ¡å™¨åˆå§‹åŒ–</h3><ol><li>åˆå§‹åŒ–æœåŠ¡å™¨çŠ¶æ€</li><li>è½½å…¥æœåŠ¡å™¨é…ç½®</li><li>åˆå§‹åŒ–æœåŠ¡å™¨æ•°æ®ç»“æ„</li><li>è¿˜åŸæ•°æ®åº“çŠ¶æ€</li><li>æ‰§è¡Œäº‹ä»¶å¾ªç¯</li></ol>]]></content>
    
    
    <categories>
      
      <category>redisè®¾è®¡ä¸å®ç°è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redisè®¾è®¡ä¸å®ç°è¯»ä¹¦ç¬”è®°ä¸€--æ•°æ®ç»“æ„</title>
    <link href="/2025/06/22/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <url>/2025/06/22/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<p>è¿™æœ¬ä¹¦é‡‡ç”¨redisä¸º2.8ï¼Œç°åœ¨ï¼ˆ2025å¹´ï¼‰redisæ›´æ–°ç‰ˆæœ¬åˆ°äº†7.xï¼Œä½œè€…ä¸‹è½½redisæºç ç‰ˆæœ¬ä¸º7.0.15ã€‚ä½†æ˜¯è¯¢é—®GPTå¾—åˆ°çš„ç­”æ¡ˆä¸ºåŸºæœ¬æ•°æ®ç»“æ„æ²¡æœ‰å¤§å˜åŠ¨ï¼Œä½†æ˜¯æ–°ç‰ˆæœ¬æ–°æ·»åŠ äº†ä¸€äº›æ•°æ®ç»“æ„ã€‚</p><h2 id="ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰"><a href="#ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰" class="headerlink" title="ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰"></a>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰</h2><h3 id="SDSå®ç°"><a href="#SDSå®ç°" class="headerlink" title="SDSå®ç°"></a>SDSå®ç°</h3><p>ä¹¦ä¸­sdsç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sdshdr</span> &#123;<br>    <span class="hljs-comment">// è®°å½• buf æ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span><br>    <span class="hljs-comment">// ç­‰äºSDS æ‰€ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦</span><br>    <span class="hljs-type">int</span> len:<br>    <span class="hljs-comment">// è®°å½• buf æ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span><br>    <span class="hljs-type">int</span> free;<br>    <span class="hljs-comment">// å­—èŠ‚æ•°ç»„,ç”¨äºä¿å­˜å­—ç¬¦ä¸²</span><br>    <span class="hljs-type">char</span> buf [];<br>&#125;;<br></code></pre></td></tr></table></figure><p>redisï¼ˆ7.0.15ï¼‰ä¸­çš„å®šä¹‰ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">__attribute__</span> ((__packed__)) sdshdr8 &#123;<br>    <span class="hljs-comment">// å®é™…ä½¿ç”¨çš„å­—èŠ‚æ•°</span><br>    <span class="hljs-type">uint8_t</span> len; <br>    <span class="hljs-comment">// åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬å¤´å’Œ\0ç»“å°¾</span><br>    <span class="hljs-type">uint8_t</span> alloc; <span class="hljs-comment">/* excluding the header and null terminator */</span><br>    <span class="hljs-comment">// è®°å½•SDSç±»å‹ï¼ˆ8ã€16ã€32ï¼‰</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> flags; <span class="hljs-comment">/* 3 lsb of type, 5 unused bits */</span><br>    <span class="hljs-type">char</span> buf[];<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="SDSç‰¹æ€§"><a href="#SDSç‰¹æ€§" class="headerlink" title="SDSç‰¹æ€§"></a>SDSç‰¹æ€§</h3><ul><li><strong>å­—ç¬¦ä¸²é•¿åº¦å¿«é€ŸæŸ¥è¯¢</strong></li></ul><p>Cè¯­è¨€ä¸­å­—ç¬¦ä¸²æŸ¥è¯¢é•¿åº¦å¤åˆ¶åº¦$O(n)$ï¼Œè€ŒSDSä¸­æŸ¥è¯¢å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦ä¸º$O(1)$ï¼Œå› ä¸ºSDSä¸­å¯ä»¥ç›´æ¥æŸ¥å­—é•¿lenã€‚è®°å½•å­—é•¿ä¹Ÿä¸ºSDSé¿å…äº†åç»­ä¿®æ”¹å­—ç¬¦ä¸²å¯¼è‡´ç¼“å†²æº¢å‡ºçš„é—®é¢˜ã€‚</p><ul><li><strong>é¢„åˆ†é…ä¸æƒ°æ€§ç©ºé—´</strong></li></ul><p>ä¸ºäº†é¿å…å¤šæ¬¡å­—ç¬¦ä¸²ä¿®æ”¹å¯¼è‡´çš„<strong>åå¤å†…å­˜é‡åˆ†é…</strong>ï¼ŒSDSä½¿ç”¨äº†é¢„åˆ†é…ä¸æƒ°æ€§ç©ºé—´çš„ç­–ç•¥ã€‚<br>å…·ä½“ä½“ç°ä¸ºï¼šå¯¹SDSåšæ‹¼æ¥ç­‰å¢åŠ å­—ç¬¦çš„æ“ä½œæ—¶ï¼ŒSDSä¼šå¤šåˆ†é…ä¸€äº›å†…å­˜ç©ºé—´ï¼›å¯¹SDSåšæˆªæ–­ç­‰åˆ é™¤å­—ç¬¦çš„æ“ä½œæ—¶ï¼ŒSDSå¹¶ä¸ä¼šæŠŠfreeçš„ç©ºé—´å…¨éƒ¨å›æ”¶ï¼Œè€Œæ˜¯åšä¿ç•™ã€‚<br>è¿™ç§ç­–ç•¥å¯ä»¥è§†ä¸ºä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œæé«˜äº†SDSçš„æ“ä½œé€Ÿåº¦æ€§èƒ½ã€‚</p><ul><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong></li></ul><p>Cè¯­è¨€çš„å­—ç¬¦ä¸²é»˜è®¤ä»¥â€™\0â€™ä½œä¸ºç»“å°¾æ ‡å¿—ï¼Œæ‰€ä»¥æ— æ³•æ”¯æŒå…·æœ‰ä¸­é—´â€™\0â€™çš„æ•°æ®ï¼Œå¦‚<strong>å›¾ç‰‡ã€å‹ç¼©åŒ…</strong>ç­‰ã€‚è€ŒSDSç”±äºä½¿ç”¨lenè®°å½•å­—é•¿ï¼Œæ‰€ä»¥SDSä¸­çš„æ•°æ®å¯ä»¥åŒ…å«ä»»æ„ä¸ªâ€™\0â€™ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ•°æ®æ— æ³•æ­£å¸¸è¯»å–ã€‚</p><h2 id="é“¾è¡¨-listNode"><a href="#é“¾è¡¨-listNode" class="headerlink" title="é“¾è¡¨(listNode)"></a>é“¾è¡¨(listNode)</h2><h3 id="listNode-listå®ç°"><a href="#listNode-listå®ç°" class="headerlink" title="listNode&amp;listå®ç°"></a>listNode&amp;listå®ç°</h3><ul><li><strong>é“¾è¡¨èŠ‚ç‚¹listNodeç»“æ„</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">listNode</span> &#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">listNode</span> *prev;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">listNode</span> *next;<br>    <span class="hljs-type">void</span> *value;<br>&#125; listNode;<br></code></pre></td></tr></table></figure><ul><li><strong>é“¾è¡¨listç»“æ„</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">list</span> &#123;<br>    listNode *head;<br>    listNode *tail;<br>    <span class="hljs-comment">// èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span><br>    <span class="hljs-type">void</span> *(*dup)(<span class="hljs-type">void</span> *ptr);<br>    <span class="hljs-comment">// èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span><br>    <span class="hljs-built_in">void</span> (*free)(<span class="hljs-type">void</span> *ptr);<br>    <span class="hljs-comment">// èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•°</span><br>    <span class="hljs-built_in">int</span> (*match)(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">void</span> *key);<br>    <span class="hljs-comment">// é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°é‡</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> len;<br>&#125; list;<br></code></pre></td></tr></table></figure><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/list.png" alt="listå’ŒlistNodeç»„æˆçš„é“¾ç»“æ„"></p><h3 id="listnode-listç‰¹æ€§"><a href="#listnode-listç‰¹æ€§" class="headerlink" title="listnode&amp;listç‰¹æ€§"></a>listnode&amp;listç‰¹æ€§</h3><ul><li><strong>åŒç«¯</strong></li></ul><p>é“¾è¡¨èŠ‚ç‚¹å¸¦æœ‰<strong>prev</strong>å’Œ<strong>next</strong>æŒ‡é’ˆ,è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„å¤æ‚åº¦éƒ½æ˜¯$O(1)$ã€‚</p><ul><li><strong>è¡¨å¤´è¡¨å°¾</strong></li></ul><p>é“¾è¡¨listå¸¦æœ‰<strong>head</strong>å’Œ<strong>tail</strong>æŒ‡é’ˆ,è·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„å¤æ‚åº¦éƒ½æ˜¯$O(1)$ã€‚</p><ul><li><strong>èŠ‚ç‚¹è®¡æ•°å™¨</strong></li></ul><p>é“¾è¡¨listå¸¦æœ‰èŠ‚ç‚¹è®¡æ•°å™¨<strong>len</strong>,è·å–é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡å¤æ‚åº¦æ˜¯$O(1)$ã€‚</p><ul><li><strong>å¤šæ€</strong></li></ul><p>é“¾è¡¨èŠ‚ç‚¹ä¸­çš„<strong>value</strong>çš„æŒ‡é’ˆç±»å‹æ˜¯*<strong>void</strong>,æ‰€ä»¥é“¾è¡¨å¯ä»¥ä¿å­˜å„ç±»ä¸åŒç±»å‹çš„å€¼ã€‚</p><h2 id="å­—å…¸ï¼ˆdictionary-dictï¼‰"><a href="#å­—å…¸ï¼ˆdictionary-dictï¼‰" class="headerlink" title="å­—å…¸ï¼ˆdictionary&#x2F;dictï¼‰"></a>å­—å…¸ï¼ˆdictionary&#x2F;dictï¼‰</h2><h3 id="å“ˆå¸Œè¡¨-hash-table"><a href="#å“ˆå¸Œè¡¨-hash-table" class="headerlink" title="å“ˆå¸Œè¡¨ hash table"></a>å“ˆå¸Œè¡¨ hash table</h3><p>å“ˆå¸Œè¡¨åˆç§°æ•£åˆ—è¡¨ï¼Œæ˜¯æ ¹æ®å…³é”®å€¼æ¥è®¿é—®æ•°æ®çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å“ˆå¸Œè¡¨é€šè¿‡å°†å…³é”®é”®å€¼æ˜ å°„ä¸ºä¸€ä¸ªåœ°å€ç´¢å¼•ï¼ŒåŠ å¿«æ•°æ®çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚åšä¸ªæ¯”å–»ï¼Œå­¦ç”Ÿå­¦å·å’Œå­¦ç”Ÿå§“ååˆ†åˆ«å¯¹åº”å…³é”®é”®å€¼ï¼ˆ<strong>key</strong>ï¼‰å’Œæ•°æ®ï¼ˆ<strong>value</strong>ï¼‰ï¼Œä¸”å­˜åœ¨ä¸€ä¸ªæ•°ç»„ï¼ˆ<strong>hash table</strong>ï¼‰ï¼Œè€Œ<strong>key</strong>å¯ä»¥é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•°å­—ç´¢å¼•ï¼ˆå‡è®¾ä¸º1ï¼‰ï¼Œåˆ™å¯ä»¥æŠŠæ•°æ®æ”¾åœ¨æ•°ç»„ç´¢å¼•ä¸º1çš„å‚¨å­˜ç©ºé—´ã€‚ä¸‹æ¬¡æˆ‘ä»¬è¦æŸ¥æ‰¾valueï¼Œåªéœ€è¦é€šè¿‡keyå³å¯çŸ¥é“æ•°æ®å‚¨å­˜ä½ç½®ï¼Œè€Œä¸”ç†æƒ³æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦ä¸ºä¸€ä¸ªå¸¸æ•°ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/hashTable.png" alt="å“ˆå¸Œè¡¨"></p><p>redisçš„å­—å…¸æœ¬è´¨æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œredisä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dict</span> &#123;<br>    <span class="hljs-comment">// å“ˆå¸Œè¡¨æ•°ç»„</span><br>    dictEntry **table;<br>    dictType *type;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> size;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sizemask;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> used;<br>    <span class="hljs-type">void</span> *privdata;<br>&#125; dict;<br></code></pre></td></tr></table></figure><p>å“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dictEntry</span> &#123;<br>    <span class="hljs-type">void</span> *key;<br>    <span class="hljs-type">void</span> *val;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dictEntry</span> *next;<br>&#125; dictEntry;<br></code></pre></td></tr></table></figure><h3 id="å“ˆå¸Œå†²çª"><a href="#å“ˆå¸Œå†²çª" class="headerlink" title="å“ˆå¸Œå†²çª"></a>å“ˆå¸Œå†²çª</h3><p>é¢å¯¹ä¸¤ä¸ªåŠä»¥ä¸Škeyæ˜ å°„åˆ°åŒä¸€ä¸ªç´¢å¼•çš„æƒ…å†µï¼Œredisä½¿ç”¨å•å‘é“¾è¡¨è§£å†³ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/oneKeyOnIndex.png" alt="ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œè¡¨"></p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/twoKeyOnIndex.png" alt="ä½¿ç”¨é“¾è¡¨è§£å†³k2å’Œk1çš„å†²çª"></p><h2 id="æ•´æ•°é›†åˆï¼ˆintsetï¼‰"><a href="#æ•´æ•°é›†åˆï¼ˆintsetï¼‰" class="headerlink" title="æ•´æ•°é›†åˆï¼ˆintsetï¼‰"></a>æ•´æ•°é›†åˆï¼ˆintsetï¼‰</h2><h3 id="intsetå®ç°"><a href="#intsetå®ç°" class="headerlink" title="intsetå®ç°"></a>intsetå®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">intset</span> &#123;<br>  <span class="hljs-comment">// ç¼–ç æ–¹å¼</span><br>  <span class="hljs-type">uint32_t</span> encoding;<br>  <span class="hljs-comment">// é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡</span><br>  <span class="hljs-type">uint32_t</span> length;<br>  <span class="hljs-comment">// ä¿å­˜å…ƒç´ çš„æ•°ç»„</span><br>  <span class="hljs-type">int8_t</span> contents [];<br>&#125; intset;<br></code></pre></td></tr></table></figure><p>contentsæ•°ç»„æ˜¯æ•´æ•°é›†åˆçš„åº•å±‚å®ç°:æ•´æ•°é›†åˆçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯contentsæ•°ç»„çš„ä¸€ä¸ªæ•°ç»„é¡¹ (item)ï¼Œå„ä¸ªé¡¹åœ¨æ•°ç»„ä¸­æŒ‰å€¼çš„å¤§å°ä»å°åˆ°å¤§<strong>æœ‰åºæ’åˆ—</strong>,å¹¶ä¸”æ•°ç»„ä¸­ä¸åŒ…å«ä»»ä½•é‡å¤é¡¹ã€‚</p><p>lengthå±æ€§è®°å½•äº†æ•´æ•°é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡,ä¹Ÿå³æ˜¯contentsæ•°ç»„çš„é•¿åº¦ã€‚è™½ç„¶intsetç»“æ„å°†contentså±æ€§å£°æ˜ä¸ºint8_tç±»å‹çš„æ•°ç»„,ä½†å®é™…ä¸Šcontentsæ•°ç»„å¹¶ä¸ä¿å­˜ä»»ä½•int8_tç±»å‹çš„å€¼,contentsæ•°ç»„çš„çœŸæ­£ç±»å‹å–å†³äºencodingå±æ€§çš„å€¼ã€‚</p><h3 id="intsetç‰¹æ€§"><a href="#intsetç‰¹æ€§" class="headerlink" title="intsetç‰¹æ€§"></a>intsetç‰¹æ€§</h3><ul><li><strong>å‡çº§</strong></li></ul><p>æ¯å½“æˆ‘ä»¬è¦å°†ä¸€ä¸ªæ–°å…ƒç´ æ·»åŠ åˆ°æ•´æ•°é›†åˆé‡Œé¢,å¹¶ä¸”æ–°å…ƒç´ çš„ç±»å‹æ¯”æ•´æ•°é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹éƒ½è¦é•¿æ—¶,æ•´æ•°é›†åˆéœ€è¦å…ˆè¿›è¡Œå‡çº§(upgrade),ç„¶åæ‰èƒ½å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•´æ•°é›†åˆé‡Œé¢ã€‚</p><p>å‡çº§æ•´æ•°é›†åˆå¹¶æ·»åŠ æ–°å…ƒç´ å…±åˆ†ä¸ºä¸‰æ­¥è¿›è¡Œ:</p><ol><li>æ ¹æ®æ–°å…ƒç´ çš„ç±»å‹,æ‰©å±•æ•´æ•°é›†åˆåº•å±‚æ•°ç»„çš„ç©ºé—´å¤§å°,å¹¶ä¸ºæ–°å…ƒç´ åˆ†é…ç©ºé—´ã€‚</li><li>å°†åº•å±‚æ•°ç»„ç°æœ‰çš„æ‰€æœ‰å…ƒç´ éƒ½è½¬æ¢æˆä¸æ–°å…ƒç´ ç›¸åŒçš„ç±»å‹,å¹¶å°†ç±»å‹è½¬æ¢åçš„å…ƒç´ æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ä¸Š,è€Œä¸”åœ¨æ”¾ç½®å…ƒç´ çš„è¿‡ç¨‹ä¸­,éœ€è¦ç»§ç»­ç»´æŒåº•å±‚æ•°ç»„çš„æœ‰åºæ€§è´¨ä¸å˜ã€‚</li><li>å°†æ–°å…ƒç´ æ·»åŠ åˆ°åº•å±‚æ•°ç»„é‡Œé¢ã€‚</li></ol><p>ç›¸è¾ƒäºæ•°ç»„ï¼Œintsetæœ‰è‡ªåŠ¨å‡çº§å’Œæœ‰åºæ’åˆ—çš„ä¼˜åŠ¿ï¼Œèƒ½èŠ‚çº¦ç©ºé—´å’ŒåŠ å¿«æŸ¥æ‰¾ã€‚</p><ul><li><strong>é™çº§</strong></li></ul><p>intsetä¸æ”¯æŒé™çº§æ“ä½œã€‚</p><h2 id="å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰"><a href="#å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰" class="headerlink" title="å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰"></a>å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰</h2><h3 id="ziplistå®ç°"><a href="#ziplistå®ç°" class="headerlink" title="ziplistå®ç°"></a>ziplistå®ç°</h3><p>å‹ç¼©åˆ—è¡¨æ˜¯ Redis ä¸ºäº†<strong>èŠ‚çº¦å†…å­˜</strong>è€Œå¼€å‘çš„,æ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹(sequential)æ•°æ®ç»“æ„ã€‚ä¸€ä¸ªå‹ç¼©åˆ—è¡¨å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹(entry),æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ª<strong>å­—èŠ‚æ•°ç»„</strong>æˆ–è€…ä¸€ä¸ª<strong>æ•´æ•°å€¼</strong>ã€‚</p><p>ä¸€ä¸ªziplistçš„æ„æˆå¦‚ä¸‹å›¾ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ziplistEx.png" alt="å‹ç¼©åˆ—è¡¨"></p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ziplistNt.png" alt="å„ä¸ªç»„æˆè¯´æ˜"></p><p>ä¸€ä¸ªentryçš„æ„æˆå¦‚ä¸‹å›¾ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ziplistEntry.png" alt="ziplistä¸­çš„èŠ‚ç‚¹"></p><ul><li><strong>previous_entry_length</strong></li></ul><p>èŠ‚ç‚¹çš„ previous_entry_length å±æ€§ä»¥å­—èŠ‚ä¸ºå•ä½,è®°å½•äº†å‹ç¼©åˆ—è¡¨ä¸­<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹</strong>çš„é•¿åº¦ã€‚previous entry length å±æ€§çš„é•¿åº¦å¯ä»¥æ˜¯1å­—èŠ‚æˆ–è€…5å­—èŠ‚ã€‚</p><ol><li>å°äº254ä¸ªå­—èŠ‚ï¼Œprevious_entry_lengthé•¿åº¦ä¸º1å­—èŠ‚ã€‚</li><li>å¤§äºç­‰äº254ä¸ªå­—èŠ‚ï¼Œprevious_entry_lengthæœ€é«˜ä½å­—èŠ‚ä¸º0xFEï¼Œå‰©ä¸‹å››ä½å­—èŠ‚è®°å½•é•¿åº¦ï¼ˆæœ€å¤š2^32-1ï¼Œ4Gï¼‰ã€‚</li></ol><ul><li><strong>encoding</strong></li></ul><p>èŠ‚ç‚¹çš„encodingå±æ€§è®°å½•äº†èŠ‚ç‚¹çš„contentå±æ€§æ‰€ä¿å­˜æ•°æ®çš„ç±»å‹ä»¥åŠé•¿åº¦ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ziplistEncode.png" alt="encodingè¯´æ˜"></p><ul><li><strong>content</strong></li></ul><p>èŠ‚ç‚¹çš„contentå±æ€§è´Ÿè´£ä¿å­˜èŠ‚ç‚¹çš„å€¼,èŠ‚ç‚¹å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…æ•´æ•°,å€¼çš„ç±»å‹å’Œé•¿åº¦ç”±èŠ‚ç‚¹çš„encodingå±æ€§å†³å®šã€‚</p><h3 id="ziplistç‰¹æ€§"><a href="#ziplistç‰¹æ€§" class="headerlink" title="ziplistç‰¹æ€§"></a>ziplistç‰¹æ€§</h3><ul><li><strong>è¿é”æ›´æ–°</strong></li></ul><p>ç”±äºå•ä¸ªentryä¸­<strong>previous_entry_length</strong>æœ‰1å­—èŠ‚å’Œ5å­—èŠ‚ä¸¤æ¬¡é•¿åº¦ï¼Œæ‰€ä»¥ç”±æŸä¸ªèŠ‚ç‚¹<strong>previous_entry_length</strong>æ”¹å˜å¯¼è‡´çš„å…¶ä»–å¤šä¸ªèŠ‚ç‚¹çš„<strong>previous_entry_length</strong>æ”¹å˜çš„ç°è±¡ï¼Œè¢«ç§°ä¸ºè¿é”æ›´æ–°ã€‚<br>è¿é”æ›´æ–°åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦å¯¹å‹ç¼©åˆ—è¡¨æ‰§è¡ŒNæ¬¡ç©ºé—´é‡åˆ†é…æ“ä½œ,è€Œæ¯æ¬¡ç©ºé—´é‡åˆ†é…çš„æœ€åå¤æ‚åº¦ä¸º$O(N)$,æ‰€ä»¥è¿é”æ›´æ–°çš„æœ€åå¤æ‚åº¦ä¸º$O(N^2)$ã€‚</p><h3 id="listpack"><a href="#listpack" class="headerlink" title="listpack"></a>listpack</h3><p>ç”±äºziplistå­˜åœ¨è¿é”æ›´æ–°ç­‰ä¸€äº›å…¶ä»–ç¼ºç‚¹ï¼Œåœ¨redis 3åé€æ­¥è¢«listpackå–ä»£ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/listpack.png" alt="listpackç»“æ„"></p><ul><li>totalbytesï¼šlistpack å ç”¨çš„å­—èŠ‚æ•°ï¼Œ4 å­—èŠ‚</li><li>sizeï¼šlistpack èŠ‚ç‚¹æ•°é‡ï¼Œ2 å­—èŠ‚</li><li>elementï¼šèŠ‚ç‚¹å…ƒç´ </li><li>endï¼šç»“å°¾ç¬¦ 0xFF 1 å­—èŠ‚</li></ul><p>ç”±äºlistpackåªè®°å½•è‡ªèº«èŠ‚ç‚¹çš„é•¿åº¦ï¼Œæ‰€ä»¥èŠ‚ç‚¹ä¹‹é—´ç‹¬ç«‹ä¸ä¼šäº’ç›¸å½±å“ã€‚</p><h3 id="quicklist"><a href="#quicklist" class="headerlink" title="quicklist"></a>quicklist</h3><p>quicklistæ˜¯listpackä¸åŒå‘é“¾è¡¨çš„æ··åˆä½“ï¼Œå…¼é¡¾èŠ‚çœå†…å­˜å’Œæ’å…¥æ•ˆç‡ã€‚</p><h2 id="è·³è¡¨ï¼ˆskiplistï¼‰"><a href="#è·³è¡¨ï¼ˆskiplistï¼‰" class="headerlink" title="è·³è¡¨ï¼ˆskiplistï¼‰"></a>è·³è¡¨ï¼ˆskiplistï¼‰</h2><p>skiplistæ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆè¾¾åˆ°å¿«é€Ÿè®¿é—®å…¶ä»–èŠ‚ç‚¹çš„ç›®çš„ã€‚<strong>å…¶æ”¯æŒå¹³å‡$O(log(N))$,æœ€å$O(N)$å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾</strong>ã€‚</p><h3 id="skiplistå®ç°"><a href="#skiplistå®ç°" class="headerlink" title="skiplistå®ç°"></a>skiplistå®ç°</h3><p>skiplistç”±<strong>zskiplist</strong>ç»“æ„å’Œ<strong>zskiplistNode</strong>ç»“æ„æ¥å®šä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplist</span> &#123;<br>    <span class="hljs-comment">// æŒ‡å‘è·³è¡¨çš„è¡¨å¤´å’Œè¡¨å°¾èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplistNode</span> *header, *tail;<br>    <span class="hljs-comment">// è®°å½•è·³è¡¨çš„é•¿åº¦ï¼Œå³è¡¨çš„æ€»èŠ‚ç‚¹æ•°</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> length;<br>    <span class="hljs-comment">// è®°å½•èŠ‚ç‚¹ï¼ˆè¡¨å¤´é™¤å¤–ï¼‰æœ€å¤§çš„å±‚æ•°</span><br>    <span class="hljs-type">int</span> level;<br>&#125; zskiplist;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplistNode</span> &#123;<br>    <span class="hljs-comment">// æˆå‘˜å±æ€§ï¼ˆä¹¦ä¸­ä¸º robj *objï¼‰</span><br>    sds ele;<br>    <span class="hljs-comment">// è·³è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‰æ­¤åˆ†å€¼æ’åˆ—</span><br>    <span class="hljs-type">double</span> score;<br>    <span class="hljs-comment">// èŠ‚ç‚¹åé€€æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplistNode</span> *backward;<br>    <span class="hljs-comment">// å±‚æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplistLevel</span> &#123;<br>        <span class="hljs-comment">// æŒ‡å‘å…¶ä»–èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">zskiplistNode</span> *forward;<br>        <span class="hljs-comment">// è·¨åº¦ï¼Œè®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»</span><br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> span;<br>    &#125; level[];<br>&#125; zskiplistNode;<br></code></pre></td></tr></table></figure><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/skiplist.png" alt="è·³è¡¨ç»“æ„"></p><p>å„ä¸ªè·³è¡¨èŠ‚ç‚¹çš„æœ€åº•å±‚æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœ‰åºé“¾è¡¨ï¼Œæ¯å¾€ä¸Šä¸€å±‚ï¼Œéƒ½ä¼š<strong>è·³è¿‡</strong>ä¸€äº›èŠ‚ç‚¹ï¼Œå½¢æˆâ€œ<strong>å¿«æ·é€šé“</strong>â€ã€‚</p><h2 id="å¯¹è±¡ï¼ˆredisObjectï¼‰"><a href="#å¯¹è±¡ï¼ˆredisObjectï¼‰" class="headerlink" title="å¯¹è±¡ï¼ˆredisObjectï¼‰"></a>å¯¹è±¡ï¼ˆredisObjectï¼‰</h2><p>rediså¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ä»¥ä¸Šæåˆ°çš„æ•°æ®ç»“æ„å®ç°é”®å€¼å¯¹æ•°æ®åº“ï¼Œè€Œæ˜¯åŸºäºå…¶æ„å»ºäº†ä¸€ä¸ªå¯¹è±¡ç³»ç»Ÿã€‚</p><h3 id="å¯¹è±¡çš„ç¼–ç å’Œç±»å‹"><a href="#å¯¹è±¡çš„ç¼–ç å’Œç±»å‹" class="headerlink" title="å¯¹è±¡çš„ç¼–ç å’Œç±»å‹"></a>å¯¹è±¡çš„ç¼–ç å’Œç±»å‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">redisObject</span> &#123;<br>    <span class="hljs-comment">// å¯¹è±¡ç±»å‹</span><br>    <span class="hljs-type">unsigned</span> type:<span class="hljs-number">4</span>;<br>    <span class="hljs-comment">// å¯¹è±¡ç¼–ç </span><br>    <span class="hljs-type">unsigned</span> encoding:<span class="hljs-number">4</span>;<br>    <span class="hljs-comment">// è®°å½•å¯¹è±¡æœ€åä¸€æ¬¡çš„å‘½ä»¤æ—¶é—´ï¼Œç”¨äºå¾—åˆ°ç©ºè½¬æ—¶é•¿</span><br>    <span class="hljs-type">unsigned</span> lru:LRU_BITS; <span class="hljs-comment">/* LRU time (relative to global lru_clock) or</span><br><span class="hljs-comment">                            * LFU data (least significant 8 bits frequency</span><br><span class="hljs-comment">                            * and most significant 16 bits access time). */</span><br>    <span class="hljs-comment">// å¼•ç”¨è®¡æ•°ï¼Œç”¨äºè‡ªåŠ¨å›æ”¶å†…å­˜</span><br>    <span class="hljs-type">int</span> refcount;<br>    <span class="hljs-comment">// æŒ‡å‘å¯¹è±¡çš„åº•å±‚å®ç°æ•°æ®ç»“æ„</span><br>    <span class="hljs-type">void</span> *ptr;<br>&#125; robj;<br></code></pre></td></tr></table></figure><h4 id="ç±»å‹-type"><a href="#ç±»å‹-type" class="headerlink" title="ç±»å‹-type"></a>ç±»å‹-type</h4><p>redisçš„å¯¹è±¡æœ‰ä»¥ä¸‹äº”ç§ç±»å‹ï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/objectType.png" alt="å¯¹è±¡çš„ç±»å‹"></p><h4 id="ç¼–ç -encoding"><a href="#ç¼–ç -encoding" class="headerlink" title="ç¼–ç -encoding"></a>ç¼–ç -encoding</h4><p>ä»¥ä¸‹ä¸ºä¸åŒç±»å‹çš„å¯¹è±¡ä»¥åŠä»–ä»¬ä¼šé‡‡ç”¨çš„ç¼–ç æ–¹å¼ï¼š</p><table><thead><tr><th>å¯¹è±¡ç±»å‹</th><th>ç¼–ç æ–¹å¼</th><th>æ˜¯å¦é»˜è®¤ &#x2F; ç‰¹æ®Šæƒ…å†µ</th></tr></thead><tbody><tr><td>String</td><td>embstr &#x2F; raw &#x2F; int</td><td>embstr æ˜¯çŸ­å­—ç¬¦ä¸²ä¼˜åŒ–ï¼›int ä¸ºæ•´æ•°</td></tr><tr><td>List</td><td>quicklist</td><td>Redis 3.2+ é»˜è®¤</td></tr><tr><td>Set</td><td>intset &#x2F; hashtable</td><td>å°æ•´æ•°é›†åˆ â†’ intset</td></tr><tr><td>Hash</td><td>listpack &#x2F; hashtable</td><td>å°å‹å“ˆå¸Œ â†’ listpack</td></tr><tr><td>ZSet</td><td>listpack &#x2F; skiplist</td><td>å¤§å‹é›†åˆæˆ–èŒƒå›´æŸ¥è¯¢ â†’ skiplist</td></tr></tbody></table><p>é€šè¿‡encodingå±æ€§æ¥è®¾å®šå¯¹è±¡çš„åº•å±‚ç¼–ç ï¼Œè€Œä¸ä¸ºæŸä¸€ç±»å‹å¯¹è±¡ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ç¼–ç ï¼Œä½¿å¾—redisèƒ½åœ¨ç‰¹å®šæƒ…å†µä¸‹è®¾ç½®encodingæ¥æé«˜è¯¥æƒ…æ™¯ä¸­çš„redisæ€§èƒ½ã€‚</p><h3 id="å­—ç¬¦ä¸²å¯¹è±¡"><a href="#å­—ç¬¦ä¸²å¯¹è±¡" class="headerlink" title="å­—ç¬¦ä¸²å¯¹è±¡"></a>å­—ç¬¦ä¸²å¯¹è±¡</h3><p>å­—ç¬¦ä¸²å¯¹è±¡åº•å±‚é‡‡ç”¨çš„ç¼–ç ä¸€èˆ¬ä¸º<strong>embstr</strong>å’Œ<strong>raw</strong>ï¼Œå…¶å®è¿™ä¸¤ç§ç¼–ç çš„å®ç°æ–¹å¼åŸç†éƒ½æ˜¯<strong>SDS</strong>ã€‚ä½†æ˜¯ï¼Œembstræ›´é€‚åˆäºçŸ­å­—ç¬¦ä¸²ï¼Œrawåˆ™ç”¨äºé•¿å­—ç¬¦ä¸²ã€‚è€Œä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯ä¸€ä¸ªæ•´æ•°å€¼æ—¶ï¼Œptrç±»å‹å˜ä¸ºlongï¼Œç¼–ç æ–¹å¼ä¸º<strong>int</strong>ã€‚<br>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><strong>embstr</strong></li></ul><ol><li>ä¸€æ¬¡æ€§åˆ†é…å†…å­˜ï¼Œä¸€æ¬¡æ€§é‡Šæ”¾å†…å­˜ã€‚</li><li>å¯¹è±¡å¤´å’ŒSDSå­—ç¬¦ä¸²åœ¨åŒä¸€å—å†…å­˜ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs å†…å­˜ç»“æ„">[ robj | sdsç»“æ„ | å­—ç¬¦ä¸²å†…å®¹ ]<br> â†‘å…¨åœ¨ä¸€å— malloc å†…å­˜ä¸­<br></code></pre></td></tr></table></figure><ul><li><strong>raw</strong></li></ul><ol><li>ä¸¤æ¬¡åˆ†é…å†…å­˜ï¼Œä¸¤æ¬¡é‡Šæ”¾å†…å­˜ã€‚</li><li>å¯¹è±¡å¤´å’ŒSDSå­—ç¬¦ä¸²åˆ†å¼€ï¼Œä¸¤ä¸ªæŒ‡é’ˆå†…å­˜ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs å†…å­˜ç»“æ„">[ robj ]     -&gt;     [ sdsç»“æ„ | å­—ç¬¦ä¸²å†…å®¹ ]<br>ï¼ˆåˆ†å¼€ malloc ä¸¤å—å†…å­˜ï¼‰<br></code></pre></td></tr></table></figure><h3 id="åˆ—è¡¨å¯¹è±¡"><a href="#åˆ—è¡¨å¯¹è±¡" class="headerlink" title="åˆ—è¡¨å¯¹è±¡"></a>åˆ—è¡¨å¯¹è±¡</h3><p>ä» Redis 3.2 å¼€å§‹ï¼Œåˆ—è¡¨å¯¹è±¡çš„åº•å±‚ç»Ÿä¸€ä½¿ç”¨<strong>quicklist</strong>ç¼–ç ï¼Œå–ä»£äº†è€ç‰ˆæœ¬çš„ziplistå’Œlinkedlistã€‚</p><blockquote><p>quicklist &#x3D; å¤šä¸ª<strong>ziplist</strong>èŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨ç»“æ„</p></blockquote><p>å®ƒç»“åˆäº† ziplistï¼ˆç´§å‡‘ã€è¿ç»­ï¼‰å’Œ linkedlistï¼ˆå¿«é€Ÿæ’å…¥&#x2F;åˆ é™¤ï¼‰çš„ä¼˜ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs quicklist">[ziplist1] &lt;-&gt; [ziplist2] &lt;-&gt; [ziplist3] ...<br></code></pre></td></tr></table></figure><h3 id="å“ˆå¸Œå¯¹è±¡"><a href="#å“ˆå¸Œå¯¹è±¡" class="headerlink" title="å“ˆå¸Œå¯¹è±¡"></a>å“ˆå¸Œå¯¹è±¡</h3><p>å“ˆå¸Œå¯¹è±¡çš„ç¼–ç æ–¹å¼ä¸º<strong>listpack</strong>æˆ–è€…<strong>hashtable</strong>ï¼Œlistpackç”¨äºå°å‹å“ˆå¸Œè¡¨ï¼Œè€Œhashtableåˆ™ç”¨äºå¤§å‹å“ˆå¸Œè¡¨ã€‚</p><p>listpackç¼–ç å®ç°çš„å“ˆå¸Œå¯¹è±¡åŸç†ä¸ziplistç¼–ç ç›¸åŒã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/hashByziplist.png" alt="ziplistç¼–ç çš„å“ˆå¸Œå¯¹è±¡"></p><p>æ·»åŠ é¡ºåºå¦‚ä¸‹ï¼š</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/hashByziplist2.png" alt="ziplistç¼–ç çš„å“ˆå¸Œå¯¹è±¡çš„åº•å±‚å®ç°"></p><p>hashtableç¼–ç åº•å±‚ä½¿ç”¨å­—å…¸å®ç°å“ˆå¸Œå¯¹è±¡ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/hashBydict.png" alt="hashtableç¼–ç çš„å“ˆå¸Œå¯¹è±¡"></p><h3 id="é›†åˆå¯¹è±¡"><a href="#é›†åˆå¯¹è±¡" class="headerlink" title="é›†åˆå¯¹è±¡"></a>é›†åˆå¯¹è±¡</h3><p>é›†åˆå¯¹è±¡å¯ä»¥ä½¿ç”¨<strong>intset</strong>æˆ–<strong>hashtable</strong>ç¼–ç å®ç°ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/set.png" alt="ä¸¤ç§ç¼–ç çš„é›†åˆå¯¹è±¡"></p><h3 id="æœ‰åºé›†åˆå¯¹è±¡"><a href="#æœ‰åºé›†åˆå¯¹è±¡" class="headerlink" title="æœ‰åºé›†åˆå¯¹è±¡"></a>æœ‰åºé›†åˆå¯¹è±¡</h3><p>æœ‰åºé›†åˆå¯¹è±¡ç¼–ç å¯ä»¥æ˜¯<strong>listpack</strong>æˆ–<strong>skiplist</strong>ã€‚</p><p>listpackç¼–ç çš„æœ‰åºå¯¹è±¡ä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨ç€çš„èŠ‚ç‚¹ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸ºå…ƒç´ æˆå‘˜ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸ºå…ƒç´ åˆ†å€¼ã€‚<strong>å‹ç¼©åˆ—è¡¨å†…çš„å…ƒç´ æŒ‰ç…§åˆ†å€¼ä»å°åˆ°å¤§è¿›è¡Œæ’åˆ—</strong>ã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/zsetByzl.png" alt="ziplistç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡"></p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/zlInzset.png" alt="æœ‰åºé›†åˆä¸­çš„å…ƒç´ "></p><p>skiplistç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡ä¸ºäº†ä¿è¯å„ä¸ªå‘½ä»¤çš„æ“ä½œæ€§èƒ½ä¸ä¸‹é™ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨äº†<strong>å­—å…¸</strong>å’Œ<strong>è·³è¡¨</strong>å…±åŒæ„å»ºã€‚</p><p><img src="/img/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/zsetBysl.png" alt="skiplistç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡"></p>]]></content>
    
    
    <categories>
      
      <category>redisè®¾è®¡ä¸å®ç°è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸Šä¼ æ–‡ç« </title>
    <link href="/2025/06/20/%E4%B8%8A%E4%BC%A0%E6%96%87%E7%AB%A0/"/>
    <url>/2025/06/20/%E4%B8%8A%E4%BC%A0%E6%96%87%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è®°å½•ä¸Šä¼ åšå®¢çš„æ“ä½œæ­¥éª¤â€”â€”â€”â€”ç¬¬ä¸€ç¯‡æ–‡ç« </p></blockquote><h2 id="æœ¬åœ°æ“ä½œ"><a href="#æœ¬åœ°æ“ä½œ" class="headerlink" title="æœ¬åœ°æ“ä½œ"></a>æœ¬åœ°æ“ä½œ</h2><p>åšå®¢ç½‘ç«™æ˜¯å€Ÿç”¨<strong>githubã€hexoã€fluid</strong>æ­å»ºçš„é™æ€ç½‘é¡µï¼Œå…¶ä¸­githubç›¸å½“äºæä¾›æœåŠ¡å™¨æœåŠ¡ï¼ˆgithub pagesï¼‰ï¼Œä½†æ˜¯åªèƒ½å­˜æ”¾é™æ€ç½‘é¡µï¼Œæ‰€ä»¥åšå®¢çš„å‘å¸ƒéœ€è¦ä½œè€…ä»æœ¬åœ°æ›´æ–°æ•´ä¸ªç½‘ç«™å†ä¸Šä¼ åˆ°githubï¼Œå…¶ä»–äººæ‰èƒ½çœ‹åˆ°ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©è¿™å¥—æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä½œè€…ç°åœ¨ä½œä¸ºå­¦ç”Ÿç±³è¿˜æ˜¯ä¸å¤Ÿå¤šğŸ¤£ï¼Œå†è€…è¯¥æ–¹æ¡ˆä½œä¸ºç¬”è®°ç³»ç»Ÿå·²ç»è¶³å¤Ÿæ»¡è¶³æˆ‘çš„éœ€æ±‚äº†ğŸ˜Šã€‚</p><p>æ‰€ä»¥æœ¬åœ°æ“ä½œåŸºäº<strong>hexo</strong>åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç½‘é¡µï¼Œç½‘é¡µè¯­è¨€ä½¿ç”¨markdownå³å¯ã€‚é¦–å…ˆè¿›å…¥ç½‘ç«™å·¥ä½œç›®å½•ï¼Œç»ˆç«¯è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new post æ–‡ç« å<br></code></pre></td></tr></table></figure><p>è¯¥æ“ä½œä¼šåœ¨<code>/source/_posts/</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªmdæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å³å¯ç¼–å†™æ–‡ç« å†…å®¹ã€‚mdæ–‡ä»¶ä¸­çš„å›¾ç‰‡æ’å…¥åˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;img src=<span class="hljs-string">&quot;/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/bpm2.png&quot;</span> alt=<span class="hljs-string">&quot;åˆ†å±‚è®¾è®¡&quot;</span> style=<span class="hljs-string">&quot;display: block; margin: 0 auto; width: 50%; height:50%;&quot;</span>&gt;<br><br>![ç¼“å†²æ± ç®¡ç†](/img/CMU15-445-Bustub-project1å®ç°ç¬”è®°/bpm.png)<br></code></pre></td></tr></table></figure><p>å›¾ç‰‡æ”¾å…¥è¯¥ç›®å½•ä¸‹çš„æ–‡ç« åŒåç›®å½•ä¸‹ã€‚</p><p>å†™å®Œæ–‡ç« åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°æœ¬åœ°çš„é™æ€ç½‘ç«™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo g -d<br><span class="hljs-comment"># ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥é€šè¿‡https://localhost:4000è®¿é—®æœ¬åœ°ç½‘ç«™</span><br>hexo s <br></code></pre></td></tr></table></figure><h2 id="ä¸Šä¼ github"><a href="#ä¸Šä¼ github" class="headerlink" title="ä¸Šä¼ github"></a>ä¸Šä¼ github</h2><p>å¯ä»¥æŠŠæ–‡ä»¶ç›®å½•ç›´æ¥pushåˆ°githubï¼Œä¹Ÿå¯ä»¥å®‰è£…<strong>hexo-deployer-git</strong>è‡ªåŠ¨åŒ–ä¸Šä¼ ã€‚å®‰è£…å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åšå®¢æ“ä½œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
